var e=(e,s,a)=>new Promise((t,r)=>{var l=e=>{try{n(a.next(e))}catch(s){r(s)}},i=e=>{try{n(a.throw(e))}catch(s){r(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,i);n((a=a.apply(e,s)).next())});import{t as s,j as a,S as t,I as r,k as l,C as i,g as n,h as c,ai as o,a as d,W as m,e as h,p as x,q as p,r as u,v as j,n as f,o as g,b as v,P as N,D as y}from"./index-BmUpYGrm.js";import{r as _}from"./vendor-vN6PtkFd.js";import{enhancedRepairHistoryService as b}from"./enhancedRepairHistoryService-DfLNwEz9.js";import{e as w}from"./enhancedMonzaBotService-CP3UVEVb.js";import{S}from"./star-CR_sFOyJ.js";import{P as M}from"./phone-CUmdYfuI.js";import{M as B}from"./mail-BiNlmlXL.js";import{C as A}from"./camera-CKQtJJJ8.js";import{F as P}from"./file-text-bXPYLusF.js";import{f as D}from"./utils-DhcIvS4g.js";import"./charts-XrXYWaKo.js";const q=()=>{const[q,C]=_.useState([]),[F,E]=_.useState(""),[k,z]=_.useState(null),[R,T]=_.useState(!0),[I,V]=_.useState(""),[W,H]=_.useState(!1);_.useEffect(()=>{L()},[]);const L=()=>e(void 0,null,function*(){T(!0);try{C([{id:"1",car_vin:"WVWAA7AJ2DW123456",car_model:"Voyah Free 2024",car_year:2024,car_color:"Pearl White",client_name:"Ahmed Al-Mahmoud",client_phone:"+973 3333 4444",client_email:"ahmed.mahmoud@email.com",client_license_plate:"ABC-123",issue_description:"Battery charging system not working properly, showing error codes related to HV battery management",solution_description:"Replaced faulty BMS (Battery Management System) module and updated software to latest version",repair_steps:["Diagnosed charging system using diagnostic tools","Identified faulty BMS module through error code analysis","Ordered replacement BMS module (Part: DF-BMS-2024-01)","Removed old BMS module following safety protocols","Installed new BMS module and calibrated system","Updated software to version 2.4.1","Performed full system test and quality check"],parts_used:[{part_number:"DF-BMS-2024-01",part_name:"Battery Management System Module",quantity:1,cost:850,supplier:"Dong Feng Parts"},{part_number:"DF-SEAL-88",part_name:"BMS Gasket Seal",quantity:2,cost:25,supplier:"Dong Feng Parts"}],labor_hours:4.5,total_cost:1200,technician_name:"Mohammad Ali",repair_date:"2024-01-15",completion_date:"2024-01-15",photos:["repair_1_before.jpg","repair_1_after.jpg"],before_photos:["bms_before_1.jpg","bms_before_2.jpg"],after_photos:["bms_after_1.jpg","bms_after_2.jpg"],repair_category:"Electrical",difficulty_level:"hard",quality_rating:5,client_satisfaction:5,warranty_period:12,follow_up_required:!1,created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T15:30:00Z"}])}catch(e){s({title:"Error",description:"Failed to load repair history",variant:"destructive"})}finally{T(!1)}}),G=()=>e(void 0,null,function*(){if(F.trim()){T(!0);try{const e=yield b.searchRepairHistory(F);C(e)}catch(e){s({title:"Error",description:"Failed to search repair history",variant:"destructive"})}finally{T(!1)}}else L()}),O=e=>{switch(e){case"easy":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"hard":return"bg-orange-100 text-orange-800";case"expert":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return R?a.jsx("div",{className:"container mx-auto py-6",children:a.jsx("div",{className:"text-center",children:"Loading enhanced repair history..."})}):a.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[a.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Enhanced Repair History"}),a.jsx("p",{className:"text-muted-foreground",children:"Detailed repair records with client information, parts used, and solutions"})]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(t,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),a.jsx(r,{placeholder:"Search by VIN, client name, issue, or solution...",className:"pl-9",value:F,onChange:e=>E(e.target.value),onKeyPress:e=>"Enter"===e.key&&G()})]}),a.jsx(l,{onClick:G,children:"Search"})]}),I&&a.jsxs(i,{className:"bg-blue-50 border-blue-200",children:[a.jsx(n,{children:a.jsxs(c,{className:"flex items-center gap-2",children:[a.jsx(o,{className:"h-5 w-5 text-blue-600"}),"MonzaBot Analysis"]})}),a.jsx(d,{children:a.jsx("div",{className:"whitespace-pre-wrap text-sm",children:I})})]}),a.jsx("div",{className:"grid gap-6",children:q.map(t=>{var r,_,b,P,q,C;return a.jsxs(i,{className:"w-full",children:[a.jsx(n,{children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsxs(c,{className:"flex items-center gap-2",children:[a.jsx(m,{className:"h-5 w-5"}),t.car_model," (",t.car_year,")"]}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["VIN: ",t.car_vin]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(h,{className:O(t.difficulty_level),children:t.difficulty_level}),t.quality_rating&&a.jsxs(h,{variant:"outline",className:"flex items-center gap-1",children:[a.jsx(S,{className:"h-3 w-3"}),t.quality_rating,"/5"]})]})]})}),a.jsx(d,{children:a.jsxs(x,{defaultValue:"overview",className:"w-full",children:[a.jsxs(p,{className:"grid w-full grid-cols-4",children:[a.jsx(u,{value:"overview",children:"Overview"}),a.jsx(u,{value:"client",children:"Client"}),a.jsx(u,{value:"parts",children:"Parts"}),a.jsx(u,{value:"solution",children:"Solution"})]}),a.jsxs(j,{value:"overview",className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(f,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("span",{className:"text-sm",children:D(new Date(t.repair_date),"MMM d, yyyy")})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(m,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("span",{className:"text-sm",children:t.technician_name})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(f,{className:"h-4 w-4 text-muted-foreground"}),a.jsxs("span",{className:"text-sm",children:[t.labor_hours,"h"]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"Issue Description"}),a.jsx("p",{className:"text-sm bg-red-50 p-3 rounded border border-red-100",children:t.issue_description})]})]}),a.jsxs(j,{value:"client",className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(g,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("span",{className:"text-sm font-medium",children:t.client_name})]}),t.client_phone&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("span",{className:"text-sm",children:t.client_phone})]}),t.client_email&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(B,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("span",{className:"text-sm",children:t.client_email})]}),t.client_license_plate&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("span",{className:"text-sm",children:t.client_license_plate})]})]}),t.client_satisfaction&&a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"Client Satisfaction"}),a.jsxs("div",{className:"flex items-center gap-2",children:[[...Array(5)].map((e,s)=>a.jsx(S,{className:"h-4 w-4 "+(s<t.client_satisfaction?"text-yellow-400 fill-current":"text-gray-300")},s)),a.jsxs("span",{className:"text-sm",children:["(",t.client_satisfaction,"/5)"]})]})]})]}),a.jsxs(j,{value:"parts",className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[a.jsx(N,{className:"h-4 w-4"}),"Parts Used"]}),a.jsx("div",{className:"space-y-2",children:t.parts_used.map((e,s)=>a.jsx("div",{className:"bg-amber-50 p-3 rounded border border-amber-100",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:e.part_name}),a.jsx("p",{className:"text-sm text-muted-foreground font-mono",children:e.part_number}),e.supplier&&a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Supplier: ",e.supplier]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"text-sm",children:["Qty: ",e.quantity]}),e.cost&&a.jsxs("p",{className:"text-sm flex items-center gap-1",children:[a.jsx(y,{className:"h-3 w-3"}),e.cost]})]})]})},s))})]}),t.total_cost&&a.jsx("div",{className:"bg-green-50 p-3 rounded border border-green-100",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"font-medium",children:"Total Cost"}),a.jsxs("span",{className:"font-bold flex items-center gap-1",children:[a.jsx(y,{className:"h-4 w-4"}),t.total_cost]})]})})]}),a.jsxs(j,{value:"solution",className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"Solution Description"}),a.jsx("p",{className:"text-sm bg-green-50 p-3 rounded border border-green-100",children:t.solution_description})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"Repair Steps"}),a.jsx("ol",{className:"space-y-2",children:t.repair_steps.map((e,s)=>a.jsxs("li",{className:"text-sm flex gap-2",children:[a.jsx("span",{className:"bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-medium",children:s+1}),a.jsx("span",{children:e})]},s))})]}),((null==(r=t.photos)?void 0:r.length)||(null==(_=t.before_photos)?void 0:_.length)||(null==(b=t.after_photos)?void 0:b.length))&&a.jsxs("div",{children:[a.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[a.jsx(A,{className:"h-4 w-4"}),"Photos Available"]}),a.jsxs("div",{className:"flex gap-2",children:[(null==(P=t.before_photos)?void 0:P.length)&&a.jsxs(h,{variant:"outline",children:[t.before_photos.length," Before Photos"]}),(null==(q=t.after_photos)?void 0:q.length)&&a.jsxs(h,{variant:"outline",children:[t.after_photos.length," After Photos"]}),(null==(C=t.photos)?void 0:C.length)&&a.jsxs(h,{variant:"outline",children:[t.photos.length," General Photos"]})]})]}),a.jsx("div",{className:"flex gap-2",children:a.jsxs(l,{variant:"outline",onClick:()=>(a=>e(void 0,null,function*(){try{H(!0),V("");const e=`Tell me about this repair case: ${a.issue_description} on ${a.car_model}`,t=yield w.processEnhancedMessage(e,{source:"repair_inquiry",formType:"repair",extractedData:a});V(t.textResponse),s({title:"MonzaBot Analysis Complete",description:"MonzaBot has analyzed the repair case"})}catch(e){s({title:"Error",description:"Failed to get MonzaBot analysis",variant:"destructive"})}finally{H(!1)}}))(t),disabled:W,className:"flex items-center gap-2",children:[a.jsx(o,{className:"h-4 w-4"}),W?"Analyzing...":"Ask MonzaBot About This Repair"]})})]})]})})]},t.id)})}),0===q.length&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(P,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium",children:"No repair history found"}),a.jsx("p",{className:"text-muted-foreground",children:F?"Try a different search term":"No enhanced repair records available yet"})]})]})};export{q as default};
