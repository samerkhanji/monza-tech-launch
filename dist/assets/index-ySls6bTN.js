const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/enhancedRepairHistoryService-DfLNwEz9.js","assets/index-BmUpYGrm.js","assets/vendor-vN6PtkFd.js","assets/charts-XrXYWaKo.js","assets/utils-DhcIvS4g.js","assets/index-wQIKT8W8.css","assets/enhancedMonzaBotService-CP3UVEVb.js","assets/DatabaseManager-DSqM9OXw.js","assets/Floor1Table-CJw2rxss.js","assets/Floor2Table-BV_QDsVu.js","assets/CarInventoryTable-DhKHS77Q.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,n=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&l(e,t,s[t]);if(a)for(var t of a(s))i.call(s,t)&&l(e,t,s[t]);return e},o=(e,a)=>s(e,t(a)),c=(e,s,t)=>new Promise((a,r)=>{var i=e=>{try{n(t.next(e))}catch(s){r(s)}},l=e=>{try{n(t.throw(e))}catch(s){r(s)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,l);n((t=t.apply(e,s)).next())});import{a8 as d,l as m,a1 as u,s as h,j as x,k as p,y as v,z as j,E as g,F as f,L as N,X as y,I as b,t as w,e as C,H as S,J as k,a7 as D,o as T,m as P,a9 as _,C as I,g as R,h as E,a as M,ak as F,ab as O,al as U,u as A,K as $,n as H,Q as q,w as L,O as V,a6 as W,am as B,an as z,b as G,ao as Y,W as K,a2 as Q,a3 as J,V as Z,Y as X,Z as ee,_ as se,$ as te,a0 as ae}from"./index-BmUpYGrm.js";import{r as re,R as ie}from"./vendor-vN6PtkFd.js";import{f as le,d as ne}from"./utils-DhcIvS4g.js";import{T as oe,a as ce,b as de,c as me,d as ue,e as he}from"./table-BEISn_Te.js";import{u as xe}from"./cameraPermissionManager-D3sOAAEG.js";import"./index-dUlNy-FG.js";import{S as pe}from"./scan-BkADKRli.js";import{C as ve}from"./camera-CKQtJJJ8.js";import{i as je}from"./inventoryService-BaDJwFj-.js";import{W as ge,E as fe}from"./enhancedRepairHistoryManager-DsLnTI82.js";import{P as Ne}from"./pen-line--cRXdmmD.js";import{C as ye,P as be}from"./PdiChecklistDialog-BFpzxMj8.js";import{S as we}from"./star-CR_sFOyJ.js";import{a as Ce}from"./errorHandling-Dc1u_gNS.js";import{E as Se}from"./EnhancedSelect-sAMWtD8W.js";import{P as ke}from"./phone-CUmdYfuI.js";import{S as De}from"./stop-circle-DSXaWKMF.js";import{P as Te}from"./play-B-a94Cc8.js";import{T as Pe}from"./test-tube-BmzcAWFY.js";import{S as _e,H as Ie}from"./sparkles-Bv856xFH.js";import{A as Re}from"./arrow-right-iDmV9z1N.js";import{F as Ee}from"./file-text-bXPYLusF.js";import"./charts-XrXYWaKo.js";import"./PdiChecklistPdf-B4FKiplK.js";import"./checkbox-CbEst83x.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=d("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]),Fe=d("FileImage",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["circle",{cx:"10",cy:"13",r:"2",key:"6v46hv"}],["path",{d:"m20 17-1.09-1.09a2 2 0 0 0-2.82 0L10 22",key:"17vly1"}]]);
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */class Oe{static findCarByVIN(e){return c(this,null,function*(){try{const{data:s,error:t}=yield h.from("showroom_floor1_inventory").select("*").eq("vinNumber",e).single();if(s&&!t)return o(n({},s),{currentFloor:"floor1"});const{data:a,error:r}=yield h.from("showroom_floor2_inventory").select("*").eq("vinNumber",e).single();if(a&&!r)return o(n({},a),{currentFloor:"floor2"});const{data:i,error:l}=yield h.from("garage_inventory").select("*").eq("vinNumber",e).single();return i&&!l?o(n({},i),{currentFloor:"garage"}):null}catch(s){return null}})}static updateCarStatus(e,s){return c(this,null,function*(){try{const t=[],{error:a}=yield h.from("showroom_floor1_inventory").update({status:s}).eq("vinNumber",e);a||t.push("Floor 1");const{error:r}=yield h.from("showroom_floor2_inventory").update({status:s}).eq("vinNumber",e);r||t.push("Floor 2");const{error:i}=yield h.from("garage_inventory").update({status:s}).eq("vinNumber",e);return i||t.push("Garage"),t.length>0}catch(t){return!1}})}static addCarToSchedule(e){return c(this,null,function*(){try{const s={id:`schedule_${Date.now()}`,carCode:e.vinNumber,carModel:e.carModel,customerName:e.customerName||"Customer TBD",priority:e.priority||"medium",estimatedDuration:e.estimatedDuration||"2",workType:e.workType||"mechanic",assignedMechanic:e.assignedMechanic||"Mechanic TBD",notes:e.notes||"Car added via VIN scan",status:"scheduled",testDriveStatus:"not_available",vinNumber:e.vinNumber,brand:e.brand,year:e.year,color:e.color,category:e.category,batteryPercentage:e.batteryPercentage,range:e.range,sellingPrice:e.sellingPrice,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{error:t}=yield h.from("garage_schedule").insert([s]);return!t}catch(s){return!1}})}static getAllCars(){return c(this,null,function*(){try{const e=[],{data:s,error:t}=yield h.from("showroom_floor1_inventory").select("*");s&&!t&&e.push(...s.map(e=>o(n({},e),{currentFloor:"floor1"})));const{data:a,error:r}=yield h.from("showroom_floor2_inventory").select("*");a&&!r&&e.push(...a.map(e=>o(n({},e),{currentFloor:"floor2"})));const{data:i,error:l}=yield h.from("garage_inventory").select("*");return i&&!l&&e.push(...i.map(e=>o(n({},e),{currentFloor:"garage"}))),e}catch(e){return[]}})}static moveCarToDestination(e,s){return c(this,null,function*(){try{const t=yield this.findCarByVIN(e);if(!t)return!1;const a=t.currentFloor;if("floor1"===a){const{error:s}=yield h.from("showroom_floor1_inventory").delete().eq("vinNumber",e);if(s)return!1}else if("floor2"===a){const{error:s}=yield h.from("showroom_floor2_inventory").delete().eq("vinNumber",e);if(s)return!1}else if("garage"===a){const{error:s}=yield h.from("garage_inventory").delete().eq("vinNumber",e);if(s)return!1}const r=o(n({},t),{currentFloor:s,updated_at:(new Date).toISOString()});let i;switch(s){case"floor1":const{error:e}=yield h.from("showroom_floor1_inventory").insert([r]);i=e;break;case"floor2":const{error:s}=yield h.from("showroom_floor2_inventory").insert([r]);i=s;break;case"garage":const{error:t}=yield h.from("garage_inventory").insert([r]);i=t;break;case"car_inventory":const{error:a}=yield h.from("showroom_floor1_inventory").insert([r]);i=a;break;default:return!1}return!i}catch(t){return!1}})}}const Ue=/^[A-HJ-NPR-Z0-9]{17}$/i;const Ae=["SHOWROOM_1","SHOWROOM_2","CAR_INVENTORY","GARAGE_INVENTORY","SCHEDULE","ORDERED_CARS"];function $e(e,s){return c(this,null,function*(){try{const t=e.trim().toUpperCase();if(!function(e){return!(!e||"string"!=typeof e)&&Ue.test(e.trim())}(t))throw new Error("Invalid VIN format. Please scan a valid VIN (17 chars, no I/O/Q).");if(!Ae.includes(s))throw new Error(`Invalid scan context: ${s}`);const{data:a,error:r}=yield h.from("car_inventory").update({current_floor:s,updated_at:(new Date).toISOString()}).eq("vin",t).select().single();if(r)throw new Error(r.message);return{ok:!0,vin:t,old_location:(null==a?void 0:a.current_floor)||"Unknown",new_location:s,message:`Car ${t} moved to ${s}`}}catch(t){throw new Error(t instanceof Error?t.message:"Failed to process VIN scan")}})}function He(e){return{SHOWROOM_1:"Floor 1",SHOWROOM_2:"Floor 2",CAR_INVENTORY:"Car Inventory",GARAGE_INVENTORY:"Garage Inventory",SCHEDULE:"Schedule",ORDERED_CARS:"Ordered Cars"}[e]||e}function qe({currentLocation:e,onCarScanned:s,onCarAdded:t,triggerButton:a,className:r=""}){const[i,l]=re.useState(!1),[n,o]=re.useState(""),[d,m]=re.useState(!1),[u,h]=re.useState(!1),{granted:C,requestCamera:S}=xe(),k=t=>c(this,null,function*(){if(t.trim()){m(!0);try{const a=yield $e(t,e);a.ok?(w({title:"Car scanned successfully",description:a.message}),s&&s(t,a),o(""),l(!1)):w({title:"Scan failed",description:a.message||"Failed to process VIN scan",variant:"destructive"})}catch(a){w({title:"Scan failed",description:a instanceof Error?a.message:"An unexpected error occurred",variant:"destructive"})}finally{m(!1)}}else w({title:"No VIN entered",description:"Please enter or scan a VIN number.",variant:"destructive"})}),D=()=>{l(!0),o("")};return x.jsxs(x.Fragment,{children:[a?x.jsx("div",{onClick:D,className:"cursor-pointer",children:a}):x.jsxs(p,{onClick:D,variant:"outline",className:`flex items-center gap-2 ${r}`,children:[x.jsx(pe,{className:"h-4 w-4"}),"Scan VIN"]}),x.jsx(v,{open:i,onOpenChange:l,children:x.jsxs(j,{className:"sm:max-w-md",children:[x.jsx(g,{children:x.jsxs(f,{className:"flex items-center gap-2",children:[x.jsx(pe,{className:"h-5 w-5"}),"VIN Scanner - ",He(e)]})}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[x.jsxs("p",{className:"text-sm text-blue-800",children:[x.jsx("strong",{children:"Scanning for:"})," ",He(e)]}),x.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Cars scanned here will be moved to this location"})]}),u&&x.jsxs("div",{className:"space-y-3",children:[x.jsx(N,{children:"Camera Scanner"}),x.jsxs("div",{className:"relative",children:[x.jsx(ve,{className:"h-32 w-full text-gray-300 bg-gray-100 rounded-lg flex items-center justify-center"}),x.jsx(p,{size:"sm",variant:"outline",className:"absolute top-2 right-2",onClick:()=>h(!1),children:x.jsx(y,{className:"h-4 w-4"})})]}),x.jsx("p",{className:"text-xs text-gray-500",children:"Camera functionality coming soon. For now, please enter VIN manually."})]}),x.jsxs("div",{className:"space-y-3",children:[x.jsx(N,{htmlFor:"vin-input",children:"Enter VIN Manually"}),x.jsxs("form",{onSubmit:e=>{e.preventDefault(),k(n)},className:"flex gap-2",children:[x.jsx(b,{id:"vin-input",value:n,onChange:e=>o(e.target.value.toUpperCase()),placeholder:"Enter 17-character VIN",maxLength:17,className:"font-mono",disabled:d}),x.jsx(p,{type:"submit",disabled:!n.trim()||d,className:"bg-blue-600 hover:bg-blue-700",children:d?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Scanning..."]}):"Scan"})]})]}),x.jsx("div",{className:"flex justify-center",children:x.jsxs(p,{variant:"outline",onClick:()=>h(!u),disabled:!C,className:"flex items-center gap-2",children:[x.jsx(ve,{className:"h-4 w-4"}),u?"Hide Camera":"Use Camera"]})}),!C&&x.jsx("div",{className:"bg-yellow-50 p-3 rounded-lg",children:x.jsxs("p",{className:"text-sm text-yellow-800",children:["Camera permission required for scanning.",x.jsx(p,{variant:"link",className:"p-0 h-auto text-yellow-800 underline",onClick:()=>S(),children:"Click here to enable"})]})})]}),x.jsx("div",{className:"flex justify-end",children:x.jsx(p,{variant:"outline",onClick:()=>{l(!1),o(""),h(!1)},children:"Close"})})]})})]})}class Le{static recordScheduleChange(e,s,t,a,r,i,l,n,o,c){try{const d={id:`schedule-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,carId:e,carCode:s,carModel:t,customerName:a,fromStatus:r,toStatus:i,fromWorkType:null==c?void 0:c.fromWorkType,toWorkType:null==c?void 0:c.toWorkType,timestamp:(new Date).toISOString(),changedBy:l,notes:o||`${n.replace("_"," ")}: ${r} → ${i}`,partsUsed:(null==c?void 0:c.partsUsed)||[],toolsUsed:(null==c?void 0:c.toolsUsed)||[],totalPartsCost:this.calculatePartsCost((null==c?void 0:c.partsUsed)||[]),totalToolsCost:this.calculateToolsCost((null==c?void 0:c.toolsUsed)||[]),workNotes:null==c?void 0:c.workNotes,issueDescription:null==c?void 0:c.issueDescription,estimatedDuration:null==c?void 0:c.estimatedDuration,actualDuration:null==c?void 0:c.actualDuration,priority:(null==c?void 0:c.priority)||"medium",assignedMechanic:null==c?void 0:c.assignedMechanic,location:(null==c?void 0:c.location)||"garage_repair",type:n};this.saveScheduleChange(d),r!==i&&this.recordAsWorkTypeChange(d),this.recordInRepairHistory(d)}catch(d){}}static recordStatusChange(e,s,t,a,r,i,l,n,o){this.recordScheduleChange(e,s,t,a,r,i,l,"status_change",n,o)}static recordWorkTypeChange(e,s,t,a,r,i,l,c,d){this.recordScheduleChange(e,s,t,a,r,i,l,"work_type_change",c,o(n({},d),{fromWorkType:r,toWorkType:i}))}static recordCompletion(e,s,t,a,r,i,l,n){this.recordScheduleChange(e,s,t,a,r,"completed",i,"completion",l,n)}static recordAssignmentChange(e,s,t,a,r,i,l,c,d){this.recordScheduleChange(e,s,t,a,r,i,l,"assignment",c,o(n({},d),{assignedMechanic:i}))}static recordPriorityChange(e,s,t,a,r,i,l,c,d){this.recordScheduleChange(e,s,t,a,r,i,l,"priority_change",c,o(n({},d),{priority:i}))}static saveScheduleChange(e){const s=localStorage.getItem(this.GARAGE_SCHEDULE_HISTORY_KEY),t=s?JSON.parse(s):[];t.unshift(e),localStorage.setItem(this.GARAGE_SCHEDULE_HISTORY_KEY,JSON.stringify(t))}static recordAsWorkTypeChange(e){e.fromStatus!==e.toStatus&&ge.recordWorkTypeChange({id:e.id,carVin:e.carCode,carModel:e.carModel,customerName:e.customerName,fromWorkType:e.fromStatus,toWorkType:e.toStatus,workTypeChange:`${e.fromStatus.replace("_"," ").toUpperCase()} → ${e.toStatus.replace("_"," ").toUpperCase()}`,timestamp:e.timestamp,changedBy:e.changedBy,notes:e.notes,type:"work_type_change",partsUsed:e.partsUsed,partsUsedInStage:e.partsUsed,totalPartsCost:e.totalPartsCost,toolsUsed:e.toolsUsed,toolsUsedInStage:e.toolsUsed,totalToolsCost:e.totalToolsCost,workNotes:e.workNotes,issueDescription:e.issueDescription})}static recordInRepairHistory(e){const s=localStorage.getItem("repairHistory"),t=s?JSON.parse(s):[],a={id:e.id,car_vin:e.carCode,car_model:e.carModel,client_name:e.customerName,issue_description:e.issueDescription||`Status changed from ${e.fromStatus} to ${e.toStatus}`,solution_description:e.notes||`${e.type.replace("_"," ")}: ${e.fromStatus} → ${e.toStatus}`,repair_steps:[`${e.type.replace("_"," ")}: ${e.fromStatus} → ${e.toStatus}`],parts_used:e.partsUsed.map(e=>({part_number:e,part_name:e,quantity:1,cost:0,supplier:"Monza Parts"})),technician_name:e.assignedMechanic||e.changedBy,repair_date:e.timestamp,completion_date:e.timestamp,difficulty_level:"medium",labor_hours:e.actualDuration?parseFloat(e.actualDuration.replace("h","")):0,total_cost:e.totalPartsCost+e.totalToolsCost,quality_rating:5,client_satisfaction:5,photos:[],before_photos:[],after_photos:[],repair_category:e.type,warranty_period:12,follow_up_required:!1,follow_up_notes:"",workTypeTransition:`${e.fromStatus} → ${e.toStatus}`,fromStage:e.fromStatus,toStage:e.toStatus,transitionTimestamp:e.timestamp,partsUsed:e.partsUsed,partsUsedInStage:e.partsUsed,totalPartsCost:e.totalPartsCost,toolsUsed:e.toolsUsed,toolsUsedInStage:e.toolsUsed,totalToolsCost:e.totalToolsCost};t.unshift(a),localStorage.setItem("repairHistory",JSON.stringify(t))}static getScheduleChanges(){try{const e=localStorage.getItem(this.GARAGE_SCHEDULE_HISTORY_KEY);return e?JSON.parse(e):[]}catch(e){return[]}}static getCarScheduleChanges(e){return this.getScheduleChanges().filter(s=>s.carId===e)}static getChangesByType(e){return this.getScheduleChanges().filter(s=>s.type===e)}static getRecentChanges(e=20){return this.getScheduleChanges().slice(0,e)}static calculatePartsCost(e){let s=0;return e.forEach(e=>{e.toLowerCase().includes("engine")?s+=500:e.toLowerCase().includes("transmission")?s+=300:e.toLowerCase().includes("brake")?s+=150:e.toLowerCase().includes("tire")?s+=200:e.toLowerCase().includes("battery")?s+=120:e.toLowerCase().includes("filter")?s+=25:e.toLowerCase().includes("oil")?s+=50:s+=75}),s}static calculateToolsCost(e){let s=0;return e.forEach(e=>{const t="string"==typeof e?e:String(e||"");t&&(t.toLowerCase().includes("diagnostic")?s+=200:t.toLowerCase().includes("lift")?s+=150:t.toLowerCase().includes("wrench")?s+=50:t.toLowerCase().includes("screwdriver")?s+=20:t.toLowerCase().includes("multimeter")?s+=100:s+=30)}),s}static clearScheduleChanges(){localStorage.removeItem(this.GARAGE_SCHEDULE_HISTORY_KEY)}}var Ve;l(Le,"symbol"!=typeof(Ve="GARAGE_SCHEDULE_HISTORY_KEY")?Ve+"":Ve,"garageScheduleHistory");const We=Object.freeze(Object.defineProperty({__proto__:null,GarageScheduleHistoryService:Le},Symbol.toStringTag,{value:"Module"})),Be=({softwareVersion:e,softwareLastUpdated:s,softwareUpdateBy:t,softwareUpdateNotes:a,compact:r=!1,editable:i=!0,onSave:l,carId:n})=>{const[o,c]=re.useState(!1),[d,m]=re.useState(e||""),[u,h]=re.useState(t||""),[v,j]=re.useState(a||""),g=()=>{l&&d.trim()&&(l({softwareVersion:d.trim(),softwareLastUpdated:(new Date).toISOString(),softwareUpdateBy:u.trim()||"System",softwareUpdateNotes:v.trim()}),w({title:"✅ Software Version Updated",description:`Updated to v${d.trim()}`})),c(!1)},f=()=>{m(e||""),h(t||""),j(a||""),c(!1)},P=()=>{i&&c(!0)};return e||o?o?x.jsxs("div",{className:"space-y-3 p-3 border rounded-lg bg-blue-50 min-w-64",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsxs("div",{children:[x.jsx(N,{htmlFor:"software-version",className:"text-xs",children:"Software Version"}),x.jsx(b,{id:"software-version",placeholder:"e.g., 2.1.0",value:d,onChange:e=>m(e.target.value),className:"h-7 text-xs",required:!0})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"update-by",className:"text-xs",children:"Updated By"}),x.jsx(b,{id:"update-by",placeholder:"e.g., IT Technician",value:u,onChange:e=>h(e.target.value),className:"h-7 text-xs"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"update-notes",className:"text-xs",children:"Update Notes"}),x.jsx(S,{id:"update-notes",placeholder:"Notes about this update...",value:v,onChange:e=>j(e.target.value),className:"text-xs",rows:2})]})]}),x.jsxs("div",{className:"flex gap-1",children:[x.jsx(p,{size:"sm",onClick:g,className:"h-6 px-2 text-xs",disabled:!d.trim(),children:x.jsx(k,{className:"w-3 h-3"})}),x.jsx(p,{size:"sm",variant:"outline",onClick:f,className:"h-6 px-2 text-xs",children:x.jsx(y,{className:"w-3 h-3"})})]})]}):r?x.jsxs("div",{className:"flex items-center gap-1 "+(i?"cursor-pointer hover:opacity-80":""),onClick:i?P:void 0,title:i?"Click to edit software version":void 0,children:[x.jsxs(C,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:["v",e]}),i&&x.jsx(Ne,{className:"w-3 h-3 text-gray-400"})]}):x.jsxs("div",{className:"space-y-2 "+(i?"cursor-pointer hover:bg-blue-50 hover:border-blue-200 p-2 rounded border border-transparent transition-colors":""),onClick:i?P:void 0,title:i?"Click to edit software version":void 0,children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsxs(C,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:[x.jsx(D,{className:"w-3 h-3 mr-1"}),"v",e]}),i&&x.jsx(Ne,{className:"w-3 h-3 text-gray-400"})]}),x.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[s&&x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx(ye,{className:"w-3 h-3"}),x.jsxs("span",{children:["Updated: ",(_=s,new Date(_).toLocaleDateString())]})]}),t&&x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx(T,{className:"w-3 h-3"}),x.jsxs("span",{children:["By: ",t]})]}),a&&x.jsxs("div",{className:"text-xs text-gray-500 italic",children:['"',a,'"']})]})]}):x.jsx("div",{className:"text-sm "+(i?"cursor-pointer hover:text-blue-600 hover:underline":""),onClick:i?P:void 0,title:i?"Click to add software version":void 0,children:x.jsx(C,{variant:"secondary",className:"text-xs text-yellow-700 bg-yellow-100 border border-yellow-300 "+(i?"hover:bg-yellow-200 hover:border-yellow-400 cursor-pointer":""),children:i?"Click to add version":"Update Needed"})});var _},ze=({isOpen:e,onClose:s,carDetails:t,onSubmit:a})=>{var r,i,l;const[d,m]=re.useState({solutionDescription:"",repairSteps:[""],partsUsed:[],toolsUsed:[],totalLaborHours:0,totalCost:0,difficultyLevel:"medium",qualityRating:5,clientSatisfaction:5,warrantPeriod:12,followUpRequired:!1,followUpNotes:"",beforePhotos:[],afterPhotos:[],mechanicNotes:"",recommendation:""}),[u,h]=re.useState([]),[k,D]=re.useState([]),[T,A]=re.useState(!1),[$,H]=re.useState("before"),q=re.useRef(null),L=re.useRef(null),V=re.useRef(null);ie.useEffect(()=>{t&&m(e=>{var s;return o(n({},e),{carId:t.id,carCode:t.carCode,carModel:t.carModel,customerName:t.customerName,assignedMechanic:t.assignedMechanic,workType:t.workType,issueDescription:t.issueDescription,toolsUsed:t.toolsUsed||[],totalLaborHours:t.actualDuration?parseFloat(t.actualDuration.replace("h","")):parseFloat(t.estimatedDuration||"0"),partsUsed:(null==(s=t.partsUsed)?void 0:s.map(e=>({partNumber:e,partName:e,quantity:1,cost:0,supplier:"Monza Parts"})))||[]})})},[t]);const W=(e,s)=>{m(t=>o(n({},t),{[e]:s}))},B=(e,s)=>{"before"===s?(h(s=>s.filter((s,t)=>t!==e)),m(s=>{var t;return o(n({},s),{beforePhotos:(null==(t=s.beforePhotos)?void 0:t.filter((s,t)=>t!==e))||[]})})):(D(s=>s.filter((s,t)=>t!==e)),m(s=>{var t;return o(n({},s),{afterPhotos:(null==(t=s.afterPhotos)?void 0:t.filter((s,t)=>t!==e))||[]})}))},z=e=>c(void 0,null,function*(){H(e),A(!0);try{const e=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});L.current&&(L.current.srcObject=e)}catch(s){w({title:"Camera Error",description:"Unable to access camera",variant:"destructive"}),A(!1)}}),G=()=>{var e;if(null==(e=L.current)?void 0:e.srcObject){L.current.srcObject.getTracks().forEach(e=>e.stop())}A(!1)};return t?x.jsxs(x.Fragment,{children:[x.jsx(v,{open:e,onOpenChange:s,children:x.jsxs(j,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[x.jsxs(g,{children:[x.jsxs(f,{className:"flex items-center gap-2",children:[x.jsx(P,{className:"h-5 w-5 text-green-600"}),"Complete Repair - Submit to History"]}),x.jsxs(_,{children:["Provide detailed information about the completed repair for ",t.carModel," (",t.carCode,")"]})]}),x.jsxs("div",{className:"space-y-6",children:[x.jsxs(I,{children:[x.jsx(R,{children:x.jsx(E,{className:"text-sm",children:"Repair Summary"})}),x.jsx(M,{className:"space-y-2",children:x.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Car:"}),x.jsxs("span",{children:[t.carModel," (",t.carCode,")"]})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Customer:"}),x.jsx("span",{children:t.customerName})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Mechanic:"}),x.jsx("span",{children:t.assignedMechanic})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Work Type:"}),x.jsx(C,{variant:"outline",children:t.workType.replace("_"," ")})]})]})})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx(N,{children:"Original Issue Description"}),x.jsx("div",{className:"p-3 bg-gray-50 rounded-md border text-sm",children:t.issueDescription||"No issue description provided"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"solution",children:"Solution Description *"}),x.jsx(S,{id:"solution",placeholder:"Describe how the issue was resolved...",value:d.solutionDescription,onChange:e=>W("solutionDescription",e.target.value),rows:4,className:"mt-1"})]})]}),x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx(N,{children:"Repair Steps Performed *"}),x.jsx(p,{size:"sm",variant:"outline",onClick:()=>{m(e=>o(n({},e),{repairSteps:[...e.repairSteps||[],""]}))},children:"Add Step"})]}),x.jsx("div",{className:"space-y-2",children:(null==(r=d.repairSteps)?void 0:r.map((e,s)=>x.jsxs("div",{className:"flex gap-2",children:[x.jsx(b,{placeholder:`Step ${s+1}...`,value:e,onChange:e=>((e,s)=>{m(t=>{var a;return o(n({},t),{repairSteps:(null==(a=t.repairSteps)?void 0:a.map((t,a)=>a===e?s:t))||[]})})})(s,e.target.value),className:"flex-1"}),d.repairSteps&&d.repairSteps.length>1&&x.jsx(p,{size:"sm",variant:"outline",onClick:()=>(e=>{m(s=>{var t;return o(n({},s),{repairSteps:(null==(t=s.repairSteps)?void 0:t.filter((s,t)=>t!==e))||[]})})})(s),children:x.jsx(y,{className:"h-4 w-4"})})]},s)))||[]})]}),x.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[x.jsxs("div",{children:[x.jsx(N,{htmlFor:"difficulty",children:"Difficulty Level"}),x.jsxs("select",{id:"difficulty",value:d.difficultyLevel,onChange:e=>W("difficultyLevel",e.target.value),className:"w-full h-10 px-3 border border-gray-300 rounded-md bg-white mt-1",children:[x.jsx("option",{value:"easy",children:"Easy"}),x.jsx("option",{value:"medium",children:"Medium"}),x.jsx("option",{value:"hard",children:"Hard"}),x.jsx("option",{value:"expert",children:"Expert"})]})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"quality",children:"Quality Rating"}),x.jsx("div",{className:"flex items-center gap-1 mt-1",children:[1,2,3,4,5].map(e=>x.jsx(we,{className:"h-5 w-5 cursor-pointer "+(e<=(d.qualityRating||0)?"text-yellow-400 fill-current":"text-gray-300"),onClick:()=>W("qualityRating",e)},e))})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"satisfaction",children:"Client Satisfaction"}),x.jsx("div",{className:"flex items-center gap-1 mt-1",children:[1,2,3,4,5].map(e=>x.jsx(we,{className:"h-5 w-5 cursor-pointer "+(e<=(d.clientSatisfaction||0)?"text-green-400 fill-current":"text-gray-300"),onClick:()=>W("clientSatisfaction",e)},e))})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"warranty",children:"Warranty (months)"}),x.jsx(b,{id:"warranty",type:"number",min:"1",max:"60",value:d.warrantPeriod,onChange:e=>W("warrantPeriod",parseInt(e.target.value)),className:"mt-1"})]})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx(N,{htmlFor:"laborHours",children:"Total Labor Hours"}),x.jsx(b,{id:"laborHours",type:"number",step:"0.5",min:"0",value:d.totalLaborHours,onChange:e=>W("totalLaborHours",parseFloat(e.target.value)),className:"mt-1"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"totalCost",children:"Total Cost (AED)"}),x.jsx(b,{id:"totalCost",type:"number",step:"0.01",min:"0",value:d.totalCost,onChange:e=>W("totalCost",parseFloat(e.target.value)),className:"mt-1"})]})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsx(N,{className:"text-base font-semibold",children:"Photo Documentation"}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx(N,{className:"text-sm",children:"Before Photos (Optional)"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsxs(p,{size:"sm",variant:"outline",onClick:()=>z("before"),children:[x.jsx(ve,{className:"h-4 w-4 mr-1"}),"Camera"]}),x.jsxs(p,{size:"sm",variant:"outline",onClick:()=>{var e;return null==(e=q.current)?void 0:e.click()},children:[x.jsx(F,{className:"h-4 w-4 mr-1"}),"Upload"]})]})]}),x.jsx("input",{ref:q,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:e=>(e=>{if(!e)return;const s=Array.from(e),t=s.filter(e=>e.type.startsWith("image/"));t.length===s.length?(h(e=>[...e,...t]),t.forEach(e=>{const s=new FileReader;s.onload=e=>{var s;const t=null==(s=e.target)?void 0:s.result;m(e=>o(n({},e),{beforePhotos:[...e.beforePhotos||[],t]}))},s.readAsDataURL(e)})):w({title:"Invalid Files",description:"Only image files are allowed",variant:"destructive"})})(e.target.files)}),x.jsxs("div",{className:"grid grid-cols-2 gap-2 min-h-[120px] border-2 border-dashed border-gray-300 rounded-lg p-2",children:[null==(i=d.beforePhotos)?void 0:i.map((e,s)=>x.jsxs("div",{className:"relative group",children:[x.jsx("img",{src:e,alt:`Before ${s+1}`,className:"w-full h-20 object-cover rounded border"}),x.jsx(p,{size:"sm",variant:"destructive",className:"absolute top-1 right-1 h-6 w-6 p-0 opacity-0 group-hover:opacity-100",onClick:()=>B(s,"before"),children:x.jsx(y,{className:"h-3 w-3"})})]},s)),(!d.beforePhotos||0===d.beforePhotos.length)&&x.jsxs("div",{className:"col-span-2 flex items-center justify-center text-gray-500 text-sm",children:[x.jsx(Fe,{className:"h-8 w-8 mr-2"}),"No before photos added"]})]})]}),x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx(N,{className:"text-sm",children:"After Photos (Optional)"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsxs(p,{size:"sm",variant:"outline",onClick:()=>z("after"),children:[x.jsx(ve,{className:"h-4 w-4 mr-1"}),"Camera"]}),x.jsxs(p,{size:"sm",variant:"outline",onClick:()=>{var e;return null==(e=q.current)?void 0:e.click()},children:[x.jsx(F,{className:"h-4 w-4 mr-1"}),"Upload"]})]})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-2 min-h-[120px] border-2 border-dashed border-gray-300 rounded-lg p-2",children:[null==(l=d.afterPhotos)?void 0:l.map((e,s)=>x.jsxs("div",{className:"relative group",children:[x.jsx("img",{src:e,alt:`After ${s+1}`,className:"w-full h-20 object-cover rounded border"}),x.jsx(p,{size:"sm",variant:"destructive",className:"absolute top-1 right-1 h-6 w-6 p-0 opacity-0 group-hover:opacity-100",onClick:()=>B(s,"after"),children:x.jsx(y,{className:"h-3 w-3"})})]},s)),(!d.afterPhotos||0===d.afterPhotos.length)&&x.jsxs("div",{className:"col-span-2 flex items-center justify-center text-gray-500 text-sm",children:[x.jsx(Fe,{className:"h-8 w-8 mr-2"}),"No after photos added"]})]})]})]})]}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("input",{type:"checkbox",id:"followUp",checked:d.followUpRequired,onChange:e=>W("followUpRequired",e.target.checked)}),x.jsx(N,{htmlFor:"followUp",children:"Follow-up Required"})]}),d.followUpRequired&&x.jsx(S,{placeholder:"Follow-up notes and instructions...",value:d.followUpNotes,onChange:e=>W("followUpNotes",e.target.value),rows:2})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"mechanicNotes",children:"Mechanic Notes & Details *"}),x.jsx(S,{id:"mechanicNotes",placeholder:"Additional notes, observations, or recommendations...",value:d.mechanicNotes,onChange:e=>W("mechanicNotes",e.target.value),rows:3,className:"mt-1"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"recommendations",children:"Recommendations for Customer"}),x.jsx(S,{id:"recommendations",placeholder:"Future maintenance recommendations, warnings, or advice...",value:d.recommendation,onChange:e=>W("recommendation",e.target.value),rows:2,className:"mt-1"})]})]}),x.jsxs(O,{className:"flex gap-2",children:[x.jsx(p,{variant:"outline",onClick:s,children:"Cancel"}),x.jsxs(p,{onClick:()=>{var e;if(!(()=>{var e,s,t;return(null==(e=d.solutionDescription)?void 0:e.trim())?(null==(s=d.repairSteps)?void 0:s.some(e=>e.trim()))?!!(null==(t=d.mechanicNotes)?void 0:t.trim())||(w({title:"Missing Information",description:"Please add mechanic notes",variant:"destructive"}),!1):(w({title:"Missing Information",description:"Please add at least one repair step",variant:"destructive"}),!1):(w({title:"Missing Information",description:"Please provide a solution description",variant:"destructive"}),!1)})()||!t)return;const r=o(n({},d),{completionDate:(new Date).toISOString(),repairSteps:(null==(e=d.repairSteps)?void 0:e.filter(e=>e.trim()))||[]});a(r),s(),m({solutionDescription:"",repairSteps:[""],partsUsed:[],toolsUsed:[],totalLaborHours:0,totalCost:0,difficultyLevel:"medium",qualityRating:5,clientSatisfaction:5,warrantPeriod:12,followUpRequired:!1,followUpNotes:"",beforePhotos:[],afterPhotos:[],mechanicNotes:"",recommendation:""}),h([]),D([])},className:"bg-green-600 hover:bg-green-700",children:[x.jsx(U,{className:"h-4 w-4 mr-2"}),"Submit to Repair History"]})]})]})}),T&&x.jsx(v,{open:T,onOpenChange:G,children:x.jsxs(j,{className:"max-w-md",children:[x.jsx(g,{children:x.jsxs(f,{children:["Capture ","before"===$?"Before":"After"," Photo"]})}),x.jsxs("div",{className:"space-y-4",children:[x.jsx("video",{ref:L,autoPlay:!0,playsInline:!0,className:"w-full rounded-lg border",style:{transform:"scaleX(-1)"}}),x.jsx("canvas",{ref:V,className:"hidden"})]}),x.jsxs(O,{children:[x.jsx(p,{variant:"outline",onClick:G,children:"Cancel"}),x.jsxs(p,{onClick:()=>{if(L.current&&V.current){const e=L.current,s=V.current,t=s.getContext("2d");if(s.width=e.videoWidth,s.height=e.videoHeight,t){t.drawImage(e,0,0);const a=s.toDataURL("image/jpeg",.8);m("before"===$?e=>o(n({},e),{beforePhotos:[...e.beforePhotos||[],a]}):e=>o(n({},e),{afterPhotos:[...e.afterPhotos||[],a]})),w({title:"Photo Captured",description:("before"===$?"Before":"After")+" photo added successfully"})}}G()},children:[x.jsx(ve,{className:"h-4 w-4 mr-2"}),"Capture Photo"]})]})]})})]}):null},Ge=({scheduledCars:e,onStatusUpdate:s,onViewDetails:t,onWorkflowComplete:a})=>{var r,i,l,d;A();const{user:m}=$(),[h,D]=re.useState([]),[F,U]=re.useState(!0),[Z,X]=re.useState(null),[ee,se]=re.useState(!1),[te,ae]=re.useState(!1),[le,ne]=re.useState(!1),[ge,ye]=re.useState(!1),[we,Re]=re.useState(null),[Ee,Fe]=re.useState(!1),[Ue,Ae]=re.useState(""),[$e,He]=re.useState(""),[Ve,Ge]=re.useState(30),[Ye,Ke]=re.useState(""),[Qe,Je]=re.useState(!1),[Ze,Xe]=re.useState(!1),[es,ss]=re.useState(null),[ts,as]=re.useState(new Date),[rs,is]=re.useState(null),[ls,ns]=re.useState(""),[os,cs]=re.useState(!1),[ds,ms]=re.useState(!1),[us,hs]=re.useState(!1),[xs,ps]=re.useState(null),[vs,js]=re.useState(""),[gs,fs]=re.useState(!1),[Ns,ys]=re.useState(null),[bs,ws]=re.useState(!1),[Cs,Ss]=re.useState(!1),[ks,Ds]=re.useState(""),[Ts,Ps]=re.useState(""),[_s,Is]=re.useState("tool"),[Rs,Es]=re.useState(null),[Ms,Fs]=re.useState("tool"),[Os,Us]=re.useState(!1),[As,$s]=re.useState(!1),[Hs,qs]=re.useState(""),[Ls,Vs]=re.useState(!1),[Ws,Bs]=re.useState(!1),[zs,Gs]=re.useState(!1),Ys=ie.useRef(null),Ks=ie.useRef(null),Qs=ie.useRef(null),Js=ie.useRef(null),{stream:Zs,requestCamera:Xs,stopCamera:et}=xe();re.useEffect(()=>{gt()},[e]);const st=()=>c(void 0,null,function*(){try{Bs(!0),Vs(!0),yield Xs({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),w({title:"📷 Scanner Ready",description:"Point camera at QR code or barcode to scan part information"})}catch(e){w({title:"Camera Error",description:"Could not access camera. Please check permissions.",variant:"destructive"}),Bs(!1),Vs(!1)}}),tt=()=>{et(),Bs(!1),Vs(!1)},at=()=>c(void 0,null,function*(){if(Ys.current&&Ks.current)try{const e=Ks.current,s=Ys.current,t=e.getContext("2d");if(!t)return;e.width=s.videoWidth,e.height=s.videoHeight,t.drawImage(s,0,0,e.width,e.height);const a=e.toDataURL("image/png"),r=yield rt(a);r?(Ds(r),tt(),w({title:"✅ Part Scanned Successfully",description:`Detected: ${r}`})):w({title:"No QR Code Detected",description:"Make sure the QR code is clearly visible and try again",variant:"destructive"})}catch(e){w({title:"Scanning Error",description:"Failed to process the image. Please try again.",variant:"destructive"})}else w({title:"Scanner Error",description:"Camera not ready for scanning",variant:"destructive"})}),rt=e=>c(void 0,null,function*(){const e=["Brake Pads Front Set","Oil Filter","Air Filter","Spark Plugs Set","Battery 12V","Windshield Wipers","Headlight Bulb H7","Engine Mount","Transmission Filter","Radiator Coolant"];return yield new Promise(e=>setTimeout(e,1e3)),e[Math.floor(Math.random()*e.length)]});re.useEffect(()=>{Ys.current&&Zs&&Ws&&(Ys.current.srcObject=Zs,Ys.current.play().catch(console.error)),Qs.current&&Zs&&zs&&(Qs.current.srcObject=Zs,Qs.current.play().catch(console.error))},[Zs,Ws,zs]);const it=()=>{et(),Gs(!1),Vs(!1)},lt=e=>c(void 0,null,function*(){const e=["Brake Pad Set Front","Oil Filter Element","Air Filter Housing","Spark Plug NGK","Battery Terminal +/-","Wiper Blade 24inch","Headlight Assembly LED","Engine Mount Rubber","Transmission Oil ATF","Radiator Cap 1.3 Bar","Fuel Pump Assembly","Alternator Brush Set","Starter Motor Bendix","Clutch Disc 240mm","Timing Belt Kit"];return yield new Promise(e=>setTimeout(e,1500)),e[Math.floor(Math.random()*e.length)]});re.useEffect(()=>{if(os||ds){const e=document.getElementById(os?"tool-name-input":"part-name-input");e&&setTimeout(()=>{e.focus()},100)}},[os,ds]),re.useEffect(()=>{const e=setInterval(()=>{as(new Date)},6e4);return()=>clearInterval(e)},[]),re.useEffect(()=>{if(h.length>0){const e=h.map(e=>o(n({},e),{timeProgress:Nt(e.car)}));D(e)}},[ts,h.length]);const nt=()=>{if(!rs)return;const e=h.map(e=>{if(e.car.id===rs.carId){const s=o(n({},e.car),{[rs.field]:ls});return o(n({},e),{car:s})}return e});D(e),is(null),ns(""),w({title:"Updated",description:`${rs.field} updated successfully`})},ot=()=>{is(null),ns("")},ct=e=>{Ps(e),Is("tool"),Ds(""),cs(!0)},dt=e=>{Ps(e),Is("part"),Ds(""),ms(!0)},mt=()=>{if(!ks.trim())return;const e=h.map(e=>{if(e.car.id===Ts){if("tool"===_s){const s={toolName:ks.trim(),toolType:"equipment",isRequired:!0};return o(n({},e),{toolsRequired:[...e.toolsRequired,s]})}{const s={partName:ks.trim(),partNumber:`PN-${ks.trim().toUpperCase().replace(/\s+/g,"")}`,quantity:1};return o(n({},e),{partsNeeded:[...e.partsNeeded,s]})}}return e});D(e),w({title:("tool"===_s?"Tool":"Part")+" Added",description:`${ks.trim()} added to the ${_s} list`}),cs(!1),ms(!1),Ds(""),Ps("")},ut=()=>{Ws&&tt(),zs&&it(),cs(!1),ms(!1),ws(!1),Ss(!1),Us(!1),$s(!1),Ds(""),Ps(""),qs(""),Es(null)},ht=(e,s)=>{Ps(e),Es(s),Fs("part"),Ds(s.partName),ws(!0)},xt=(e,s)=>{Ps(e),Es(s),Fs("tool"),Ds(s.toolName),Ss(!0)},pt=()=>{if(!ks.trim()||!Rs)return;const e=h.map(e=>{if(e.car.id===Ts){if("tool"===Ms){const s=e.toolsRequired.map(e=>e===Rs?o(n({},e),{toolName:ks.trim()}):e);return o(n({},e),{toolsRequired:s})}{const s=e.partsNeeded.map(e=>e===Rs?o(n({},e),{partName:ks.trim()}):e);return o(n({},e),{partsNeeded:s})}}return e});D(e),w({title:("tool"===Ms?"Tool":"Part")+" Updated",description:`${Rs.name} updated to ${ks.trim()}`}),ut()},vt=()=>{if(!Rs)return;const e=h.map(e=>{if(e.car.id===Ts){if("tool"===Ms){const s=e.toolsRequired.filter(e=>e!==Rs);return o(n({},e),{toolsRequired:s})}{const s=e.partsNeeded.filter(e=>e!==Rs);return o(n({},e),{partsNeeded:s})}}return e});D(e),w({title:("tool"===Ms?"Tool":"Part")+" Deleted",description:`${Rs.name} removed from the list`}),ut()},jt=(e,s,t,a="text",r)=>{try{if(!e||!e.car||!e.car.id)return x.jsx("div",{className:"text-gray-400 text-sm",children:"Invalid data"});if("select"===a&&(!r||0===r.length))return x.jsx("div",{className:"text-gray-400 text-sm",children:"No options"});if((null==rs?void 0:rs.carId)===e.car.id&&(null==rs?void 0:rs.field)===s)return x.jsxs("div",{className:"flex items-center gap-2",style:{position:"relative",zIndex:1e3},children:["select"===a&&r?x.jsx("div",{className:"w-32",children:x.jsx(Se,{value:ls,onValueChange:ns,options:r.map(e=>({value:e,label:e.replace("_"," ").toLowerCase()})),placeholder:"Select...",searchable:!0})}):x.jsx(b,{id:`edit-${s}-${e.car.id}`,value:ls,onChange:e=>ns(e.target.value),className:"w-32 h-8",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key?nt():"Escape"===e.key&&ot()}}),x.jsx(p,{size:"sm",onClick:nt,className:"h-6 w-6 p-0",children:x.jsx(k,{className:"h-3 w-3"})}),x.jsx(p,{size:"sm",onClick:ot,variant:"outline",className:"h-6 w-6 p-0",children:x.jsx(y,{className:"h-3 w-3"})})]});let i=t||"";return"priority"===s?i=(t||"").toUpperCase():"status"===s?i=(t||"").replace("_"," ").toUpperCase():"workType"===s&&(i=(t||"").replace("_"," ").toLowerCase()),x.jsxs("div",{className:"cursor-pointer hover:bg-gray-100 p-1 rounded flex items-center gap-1",style:{position:"relative",zIndex:1},onClick:a=>{a.preventDefault(),a.stopPropagation();try{((e,s,t)=>{try{is({carId:e,field:s,value:t}),ns(t)}catch(a){is(null),ns("")}})(e.car.id,s,t||"")}catch(r){is(null),ns("")}},children:[x.jsx("span",{className:"priority"===s?"font-medium":"",children:"priority"===s?x.jsx(C,{className:wt(t||""),variant:"outline",children:i}):"status"===s?x.jsx(C,{className:bt(t||""),children:i}):i}),x.jsx(Ne,{className:"h-3 w-3 text-gray-400 opacity-0 group-hover:opacity-100"})]})}catch(i){return x.jsx("div",{className:"text-red-500 text-sm",children:"Error loading cell"})}},gt=()=>c(void 0,null,function*(){U(!0);const s=[];for(const a of e)try{const e=ft(a),t=Nt(a),r=o(n({},a),{startTime:a.startTime||void 0,actualStartTime:a.actualStartTime||void 0,actualEndTime:a.actualEndTime||void 0,partsHistory:a.partsHistory||[]});s.push({car:r,repairHistory:[],partsNeeded:e.parts.map(e=>({partName:e,partNumber:`PN-${e.toUpperCase().replace(/\s+/g,"")}`,quantity:1})),toolsRequired:e.tools.map(e=>({toolName:e,toolType:"equipment",isRequired:!0})),aiRecommendations:e,timeProgress:t,isTimerRunning:!1})}catch(t){const e=ft(a),r=o(n({},a),{startTime:a.startTime||void 0,actualStartTime:a.actualStartTime||void 0,actualEndTime:a.actualEndTime||void 0,partsHistory:a.partsHistory||[]});s.push({car:r,repairHistory:[],partsNeeded:[],toolsRequired:[],aiRecommendations:e,timeProgress:Nt(a),isTimerRunning:!1})}D(s),U(!1)}),ft=e=>{const s={electrical:{parts:["Battery","Alternator","Starter Motor","Fuses","Wiring Harness"],tools:["Multimeter","Battery Tester","Wire Crimper","Soldering Iron"],expectedTime:"2-4 hours",notes:"Electrical diagnostics and repair work"},mechanic:{parts:["Oil Filter","Air Filter","Brake Pads","Spark Plugs","Timing Belt"],tools:["Socket Set","Wrench Set","Jack Stands","Torque Wrench"],expectedTime:"3-6 hours",notes:"Mechanical maintenance and repair"},body_work:{parts:["Body Panels","Bumper","Paint","Filler","Primer"],tools:["Welder","Grinder","Paint Gun","Sanding Tools"],expectedTime:"4-8 hours",notes:"Body repair and paint work"},painter:{parts:["Paint","Clear Coat","Primer","Filler","Sandpaper"],tools:["Paint Gun","Compressor","Sanding Tools","Masking Tape"],expectedTime:"2-5 hours",notes:"Paint and finish work"},detailer:{parts:["Wax","Polish","Interior Cleaner","Glass Cleaner"],tools:["Buffer","Vacuum","Steam Cleaner","Microfiber Cloths"],expectedTime:"1-3 hours",notes:"Interior and exterior detailing"}},t=s[e.workType]||s.mechanic;return{expectedTime:t.expectedTime,parts:t.parts,tools:t.tools,notes:t.notes}},Nt=e=>{const s=e.actualStartTime,t=60*Ce(e.estimatedDuration,0);if(!s)return{elapsed:0,remaining:t,percentage:0,isOverrunning:!1,isDelayed:!1};const a=new Date(s),r=ts||new Date,i=Math.floor((r.getTime()-a.getTime())/6e4);return{elapsed:i,remaining:Math.max(0,t-i),percentage:Math.min(100,i/t*100),isOverrunning:i>t,startTime:a}},yt=e=>{switch(e){case"electrical":return x.jsx(J,{className:"h-4 w-4 text-blue-600"});case"mechanic":return x.jsx(K,{className:"h-4 w-4 text-green-600"});case"body_work":return x.jsx(Ie,{className:"h-4 w-4 text-purple-600"});case"painter":return x.jsx(Q,{className:"h-4 w-4 text-orange-600"});case"detailer":return x.jsx(_e,{className:"h-4 w-4 text-pink-600"});default:return x.jsx(G,{className:"h-4 w-4"})}},bt=e=>{switch(e){case"in_progress":return"bg-green-100 text-green-700 border-green-200";case"completed":return"bg-emerald-100 text-emerald-700 border-emerald-200";case"waiting_parts":return"bg-orange-100 text-orange-700 border-orange-200";case"paused":return"bg-red-100 text-red-700 border-red-200";case"scheduled":return"bg-blue-100 text-blue-700 border-blue-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},wt=e=>{switch(e){case"high":return"bg-red-100 text-red-700 border-red-200";case"medium":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"low":return"bg-green-100 text-green-700 border-green-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},Ct=e=>{const s=Math.floor(e/60),t=e%60;return s>0?`${s}h ${t}m`:`${t}m`},St=(e,t)=>c(void 0,null,function*(){var a,r,i,l;try{const n=h.find(s=>s.car.id===e);if(!n)return;const{GarageScheduleHistoryService:o}=yield u(()=>c(void 0,null,function*(){const{GarageScheduleHistoryService:e}=yield Promise.resolve().then(()=>We);return{GarageScheduleHistoryService:e}}),void 0);o.recordStatusChange(n.car.id,n.car.carCode,n.car.carModel,n.car.customerName,n.car.status,t,"Garage Mechanic",`Status changed from ${n.car.status} to ${t}`,{partsUsed:(null==(a=n.car.partsHistory)?void 0:a.map(e=>e.partName))||[],toolsUsed:n.toolsRequired||[],workNotes:n.car.notes,issueDescription:`Work type: ${n.car.workType}`,estimatedDuration:n.car.estimatedDuration,actualDuration:(null==(r=n.timeProgress)?void 0:r.elapsed)?`${Math.round(n.timeProgress.elapsed/60)}h`:void 0,priority:n.car.priority,assignedMechanic:n.car.assignedMechanic,location:"garage_repair"}),"completed"===t&&o.recordCompletion(n.car.id,n.car.carCode,n.car.carModel,n.car.customerName,n.car.status,"Garage Mechanic","Repair completed successfully",{partsUsed:(null==(i=n.car.partsHistory)?void 0:i.map(e=>e.partName))||[],toolsUsed:n.toolsRequired||[],workNotes:n.car.notes,issueDescription:`Completed ${n.car.workType} work`,estimatedDuration:n.car.estimatedDuration,actualDuration:(null==(l=n.timeProgress)?void 0:l.elapsed)?`${Math.round(n.timeProgress.elapsed/60)}h`:void 0,priority:n.car.priority,assignedMechanic:n.car.assignedMechanic,location:"garage_repair"});if(!(yield Oe.updateCarStatus(n.car.carCode,t)))return void w({title:"Status Update Failed",description:"Failed to update car status in inventory tables",variant:"destructive"});s(e,t),w({title:"Status Updated",description:`Car status changed to ${t.replace("_"," ")} and recorded in repair history`}),"completed"===t&&(yield gt())}catch(n){w({title:"Error",description:"An error occurred while updating car status",variant:"destructive"})}}),kt=e=>{const s=new Date,t=h.map(t=>t.car.id===e.car.id?o(n({},t),{isTimerRunning:!0,timerStartTime:s,car:o(n({},t.car),{actualStartTime:s.toISOString()})}):t);D(t),w({title:"Real-Time Timer Started",description:`Started minute-by-minute tracking for ${e.car.carModel}`})},Dt=e=>{const s=new Date,t=h.map(t=>t.car.id===e.car.id?o(n({},t),{isTimerRunning:!1,car:o(n({},t.car),{actualEndTime:s.toISOString()})}):t);D(t);const a=e.timerStartTime?Math.floor((s.getTime()-e.timerStartTime.getTime())/6e4):0;w({title:"Timer Stopped",description:`Completed work on ${e.car.carModel} in ${Ct(a)}`})},Tt=e=>{switch(e){case"floor1":return"Floor 1 Inventory";case"floor2":return"Floor 2 Inventory";case"garage":return"Garage Inventory";case"car_inventory":return"Car Inventory";default:return"Unknown Destination"}};return F?x.jsxs("div",{className:"flex items-center justify-center p-8",children:[x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-monza-yellow"}),x.jsx("span",{className:"ml-2",children:"Loading schedule data..."})]}):h&&0!==h.length?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Garage Schedule - Repair Station"}),x.jsx("p",{className:"text-gray-600",children:"Comprehensive view of all scheduled cars with parts, tools, and work progress"})]}),x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{Je(!0)},className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[x.jsx(q,{className:"h-4 w-4 mr-2"}),"Scan VIN"]}),x.jsxs(C,{className:"bg-green-100 text-green-700",children:[x.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse mr-1"}),"Monza AI Enhanced"]})]})]}),x.jsxs(I,{children:[x.jsx(R,{children:x.jsxs(E,{className:"flex items-center gap-2",children:[x.jsx(H,{className:"h-5 w-5"}),"Scheduled Cars (",e.length,")"]})}),x.jsx(M,{children:x.jsx("div",{className:"overflow-x-auto",children:x.jsxs(oe,{children:[x.jsx(ce,{children:x.jsxs(de,{children:[x.jsx(me,{children:"Car Info"}),x.jsx(me,{children:"Customer"}),x.jsx(me,{children:"Work Type"}),x.jsx(me,{children:"Assigned Worker"}),x.jsx(me,{children:"Expected Time"}),x.jsx(me,{children:"Progress"}),x.jsx(me,{children:"Parts Needed"}),x.jsx(me,{children:"Tools Required"}),x.jsx(me,{children:"Status"}),x.jsx(me,{children:"Notes"}),x.jsx(me,{children:"Software Model"}),x.jsx(me,{children:"Actions"})]})}),x.jsx(ue,{children:h.map(e=>{try{return e&&e.car&&e.car.id?x.jsxs(de,{className:"hover:bg-gray-50",children:[x.jsx(he,{children:x.jsxs("div",{className:"space-y-1",children:[jt(e,"carModel",e.car.carModel),jt(e,"carCode",e.car.carCode),jt(e,"priority",e.car.priority,"select",["high","medium","low"])]})}),x.jsx(he,{children:x.jsxs("div",{className:"space-y-1",children:[jt(e,"customerName",e.car.customerName),x.jsxs("div",{className:"text-sm text-gray-500",children:[x.jsx(ke,{className:"h-3 w-3 inline mr-1"}),"Contact Info"]})]})}),x.jsx(he,{children:x.jsxs("div",{className:"flex items-center gap-2",children:[yt(e.car.workType),jt(e,"workType",e.car.workType,"select",["electrical","painter","detailer","mechanic","body_work"])]})}),x.jsx(he,{children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(T,{className:"h-4 w-4 text-blue-500"}),jt(e,"assignedMechanic",e.car.assignedMechanic||"Unassigned")]})}),x.jsx(he,{children:x.jsxs("div",{className:"space-y-1",children:[jt(e,"estimatedDuration",e.car.estimatedDuration),x.jsx("div",{className:"text-sm text-gray-500",children:"AI Estimated"})]})}),x.jsx(he,{children:x.jsxs("div",{className:"space-y-2",children:[x.jsx(L,{value:e.timeProgress.percentage,className:"h-2"}),x.jsxs("div",{className:"text-xs text-gray-600",children:[x.jsxs("div",{className:"font-medium",children:[Ct(e.timeProgress.elapsed)," / ",e.car.estimatedDuration,"h"]}),e.isTimerRunning&&x.jsx("div",{className:"text-green-600 font-semibold animate-pulse",children:"⏱️ Live tracking..."}),e.timeProgress.remaining>0&&!e.isTimerRunning&&x.jsxs("div",{className:"text-blue-600",children:[Ct(e.timeProgress.remaining)," remaining"]})]}),e.timeProgress.isOverrunning&&x.jsxs(C,{className:"bg-red-100 text-red-700 text-xs",children:["⚠️ Overrunning by ",Ct(e.timeProgress.elapsed-60*parseInt(e.car.estimatedDuration))]}),e.isTimerRunning?x.jsx(p,{size:"sm",variant:"outline",onClick:()=>Dt(e),className:"h-7 w-7 p-0 bg-red-50 hover:bg-red-100",title:"Stop Timer",children:x.jsx(De,{className:"h-3 w-3 text-red-600"})}):x.jsx(p,{size:"sm",variant:"outline",onClick:()=>kt(e),className:"h-7 w-7 p-0 bg-green-50 hover:bg-green-100",title:"Start Timer",children:x.jsx(Te,{className:"h-3 w-3 text-green-600"})})]})}),x.jsx(he,{children:x.jsxs("div",{className:"space-y-1",children:[x.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"AI Recommended:"}),x.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.partsNeeded.slice(0,2).map((s,t)=>x.jsx(C,{variant:"outline",className:"text-xs cursor-pointer hover:bg-blue-50 hover:text-blue-700 transition-colors",onClick:()=>ht(e.car.id,s),children:s.partName},t)),e.partsNeeded.length>2&&x.jsxs(C,{variant:"outline",className:"text-xs cursor-pointer hover:bg-blue-50 hover:text-blue-700",onClick:()=>{return s=e.car.id,qs(s),void Us(!0);var s},children:["+",e.partsNeeded.length-2," more"]})]}),x.jsx("div",{className:"mt-2",children:x.jsxs(p,{size:"sm",variant:"outline",className:"h-6 px-2 text-xs",onClick:()=>dt(e.car.id),children:[x.jsx(V,{className:"h-3 w-3 mr-1"}),"Add Part"]})}),e.car.partsHistory.length>0&&x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"text-xs text-gray-500 mt-2 mb-1",children:"Scanned Parts:"}),x.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.car.partsHistory.slice(0,2).map((e,s)=>x.jsx(C,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:e.partName},s)),e.car.partsHistory.length>2&&x.jsxs(C,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:["+",e.car.partsHistory.length-2," more"]})]})]})]})}),x.jsx(he,{children:x.jsxs("div",{className:"space-y-1",children:[x.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"AI Recommended:"}),x.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.toolsRequired.slice(0,2).map((s,t)=>x.jsx(C,{variant:"outline",className:"text-xs cursor-pointer hover:bg-blue-50 hover:text-blue-700 transition-colors",onClick:()=>xt(e.car.id,s),children:s.toolName},t)),e.toolsRequired.length>2&&x.jsxs(C,{variant:"outline",className:"text-xs cursor-pointer hover:bg-blue-50 hover:text-blue-700",onClick:()=>{return s=e.car.id,qs(s),void $s(!0);var s},children:["+",e.toolsRequired.length-2," more"]})]}),x.jsx("div",{className:"mt-2",children:x.jsxs(p,{size:"sm",variant:"outline",className:"h-6 px-2 text-xs",onClick:()=>ct(e.car.id),children:[x.jsx(V,{className:"h-3 w-3 mr-1"}),"Add Tool"]})})]})}),x.jsx(he,{children:jt(e,"status",e.car.status,"select",["pending","scheduled","in_progress","completed","delayed"])}),x.jsx(he,{children:jt(e,"notes",e.car.notes||"Add notes...")}),x.jsx(he,{children:x.jsx(Be,{softwareVersion:e.car.softwareVersion,softwareLastUpdated:e.car.softwareLastUpdated,softwareUpdateBy:e.car.softwareUpdateBy,softwareUpdateNotes:e.car.softwareUpdateNotes,compact:!0,editable:!0,carId:e.car.id,onSave:s=>{((e,s)=>{const t=h.map(t=>{if(t.car.id===e){const e=o(n({},t.car),{softwareVersion:s.softwareVersion,softwareLastUpdated:s.softwareLastUpdated,softwareUpdateBy:s.softwareUpdateBy,softwareUpdateNotes:s.softwareUpdateNotes});return o(n({},t),{car:e})}return t});D(t)})(e.car.id,s)}})}),x.jsx(he,{children:x.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[x.jsx(p,{size:"sm",variant:"outline",onClick:()=>{X(e),se(!0)},className:"h-7 w-7 p-0",title:"View Details",children:x.jsx(W,{className:"h-3 w-3"})}),x.jsx(p,{size:"sm",variant:"outline",onClick:()=>{var s,t,a,r,i,l,n,o;const c={id:(null==(s=null==e?void 0:e.car)?void 0:s.id)||(null==e?void 0:e.carId)||(null==e?void 0:e.id),vinNumber:(null==(t=null==e?void 0:e.car)?void 0:t.vinNumber)||(null==(a=null==e?void 0:e.car)?void 0:a.vin)||(null==e?void 0:e.vinNumber)||(null==e?void 0:e.vin),model:(null==(r=null==e?void 0:e.car)?void 0:r.carModel)||(null==(i=null==e?void 0:e.car)?void 0:i.model)||(null==e?void 0:e.carModel)||(null==e?void 0:e.model),arrivalDate:(null==(l=null==e?void 0:e.car)?void 0:l.arrivalDate)||(new Date).toISOString(),category:(null==(n=null==e?void 0:e.car)?void 0:n.category)||"EV",status:(null==(o=null==e?void 0:e.car)?void 0:o.status)||"in_stock"};Re(c),Promise.resolve().then(()=>ae(!0))},type:"button",className:"h-7 w-7 p-0",title:"Test Drive",children:x.jsx(Pe,{className:"h-3 w-3"})}),x.jsx(p,{size:"sm",variant:"outline",onClick:()=>{Re(e.car),ne(!0)},className:"h-7 w-7 p-0",title:"PDI Check",children:x.jsx(B,{className:"h-3 w-3"})}),x.jsx(p,{size:"sm",variant:"outline",onClick:()=>{ss(e),Xe(!0)},className:"h-7 w-7 p-0",title:"Scan Part",children:x.jsx(pe,{className:"h-3 w-3"})}),"scheduled"===e.car.status&&x.jsx(p,{size:"sm",variant:"outline",onClick:()=>St(e.car.id,"in_progress"),className:"h-7 w-7 p-0 bg-green-50 hover:bg-green-100",title:"Start Work",children:x.jsx(Te,{className:"h-3 w-3 text-green-600"})}),"in_progress"===e.car.status&&x.jsx(p,{size:"sm",variant:"outline",onClick:()=>a?a(e.car):St(e.car.id,"completed"),className:"h-7 w-7 p-0 bg-blue-50 hover:bg-blue-100",title:"Complete Work",children:x.jsx(P,{className:"h-3 w-3 text-blue-600"})}),"completed"===e.car.status&&x.jsx(p,{size:"sm",variant:"outline",onClick:()=>(e=>{ys(e),fs(!0)})(e),className:"h-7 w-7 p-0 bg-green-50 hover:bg-green-100",title:"Complete Repair & Move Car",children:x.jsx(Me,{className:"h-3 w-3 text-green-600"})}),"pending"===e.car.status&&x.jsx(p,{size:"sm",variant:"outline",onClick:()=>St(e.car.id,"scheduled"),className:"h-7 w-7 p-0 bg-orange-50 hover:bg-orange-100",title:"Mark Scheduled",children:x.jsx(H,{className:"h-3 w-3 text-orange-600"})}),"delayed"===e.car.status&&x.jsx(p,{size:"sm",variant:"outline",onClick:()=>St(e.car.id,"in_progress"),className:"h-7 w-7 p-0 bg-yellow-50 hover:bg-yellow-100",title:"Resume Work",children:x.jsx(Te,{className:"h-3 w-3 text-yellow-600"})})]})})]},e.car.id):null}catch(s){return null}})})]})})})]}),x.jsx(v,{open:te,onOpenChange:ae,children:x.jsx(z,{container:"undefined"!=typeof document?document.getElementById("modals-root"):void 0,children:x.jsxs(j,{className:"calendar-dialog-fix z-extreme max-w-xl w-[min(700px,95vw)]",overlayClassName:"bg-black/50",onOpenAutoFocus:e=>{e.preventDefault(),setTimeout(()=>{const e=document.getElementById("testDriveDate");if(e&&e.focus)try{e.focus({preventScroll:!0})}catch(s){e.focus()}},0)},children:[x.jsxs(g,{children:[x.jsxs(f,{children:["Test Drive - ",(null==we?void 0:we.model)||(null==we?void 0:we.carModel)]}),x.jsx(_,{children:"Schedule and manage test drive for this vehicle"})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"calendar-input-container",children:[x.jsx(N,{htmlFor:"testDriveDate",children:"Test Drive Date"}),x.jsx("div",{className:"relative",children:x.jsx(b,{id:"testDriveDate",type:"datetime-local",className:"calendar-fix"})})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"driverName",children:"Driver"}),x.jsx(b,{id:"driverName",placeholder:"Driver name"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"testDriveDuration",children:"Duration (minutes)"}),x.jsx(b,{id:"testDriveDuration",type:"number",placeholder:"30"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"testDriveNotes",children:"Notes"}),x.jsx(S,{id:"testDriveNotes",placeholder:"Test drive notes..."})]})]}),x.jsxs(O,{children:[x.jsx(p,{variant:"outline",onClick:()=>ae(!1),children:"Cancel"}),x.jsx(p,{onClick:()=>{w({title:"Test Drive Scheduled",description:`Test drive scheduled for ${(null==we?void 0:we.model)||(null==we?void 0:we.carModel)}`}),ae(!1)},children:"Schedule Test Drive"})]})]})})}),Ee&&x.jsxs("div",{className:"fixed top-16 right-0 h-[calc(100vh-4rem)] w-full max-w-md bg-white border-l border-gray-200 shadow-xl z-[2147483001] flex flex-col",children:[x.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("div",{className:"text-sm text-gray-500",children:"Test Drive"}),x.jsx("div",{className:"text-lg font-semibold",children:(null==we?void 0:we.carModel)||"Vehicle"})]}),x.jsx("button",{type:"button",className:"h-9 px-3 border rounded-md",onClick:()=>Fe(!1),children:"Close"})]}),x.jsxs("div",{className:"p-4 space-y-4 overflow-auto",children:[(null==we?void 0:we.testDriveStartTime)&&x.jsxs("div",{className:"rounded-md border border-gray-200 p-3 bg-gray-50",children:[x.jsx("div",{className:"text-sm font-medium mb-1",children:"Previous Test Drive"}),x.jsxs("div",{className:"text-sm text-gray-700",children:[x.jsxs("div",{children:["Start: ",new Date(we.testDriveStartTime).toLocaleString()]}),"number"==typeof we.testDriveDuration?x.jsxs("div",{children:["Duration: ",we.testDriveDuration," min"]}):x.jsxs("div",{children:["Duration: ",Math.max(1,Math.floor((Date.now()-new Date(we.testDriveStartTime).getTime())/6e4))," min (running)"]}),we.testDriveDriver&&x.jsxs("div",{children:["Driver: ",we.testDriveDriver]})]})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"td-date",className:"block text-sm font-medium",children:"Date & Time"}),x.jsx("input",{id:"td-date",type:"datetime-local",value:Ue,onChange:e=>Ae(e.target.value),className:"mt-1 w-full h-12 border px-4 rounded-md"})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"td-driver",className:"block text-sm font-medium",children:"Driver"}),x.jsx("input",{id:"td-driver",value:$e,onChange:e=>He(e.target.value),placeholder:"Driver name",className:"mt-1 w-full h-12 border px-4 rounded-md"})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"td-duration",className:"block text-sm font-medium",children:"Duration (minutes)"}),x.jsx("input",{id:"td-duration",type:"number",min:5,value:Ve,onChange:e=>Ge(Number(e.target.value)),className:"mt-1 w-full h-12 border px-4 rounded-md"})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"td-notes",className:"block text-sm font-medium",children:"Notes"}),x.jsx("textarea",{id:"td-notes",value:Ye,onChange:e=>Ke(e.target.value),placeholder:"Notes…",className:"mt-1 w-full min-h-[100px] border px-4 py-3 rounded-md"})]}),x.jsxs("div",{className:"flex items-center justify-end gap-2",children:[x.jsx("button",{type:"button",className:"h-10 px-4 border rounded-md",onClick:()=>Fe(!1),children:"Cancel"}),x.jsx("button",{type:"button",className:"h-10 px-4 rounded-md bg-monza-yellow text-monza-black",onClick:()=>{we&&(D(e=>e.map(e=>{var s;if(((null==(s=null==e?void 0:e.car)?void 0:s.id)||(null==e?void 0:e.carId)||(null==e?void 0:e.id))!==we.id)return e;const t=n({},e);return t.car=o(n({},e.car),{testDriveStatus:"on_test_drive",testDriveDriver:$e,testDriveStartTime:Ue||(new Date).toISOString(),testDriveDuration:Ve}),t})),w({title:"Test Drive Scheduled",description:"Vehicle remains in Schedule. Test drive info saved."}),Fe(!1))},children:"Save"})]}),x.jsxs("div",{className:"text-sm text-gray-600",children:["Status: ",x.jsx("span",{className:"font-medium",children:(null==we?void 0:we.testDriveStatus)||"available"})]})]})]}),we&&x.jsx(be,{car:{id:we.id,model:we.carModel,year:(new Date).getFullYear(),color:"",arrivalDate:(new Date).toISOString(),status:"in_stock",vinNumber:we.vin||we.vinNumber||""},isOpen:le,onClose:()=>ne(!1),onSave:()=>ne(!1)}),x.jsx(v,{open:ge,onOpenChange:ye,children:x.jsx(z,{container:"undefined"!=typeof document?document.getElementById("modals-root"):void 0,children:x.jsxs(j,{className:"z-extreme",overlayClassName:"bg-black/50",children:[x.jsxs(g,{children:[x.jsxs(f,{children:["Customs - ",null==we?void 0:we.carModel]}),x.jsx(_,{children:"Manage customs documentation and status"})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx(N,{htmlFor:"customsStatus",children:"Customs Status"}),x.jsx(Se,{value:"",onValueChange:()=>{},options:[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"}],placeholder:"Select status...",searchable:!1})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"customsDocumentation",children:"Documentation"}),x.jsx(b,{id:"customsDocumentation",placeholder:"Document reference"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"customsNotes",children:"Notes"}),x.jsx(S,{id:"customsNotes",placeholder:"Customs notes..."})]})]}),x.jsxs(O,{children:[x.jsx(p,{variant:"outline",onClick:()=>ye(!1),children:"Cancel"}),x.jsx(p,{onClick:()=>{w({title:"Customs Updated",description:`Customs status updated for ${null==we?void 0:we.carModel}`}),ye(!1)},children:"Update Customs"})]})]})})}),x.jsx(qe,{isOpen:Qe,onClose:()=>Je(!1),onVinScanned:(e,s)=>{var t;t=e.vin,c(void 0,null,function*(){try{const e=yield Oe.findCarByVIN(t);if(!e)return w({title:"Car Not Found",description:`No car found with VIN ${t} in any inventory`,variant:"destructive"}),void Je(!1);if(!(yield Oe.updateCarStatus(t,"in_repair")))return w({title:"Status Update Failed",description:"Failed to update car status in inventory tables",variant:"destructive"}),void Je(!1);if(!(yield Oe.addCarToSchedule(e)))return w({title:"Schedule Addition Failed",description:"Failed to add car to garage schedule",variant:"destructive"}),void Je(!1);Oe.removeCarFromInventory(t,"Added to garage schedule via VIN scanner"),w({title:"Car Added to Schedule",description:`${e.carModel} (${t}) has been added to repair schedule and removed from all inventory locations`}),yield gt(),Je(!1)}catch(e){w({title:"Error",description:"An error occurred while processing the VIN scan",variant:"destructive"}),Je(!1)}})}}),x.jsx(v,{open:Ze,onOpenChange:Xe,children:x.jsxs(j,{className:"max-w-md",children:[x.jsxs(g,{children:[x.jsx(f,{children:"Scan Part Number"}),x.jsxs(_,{children:["Scan part number for ",null==es?void 0:es.car.carModel]})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:[x.jsx(ve,{className:"h-12 w-12 mx-auto text-gray-400 mb-2"}),x.jsx("p",{className:"text-sm text-gray-600",children:"OCR Camera Scanner"}),x.jsx("p",{className:"text-xs text-gray-500",children:"Point camera at part number"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(N,{htmlFor:"partNumber",children:"Part Number"}),x.jsx(b,{id:"partNumber",placeholder:"Enter part number manually or scan..."})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(N,{htmlFor:"partName",children:"Part Name"}),x.jsx(b,{id:"partName",placeholder:"Part name..."})]})]}),x.jsxs(O,{children:[x.jsx(p,{variant:"outline",onClick:()=>Xe(!1),children:"Cancel"}),x.jsx(p,{onClick:()=>((e,s)=>{if(es){if(!je.usePart(e,1,{carVIN:es.car.carCode||es.car.vin||"UNKNOWN-CAR",employee:(null==m?void 0:m.name)||"Unknown",type:"scan",context:"schedule_repair"}))return w({title:"Part Scan Failed",description:"Failed to process part scan. Check if part exists and has sufficient quantity.",variant:"destructive"}),Xe(!1),void ss(null);const t=h.map(t=>t.car.id===es.car.id?o(n({},t),{car:o(n({},t.car),{partsHistory:[...t.car.partsHistory,{partNumber:e,partName:s,scannedAt:(new Date).toISOString(),scannedBy:(null==m?void 0:m.name)||"Unknown"}]})}):t);D(t),w({title:"Part Scanned",description:`${s} (${e}) added to ${es.car.carModel}. Inventory updated.`})}Xe(!1),ss(null)})("PN123456","Brake Pad"),children:"Add Part to Car"})]})]})}),x.jsx(v,{open:os,onOpenChange:cs,children:x.jsxs(j,{className:"max-w-xl",children:[x.jsxs(g,{children:[x.jsx(f,{children:"Add New Tool"}),x.jsx(_,{children:"Add a new tool to the tools list"})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[x.jsx(p,{variant:Ws?"outline":"default",onClick:()=>{Ws&&tt()},className:"w-full rounded-none",children:"Manual Entry"}),x.jsx(p,{variant:Ws?"default":"outline",onClick:()=>c(void 0,null,function*(){Ws||(yield st())}),className:"w-full rounded-none",children:"Scan Tool Number"})]}),!Ws&&x.jsxs("div",{className:"space-y-2",children:[x.jsx(N,{htmlFor:"tool-name-input",children:"Tool Number or Name"}),x.jsx(b,{id:"tool-name-input",placeholder:"Enter tool number or name...",value:ks,onChange:e=>{Ds(e.target.value)},onKeyDown:e=>{"Enter"===e.key?mt():"Escape"===e.key&&ut()},autoFocus:!0,className:"w-full h-12 px-5 py-3 text-base text-center rounded-none"})]}),Ws&&x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"aspect-video bg-slate-100 border",children:[x.jsx("video",{ref:Ys,className:"w-full h-full object-cover",playsInline:!0,muted:!0}),x.jsx("canvas",{ref:Ks,className:"hidden"})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(p,{variant:"outline",onClick:tt,className:"flex-1",children:"Cancel"}),x.jsx(p,{onClick:at,className:"flex-1",children:"Capture & Scan"})]}),ks&&x.jsxs("div",{className:"text-sm text-muted-foreground",children:["Detected: ",x.jsx("span",{className:"font-mono",children:ks})]})]})]}),x.jsxs(O,{children:[x.jsx(p,{variant:"outline",onClick:ut,children:"Cancel"}),x.jsx(p,{onClick:mt,disabled:!ks.trim(),children:"Add Tool"})]})]})}),x.jsx(v,{open:ds,onOpenChange:ms,children:x.jsxs(j,{className:"max-w-md",children:[x.jsxs(g,{children:[x.jsx(f,{children:"Add New Part"}),x.jsx(_,{children:"Add a new part to the parts list"})]}),x.jsxs("div",{className:"space-y-4",children:[Ws?x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"text-center",children:[x.jsx("h3",{className:"font-medium mb-2",children:"Part Scanner"}),x.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Point camera at QR code or barcode"})]}),x.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden aspect-video",children:Zs?x.jsxs(x.Fragment,{children:[x.jsx("video",{ref:Ys,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),x.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:x.jsx("div",{className:"border-2 border-blue-500 bg-transparent w-48 h-32 rounded-lg opacity-80",children:x.jsxs("div",{className:"relative w-full h-full",children:[x.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-l-2 border-t-2 border-blue-500"}),x.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-r-2 border-t-2 border-blue-500"}),x.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-l-2 border-b-2 border-blue-500"}),x.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-r-2 border-b-2 border-blue-500"})]})})})]}):x.jsx("div",{className:"flex items-center justify-center h-full",children:x.jsxs("div",{className:"text-center text-white",children:[x.jsx(ve,{className:"mx-auto h-8 w-8 mb-2 opacity-60"}),x.jsx("p",{className:"text-sm opacity-80",children:"Starting camera..."})]})})}),x.jsxs("div",{className:"flex gap-2",children:[x.jsxs(p,{onClick:at,disabled:!Zs,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[x.jsx(pe,{className:"h-4 w-4 mr-2"}),"Scan Now"]}),x.jsx(p,{variant:"outline",onClick:tt,className:"px-4",children:x.jsx(y,{className:"h-4 w-4"})})]}),x.jsx("div",{className:"text-xs text-center text-gray-500",children:'Position the QR code or barcode within the blue frame and click "Scan Now"'})]}):x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(N,{htmlFor:"part-name-input",children:"Part Name"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(b,{id:"part-name-input",placeholder:"Enter part name...",value:ks,onChange:e=>{Ds(e.target.value)},onKeyDown:e=>{"Enter"===e.key?mt():"Escape"===e.key&&ut()},autoFocus:!0,className:"flex-1"}),x.jsx(p,{type:"button",variant:"outline",onClick:st,className:"px-3",title:"Scan QR Code",children:x.jsx(q,{className:"h-4 w-4"})})]})]}),x.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[x.jsx(pe,{className:"h-3 w-3"}),"Click the QR icon to scan part barcodes or QR codes"]})]}),x.jsx("canvas",{ref:Ks,style:{display:"none"}})]}),x.jsxs(O,{children:[x.jsx(p,{variant:"outline",onClick:ut,children:"Cancel"}),x.jsx(p,{onClick:mt,disabled:!ks.trim(),children:"Add Part"})]})]})}),x.jsx(v,{open:bs,onOpenChange:ws,children:x.jsxs(j,{className:"max-w-md",children:[x.jsxs(g,{children:[x.jsx(f,{children:"Edit Part"}),x.jsx(_,{children:"Edit or delete this part from the parts list"})]}),x.jsxs("div",{className:"space-y-4",children:[zs?x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"text-center",children:[x.jsx("h3",{className:"font-medium mb-2",children:"OCR Part Scanner"}),x.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Point camera at part label or barcode for OCR scanning"})]}),x.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden aspect-video",children:Zs?x.jsxs(x.Fragment,{children:[x.jsx("video",{ref:Qs,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),x.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:x.jsx("div",{className:"border-2 border-green-500 bg-transparent w-64 h-40 rounded-lg opacity-90",children:x.jsxs("div",{className:"relative w-full h-full",children:[x.jsx("div",{className:"absolute top-0 left-0 w-5 h-5 border-l-2 border-t-2 border-green-500"}),x.jsx("div",{className:"absolute top-0 right-0 w-5 h-5 border-r-2 border-t-2 border-green-500"}),x.jsx("div",{className:"absolute bottom-0 left-0 w-5 h-5 border-l-2 border-b-2 border-green-500"}),x.jsx("div",{className:"absolute bottom-0 right-0 w-5 h-5 border-r-2 border-b-2 border-green-500"}),x.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:x.jsx("div",{className:"bg-green-500 bg-opacity-20 px-2 py-1 rounded text-white text-xs font-medium",children:"OCR SCAN AREA"})})]})})})]}):x.jsx("div",{className:"flex items-center justify-center h-full",children:x.jsxs("div",{className:"text-center text-white",children:[x.jsx(ve,{className:"mx-auto h-10 w-10 mb-2 opacity-60"}),x.jsx("p",{className:"text-sm opacity-80",children:"Starting OCR camera..."})]})})}),x.jsxs("div",{className:"flex gap-2",children:[x.jsxs(p,{onClick:()=>c(void 0,null,function*(){if(Qs.current&&Js.current)try{const e=Js.current,s=Qs.current,t=e.getContext("2d");if(!t)return;e.width=s.videoWidth,e.height=s.videoHeight,t.drawImage(s,0,0,e.width,e.height);const a=e.toDataURL("image/png"),r=yield lt(a);r?(Ds(r),it(),w({title:"✅ Part Scanned Successfully",description:`OCR Detected: ${r}`})):w({title:"No Text Detected",description:"Make sure the part label is clearly visible and try again",variant:"destructive"})}catch(e){w({title:"Scanning Error",description:"Failed to process the image. Please try again.",variant:"destructive"})}else w({title:"Scanner Error",description:"Camera not ready for scanning",variant:"destructive"})}),disabled:!Zs,className:"flex-1 bg-green-600 hover:bg-green-700",children:[x.jsx(ve,{className:"h-4 w-4 mr-2"}),"Scan with OCR"]}),x.jsx(p,{variant:"outline",onClick:it,className:"px-4",children:x.jsx(y,{className:"h-4 w-4"})})]}),x.jsx("div",{className:"text-xs text-center text-gray-500",children:'Position part label or barcode within the green frame and click "Scan with OCR"'}),Rs&&x.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"Original Part:"})," ",Rs.partNumber]}),x.jsxs("p",{children:[x.jsx("strong",{children:"Quantity:"})," ",Rs.quantity]})]})]}):x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(N,{htmlFor:"edit-part-name-input",children:"Part Name"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(b,{id:"edit-part-name-input",placeholder:"Enter part name...",value:ks,onChange:e=>{Ds(e.target.value)},onKeyDown:e=>{"Enter"===e.key?pt():"Escape"===e.key&&ut()},autoFocus:!0,className:"flex-1"}),x.jsx(p,{type:"button",variant:"outline",onClick:()=>c(void 0,null,function*(){try{Gs(!0),Vs(!0),yield Xs({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),w({title:"📷 OCR Scanner Ready",description:"Point camera at part label or barcode to scan part information"})}catch(e){w({title:"Camera Error",description:"Could not access camera. Please check permissions.",variant:"destructive"}),Gs(!1),Vs(!1)}}),className:"px-3",title:"Scan with OCR Camera",children:x.jsx(ve,{className:"h-4 w-4"})})]})]}),x.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[x.jsx(ve,{className:"h-3 w-3"}),"Click the camera icon to scan part labels with OCR"]}),Rs&&x.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"Part Number:"})," ",Rs.partNumber]}),x.jsxs("p",{children:[x.jsx("strong",{children:"Quantity:"})," ",Rs.quantity]})]})]}),x.jsx("canvas",{ref:Js,style:{display:"none"}})]}),x.jsxs(O,{className:"flex justify-between",children:[x.jsx(p,{variant:"destructive",onClick:vt,className:"mr-auto",children:"Delete Part"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(p,{variant:"outline",onClick:ut,children:"Cancel"}),x.jsx(p,{onClick:pt,disabled:!ks.trim(),children:"Save Changes"})]})]})]})}),x.jsx(v,{open:Cs,onOpenChange:Ss,children:x.jsxs(j,{className:"max-w-md",children:[x.jsxs(g,{children:[x.jsx(f,{children:"Edit Tool"}),x.jsx(_,{children:"Edit or delete this tool from the tools list"})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(N,{htmlFor:"edit-tool-name-input",children:"Tool Name"}),x.jsx(b,{id:"edit-tool-name-input",placeholder:"Enter tool name...",value:ks,onChange:e=>{Ds(e.target.value)},onKeyDown:e=>{"Enter"===e.key?pt():"Escape"===e.key&&ut()},autoFocus:!0,className:"w-full"})]}),Rs&&x.jsxs("div",{className:"text-sm text-gray-600",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"Tool Type:"})," ",Rs.toolType]}),x.jsxs("p",{children:[x.jsx("strong",{children:"Required:"})," ",Rs.isRequired?"Yes":"No"]})]})]}),x.jsxs(O,{className:"flex justify-between",children:[x.jsx(p,{variant:"destructive",onClick:vt,className:"mr-auto",children:"Delete Tool"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(p,{variant:"outline",onClick:ut,children:"Cancel"}),x.jsx(p,{onClick:pt,disabled:!ks.trim(),children:"Save Changes"})]})]})]})}),x.jsx(v,{open:Os,onOpenChange:Us,children:x.jsxs(j,{className:"max-w-2xl",children:[x.jsxs(g,{children:[x.jsx(f,{children:"All Parts"}),x.jsx(_,{children:"All parts for this car. Click any part to edit or delete it."})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:null==(r=h.find(e=>e.car.id===Hs))?void 0:r.partsNeeded.map((e,s)=>x.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[x.jsxs("div",{className:"flex-1",children:[x.jsx("div",{className:"font-medium",children:e.partName}),x.jsxs("div",{className:"text-sm text-gray-500",children:["Part #: ",e.partNumber]}),x.jsxs("div",{className:"text-sm text-gray-500",children:["Qty: ",e.quantity]})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(p,{size:"sm",variant:"outline",onClick:()=>{Us(!1),ht(Hs,e)},children:"Edit"}),x.jsx(p,{size:"sm",variant:"destructive",onClick:()=>{const s=h.map(s=>{if(s.car.id===Hs){const t=s.partsNeeded.filter(s=>s!==e);return o(n({},s),{partsNeeded:t})}return s});D(s),w({title:"Part Deleted",description:`${e.partName} removed from the parts list`})},children:"Delete"})]})]},s))}),0===(null==(i=h.find(e=>e.car.id===Hs))?void 0:i.partsNeeded.length)&&x.jsx("div",{className:"text-center py-8 text-gray-500",children:'No parts available. Click "Add Part" to add new parts.'})]}),x.jsxs(O,{children:[x.jsx(p,{variant:"outline",onClick:()=>Us(!1),children:"Close"}),x.jsx(p,{onClick:()=>{Us(!1),dt(Hs)},children:"Add New Part"})]})]})}),x.jsx(v,{open:As,onOpenChange:$s,children:x.jsxs(j,{className:"max-w-2xl",children:[x.jsxs(g,{children:[x.jsx(f,{children:"All Tools"}),x.jsx(_,{children:"All tools for this car. Click any tool to edit or delete it."})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:null==(l=h.find(e=>e.car.id===Hs))?void 0:l.toolsRequired.map((e,s)=>x.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[x.jsxs("div",{className:"flex-1",children:[x.jsx("div",{className:"font-medium",children:e.toolName}),x.jsxs("div",{className:"text-sm text-gray-500",children:["Type: ",e.toolType]}),x.jsxs("div",{className:"text-sm text-gray-500",children:["Required: ",e.isRequired?"Yes":"No"]})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(p,{size:"sm",variant:"outline",onClick:()=>{$s(!1),xt(Hs,e)},children:"Edit"}),x.jsx(p,{size:"sm",variant:"destructive",onClick:()=>{const s=h.map(s=>{if(s.car.id===Hs){const t=s.toolsRequired.filter(s=>s!==e);return o(n({},s),{toolsRequired:t})}return s});D(s),w({title:"Tool Deleted",description:`${e.toolName} removed from the tools list`})},children:"Delete"})]})]},s))}),0===(null==(d=h.find(e=>e.car.id===Hs))?void 0:d.toolsRequired.length)&&x.jsx("div",{className:"text-center py-8 text-gray-500",children:'No tools available. Click "Add Tool" to add new tools.'})]}),x.jsxs(O,{children:[x.jsx(p,{variant:"outline",onClick:()=>$s(!1),children:"Close"}),x.jsx(p,{onClick:()=>{$s(!1),ct(Hs)},children:"Add New Tool"})]})]})}),x.jsx(v,{open:ee,onOpenChange:se,children:x.jsxs(j,{className:"max-w-4xl h-[90vh] flex flex-col",children:[x.jsxs(g,{className:"flex-shrink-0 pb-4 border-b",children:[x.jsxs(f,{className:"flex items-center gap-2",children:[x.jsx(G,{className:"h-5 w-5"}),"Car Details - ",null==Z?void 0:Z.car.carModel]}),x.jsx(_,{children:"Comprehensive view of all car information, work progress, and details"})]}),x.jsx("div",{className:"flex-1 overflow-y-auto pr-2",style:{scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"},children:Z&&x.jsxs("div",{className:"space-y-6 py-4",children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold border-b pb-2",children:"Basic Information"}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Car Model:"}),x.jsx("span",{children:Z.car.carModel})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Car Code:"}),x.jsx("span",{children:Z.car.carCode})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"VIN:"}),x.jsx("span",{children:Z.car.vin||"Not available"})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Customer:"}),x.jsx("span",{children:Z.car.customerName})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Priority:"}),x.jsx(C,{className:wt(Z.car.priority),variant:"outline",children:Z.car.priority.toUpperCase()})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Status:"}),x.jsx(C,{className:bt(Z.car.status),children:Z.car.status.replace("_"," ").toUpperCase()})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Work Type:"}),x.jsxs("div",{className:"flex items-center gap-2",children:[yt(Z.car.workType),x.jsx("span",{children:Z.car.workType.replace("_"," ").toUpperCase()})]})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Assigned Mechanic:"}),x.jsx("span",{children:Z.car.assignedMechanic||"Unassigned"})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Estimated Duration:"}),x.jsxs("span",{children:[Z.car.estimatedDuration," hours"]})]})]})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold border-b pb-2",children:"Work Progress"}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Progress:"}),x.jsxs("span",{children:[Z.timeProgress.percentage,"%"]})]}),x.jsx(L,{value:Z.timeProgress.percentage,className:"h-2"}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Elapsed Time:"}),x.jsx("span",{children:Ct(Z.timeProgress.elapsed)})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Remaining Time:"}),x.jsx("span",{children:Ct(Z.timeProgress.remaining)})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Timer Status:"}),x.jsx("span",{className:Z.isTimerRunning?"text-green-600 font-semibold":"text-gray-600",children:Z.isTimerRunning?"⏱️ Running":"⏸️ Stopped"})]}),Z.timeProgress.isOverrunning&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Overrun:"}),x.jsxs(C,{className:"bg-red-100 text-red-700",children:["⚠️ ",Ct(Z.timeProgress.elapsed-60*parseInt(Z.car.estimatedDuration))]})]})]})]})]}),x.jsxs("div",{className:"border-t pt-4",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Timer Controls"}),x.jsx("div",{className:"flex gap-2",children:Z.isTimerRunning?x.jsxs(p,{onClick:()=>Dt(Z),className:"bg-red-50 hover:bg-red-100 text-red-700",children:[x.jsx(De,{className:"h-4 w-4 mr-2"}),"Stop Timer"]}):x.jsxs(p,{onClick:()=>kt(Z),className:"bg-green-50 hover:bg-green-100 text-green-700",children:[x.jsx(Te,{className:"h-4 w-4 mr-2"}),"Start Timer"]})})]}),x.jsxs("div",{className:"border-t pt-4",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Parts Information"}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("h4",{className:"font-medium mb-2",children:"AI Recommended Parts:"}),x.jsx("div",{className:"space-y-2",children:Z.partsNeeded.map((e,s)=>x.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[x.jsx("span",{children:e.partName}),x.jsx(C,{variant:"outline",className:"text-xs",children:e.partNumber})]},s))})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"font-medium mb-2",children:"Scanned Parts:"}),x.jsx("div",{className:"space-y-2",children:Z.car.partsHistory.length>0?Z.car.partsHistory.map((e,s)=>x.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded",children:[x.jsx("span",{children:e.partName}),x.jsx("div",{className:"text-xs text-gray-500",children:new Date(e.scannedAt).toLocaleDateString()})]},s)):x.jsx("div",{className:"text-gray-500 text-sm",children:"No parts scanned yet"})})]})]})]}),x.jsxs("div",{className:"border-t pt-4",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Tools Information"}),x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.jsxs("div",{children:[x.jsx("h4",{className:"font-medium mb-2",children:"Required Tools:"}),x.jsx("div",{className:"space-y-2",children:Z.toolsRequired.map((e,s)=>x.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded",children:[x.jsx("span",{children:e.toolName}),x.jsx(C,{variant:"outline",className:"text-xs",children:e.toolType})]},s))})]})})]}),x.jsxs("div",{className:"border-t pt-4",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3",children:"AI Recommendations"}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"font-medium",children:"Expected Time:"}),x.jsx("span",{children:Z.aiRecommendations.expectedTime})]}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"Notes:"}),x.jsx("p",{className:"text-sm text-gray-600 mt-1",children:Z.aiRecommendations.notes})]})]})]}),Z.car.notes&&x.jsxs("div",{className:"border-t pt-4",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Work Notes"}),x.jsx("div",{className:"p-3 bg-gray-50 rounded",children:x.jsx("p",{className:"text-sm",children:Z.car.notes})})]})]})}),x.jsxs(O,{className:"flex-shrink-0 pt-4 border-t",children:[x.jsx(p,{variant:"outline",onClick:()=>se(!1),children:"Close"}),x.jsx(p,{onClick:()=>{se(!1)},children:"Export Details"})]})]})}),x.jsx(v,{open:us,onOpenChange:hs,children:x.jsxs(j,{className:"max-w-md",children:[x.jsxs(g,{children:[x.jsxs(f,{className:"flex items-center gap-2",children:[x.jsx(Me,{className:"h-5 w-5 text-green-600"}),"Complete Repair & Move Car"]}),x.jsx(_,{children:"Choose where to send the completed car after repair"})]}),x.jsxs("div",{className:"space-y-4",children:[xs&&x.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[x.jsx("h4",{className:"font-medium text-blue-900",children:xs.car.carModel}),x.jsxs("p",{className:"text-sm text-blue-700",children:["VIN: ",xs.car.vin||xs.car.carCode]}),x.jsxs("p",{className:"text-sm text-blue-700",children:["Status: ",xs.car.status]})]}),x.jsxs("div",{className:"space-y-3",children:[x.jsx(N,{className:"text-sm font-medium",children:"Select Destination:"}),x.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[x.jsx(p,{variant:"floor1"===vs?"default":"outline",onClick:()=>js("floor1"),className:"justify-start h-auto p-4",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx(Y,{className:"h-5 w-5"}),x.jsxs("div",{className:"text-left",children:[x.jsx("div",{className:"font-medium",children:"Floor 1 Inventory"}),x.jsx("div",{className:"text-sm text-muted-foreground",children:"Showroom Floor 1"})]})]})}),x.jsx(p,{variant:"floor2"===vs?"default":"outline",onClick:()=>js("floor2"),className:"justify-start h-auto p-4",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx(Y,{className:"h-5 w-5"}),x.jsxs("div",{className:"text-left",children:[x.jsx("div",{className:"font-medium",children:"Floor 2 Inventory"}),x.jsx("div",{className:"text-sm text-muted-foreground",children:"Showroom Floor 2"})]})]})}),x.jsx(p,{variant:"garage"===vs?"default":"outline",onClick:()=>js("garage"),className:"justify-start h-auto p-4",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx(K,{className:"h-5 w-5"}),x.jsxs("div",{className:"text-left",children:[x.jsx("div",{className:"font-medium",children:"Garage Inventory"}),x.jsx("div",{className:"text-sm text-muted-foreground",children:"Keep in garage for further work"})]})]})}),x.jsx(p,{variant:"car_inventory"===vs?"default":"outline",onClick:()=>js("car_inventory"),className:"justify-start h-auto p-4",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx(G,{className:"h-5 w-5"}),x.jsxs("div",{className:"text-left",children:[x.jsx("div",{className:"font-medium",children:"Car Inventory"}),x.jsx("div",{className:"text-sm text-muted-foreground",children:"Main car inventory system"})]})]})})]})]})]}),x.jsxs(O,{children:[x.jsx(p,{variant:"outline",onClick:()=>hs(!1),children:"Cancel"}),x.jsxs(p,{onClick:()=>c(void 0,null,function*(){var e;if(xs&&vs)try{const t=xs.car,a=t.vin||t.carCode;let r;switch(vs){case"floor1":case"floor2":case"car_inventory":default:r="in_stock";break;case"garage":r="in_repair"}if(!(yield Oe.updateCarStatus(a,r)))return void w({title:"Status Update Failed",description:"Failed to update car status in inventory",variant:"destructive"});if(!(yield Oe.moveCarToDestination(a,vs)))return void w({title:"Move Failed",description:"Failed to move car to selected destination",variant:"destructive"});yield(e=xs,c(void 0,null,function*(){try{const{enhancedRepairHistoryService:s}=yield u(()=>c(void 0,null,function*(){const{enhancedRepairHistoryService:e}=yield import("./enhancedRepairHistoryService-DfLNwEz9.js");return{enhancedRepairHistoryService:e}}),__vite__mapDeps([0,1,2,3,4,5,6])),t=e.car.actualStartTime?new Date(e.car.actualStartTime):null,a=e.car.actualEndTime?new Date(e.car.actualEndTime):new Date;t&&Math.floor((a.getTime()-t.getTime())/6e4),e.car.vin||e.car.carCode,e.car.carModel,e.car.customerName,e.car.notes,e.car.workType,e.car.carModel,e.car.workType,e.car.partsHistory.map(e=>({part_number:e.partNumber,part_name:e.partName,quantity:1,cost:0,supplier:"Monza Parts"})),e.car.assignedMechanic,t?t.toISOString():(new Date).toISOString(),a.toISOString(),e.car.workType,w({title:"Repair History Updated",description:`${e.car.carModel} repair data has been saved to repair history with ${e.car.partsHistory.length} parts and ${e.toolsRequired.length} tools used`})}catch(s){w({title:"Error",description:"Failed to save repair history data",variant:"destructive"})}})),yield s(t.id,"completed"),w({title:"Repair Completed",description:`${t.carModel} has been completed and moved to ${Tt(vs)}`}),yield gt(),hs(!1),ps(null),js("")}catch(t){w({title:"Error",description:"An error occurred while completing the repair",variant:"destructive"})}else w({title:"Missing Information",description:"Please select a destination for the completed car",variant:"destructive"})}),disabled:!vs,className:"bg-green-600 hover:bg-green-700",children:[x.jsx(Me,{className:"h-4 w-4 mr-2"}),"Complete & Move"]})]})]})}),x.jsx(ze,{isOpen:gs,onClose:()=>{fs(!1),ys(null)},carDetails:Ns?{id:Ns.car.id,carCode:Ns.car.carCode,carModel:Ns.car.carModel,customerName:Ns.car.customerName,assignedMechanic:Ns.car.assignedMechanic,workType:Ns.car.workType,status:Ns.car.status,issueDescription:Ns.car.issueDescription||Ns.car.notes||"",partsUsed:Ns.car.partsUsed||[],toolsUsed:Ns.car.toolsUsed||[],estimatedDuration:Ns.car.estimatedDuration,actualDuration:Ns.car.actualDuration,startTime:Ns.car.startTime,endTime:Ns.car.actualEndTime}:null,onSubmit:e=>c(void 0,null,function*(){try{if(!fe.saveRepairFromCompletion(e))return void w({title:"Error",description:"Failed to save repair to history",variant:"destructive"});if(Ns){const s=Ns.car,t=s.vin||s.carCode;yield Oe.updateCarStatus(t,"completed");const a=h.filter(e=>e.car.id!==s.id);D(a),Le.recordScheduleChange(s.id,s.carCode,s.carModel,s.customerName,s.status,"completed",e.assignedMechanic,"completion",`Repair completed and documented. ${e.solutionDescription}`,{partsUsed:e.partsUsed.map(e=>e.partName),toolsUsed:e.toolsUsed,workNotes:e.mechanicNotes,actualDuration:`${e.totalLaborHours}h`,assignedMechanic:e.assignedMechanic}),w({title:"✅ Repair Completed",description:`Repair for ${s.carModel} (${s.carCode}) has been completed and documented in repair history.`})}fs(!1),ys(null)}catch(s){w({title:"Error",description:"An error occurred while completing the repair",variant:"destructive"})}})})]}):x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:"flex items-center justify-between",children:x.jsxs("div",{children:[x.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Garage Schedule - Repair Station"}),x.jsx("p",{className:"text-gray-600",children:"Comprehensive view of all scheduled cars with parts, tools, and work progress"})]})}),x.jsxs(I,{children:[x.jsx(R,{children:x.jsxs(E,{className:"flex items-center gap-2",children:[x.jsx(H,{className:"h-5 w-5"}),"Scheduled Cars (0)"]})}),x.jsx(M,{children:x.jsx("div",{className:"text-center py-8 text-gray-500",children:"No cars scheduled for today. The schedule will appear here when cars are added."})})]})]})},Ye=({isOpen:e,onClose:s,completedCar:t})=>{var a;const[r,i]=re.useState(""),[l,d]=re.useState("in_stock"),[m,u]=re.useState({name:"",phone:"",email:"",address:""}),[h,y]=re.useState(""),[k,D]=re.useState(!1);re.useEffect(()=>{e&&(i(""),d("in_stock"),u({name:"",phone:"",email:"",address:""}),y(""))},[e]);const _=[{value:"in_stock",label:"In Stock",description:"Available for sale"},{value:"reserved",label:"Reserved",description:"Reserved for customer"},{value:"sold",label:"Sold",description:"Car has been sold"}];return t?x.jsx(v,{open:e,onOpenChange:s,children:x.jsxs(j,{className:"max-w-2xl",children:[x.jsx(g,{children:x.jsxs(f,{className:"flex items-center gap-2",children:[x.jsx(P,{className:"h-5 w-5 text-green-500"}),"Complete Garage Work"]})}),x.jsxs("div",{className:"space-y-6",children:[x.jsxs(I,{children:[x.jsx(R,{children:x.jsxs(E,{className:"flex items-center gap-2",children:[x.jsx(G,{className:"h-4 w-4"}),"Car Information"]})}),x.jsx(M,{children:x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx(N,{className:"text-sm font-medium",children:"Car"}),x.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.brand," ",t.model]})]}),x.jsxs("div",{children:[x.jsx(N,{className:"text-sm font-medium",children:"VIN"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:t.vinNumber})]}),x.jsxs("div",{children:[x.jsx(N,{className:"text-sm font-medium",children:"Current Location"}),x.jsx(C,{variant:"secondary",children:"Garage"})]}),x.jsxs("div",{children:[x.jsx(N,{className:"text-sm font-medium",children:"Work Type"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:t.workType||"General Service"})]})]})})]}),x.jsxs(I,{children:[x.jsx(R,{children:x.jsxs(E,{className:"flex items-center gap-2",children:[x.jsx(Z,{className:"h-4 w-4"}),"Where should the car go?"]})}),x.jsx(M,{children:x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx(N,{htmlFor:"destination",children:"Destination"}),x.jsxs(X,{value:r,onValueChange:i,children:[x.jsx(ee,{children:x.jsx(se,{placeholder:"Select destination"})}),x.jsx(te,{children:[{value:"Showroom Floor 1",label:"Showroom Floor 1",description:"Display for customers"},{value:"Showroom Floor 2",label:"Showroom Floor 2",description:"Additional display area"},{value:"Inventory",label:"Inventory Storage",description:"Back storage area"},{value:"Inventory Floor 2",label:"Inventory Floor 2",description:"Secondary storage"},{value:"Delivery Lot",label:"Delivery Lot",description:"Ready for customer pickup"},{value:"Test Drive",label:"Test Drive Area",description:"Available for test drives"},{value:"External Location",label:"External Location",description:"Off-site location"}].map(e=>x.jsx(ae,{value:e.value,children:x.jsxs("div",{className:"flex flex-col",children:[x.jsx("span",{children:e.label}),x.jsx("span",{className:"text-xs text-muted-foreground",children:e.description})]})},e.value))})]})]}),r&&x.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(Re,{className:"h-4 w-4 text-blue-500"}),x.jsx("span",{className:"text-sm font-medium",children:"Car will be moved to:"}),x.jsx(C,{className:(e=>{switch(e){case"Showroom Floor 1":case"Showroom Floor 2":return"bg-purple-100 text-purple-800";case"Inventory":case"Inventory Floor 2":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}})(r),children:r})]})})]})})]}),x.jsxs(I,{children:[x.jsx(R,{children:x.jsxs(E,{className:"flex items-center gap-2",children:[x.jsx(T,{className:"h-4 w-4"}),"Car Status"]})}),x.jsx(M,{children:x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx(N,{htmlFor:"status",children:"Status"}),x.jsxs(X,{value:l,onValueChange:d,children:[x.jsx(ee,{children:x.jsx(se,{placeholder:"Select status"})}),x.jsx(te,{children:_.map(e=>x.jsx(ae,{value:e.value,children:x.jsxs("div",{className:"flex flex-col",children:[x.jsx("span",{children:e.label}),x.jsx("span",{className:"text-xs text-muted-foreground",children:e.description})]})},e.value))})]})]}),l&&x.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(P,{className:"h-4 w-4 text-green-500"}),x.jsx("span",{className:"text-sm font-medium",children:"Car status will be:"}),x.jsx(C,{className:(e=>{switch(e){case"in_stock":return"bg-green-100 text-green-800";case"reserved":return"bg-yellow-100 text-yellow-800";case"sold":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(l),children:null==(a=_.find(e=>e.value===l))?void 0:a.label})]})})]})})]}),("reserved"===l||"sold"===l)&&x.jsxs(I,{children:[x.jsx(R,{children:x.jsxs(E,{className:"flex items-center gap-2",children:[x.jsx(T,{className:"h-4 w-4"}),"Client Information"]})}),x.jsx(M,{children:x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx(N,{htmlFor:"clientName",children:"Client Name *"}),x.jsx(b,{id:"clientName",value:m.name,onChange:e=>u(s=>o(n({},s),{name:e.target.value})),placeholder:"Enter client name"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"clientPhone",children:"Phone *"}),x.jsx(b,{id:"clientPhone",value:m.phone,onChange:e=>u(s=>o(n({},s),{phone:e.target.value})),placeholder:"Enter phone number"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"clientEmail",children:"Email"}),x.jsx(b,{id:"clientEmail",value:m.email,onChange:e=>u(s=>o(n({},s),{email:e.target.value})),placeholder:"Enter email address"})]}),x.jsxs("div",{children:[x.jsx(N,{htmlFor:"clientAddress",children:"Address"}),x.jsx(b,{id:"clientAddress",value:m.address,onChange:e=>u(s=>o(n({},s),{address:e.target.value})),placeholder:"Enter address"})]})]})})]}),x.jsxs(I,{children:[x.jsx(R,{children:x.jsxs(E,{className:"flex items-center gap-2",children:[x.jsx(Ee,{className:"h-4 w-4"}),"Work Notes"]})}),x.jsx(M,{children:x.jsxs("div",{children:[x.jsx(N,{htmlFor:"workNotes",children:"Notes about completed work"}),x.jsx(S,{id:"workNotes",value:h,onChange:e=>y(e.target.value),placeholder:"Describe the work that was completed...",rows:3})]})})]}),x.jsxs("div",{className:"flex justify-end gap-3",children:[x.jsx(p,{variant:"outline",onClick:s,disabled:k,children:"Cancel"}),x.jsx(p,{onClick:()=>c(void 0,null,function*(){if(t&&r)if("reserved"!==l&&"sold"!==l||m.name&&m.phone){D(!0);try{const e=JSON.parse(localStorage.getItem("carInventory")||"[]"),a=e.findIndex(e=>e.id===t.id||e.carCode===t.carCode||e.vinNumber===t.vinNumber);if(-1===a)throw new Error("Car not found in inventory");const i=o(n({},e[a]),{currentFloor:r,status:l,lastUpdated:(new Date).toISOString(),workCompleted:!0,workCompletionDate:(new Date).toISOString(),workNotes:h,moveHistory:[...e[a].moveHistory||[],{from:"Garage",to:r,date:(new Date).toISOString(),reason:"Work completed",notes:h}]});"reserved"!==l&&"sold"!==l||(i.clientName=m.name,i.clientPhone=m.phone,i.clientEmail=m.email,i.clientAddress=m.address,"sold"===l?i.soldDate=(new Date).toISOString():"reserved"===l&&(i.reservedDate=(new Date).toISOString())),e[a]=i,localStorage.setItem("carInventory",JSON.stringify(e));const c=JSON.parse(localStorage.getItem("garageSchedule")||"[]").filter(e=>e.carId!==t.id&&e.carCode!==t.carCode);localStorage.setItem("garageSchedule",JSON.stringify(c));const d=JSON.parse(localStorage.getItem("activityLogs")||"[]"),u={id:`activity_${Date.now()}_${t.id}`,timestamp:(new Date).toISOString(),action:"garage_work_completed",itemId:t.id,itemType:"car",description:`Work completed on ${t.brand} ${t.carModel}. Moved to ${r} with status: ${l}`,userId:"employee",changes:{destination:r,status:l,workNotes:h}};d.push(u),localStorage.setItem("activityLogs",JSON.stringify(d)),w({title:"Work Completed Successfully",description:`${t.model} moved to ${r} with status: ${l}`}),s()}catch(e){w({title:"Error",description:"Failed to complete workflow. Please try again.",variant:"destructive"})}finally{D(!1)}}else w({title:"Missing Client Information",description:"Please provide client name and phone for reserved/sold cars",variant:"destructive"});else w({title:"Missing Information",description:"Please select a destination for the car",variant:"destructive"})}),disabled:k||!r,className:"bg-green-600 hover:bg-green-700",children:k?"Processing...":"Complete Work"})]})]})]})}):null},Ke=()=>{var e;const{todaySchedule:s,today:t,saveSchedules:a,schedules:r}=(()=>{const[e,s]=re.useState([]),[t,a]=re.useState(null),[r,i]=re.useState(null);m();const l=le(new Date,"yyyy-MM-dd"),d=le(ne(new Date,1),"yyyy-MM-dd");re.useEffect(()=>{c(void 0,null,function*(){try{const{DatabaseManager:e}=yield u(()=>c(void 0,null,function*(){const{DatabaseManager:e}=yield import("./DatabaseManager-DSqM9OXw.js");return{DatabaseManager:e}}),__vite__mapDeps([7,8,1,2,3,4,5,9,10])),t=yield e.getScheduledCount(),r={id:"today",date:l,startTime:"09:00",endTime:"17:00",available:!0,notes:t>0?`${t} cars scheduled`:"No scheduled cars",maxCarsCapacity:7,currentCarsScheduled:t,scheduledCars:[]},n={id:"tomorrow",date:d,startTime:"09:00",endTime:"17:00",available:!0,notes:"No scheduled cars for tomorrow",maxCarsCapacity:5,currentCarsScheduled:0,scheduledCars:[]};s([r,n]),a(r),i(n)}catch(e){const t={id:"empty-today",date:l,startTime:"09:00",endTime:"17:00",available:!0,notes:"Error loading data",maxCarsCapacity:7,currentCarsScheduled:0,scheduledCars:[]},r={id:"empty-tomorrow",date:d,startTime:"09:00",endTime:"17:00",available:!0,notes:"Error loading data",maxCarsCapacity:5,currentCarsScheduled:0,scheduledCars:[]};s([t,r]),a(t),i(r)}})},[l,d]);const h=e=>{s(e);const t=e.find(e=>e.date===l),r=e.find(e=>e.date===d);a(t||null),i(r||null)};return{schedules:e,todaySchedule:t,tomorrowSchedule:r,today:l,tomorrow:d,saveSchedules:h,createSchedule:(s,t)=>{if(t){const a=e.map(e=>e.id===t.id?o(n(n({},t),s),{maxCarsCapacity:s.maxCarsCapacity,scheduledCars:t.scheduledCars||[]}):e);h(a)}else{const t=o(n({id:Date.now().toString()},s),{maxCarsCapacity:s.maxCarsCapacity,currentCarsScheduled:0,scheduledCars:[]});h([...e,t])}},deleteSchedule:s=>{const t=e.filter(e=>e.id!==s);h(t)},createDefaultSchedule:s=>{const t={id:Date.now().toString(),date:s,startTime:"09:00",endTime:"17:00",available:!0,notes:"",maxCarsCapacity:7,currentCarsScheduled:0,scheduledCars:[]};h([...e,t])}}})(),[i,l]=re.useState(!1),[d,h]=re.useState(null);return x.jsx("div",{className:"p-6 garage-schedule-container",children:x.jsxs("div",{className:"garage-schedule-content",children:[x.jsxs("div",{className:"mb-4",children:[x.jsx("h1",{className:"text-2xl font-bold",children:"Garage Schedule"}),x.jsxs("p",{className:"text-gray-600",children:["Today: ",t]}),x.jsxs("p",{className:"text-gray-600",children:["Cars scheduled: ",(null==(e=null==s?void 0:s.scheduledCars)?void 0:e.length)||0]})]}),x.jsx("div",{className:"garage-schedule-table-container",children:x.jsx(Ge,{scheduledCars:(null==s?void 0:s.scheduledCars)||[],onStatusUpdate:(e,t)=>{var i;const l=s;if(!l)return;const c=o(n({},l),{scheduledCars:(null==(i=l.scheduledCars)?void 0:i.map(s=>s.id===e?o(n({},s),{status:t}):s))||[]}),d=r.map(e=>e.id===l.id?c:e);a(d)},onViewDetails:()=>{},onWorkflowComplete:e=>{h(e),l(!0)}})}),x.jsx(Ye,{isOpen:i,onClose:()=>{l(!1),h(null),window.location.reload()},completedCar:d})]})})};export{Ke as default};
