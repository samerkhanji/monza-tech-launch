import{K as e,s,j as t,aY as i,am as a,aZ as l,ae as r,k as n,C as c,g as d,h as o,a as x,V as m,n as h,d as j,p as u,q as v,r as N,v as y,R as p,e as f,a7 as g,c as w,a6 as _,f as b}from"./index-BmUpYGrm.js";import{r as R}from"./vendor-vN6PtkFd.js";import{T as E,a as O,b as L,c as S,d as U,e as A}from"./table-BEISn_Te.js";import{R as W}from"./refresh-cw-C6MAcERo.js";import{D as k}from"./download-CLPHGjzE.js";import{G as C}from"./globe-DlCryj_B.js";import{S as D}from"./smartphone-Cgftoe1I.js";import{f as I}from"./utils-DhcIvS4g.js";import"./charts-XrXYWaKo.js";function T(){var T;const{user:M}=e(),[P,H]=R.useState(null),[q,F]=R.useState([]),[$,z]=R.useState(!0),[B,V]=R.useState(7),[G,K]=R.useState("overview"),J="OWNER"===(null==(T=null==M?void 0:M.role)?void 0:T.toUpperCase());R.useEffect(()=>{J&&Y()},[J,B]);const Y=()=>{return e=this,t=null,i=function*(){z(!0);try{const{data:e,error:t}=yield s.rpc("get_owner_activity_summary",{p_days:B});if(t)throw t;H(e[0]||null);const{data:i,error:a}=yield s.from("all_user_activity").select("*").gte("login_time",new Date(Date.now()-24*B*60*60*1e3).toISOString()).order("login_time",{ascending:!1}).limit(500);if(a)throw a;F(i||[])}catch(e){}finally{z(!1)}},new Promise((s,a)=>{var l=e=>{try{n(i.next(e))}catch(s){a(s)}},r=e=>{try{n(i.throw(e))}catch(s){a(s)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,r);n((i=i.apply(e,t)).next())});var e,t,i},Z=e=>[["Date/Time","User","Role","Email","Location","Country","IP Address","Device","Browser","Status","Category","Time Category"],...e.map(e=>[I(new Date(e.login_time),"yyyy-MM-dd HH:mm:ss"),e.user_name||e.email.split("@")[0],e.role,e.email,`${e.city||"Unknown"}, ${e.region||""}`.replace(", ",", ").trim(),e.country||"Unknown",e.ip_address,e.device_type||"Unknown",e.browser||"Unknown",e.login_status,e.location_category,e.time_category])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),Q=e=>{switch(e){case"TRACKED_UNRESTRICTED":return"bg-blue-500 text-white";case"SUSPICIOUS":return"bg-red-500 text-white";case"NEW_LOCATION":return"bg-yellow-500 text-white";case"FAILED_LOGIN":return"bg-orange-500 text-white";default:return"bg-green-500 text-white"}},X=e=>{const s=[e.city,e.region,e.country].filter(Boolean);return s.length>0?s.join(", "):"Unknown Location"};return J?$?t.jsx("div",{className:"container mx-auto p-6",children:t.jsxs("div",{className:"flex items-center justify-center min-h-[400px]",children:[t.jsx(W,{className:"h-8 w-8 animate-spin"}),t.jsx("span",{className:"ml-2",children:"Loading developer overview..."})]})}):t.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[t.jsx(r,{className:"h-8 w-8 text-yellow-500"}),"Developer Overview"]}),t.jsx("p",{className:"text-muted-foreground",children:"Complete system activity and OWNER tracking"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("select",{id:"timeRangeFilter",name:"timeRangeFilter",value:B,onChange:e=>V(Number(e.target.value)),className:"px-3 py-2 border rounded-md",children:[t.jsx("option",{value:1,children:"Last 24 hours"}),t.jsx("option",{value:7,children:"Last 7 days"}),t.jsx("option",{value:30,children:"Last 30 days"}),t.jsx("option",{value:90,children:"Last 90 days"})]}),t.jsxs(n,{onClick:Y,variant:"outline",size:"sm",children:[t.jsx(W,{className:"h-4 w-4 mr-2"}),"Refresh"]}),t.jsxs(n,{onClick:()=>{const e=Z(q),s=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(s),i=document.createElement("a");i.href=t,i.download=`monza-user-activity-${I(new Date,"yyyy-MM-dd")}.csv`,i.click(),window.URL.revokeObjectURL(t)},variant:"outline",size:"sm",children:[t.jsx(k,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]}),P&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs(c,{children:[t.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(o,{className:"text-sm font-medium",children:"OWNER Logins"}),t.jsx(r,{className:"h-4 w-4 text-yellow-500"})]}),t.jsxs(x,{children:[t.jsx("div",{className:"text-2xl font-bold",children:P.total_logins}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[P.unique_owners," unique OWNER",1!==P.unique_owners?"s":""]})]})]}),t.jsxs(c,{children:[t.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(o,{className:"text-sm font-medium",children:"Locations"}),t.jsx(m,{className:"h-4 w-4 text-blue-500"})]}),t.jsxs(x,{children:[t.jsx("div",{className:"text-2xl font-bold",children:P.unique_locations}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[P.international_logins," international"]})]})]}),t.jsxs(c,{children:[t.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(o,{className:"text-sm font-medium",children:"After Hours"}),t.jsx(h,{className:"h-4 w-4 text-orange-500"})]}),t.jsxs(x,{children:[t.jsx("div",{className:"text-2xl font-bold",children:P.after_hours_logins}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[P.weekend_logins," weekend logins"]})]})]}),t.jsxs(c,{children:[t.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(o,{className:"text-sm font-medium",children:"Failed Attempts"}),t.jsx(j,{className:"h-4 w-4 text-red-500"})]}),t.jsxs(x,{children:[t.jsx("div",{className:"text-2xl font-bold",children:P.failed_attempts}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[P.unique_ips," unique IPs"]})]})]})]}),t.jsxs(u,{value:G,onValueChange:K,children:[t.jsxs(v,{children:[t.jsx(N,{value:"overview",children:"All Activity"}),t.jsx(N,{value:"owners",children:"OWNER Tracking"}),t.jsx(N,{value:"security",children:"Security Events"}),t.jsx(N,{value:"analytics",children:"Analytics"})]}),t.jsx(y,{value:"overview",className:"space-y-4",children:t.jsxs(c,{children:[t.jsxs(d,{children:[t.jsx(o,{children:"Complete User Activity Log"}),t.jsxs(p,{children:["All login activity across the system (last ",B," days)"]})]}),t.jsxs(x,{children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs(E,{children:[t.jsx(O,{children:t.jsxs(L,{children:[t.jsx(S,{children:"Time"}),t.jsx(S,{children:"User"}),t.jsx(S,{children:"Role"}),t.jsx(S,{children:"Location"}),t.jsx(S,{children:"Device"}),t.jsx(S,{children:"IP Address"}),t.jsx(S,{children:"Status"}),t.jsx(S,{children:"Category"})]})}),t.jsx(U,{children:q.map(e=>t.jsxs(L,{children:[t.jsx(A,{className:"font-mono text-sm",children:I(new Date(e.login_time),"MMM dd, HH:mm")}),t.jsx(A,{children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium flex items-center gap-1",children:["OWNER"===e.role&&t.jsx(r,{className:"h-3 w-3 text-yellow-500"}),e.user_name||e.email.split("@")[0]]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:e.email})]})}),t.jsx(A,{children:t.jsx(f,{variant:"OWNER"===e.role?"default":"outline",children:e.role})}),t.jsx(A,{children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(C,{className:"h-4 w-4 mr-1"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",children:X(e)}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.location_category})]})]})}),t.jsx(A,{children:t.jsxs("div",{className:"flex items-center",children:["mobile"===e.device_type?t.jsx(D,{className:"h-4 w-4 mr-1"}):t.jsx(g,{className:"h-4 w-4 mr-1"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",children:e.device_type||"Unknown"}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.browser})]})]})}),t.jsx(A,{className:"font-mono text-sm",children:e.ip_address}),t.jsx(A,{children:t.jsx(f,{className:Q(e.login_status),children:e.login_status.replace("_"," ")})}),t.jsx(A,{children:t.jsxs("div",{className:"text-sm",children:[t.jsx("div",{children:e.time_category}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.location_category})]})})]},e.id))})]})}),0===q.length&&t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(w,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{children:"No user activity found for the selected time range"})]})]})]})}),t.jsx(y,{value:"owners",className:"space-y-4",children:t.jsxs(c,{children:[t.jsxs(d,{children:[t.jsxs(o,{className:"flex items-center gap-2",children:[t.jsx(r,{className:"h-5 w-5 text-yellow-500"}),"OWNER Activity Tracking"]}),t.jsx(p,{children:"Unrestricted access monitoring for all OWNER users"})]}),t.jsx(x,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs(i,{children:[t.jsx(_,{className:"h-4 w-4"}),t.jsxs(l,{children:[t.jsx("strong",{children:"OWNER Policy:"})," OWNERs can login from anywhere without restrictions, but all activity is tracked for security oversight."]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs(E,{children:[t.jsx(O,{children:t.jsxs(L,{children:[t.jsx(S,{children:"Time"}),t.jsx(S,{children:"OWNER"}),t.jsx(S,{children:"Location"}),t.jsx(S,{children:"Device"}),t.jsx(S,{children:"IP Address"}),t.jsx(S,{children:"Access Pattern"})]})}),t.jsx(U,{children:q.filter(e=>"OWNER"===e.role).map(e=>t.jsxs(L,{children:[t.jsx(A,{className:"font-mono text-sm",children:I(new Date(e.login_time),"MMM dd, HH:mm")}),t.jsx(A,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(r,{className:"h-4 w-4 text-yellow-500"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.user_name||e.email.split("@")[0]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:e.email})]})]})}),t.jsx(A,{children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",children:X(e)}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.location_category})]})}),t.jsx(A,{children:t.jsxs("div",{className:"flex items-center",children:["mobile"===e.device_type?t.jsx(D,{className:"h-4 w-4 mr-1"}):t.jsx(g,{className:"h-4 w-4 mr-1"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",children:e.device_type}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.browser})]})]})}),t.jsx(A,{className:"font-mono text-sm",children:e.ip_address}),t.jsx(A,{children:t.jsxs("div",{className:"space-y-1",children:[t.jsx(f,{variant:"secondary",children:e.time_category}),"International"===e.location_category&&t.jsx(f,{variant:"outline",className:"ml-1",children:"International"})]})})]},e.id))})]})}),0===q.filter(e=>"OWNER"===e.role).length&&t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(r,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{children:"No OWNER activity found for the selected time range"})]})]})})]})}),t.jsx(y,{value:"security",className:"space-y-4",children:t.jsxs(c,{children:[t.jsxs(d,{children:[t.jsx(o,{children:"Security Events"}),t.jsx(p,{children:"Failed logins, suspicious activity, and security alerts"})]}),t.jsx(x,{children:t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(a,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{children:"Security events monitoring interface"}),t.jsx("p",{className:"text-xs",children:"Will show failed logins, suspicious patterns, and alerts"})]})})]})}),t.jsx(y,{value:"analytics",className:"space-y-4",children:t.jsxs(c,{children:[t.jsxs(d,{children:[t.jsx(o,{children:"Usage Analytics"}),t.jsx(p,{children:"System usage patterns and trends"})]}),t.jsx(x,{children:t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(b,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),t.jsx("p",{children:"Analytics dashboard coming soon"}),t.jsx("p",{className:"text-xs",children:"Will show usage trends, popular locations, device analytics"})]})})]})})]})]}):t.jsx("div",{className:"container mx-auto p-6",children:t.jsxs(i,{children:[t.jsx(a,{className:"h-4 w-4"}),t.jsx(l,{children:"Access Denied: This is a developer-only overview dashboard."})]})})}export{T as default};
