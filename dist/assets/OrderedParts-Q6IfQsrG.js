var e=Object.defineProperty,a=Object.defineProperties,r=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(a,r,t)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[r]=t,l=(e,a)=>{for(var r in a||(a={}))s.call(a,r)&&i(e,r,a[r]);if(t)for(var r of t(a))n.call(a,r)&&i(e,r,a[r]);return e},o=(e,t)=>a(e,r(t)),c=(e,a,r)=>new Promise((t,s)=>{var n=e=>{try{l(r.next(e))}catch(a){s(a)}},i=e=>{try{l(r.throw(e))}catch(a){s(a)}},l=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);l((r=r.apply(e,a)).next())});import{a8 as d,t as m,j as p,k as u,ak as h,y as x,z as v,E as g,F as j,b as y,e as f,C as b,g as N,h as w,R as C,a as k,L as S,I as P,O as E,ar as _,ab as R,ah as D,W as z,a9 as O,X as I,a4 as V,u as M,P as F,p as U,q as T,r as A,v as q,H as L,ad as $,S as B,m as H,aU as W}from"./index-BmUpYGrm.js";import{r as Y}from"./vendor-vN6PtkFd.js";import{E as J}from"./EnhancedSelect-sAMWtD8W.js";import{T as Q,a as Z,b as X,c as G,d as K,e as ee}from"./table-BEISn_Te.js";import{e as ae}from"./enhancedMonzaBotService-CP3UVEVb.js";import{C as re}from"./camera-CKQtJJJ8.js";import{S as te}from"./scan-BkADKRli.js";import{L as se}from"./loader-2-BYW_3amd.js";import{F as ne}from"./file-text-bXPYLusF.js";import{w as ie,s as le,c as oe,b as ce}from"./errorHandling-Dc1u_gNS.js";import{C as de}from"./chevron-left-D5y0IByA.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=d("CameraOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]]),pe=d("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),ue={processReceiptImage(e){return c(this,null,function*(){try{const a=(yield ae.processEnhancedMessage('Analyze this receipt image and extract the following information in JSON format:\n        {\n          "supplier": "supplier name",\n          "orderReference": "order/invoice number",\n          "orderDate": "date in YYYY-MM-DD format",\n          "items": [\n            {\n              "partName": "part name",\n              "partNumber": "part number",\n              "quantity": number,\n              "price": number\n            }\n          ],\n          "totalAmount": total amount,\n          "shippingCompany": "shipping company if mentioned",\n          "trackingCode": "tracking code if mentioned"\n        }\n        Extract all visible parts/items from the receipt. Be thorough and accurate.',{source:"receipt_processing",imageData:e,currentRoute:"/ordered-parts"})).textResponse.match(/\{[\s\S]*\}/);if(a)return JSON.parse(a[0]);throw new Error("Could not extract structured data from receipt")}catch(a){throw new Error("Failed to process receipt. Please try again or enter data manually.")}})}},he=()=>{const[e,a]=Y.useState(!1),[r,t]=Y.useState(null),[s,n]=Y.useState(null),[i,l]=Y.useState(!1),[o,d]=Y.useState(!0),[p,u]=Y.useState(!1),h=Y.useRef(null),x=Y.useRef(null),v=Y.useRef(null),g=Y.useRef(null);Y.useEffect(()=>{c(void 0,null,function*(){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void d(!1);const e=(yield navigator.mediaDevices.enumerateDevices()).some(e=>"videoinput"===e.kind);d(e)}catch(e){d(!1)}})},[]),Y.useEffect(()=>{const a=()=>{document.hidden&&e&&!r&&(y(),m({title:"Camera stopped",description:"Camera was turned off when you left the tab"}))};return document.addEventListener("visibilitychange",a),()=>{document.removeEventListener("visibilitychange",a),v.current&&v.current.getTracks().forEach(e=>e.stop())}},[e,r]);const j=()=>c(void 0,null,function*(){if(h.current&&x.current&&v.current)try{const e=h.current,a=x.current,r=a.getContext("2d");if(!r)throw new Error("Canvas context not available");if((0===e.videoWidth||0===e.videoHeight)&&(yield new Promise(e=>setTimeout(e,100)),0===e.videoWidth||0===e.videoHeight))throw new Error("Video not ready for capture - no dimensions available");a.width=e.videoWidth,a.height=e.videoHeight,r.drawImage(e,0,0,a.width,a.height);const s=a.toDataURL("image/jpeg",.9);return t(s),m({title:"Photo captured",description:"Photo captured successfully"}),s}catch(e){return m({title:"Capture Failed",description:"Failed to capture image. Please try again.",variant:"destructive"}),null}return null}),y=()=>{v.current&&(v.current.getTracks().forEach(e=>{e.stop()}),v.current=null),h.current&&(h.current.srcObject=null),a(!1),t(null),n(null),l(!1)};return{cameraOpen:e,capturedImage:r,setCapturedImage:t,cameraError:s,isCapturing:i,cameraSupported:o,isStartingCamera:p,videoRef:h,canvasRef:x,streamRef:v,fileInputRef:g,startCamera:()=>c(void 0,null,function*(){try{if(n(null),!o)return void n("Camera not supported on this device");v.current&&v.current.getTracks().forEach(e=>e.stop());let t,s={video:{width:{ideal:1920,min:640},height:{ideal:1080,min:480},facingMode:"environment",frameRate:{ideal:30,min:15}}};try{t=yield navigator.mediaDevices.getUserMedia(s)}catch(e){s={video:{facingMode:"environment"}};try{t=yield navigator.mediaDevices.getUserMedia(s)}catch(r){s={video:!0},t=yield navigator.mediaDevices.getUserMedia(s)}}v.current=t;let i=h.current;if(!i)for(let e=0;e<50&&(yield new Promise(e=>setTimeout(e,100)),i=h.current,!i);e++);if(!i)throw new Error("Video element not found in DOM. The camera container may not be rendered yet.");i.srcObject=t,yield new Promise((e,r)=>{if(!h.current)return void r(new Error("Video element not available"));const t=h.current;let s;const n=()=>{s&&clearTimeout(s),t.removeEventListener("loadedmetadata",i),t.removeEventListener("error",o),t.removeEventListener("canplay",l)},i=()=>{},l=()=>{t.play().then(()=>{a(!0),m({title:"Camera started",description:"Camera is ready for capturing"}),n(),e(!0)}).catch(e=>{n(),r(e)})},o=e=>{n(),r(e)};s=setTimeout(()=>{n(),r(new Error("Camera initialization timeout"))},1e4),t.addEventListener("loadedmetadata",i,{once:!0}),t.addEventListener("canplay",l,{once:!0}),t.addEventListener("error",o,{once:!0})})}catch(e){const a=e instanceof Error?e.message:"Unknown camera error";a.includes("Permission denied")||a.includes("NotAllowedError")?n("Camera permission denied. Please allow camera access and try again."):a.includes("NotFoundError")||a.includes("DevicesNotFoundError")?n("No camera found on this device."):a.includes("NotReadableError")||a.includes("TrackStartError")?n("Camera is busy or not accessible. Please close other applications using the camera."):n(a),m({title:"Camera Error",description:`Failed to start camera: ${a}`,variant:"destructive"})}}),capturePhoto:j,captureImage:()=>c(void 0,null,function*(){try{l(!0);return yield j()}catch(e){return m({title:"Capture Failed",description:"Failed to capture image. Please try again.",variant:"destructive"}),null}finally{l(!1)}}),handleFileUpload:e=>new Promise(a=>{var r;const s=null==(r=e.target.files)?void 0:r[0];if(!s)return void a(null);if(!s.type.startsWith("image/"))return m({title:"Invalid file",description:"Please select an image file",variant:"destructive"}),void a(null);const n=new FileReader;n.onload=e=>{var r;const s=null==(r=e.target)?void 0:r.result;t(s),m({title:"Image uploaded",description:"Image uploaded successfully"}),a(s)},n.onerror=()=>{m({title:"Upload failed",description:"Failed to upload image",variant:"destructive"}),a(null)},n.readAsDataURL(s)}),stopCamera:y}},xe=({cameraOpen:e,cameraError:a,capturedImage:r,extractedData:t,isProcessing:s,videoRef:n,canvasRef:i,streamRef:l,fileInputRef:o,onStartCamera:c,onStopCamera:d,onCapturePhoto:m,onFileUpload:x})=>{var v,g;return p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex gap-2",children:[p.jsxs(u,{onClick:e?d:c,disabled:s,className:"flex-1",variant:"outline",children:[e?p.jsx(me,{className:"h-4 w-4 mr-2"}):p.jsx(re,{className:"h-4 w-4 mr-2"}),e?"Stop Camera":"Start Camera"]}),p.jsxs(u,{onClick:()=>{var e;return null==(e=o.current)?void 0:e.click()},disabled:s,variant:"outline",className:"flex items-center gap-2",children:[p.jsx(h,{className:"h-4 w-4"}),"Upload"]})]}),p.jsx("input",{ref:o,type:"file",accept:"image/*",onChange:x,className:"hidden"}),a&&p.jsxs("div",{className:"p-2 bg-red-50 border border-red-200 rounded text-sm text-red-600",children:[p.jsx("strong",{children:"Camera Error:"})," ",a]}),e&&p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"relative w-full bg-gray-900 rounded-lg overflow-hidden border-2 border-blue-300",style:{aspectRatio:"4/3",minHeight:"200px"},children:[p.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{backgroundColor:"#000000",display:"block"}}),p.jsxs("div",{className:"absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-xs flex items-center gap-1",children:[p.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),l.current?"LIVE":"Connecting..."]}),p.jsxs("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs",children:[null==(v=n.current)?void 0:v.videoWidth,"x",null==(g=n.current)?void 0:g.videoHeight]})]}),p.jsxs(u,{onClick:m,className:"w-full",disabled:s||!l.current,children:[p.jsx(re,{className:"h-4 w-4 mr-2"}),"Capture & Auto-Analyze"]})]}),r&&p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"relative",children:[p.jsx("img",{src:r,alt:"Captured",className:"w-full rounded-lg border max-h-64 object-contain bg-gray-50"}),t&&p.jsx("div",{className:"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded text-xs",children:"Analyzed âœ“"})]}),t&&p.jsxs("div",{className:"p-2 bg-green-50 rounded text-xs",children:[p.jsx("strong",{children:"MonzaBot Found:"}),Object.entries(t).map(([e,a])=>p.jsxs("div",{className:"truncate",children:[e,": ",String(a)]},e))]})]}),p.jsx("canvas",{ref:i,className:"hidden"})]})},ve=({isOpen:e,onClose:a,onSave:r})=>{const[t,s]=Y.useState("upload"),[n,i]=Y.useState(!1),[d,h]=Y.useState(null),[z,O]=Y.useState([]),[I,V]=Y.useState({supplier:"",orderReference:"",orderDate:"",expectedDelivery:"",estimatedEta:"",shippingCompany:"",trackingCode:""}),{cameraOpen:M,capturedImage:F,cameraError:U,videoRef:T,canvasRef:A,streamRef:q,fileInputRef:L,startCamera:$,capturePhoto:B,handleFileUpload:H,stopCamera:W}=he(),J=e=>c(void 0,null,function*(){try{i(!0),W();const a=yield ue.processReceiptImage(e);h(a),V(e=>o(l({},e),{supplier:a.supplier||"",orderReference:a.orderReference||"",orderDate:a.orderDate||"",shippingCompany:a.shippingCompany||"",trackingCode:a.trackingCode||""}));const r=a.items.map(e=>({partName:e.partName,partNumber:e.partNumber,quantity:e.quantity,price:e.price}));O(r),s("review"),m({title:"Receipt processed",description:`Found ${a.items.length} Voyah/Mhero parts. Please review and edit as needed.`})}catch(a){m({title:"Processing failed",description:a instanceof Error?a.message:"Failed to process receipt",variant:"destructive"})}finally{i(!1)}}),ae=(e,a,r)=>{O(t=>t.map((t,s)=>s===e?o(l({},t),{[a]:r}):t))},re=()=>{s("upload"),h(null),O([]),V({supplier:"",orderReference:"",orderDate:"",expectedDelivery:"",estimatedEta:"",shippingCompany:"",trackingCode:""}),W(),a()};return p.jsx(x,{open:e,onOpenChange:re,children:p.jsxs(v,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[p.jsx(g,{children:p.jsxs(j,{className:"flex items-center gap-2",children:[p.jsx(y,{className:"h-5 w-5 text-blue-600"}),"Bulk Upload Voyah/Mhero Parts",p.jsx(f,{variant:"outline",className:"bg-blue-100 text-blue-800",children:t})]})}),p.jsxs("div",{className:"flex-1 overflow-auto",children:["upload"===t&&p.jsx("div",{className:"space-y-4",children:p.jsxs(b,{children:[p.jsxs(N,{children:[p.jsx(w,{className:"text-blue-700",children:"Upload Voyah/Mhero Parts Receipt"}),p.jsx(C,{children:"Upload receipt for Voyah or Mhero electric vehicle parts. MonzaBot will extract the information automatically."})]}),p.jsx(k,{children:p.jsx(xe,{cameraOpen:M,cameraError:U,capturedImage:F,extractedData:d,isProcessing:n,videoRef:T,canvasRef:A,streamRef:q,fileInputRef:L,onStartCamera:$,onStopCamera:W,onCapturePhoto:()=>c(void 0,null,function*(){const e=yield B();e&&(yield J(e))}),onFileUpload:e=>c(void 0,null,function*(){const a=yield H(e);a&&(yield J(a))})})})]})}),"review"===t&&p.jsxs("div",{className:"space-y-4",children:[p.jsxs(b,{children:[p.jsxs(N,{children:[p.jsx(w,{className:"text-blue-700",children:"Voyah/Mhero Order Settings"}),p.jsx(C,{children:"These settings will apply to all Voyah/Mhero parts in this order"})]}),p.jsxs(k,{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Supplier *"}),p.jsx(P,{value:I.supplier,onChange:e=>V(a=>o(l({},a),{supplier:e.target.value})),placeholder:"Voyah/Mhero supplier"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Order Reference *"}),p.jsx(P,{value:I.orderReference,onChange:e=>V(a=>o(l({},a),{orderReference:e.target.value})),placeholder:"Order reference"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Order Date"}),p.jsx(P,{type:"date",value:I.orderDate,onChange:e=>V(a=>o(l({},a),{orderDate:e.target.value}))})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Expected Delivery"}),p.jsx(P,{type:"date",value:I.expectedDelivery,onChange:e=>V(a=>o(l({},a),{expectedDelivery:e.target.value}))})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Shipping Company"}),p.jsx(P,{value:I.shippingCompany,onChange:e=>V(a=>o(l({},a),{shippingCompany:e.target.value})),placeholder:"Shipping company"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Tracking Code"}),p.jsx(P,{value:I.trackingCode,onChange:e=>V(a=>o(l({},a),{trackingCode:e.target.value})),placeholder:"Tracking code"})]})]})]}),p.jsxs(b,{children:[p.jsx(N,{children:p.jsxs(w,{className:"flex items-center justify-between text-blue-700",children:["Voyah/Mhero Parts List (",z.length," items)",p.jsxs(u,{onClick:()=>{O(e=>[...e,{partName:"",partNumber:"",quantity:1,price:0}])},size:"sm",variant:"outline",children:[p.jsx(E,{className:"h-4 w-4 mr-1"}),"Add Item"]})]})}),p.jsx(k,{children:p.jsxs(Q,{children:[p.jsx(Z,{children:p.jsxs(X,{children:[p.jsx(G,{children:"Part Name"}),p.jsx(G,{children:"Part Number"}),p.jsx(G,{children:"Quantity"}),p.jsx(G,{children:"Price"}),p.jsx(G,{children:"Actions"})]})}),p.jsx(K,{children:z.map((e,a)=>p.jsxs(X,{children:[p.jsx(ee,{children:p.jsx(P,{value:e.partName,onChange:e=>ae(a,"partName",e.target.value),placeholder:"Voyah/Mhero part name"})}),p.jsx(ee,{children:p.jsx(P,{value:e.partNumber,onChange:e=>ae(a,"partNumber",e.target.value),placeholder:"Part number"})}),p.jsx(ee,{children:p.jsx(P,{type:"number",min:"1",value:e.quantity,onChange:e=>ae(a,"quantity",parseInt(e.target.value))})}),p.jsx(ee,{children:p.jsx(P,{type:"number",step:"0.01",value:e.price||"",onChange:e=>ae(a,"price",parseFloat(e.target.value)||0),placeholder:"Price"})}),p.jsx(ee,{children:p.jsx(u,{onClick:()=>(e=>{O(a=>a.filter((a,r)=>r!==e))})(a),size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:p.jsx(_,{className:"h-4 w-4"})})})]},a))})]})})]})]})]}),p.jsxs(R,{children:["upload"===t&&p.jsx(u,{onClick:re,variant:"outline",children:"Cancel"}),"review"===t&&p.jsxs("div",{className:"flex gap-2",children:[p.jsx(u,{onClick:()=>s("upload"),variant:"outline",children:"Back"}),p.jsxs(u,{onClick:()=>{const e=z.map(e=>({part_name:e.partName,part_number:e.partNumber,quantity:e.quantity,supplier:I.supplier,order_reference:I.orderReference,order_date:I.orderDate||(new Date).toISOString(),expected_delivery:I.expectedDelivery||void 0,estimated_eta:I.estimatedEta||void 0,status:"ordered",price:e.price,shipping_company:I.shippingCompany||void 0,tracking_code:I.trackingCode||void 0,notes:e.notes||void 0,category:"voyah"}));r(e),re()},disabled:!I.supplier||!I.orderReference||0===z.length,className:"bg-blue-600 hover:bg-blue-700",children:[p.jsx(D,{className:"h-4 w-4 mr-2"}),"Save ",z.length," Voyah/Mhero Parts"]})]})]})]})})},ge=({isOpen:e,onClose:a,onSave:r})=>{const[t,s]=Y.useState("upload"),[n,i]=Y.useState(!1),[d,h]=Y.useState(null),[y,O]=Y.useState([]),[I,V]=Y.useState({supplier:"",orderReference:"",orderDate:"",expectedDelivery:"",estimatedEta:"",shippingCompany:"",trackingCode:""}),{cameraOpen:M,capturedImage:F,cameraError:U,videoRef:T,canvasRef:A,streamRef:q,fileInputRef:L,startCamera:$,capturePhoto:B,handleFileUpload:H,stopCamera:W}=he(),J=e=>c(void 0,null,function*(){try{i(!0),W();const a=yield ue.processReceiptImage(e);h(a),V(e=>o(l({},e),{supplier:a.supplier||"",orderReference:a.orderReference||"",orderDate:a.orderDate||"",shippingCompany:a.shippingCompany||"",trackingCode:a.trackingCode||""}));const r=a.items.map(e=>({partName:e.partName,partNumber:e.partNumber,quantity:e.quantity,price:e.price}));O(r),s("review"),m({title:"Receipt processed",description:`Found ${a.items.length} ICEV parts. Please review and edit as needed.`})}catch(a){m({title:"Processing failed",description:a instanceof Error?a.message:"Failed to process receipt",variant:"destructive"})}finally{i(!1)}}),ae=(e,a,r)=>{O(t=>t.map((t,s)=>s===e?o(l({},t),{[a]:r}):t))},re=()=>{s("upload"),h(null),O([]),V({supplier:"",orderReference:"",orderDate:"",expectedDelivery:"",estimatedEta:"",shippingCompany:"",trackingCode:""}),W(),a()};return p.jsx(x,{open:e,onOpenChange:re,children:p.jsxs(v,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[p.jsx(g,{children:p.jsxs(j,{className:"flex items-center gap-2",children:[p.jsx(z,{className:"h-5 w-5 text-gray-600"}),"Bulk Upload ICEV Parts",p.jsx(f,{variant:"outline",className:"bg-gray-100 text-gray-800",children:t})]})}),p.jsxs("div",{className:"flex-1 overflow-auto",children:["upload"===t&&p.jsx("div",{className:"space-y-4",children:p.jsxs(b,{children:[p.jsxs(N,{children:[p.jsx(w,{className:"text-gray-700",children:"Upload ICEV Parts Receipt"}),p.jsx(C,{children:"Upload receipt for Internal Combustion Engine Vehicle parts. MonzaBot will extract the information automatically."})]}),p.jsx(k,{children:p.jsx(xe,{cameraOpen:M,cameraError:U,capturedImage:F,extractedData:d,isProcessing:n,videoRef:T,canvasRef:A,streamRef:q,fileInputRef:L,onStartCamera:$,onStopCamera:W,onCapturePhoto:()=>c(void 0,null,function*(){const e=yield B();e&&(yield J(e))}),onFileUpload:e=>c(void 0,null,function*(){const a=yield H(e);a&&(yield J(a))})})})]})}),"review"===t&&p.jsxs("div",{className:"space-y-4",children:[p.jsxs(b,{children:[p.jsxs(N,{children:[p.jsx(w,{className:"text-gray-700",children:"ICEV Order Settings"}),p.jsx(C,{children:"These settings will apply to all ICEV parts in this order"})]}),p.jsxs(k,{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Supplier *"}),p.jsx(P,{value:I.supplier,onChange:e=>V(a=>o(l({},a),{supplier:e.target.value})),placeholder:"ICEV parts supplier"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Order Reference *"}),p.jsx(P,{value:I.orderReference,onChange:e=>V(a=>o(l({},a),{orderReference:e.target.value})),placeholder:"Order reference"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Order Date"}),p.jsx(P,{type:"date",value:I.orderDate,onChange:e=>V(a=>o(l({},a),{orderDate:e.target.value}))})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Expected Delivery"}),p.jsx(P,{type:"date",value:I.expectedDelivery,onChange:e=>V(a=>o(l({},a),{expectedDelivery:e.target.value}))})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Shipping Company"}),p.jsx(P,{value:I.shippingCompany,onChange:e=>V(a=>o(l({},a),{shippingCompany:e.target.value})),placeholder:"Shipping company"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{children:"Tracking Code"}),p.jsx(P,{value:I.trackingCode,onChange:e=>V(a=>o(l({},a),{trackingCode:e.target.value})),placeholder:"Tracking code"})]})]})]}),p.jsxs(b,{children:[p.jsx(N,{children:p.jsxs(w,{className:"flex items-center justify-between text-gray-700",children:["ICEV Parts List (",y.length," items)",p.jsxs(u,{onClick:()=>{O(e=>[...e,{partName:"",partNumber:"",quantity:1,price:0}])},size:"sm",variant:"outline",children:[p.jsx(E,{className:"h-4 w-4 mr-1"}),"Add Item"]})]})}),p.jsx(k,{children:p.jsxs(Q,{children:[p.jsx(Z,{children:p.jsxs(X,{children:[p.jsx(G,{children:"Part Name"}),p.jsx(G,{children:"Part Number"}),p.jsx(G,{children:"Quantity"}),p.jsx(G,{children:"Price"}),p.jsx(G,{children:"Actions"})]})}),p.jsx(K,{children:y.map((e,a)=>p.jsxs(X,{children:[p.jsx(ee,{children:p.jsx(P,{value:e.partName,onChange:e=>ae(a,"partName",e.target.value),placeholder:"ICEV part name"})}),p.jsx(ee,{children:p.jsx(P,{value:e.partNumber,onChange:e=>ae(a,"partNumber",e.target.value),placeholder:"Part number"})}),p.jsx(ee,{children:p.jsx(P,{type:"number",min:"1",value:e.quantity,onChange:e=>ae(a,"quantity",parseInt(e.target.value))})}),p.jsx(ee,{children:p.jsx(P,{type:"number",step:"0.01",value:e.price||"",onChange:e=>ae(a,"price",parseFloat(e.target.value)||0),placeholder:"Price"})}),p.jsx(ee,{children:p.jsx(u,{onClick:()=>(e=>{O(a=>a.filter((a,r)=>r!==e))})(a),size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:p.jsx(_,{className:"h-4 w-4"})})})]},a))})]})})]})]})]}),p.jsxs(R,{children:["upload"===t&&p.jsx(u,{onClick:re,variant:"outline",children:"Cancel"}),"review"===t&&p.jsxs("div",{className:"flex gap-2",children:[p.jsx(u,{onClick:()=>s("upload"),variant:"outline",children:"Back"}),p.jsxs(u,{onClick:()=>{const e=y.map(e=>({part_name:e.partName,part_number:e.partNumber,quantity:e.quantity,supplier:I.supplier,order_reference:I.orderReference,order_date:I.orderDate||(new Date).toISOString(),expected_delivery:I.expectedDelivery||void 0,estimated_eta:I.estimatedEta||void 0,status:"ordered",price:e.price,shipping_company:I.shippingCompany||void 0,tracking_code:I.trackingCode||void 0,notes:e.notes||void 0,category:"normal_engine"}));r(e),re()},disabled:!I.supplier||!I.orderReference||0===y.length,className:"bg-gray-600 hover:bg-gray-700",children:[p.jsx(D,{className:"h-4 w-4 mr-2"}),"Save ",y.length," ICEV Parts"]})]})]})]})})},je=({isOpen:e,onClose:a,onReceiptProcessed:r})=>{const[t,s]=Y.useState(!1),[n,i]=Y.useState(null),[l,o]=Y.useState(null),[d,y]=Y.useState(!1),[P,E]=Y.useState(!1),[_,R]=Y.useState(null),[D,z]=Y.useState("select"),M=Y.useRef(null),F=Y.useRef(null),U=Y.useRef(null),T=Y.useRef(null),A=Y.useRef(!0);Y.useEffect(()=>(A.current=!0,e||L(),()=>{A.current=!1,L()}),[e]);const q=Y.useCallback(()=>c(void 0,null,function*(){try{if(E(!0),z("camera"),yield new Promise(e=>setTimeout(e,100)),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera API not supported in this browser");if(!("https:"===window.location.protocol||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname))throw new Error("Camera requires HTTPS or localhost. Current protocol: "+window.location.protocol);const a=[{video:{facingMode:"environment",width:{ideal:1920,max:4032},height:{ideal:1080,max:3024}}},{video:{facingMode:"environment",width:{ideal:1280,max:1920},height:{ideal:720,max:1080}}},{video:{facingMode:"user",width:{ideal:1280,max:1920},height:{ideal:720,max:1080}}},{video:{width:{ideal:1280,max:1920},height:{ideal:720,max:1080}}},{video:!0}];let r=null,t=null;for(let n=0;n<a.length;n++){const s=a[n];try{r=yield navigator.mediaDevices.getUserMedia(s),t=s;break}catch(e){if(e instanceof DOMException&&"NotAllowedError"===e.name)throw e;continue}}if(!r)throw new Error("Failed to get camera stream with any constraints. Please check camera permissions and try again.");if(T.current=r,!A.current||!F.current)return r&&r.getTracks().forEach(e=>e.stop()),E(!1),void m({title:"Camera Error",description:"Video element not found. Please try again.",variant:"destructive"});const s=F.current;s.srcObject=null,setTimeout(()=>{s.srcObject=r,s.muted=!0,s.playsInline=!0,s.autoplay=!0,s.style.display="block",s.style.width="100%",s.style.height="100%";s.addEventListener("loadedmetadata",()=>{s.play().then(()=>{y(!0),E(!1)}).catch(e=>{y(!0),E(!1)})},{once:!0}),s.addEventListener("error",e=>{E(!1),m({title:"Video Error",description:"Video element error occurred. Please try again.",variant:"destructive"})},{once:!0})},100)}catch(a){E(!1);let e="Could not access camera. ",r="Camera Error";if(a instanceof DOMException)switch(a.name){case"NotAllowedError":r="Camera Permission Denied",e="Please allow camera access in your browser settings and refresh the page.";break;case"NotFoundError":r="No Camera Found",e="No camera devices were found on this device.";break;case"NotSupportedError":r="Camera Not Supported",e="Camera is not supported in this browser or device.";break;case"NotReadableError":r="Camera Not Available",e="Camera is already in use by another application or there was a hardware error.";break;case"SecurityError":r="Security Error",e="Camera access blocked due to security restrictions.";break;default:e=`Camera error: ${a.name}. Please check camera permissions and ensure you are using HTTPS.`}else a instanceof Error&&(e=a.message);m({title:r,description:e,variant:"destructive"})}}),[]),L=Y.useCallback(()=>{T.current&&(T.current.getTracks().forEach(e=>{e.stop()}),T.current=null),F.current&&(F.current.srcObject=null),y(!1),E(!1),R(null),z("select")},[d,D]),$=Y.useCallback(()=>{if(!F.current||!U.current)return void m({title:"Camera not ready",description:"Please ensure the camera is active before capturing.",variant:"destructive"});const e=U.current,a=F.current,r=e.getContext("2d");if(!r)return;e.width=a.videoWidth,e.height=a.videoHeight,r.drawImage(a,0,0);const t=e.toDataURL("image/jpeg",.9);R(t),L(),m({title:"Photo captured",description:"Receipt photo captured! Processing with OCR..."}),B(t)},[]),B=e=>c(void 0,null,function*(){try{const a=yield ue.processReceiptImage(e);i(a);const r=H(a);o(r),m({title:"Receipt processed successfully",description:`Found ${a.items.length} items. Category: ${"voyah"===r?"Voyah/MHero":"ICEV"}`})}catch(a){m({title:"Processing failed",description:a instanceof Error?a.message:"Failed to process receipt",variant:"destructive"})}finally{s(!1)}}),H=e=>{const a=`${e.supplier||""} ${e.items.map(e=>`${e.partName} ${e.partNumber}`).join(" ")}`.toLowerCase();return["voyah","mhero","electric","ev","battery","hybrid","lantu"].some(e=>a.includes(e))?"voyah":"normal_engine"},W=()=>{i(null),o(null),s(!1),R(null),z("select"),L(),M.current&&(M.current.value="")},J=()=>{a(),W()};return p.jsx(x,{open:e,onOpenChange:J,children:p.jsxs(v,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[p.jsxs(g,{children:[p.jsxs(j,{className:"flex items-center gap-2",children:[p.jsx(pe,{className:"h-5 w-5"}),"Upload Receipt for Parts"]}),p.jsx(O,{children:"Upload a receipt image and MonzaBot will extract the parts information automatically"})]}),p.jsxs("div",{className:"space-y-6",children:["select"===D&&!n&&!t&&p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs(u,{onClick:()=>{var e;return null==(e=M.current)?void 0:e.click()},variant:"outline",className:"h-32 flex flex-col items-center justify-center gap-3 border-2 border-dashed hover:border-solid",children:[p.jsx(h,{className:"h-8 w-8"}),p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"font-medium",children:"Upload Image"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"From your device"})]})]}),p.jsxs(u,{onClick:q,variant:"outline",className:"h-32 flex flex-col items-center justify-center gap-3 border-2 border-dashed border-monza-yellow hover:border-solid hover:bg-monza-yellow/5",children:[p.jsx(re,{className:"h-8 w-8 text-monza-yellow"}),p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"font-medium",children:"Take Photo"}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"Using camera"})]})]})]}),"camera"===D&&p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden mx-auto max-w-lg",children:[p.jsx("video",{ref:F,autoPlay:!0,playsInline:!0,muted:!0,controls:!1,className:"w-full h-full min-h-[400px] max-h-[600px] object-cover cursor-pointer block",style:{display:"block",backgroundColor:"#000",minHeight:"400px",maxHeight:"600px"}}),P&&p.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-80 flex items-center justify-center z-20",children:p.jsxs("div",{className:"text-center text-white",children:[p.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-monza-yellow border-t-transparent rounded-full mx-auto mb-4"}),p.jsx("p",{className:"text-sm font-medium",children:"Starting camera..."}),p.jsx("p",{className:"text-xs opacity-80 mt-1",children:"Please allow camera access when prompted"})]})}),d&&!P&&p.jsx("div",{className:"absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded z-10",children:"ðŸ“¹ Camera Active"}),d&&!P&&p.jsx("div",{className:"absolute inset-4 border-2 border-monza-yellow border-dashed rounded-lg flex items-center justify-center pointer-events-none",children:p.jsxs("div",{className:"bg-black/70 text-white px-4 py-2 rounded-lg text-center",children:[p.jsx("div",{className:"text-sm font-medium",children:"DOCUMENT Position receipt here"}),p.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Ensure all text is visible and clear"})]})}),d&&!P&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"absolute top-8 left-8 w-6 h-6 border-l-2 border-t-2 border-monza-yellow"}),p.jsx("div",{className:"absolute top-8 right-8 w-6 h-6 border-r-2 border-t-2 border-monza-yellow"}),p.jsx("div",{className:"absolute bottom-8 left-8 w-6 h-6 border-l-2 border-b-2 border-monza-yellow"}),p.jsx("div",{className:"absolute bottom-8 right-8 w-6 h-6 border-r-2 border-b-2 border-monza-yellow"})]})]}),d&&!P&&p.jsxs("div",{className:"flex gap-2 justify-center flex-wrap",children:[p.jsxs(u,{onClick:$,className:"flex items-center gap-2 bg-monza-yellow hover:bg-monza-yellow/90 text-monza-black font-semibold",children:[p.jsx(te,{className:"h-4 w-4"}),"Capture & Process Receipt"]}),p.jsxs(u,{onClick:L,variant:"outline",className:"flex items-center gap-2",children:[p.jsx(I,{className:"h-4 w-4"}),"Cancel"]})]}),p.jsx("canvas",{ref:U,className:"hidden"})]}),t&&p.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[p.jsx(se,{className:"h-8 w-8 animate-spin mb-4"}),p.jsx("p",{className:"text-lg font-medium",children:"Processing receipt..."}),p.jsx("p",{className:"text-sm text-muted-foreground",children:"MonzaBot is extracting parts information"})]}),_&&!n&&!t&&p.jsxs("div",{className:"text-center space-y-4",children:[p.jsx("div",{className:"relative inline-block",children:p.jsx("img",{src:_,alt:"Captured receipt",className:"max-w-full max-h-64 object-contain rounded-lg border"})}),p.jsxs("div",{className:"flex gap-2 justify-center",children:[p.jsxs(u,{onClick:()=>B(_),className:"flex items-center gap-2",children:[p.jsx(te,{className:"h-4 w-4"}),"Process Receipt"]}),p.jsxs(u,{onClick:()=>{R(null),q()},variant:"outline",className:"flex items-center gap-2",children:[p.jsx(V,{className:"h-4 w-4"}),"Retake Photo"]})]})]}),n&&p.jsxs(b,{children:[p.jsxs(N,{children:[p.jsxs(w,{className:"flex items-center justify-between",children:[p.jsx("span",{children:"Extracted Information"}),p.jsx(f,{variant:"voyah"===l?"default":"secondary",children:"voyah"===l?"Voyah/MHero Parts":"ICEV Parts"})]}),p.jsx(C,{children:"Review the extracted information before adding to ordered parts"})]}),p.jsxs(k,{className:"space-y-4",children:[p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[p.jsxs("div",{children:[p.jsx(S,{className:"font-medium",children:"Supplier"}),p.jsx("p",{children:n.supplier||"Not detected"})]}),p.jsxs("div",{children:[p.jsx(S,{className:"font-medium",children:"Order Reference"}),p.jsx("p",{children:n.orderReference||"Not detected"})]}),p.jsxs("div",{children:[p.jsx(S,{className:"font-medium",children:"Order Date"}),p.jsx("p",{children:n.orderDate||"Not detected"})]}),p.jsxs("div",{children:[p.jsx(S,{className:"font-medium",children:"Total Amount"}),p.jsx("p",{children:n.totalAmount?`$${n.totalAmount}`:"Not detected"})]})]}),p.jsxs("div",{children:[p.jsxs(S,{className:"font-medium mb-2 block",children:["Parts (",n.items.length,")"]}),p.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:n.items.map((e,a)=>p.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[p.jsxs("div",{children:[p.jsx("p",{className:"font-medium",children:e.partName}),p.jsxs("p",{className:"text-sm text-gray-600",children:["#",e.partNumber]})]}),p.jsxs("div",{className:"text-right",children:[p.jsxs("p",{className:"font-medium",children:["Qty: ",e.quantity]}),e.price&&p.jsxs("p",{className:"text-sm text-gray-600",children:["$",e.price]})]})]},a))})]}),(n.shippingCompany||n.trackingCode)&&p.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[n.shippingCompany&&p.jsxs("div",{children:[p.jsx(S,{className:"font-medium",children:"Shipping Company"}),p.jsx("p",{children:n.shippingCompany})]}),n.trackingCode&&p.jsxs("div",{children:[p.jsx(S,{className:"font-medium",children:"Tracking Code"}),p.jsx("p",{children:n.trackingCode})]})]})]})]}),p.jsxs("div",{className:"flex justify-end gap-2",children:[p.jsx(u,{variant:"outline",onClick:J,children:"Cancel"}),n&&p.jsxs(u,{onClick:()=>{n&&l&&(r(n,l),a(),W())},className:"flex items-center gap-2",children:[p.jsx(ne,{className:"h-4 w-4"}),"Add to Ordered Parts"]})]})]}),p.jsx("input",{ref:M,type:"file",accept:"image/*",onChange:e=>c(void 0,null,function*(){var a;const r=null==(a=e.target.files)?void 0:a[0];if(r)if(r.type.startsWith("image/")){z("upload"),s(!0);try{const e=new FileReader;e.onload=e=>c(void 0,null,function*(){var a;const r=null==(a=e.target)?void 0:a.result;yield B(r)}),e.readAsDataURL(r)}catch(t){m({title:"Error",description:"Failed to read the image file",variant:"destructive"}),s(!1)}}else m({title:"Invalid file type",description:"Please upload an image file",variant:"destructive"})}),className:"hidden"})]})})},ye=()=>{M();const[e,a]=Y.useState([]),[r,t]=Y.useState(!1),[s,n]=Y.useState(!1),[i,c]=Y.useState(!1),[d,h]=Y.useState("ev_erev"),[x,v]=Y.useState({supplier:"",status:"",partName:"",etaRange:{start:"",end:""}}),[g,j]=Y.useState("order_date"),[R,D]=Y.useState("desc"),[O,I]=Y.useState(1),[ae]=Y.useState(10),[re,te]=Y.useState(""),[se,ne]=Y.useState(""),[me,ue]=Y.useState(1),[he,xe]=Y.useState(""),[ye,fe]=Y.useState(""),[be,Ne]=Y.useState(""),[we,Ce]=Y.useState(""),[ke,Se]=Y.useState(""),[Pe,Ee]=Y.useState(""),[_e,Re]=Y.useState(""),[De,ze]=Y.useState("ev_erev"),[Oe,Ie]=Y.useState({}),[Ve,Me]=Y.useState(null);Y.useEffect(()=>{Fe();const e=le("orderedPartsActiveTab","ev_erev");e&&["order-new","ev_erev","normal-engine"].includes(e)&&h(e)},[]);const Fe=ie(()=>{const e=le("orderedParts",[]);a(e)},e=>{a([])}),Ue=ie(e=>{oe("orderedParts",e),a(e)},e=>{m({title:"Error",description:"Failed to save ordered parts data.",variant:"destructive"})}),Te=()=>{const e={};return re.trim()||(e.partName="Part name is required"),se.trim()?/^[A-Z0-9\-]+$/.test(se.trim())||(e.partNumber="Part number must contain only letters, numbers, and hyphens"):e.partNumber="Part number is required",he.trim()||(e.supplier="Supplier is required"),ye.trim()||(e.orderReference="Order reference is required"),Ie(e),0===Object.keys(e).length},Ae=e=>{Ie(a=>o(l({},a),{[e]:void 0}))},qe=e=>{let a=e.filter(e=>!(x.partName&&!e.part_name.toLowerCase().includes(x.partName.toLowerCase()))&&(!(x.supplier&&!e.supplier.toLowerCase().includes(x.supplier.toLowerCase()))&&((!x.status||e.status===x.status)&&(!(x.etaRange.start&&e.expected_delivery&&new Date(e.expected_delivery)<new Date(x.etaRange.start))&&!(x.etaRange.end&&e.expected_delivery&&new Date(e.expected_delivery)>new Date(x.etaRange.end))))));return a.sort((e,a)=>{let r,t;switch(g){case"order_date":r=new Date(e.created_at),t=new Date(a.created_at);break;case"expected_delivery":r=e.expected_delivery?new Date(e.expected_delivery):new Date(0),t=a.expected_delivery?new Date(a.expected_delivery):new Date(0);break;case"part_name":r=e.part_name.toLowerCase(),t=a.part_name.toLowerCase();break;case"supplier":r=e.supplier.toLowerCase(),t=a.supplier.toLowerCase();break;default:r=e.status,t=a.status}return"asc"===R?r>t?1:-1:r<t?1:-1}),a},Le=Math.ceil(qe(e).length/ae),$e=e=>[...new Set(e.map(e=>e.supplier))].sort(),Be=(e,a,r)=>{const t=JSON.parse(le("orderedPartsAuditLog","[]"));t.push({action:e,partId:a,details:r,timestamp:(new Date).toISOString(),user:"Current User"}),oe("orderedPartsAuditLog",JSON.stringify(t))},He=a=>{const r=a.map(e=>o(l({},e),{id:`part_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),order_date:(new Date).toISOString()})),t=[...e,...r];Ue(t),r.forEach(e=>{Be("part_created",e.id,{part_name:e.part_name,supplier:e.supplier})}),m({title:"Parts Added",description:`${r.length} parts have been added to the order`})},We=a=>{const r=e.find(e=>e.id===a);r&&(((a,r)=>{const t=e.map(e=>e.id===a?o(l({},e),{status:r,updated_at:(new Date).toISOString()}):e);Ue(t),Be("status_update",a,{newStatus:r}),m({title:"Status Updated",description:`Part status changed to ${r}`})})(a,"delivered"),m({title:"Part Delivered",description:`${r.part_name} has been marked as delivered and moved to new arrivals`}))},Ye=e=>{const a={ordered:"bg-blue-100 text-blue-800",shipped:"bg-yellow-100 text-yellow-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"};return a[e]||a.ordered},Je=e=>{if(!e)return"";const a=new Date(e),r=new Date,t=Math.ceil((a.getTime()-r.getTime())/864e5);return t<0?"bg-red-50 border-red-200":t<=3?"bg-yellow-50 border-yellow-200":""},Qe=a=>{const r=qe(a),t=(e=>{const a=(O-1)*ae,r=a+ae;return e.slice(a,r)})(r);return 0===t.length?p.jsxs("div",{className:"text-center py-12",children:[p.jsx(F,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Parts Found"}),p.jsx("p",{className:"text-gray-600 mb-4",children:x.supplier||x.partName||x.status?"No parts match your current filters":"No parts have been ordered yet"}),p.jsxs(u,{onClick:()=>h("order-new"),className:"flex items-center gap-2",children:[p.jsx(E,{className:"h-4 w-4"}),"Order New Part"]})]}):p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4 bg-gray-50 rounded-lg",children:[p.jsx("div",{className:"flex-1",children:p.jsxs("div",{className:"relative",children:[p.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),p.jsx(P,{placeholder:"Search by part name, number, or supplier...",value:x.partName,onChange:e=>v(a=>o(l({},a),{partName:e.target.value})),className:"pl-10"})]})}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(J,{value:x.supplier,onValueChange:e=>v(a=>o(l({},a),{supplier:e})),options:[{value:"",label:"All Suppliers"},...$e(e).map(e=>({value:e,label:e}))],placeholder:"Filter by supplier",className:"w-48",searchable:!0}),p.jsx(J,{value:x.status,onValueChange:e=>v(a=>o(l({},a),{status:e})),options:[{value:"",label:"All Status"},{value:"ordered",label:"Ordered"},{value:"shipped",label:"Shipped"},{value:"delivered",label:"Delivered"},{value:"cancelled",label:"Cancelled"}],placeholder:"Status",className:"w-32"}),p.jsx(J,{value:g,onValueChange:e=>j(e),options:[{value:"order_date",label:"Order Date"},{value:"expected_delivery",label:"Expected Delivery"},{value:"status",label:"Status"},{value:"part_name",label:"Part Name"},{value:"supplier",label:"Supplier"}],placeholder:"Sort by",className:"w-40"}),p.jsx(u,{variant:"outline",size:"sm",onClick:()=>D(e=>"asc"===e?"desc":"asc"),children:"asc"===R?"â†‘":"â†“"})]})]}),p.jsx("div",{className:"border rounded-lg overflow-hidden",children:p.jsxs(Q,{children:[p.jsx(Z,{children:p.jsxs(X,{children:[p.jsx(G,{children:"Part Name"}),p.jsx(G,{children:"Part Number"}),p.jsx(G,{children:"Supplier"}),p.jsx(G,{children:"Status"}),p.jsx(G,{children:"Expected Delivery"}),p.jsx(G,{children:"Price"}),p.jsx(G,{children:"Actions"})]})}),p.jsx(K,{children:t.map(a=>p.jsxs(X,{children:[p.jsx(ee,{className:"font-medium",children:a.part_name}),p.jsx(ee,{className:"font-mono text-sm",children:a.part_number}),p.jsx(ee,{children:a.supplier}),p.jsx(ee,{children:p.jsx(f,{className:Ye(a.status),children:a.status})}),p.jsx(ee,{children:p.jsx("div",{className:`p-2 rounded border ${Je(a.expected_delivery)}`,children:a.expected_delivery?new Date(a.expected_delivery).toLocaleDateString():"Not set"})}),p.jsxs(ee,{children:["$",a.price]}),p.jsx(ee,{children:p.jsxs("div",{className:"flex gap-1",children:[p.jsx(u,{size:"sm",variant:"outline",onClick:()=>(e=>{Me(e),h("order-new"),oe("orderedPartsActiveTab","order-new"),te(e.part_name),ne(e.part_number),ue(e.quantity),xe(e.supplier),fe(e.order_reference),Ne(e.expected_delivery||""),Ce(e.price.toString()),Se(e.shipping_company),Ee(e.tracking_code),Re(e.notes),ze(e.category);const a=document.getElementById("order-form");a&&a.scrollIntoView({behavior:"smooth"})})(a),title:"Edit Part",children:p.jsx($,{className:"h-3 w-3"})}),p.jsx(u,{size:"sm",variant:"outline",onClick:()=>(a=>{const r=e.find(e=>e.id===a);if(!r)return;const t=e.filter(e=>e.id!==a);Ue(t),Be("part_deleted",a,{part_name:r.part_name}),m({title:"Part Deleted",description:`${r.part_name} has been removed from the order`})})(a.id),title:"Delete Part",children:p.jsx(_,{className:"h-3 w-3"})}),p.jsx(u,{size:"sm",variant:"outline",onClick:()=>We(a.id),title:"Mark as Delivered",children:p.jsx(H,{className:"h-3 w-3"})}),p.jsx(u,{size:"sm",variant:"outline",onClick:()=>(e=>{te(e.part_name),ne(e.part_number),ue(e.quantity),xe(e.supplier),Ce(e.price.toString()),Re(`Reordered from ${e.order_reference}`),ze(e.category),h("order-new"),oe("orderedPartsActiveTab","order-new");const a=document.getElementById("order-form");a&&a.scrollIntoView({behavior:"smooth"}),Be("part_reordered",e.id,{original_order:e.order_reference}),m({title:"Part Ready for Reorder",description:`${e.part_name} has been added to the order form`})})(a),title:"Reorder Part",children:p.jsx(V,{className:"h-3 w-3"})})]})})]},a.id))})]})}),Le>1&&p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(O-1)*ae+1," to ",Math.min(O*ae,r.length)," of ",r.length," parts"]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsxs(u,{variant:"outline",size:"sm",onClick:()=>I(e=>Math.max(1,e-1)),disabled:1===O,children:[p.jsx(de,{className:"h-4 w-4"}),"Previous"]}),p.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Le},(e,a)=>a+1).map(e=>p.jsx(u,{variant:O===e?"default":"outline",size:"sm",onClick:()=>I(e),children:e},e))}),p.jsxs(u,{variant:"outline",size:"sm",onClick:()=>I(e=>Math.min(Le,e+1)),disabled:O===Le,children:["Next",p.jsx(W,{className:"h-4 w-4"})]})]})]})]})};return p.jsxs("div",{className:"container mx-auto py-6 space-y-6 bg-gray-50 min-h-screen",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"bg-monza-yellow p-3 rounded-lg",children:p.jsx(F,{className:"h-8 w-8 text-monza-black"})}),p.jsxs("div",{children:[p.jsx("h1",{className:"text-3xl font-bold tracking-tight text-monza-black",children:"Ordered Parts"}),p.jsx("p",{className:"text-gray-600",children:"Track parts orders for EV/EREV vehicles and normal engine cars"})]})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsxs(u,{onClick:e=>{e.preventDefault(),e.stopPropagation(),c(!0)},className:"flex items-center gap-2 bg-green-50 hover:bg-green-100 text-green-700 border border-green-200",variant:"outline",children:[p.jsx(pe,{className:"h-4 w-4"}),"Upload Receipt"]}),p.jsxs(u,{onClick:e=>{e.preventDefault(),e.stopPropagation(),t(!0)},variant:"outline",className:"flex items-center gap-2 bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200",children:[p.jsx(y,{className:"h-4 w-4"}),"EV/EREV Bulk Upload"]}),p.jsxs(u,{onClick:e=>{e.preventDefault(),e.stopPropagation(),n(!0)},variant:"outline",className:"flex items-center gap-2 bg-gray-50 hover:bg-gray-100 text-gray-700 border border-gray-200",children:[p.jsx(z,{className:"h-4 w-4"}),"ICEV Bulk Upload"]})]})]}),p.jsxs(U,{value:d,onValueChange:e=>{const a=e;if(h(a),oe("orderedPartsActiveTab",a),"order-new"===a){const e=document.getElementById("order-form");e&&e.scrollIntoView({behavior:"smooth"})}},className:"w-full",children:[p.jsxs(T,{className:"grid w-full grid-cols-3 bg-white border border-gray-200",children:[p.jsxs(A,{value:"order-new",className:"flex items-center gap-2 data-[state=active]:bg-monza-yellow data-[state=active]:text-monza-black",onClick:e=>{e.preventDefault(),h("order-new")},children:[p.jsx(F,{className:"h-4 w-4"}),"Order New Part"]}),p.jsxs(A,{value:"ev_erev",className:"flex items-center gap-2 data-[state=active]:bg-monza-yellow data-[state=active]:text-monza-black",onClick:e=>{e.preventDefault(),h("ev_erev")},children:[p.jsx(y,{className:"h-4 w-4"}),"EV/EREV Parts (",e.filter(e=>"ev_erev"===e.category).length,")"]}),p.jsxs(A,{value:"normal-engine",className:"flex items-center gap-2 data-[state=active]:bg-monza-yellow data-[state=active]:text-monza-black",onClick:e=>{e.preventDefault(),h("normal-engine")},children:[p.jsx(z,{className:"h-4 w-4"}),"Normal Engine Parts (",e.filter(e=>"normal_engine"===e.category).length,")"]})]}),p.jsx(q,{value:"order-new",children:p.jsxs(b,{className:"border-gray-200 shadow-sm",children:[p.jsxs(N,{className:"bg-gray-50 border-b border-gray-200",children:[p.jsx(w,{className:"text-monza-black",children:"Order New Part"}),p.jsx(C,{children:"Add a new part order to track shipment and delivery"})]}),p.jsx(k,{className:"p-6",children:p.jsxs("form",{onSubmit:a=>{if(a.preventDefault(),!Te())return void m({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"});const r={id:`part_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,part_name:re.trim(),part_number:se.trim(),quantity:me,supplier:he.trim(),order_reference:ye.trim(),expected_delivery:be||void 0,estimated_eta:be||void 0,price:ce(we,0),shipping_company:ke.trim(),tracking_code:Pe.trim(),notes:_e.trim(),status:"ordered",category:De,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),order_date:(new Date).toISOString()},t=[...e,r];Ue(t),Be("part_created",r.id,{part_name:r.part_name,supplier:r.supplier}),te(""),ne(""),ue(1),xe(""),fe(""),Ne(""),Ce(""),Se(""),Ee(""),Re(""),ze("ev_erev"),Ie({});const s="ev_erev"===De?"ev_erev":"normal-engine";h(s),oe("orderedPartsActiveTab",s),m({title:"Part Ordered",description:`${re} has been added to the order`})},className:"space-y-4",id:"order-form",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"partType",className:"text-monza-black",children:"Part Type *"}),p.jsx(J,{value:De,onValueChange:e=>{ze(e),Ae("partName")},options:[{value:"ev_erev",label:"EV/EREV"},{value:"normal_engine",label:"Normal Engine (ICEV)"}],placeholder:"Select part type",className:"w-full",triggerClassName:"h-10 rounded-md border border-gray-200 bg-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-monza-yellow focus:border-monza-yellow"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"partName",className:"text-monza-black",children:"Part Name *"}),p.jsx(P,{id:"partName",value:re,onChange:e=>{te(e.target.value),Ae("partName")},placeholder:"Enter part name",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow "+(Oe.partName?"border-red-500 focus:border-red-500 focus:ring-red-500":"")}),Oe.partName&&p.jsx("p",{className:"text-red-500 text-sm",children:Oe.partName})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"partNumber",className:"text-monza-black",children:"Part Number *"}),p.jsx(P,{id:"partNumber",value:se,onChange:e=>{ne(e.target.value),Ae("partNumber")},placeholder:"e.g., VOY-X43-009",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow "+(Oe.partNumber?"border-red-500 focus:border-red-500 focus:ring-red-500":"")}),Oe.partNumber&&p.jsx("p",{className:"text-red-500 text-sm",children:Oe.partNumber})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"quantity",className:"text-monza-black",children:"Quantity"}),p.jsx(P,{id:"quantity",type:"number",min:"1",value:me,onChange:e=>ue(parseInt(e.target.value)||1),className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"supplier",className:"text-monza-black",children:"Supplier *"}),p.jsx(P,{id:"supplier",value:he,onChange:e=>{xe(e.target.value),Ae("supplier")},placeholder:"Enter supplier name",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow "+(Oe.supplier?"border-red-500 focus:border-red-500 focus:ring-red-500":"")}),Oe.supplier&&p.jsx("p",{className:"text-red-500 text-sm",children:Oe.supplier})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"orderReference",className:"text-monza-black",children:"Order Reference *"}),p.jsx(P,{id:"orderReference",value:ye,onChange:e=>{fe(e.target.value),Ae("orderReference")},placeholder:"Enter order reference",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow "+(Oe.orderReference?"border-red-500 focus:border-red-500 focus:ring-red-500":"")}),Oe.orderReference&&p.jsx("p",{className:"text-red-500 text-sm",children:Oe.orderReference})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"expectedDelivery",className:"text-monza-black",children:"Expected Delivery"}),p.jsx("div",{className:"relative date-input-wrapper",children:p.jsx(P,{id:"expectedDelivery",type:"date",value:be,onChange:e=>Ne(e.target.value),className:"pdi-date-input calendar-fix border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow cursor-pointer",style:{zIndex:1e4,colorScheme:"light",WebkitAppearance:"none",appearance:"none"},placeholder:""})})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"price",className:"text-monza-black",children:"Price"}),p.jsx(P,{id:"price",type:"number",step:"0.01",value:we,onChange:e=>Ce(e.target.value),placeholder:"Enter price",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"shippingCompany",className:"text-monza-black",children:"Shipping Company"}),p.jsx(P,{id:"shippingCompany",value:ke,onChange:e=>Se(e.target.value),placeholder:"Enter shipping company",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"trackingCode",className:"text-monza-black",children:"Tracking Code"}),p.jsx(P,{id:"trackingCode",value:Pe,onChange:e=>Ee(e.target.value),placeholder:"Enter tracking code",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(S,{htmlFor:"notes",className:"text-monza-black",children:"Notes"}),p.jsx(L,{id:"notes",value:_e,onChange:e=>Re(e.target.value),placeholder:"Enter any additional notes",rows:3,className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),p.jsx("div",{className:"flex gap-2",children:Ve?p.jsxs(p.Fragment,{children:[p.jsxs(u,{type:"button",onClick:()=>{if(!Ve||!Te())return void m({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"});const a=e.map(e=>e.id===Ve.id?o(l({},e),{part_name:re.trim(),part_number:se.trim(),quantity:me,supplier:he.trim(),order_reference:ye.trim(),expected_delivery:be||void 0,estimated_eta:be||void 0,price:ce(we,0),shipping_company:ke.trim(),tracking_code:Pe.trim(),notes:_e.trim(),category:De,updated_at:(new Date).toISOString()}):e);Ue(a),Be("part_edited",Ve.id,{part_name:re}),Me(null),te(""),ne(""),ue(1),xe(""),fe(""),Ne(""),Ce(""),Se(""),Ee(""),Re(""),ze("ev_erev"),Ie({}),m({title:"Part Updated",description:`${re} has been updated`})},className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:[p.jsx($,{className:"h-4 w-4 mr-2"}),"Update Part"]}),p.jsx(u,{type:"button",onClick:()=>{Me(null),te(""),ne(""),ue(1),xe(""),fe(""),Ne(""),Ce(""),Se(""),Ee(""),Re(""),ze("ev_erev"),Ie({})},variant:"outline",children:"Cancel"})]}):p.jsxs(u,{type:"submit",className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:[p.jsx(F,{className:"h-4 w-4 mr-2"}),"Order Part"]})})]})})]})}),p.jsx(q,{value:"ev_erev",children:Qe(e.filter(e=>"ev_erev"===e.category))}),p.jsx(q,{value:"normal-engine",children:Qe(e.filter(e=>"normal_engine"===e.category))})]}),p.jsx(ve,{isOpen:r,onClose:()=>t(!1),onSave:He}),p.jsx(ge,{isOpen:s,onClose:()=>n(!1),onSave:He}),p.jsx(je,{isOpen:i,onClose:()=>c(!1),onReceiptProcessed:(e,a)=>{const r="voyah"===a?"ev_erev":"normal_engine",t=e.items.map(a=>({part_name:a.partName,part_number:a.partNumber,quantity:a.quantity,supplier:e.supplier||"Unknown",order_reference:`REC-${Date.now()}`,expected_delivery:"",estimated_eta:"",price:ce(a.price,0),shipping_company:"",tracking_code:"",notes:"",status:"ordered",category:r,order_date:(new Date).toISOString()}));He(t),c(!1)}})]})};
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{ye as default};
