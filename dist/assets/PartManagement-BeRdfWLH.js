var e=Object.defineProperty,r=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(r,t,a)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,l=(e,r)=>{for(var t in r||(r={}))s.call(r,t)&&n(e,t,r[t]);if(a)for(var t of a(r))o.call(r,t)&&n(e,t,r[t]);return e},i=(e,a)=>r(e,t(a)),d=(e,r,t)=>new Promise((a,s)=>{var o=e=>{try{l(t.next(e))}catch(r){s(r)}},n=e=>{try{l(t.throw(e))}catch(r){s(r)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,n);l((t=t.apply(e,r)).next())});import{j as c,y as u,z as m,E as h,F as p,L as x,I as g,ab as v,k as j,t as b,a9 as y,p as f,q as N,r as w,O as C,P as S,S as P,v as _,X as k,H as E,s as D,ak as F,Q as O,ar as T}from"./index-BmUpYGrm.js";import{r as I}from"./vendor-vN6PtkFd.js";import{T as q,a as M,b as A,c as L,d as V,e as z}from"./table-BEISn_Te.js";import{u as R}from"./cameraPermissionManager-D3sOAAEG.js";import{C as B}from"./camera-CKQtJJJ8.js";import{S as Z}from"./scan-BkADKRli.js";import{P as $}from"./PartNumberScannerDialog-s5LV33ZH.js";import{D as G}from"./download-CLPHGjzE.js";import{R as Q}from"./refresh-cw-C6MAcERo.js";import{P as W}from"./pen-line--cRXdmmD.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";import"./enhancedMonzaBotService-CP3UVEVb.js";import"./loader-2-BYW_3amd.js";const H=({isOpen:e,onClose:r,part:t,onSave:a})=>{const[s,o]=I.useState({});I.useEffect(()=>{o(t&&e?{car_model:t.car_model,oe_number:t.oe_number,product_name:t.product_name,quantity:t.quantity,order_date:t.order_date,source:t.source,storage_zone:t.storage_zone}:{})},[t,e]);const n=(e,r)=>{o(t=>i(l({},t),{[e]:r}))};return t?c.jsx(u,{open:e,onOpenChange:r,children:c.jsxs(m,{className:"sm:max-w-[600px] dialog-content",children:[c.jsx(h,{children:c.jsxs(p,{children:["Edit Part: ",t.product_name]})}),c.jsxs("div",{className:"grid gap-4 py-4",children:[c.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[c.jsx(x,{htmlFor:"oe_number",className:"text-right",children:"OE Number"}),c.jsx(g,{id:"oe_number",value:s.oe_number||"",onChange:e=>n("oe_number",e.target.value),className:"col-span-3",readOnly:!0})]}),c.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[c.jsx(x,{htmlFor:"product_name",className:"text-right",children:"Product Name"}),c.jsx(g,{id:"product_name",value:s.product_name||"",onChange:e=>n("product_name",e.target.value),className:"col-span-3"})]}),c.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[c.jsx(x,{htmlFor:"car_model",className:"text-right",children:"Car Model"}),c.jsx(g,{id:"car_model",value:s.car_model||"",onChange:e=>n("car_model",e.target.value),className:"col-span-3"})]}),c.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[c.jsx(x,{htmlFor:"quantity",className:"text-right",children:"Quantity"}),c.jsx(g,{id:"quantity",type:"number",value:s.quantity||0,onChange:e=>n("quantity",parseInt(e.target.value)||0),className:"col-span-3"})]}),c.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[c.jsx(x,{htmlFor:"storage_zone",className:"text-right",children:"Storage Zone"}),c.jsx(g,{id:"storage_zone",value:s.storage_zone||"",onChange:e=>n("storage_zone",e.target.value),className:"col-span-3"})]}),c.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[c.jsx(x,{htmlFor:"source",className:"text-right",children:"Source"}),c.jsx(g,{id:"source",value:s.source||"",onChange:e=>n("source",e.target.value),className:"col-span-3"})]}),c.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[c.jsx(x,{htmlFor:"order_date",className:"text-right",children:"Order Date"}),c.jsx(g,{id:"order_date",type:"date",value:s.order_date||"",onChange:e=>n("order_date",e.target.value),className:"col-span-3"})]})]}),c.jsxs(v,{children:[c.jsx(j,{variant:"outline",onClick:r,children:"Cancel"}),c.jsx(j,{onClick:()=>{s&&t&&(a(s),r())},children:"Save Changes"})]})]})}):null},U=({isOpen:e,onClose:r,onAddPart:t,onIncrementPart:a,existingParts:s=[],floor:o})=>{const[n,D]=I.useState("manual"),[F,O]=I.useState(!1),[T,q]=I.useState(!1),[M,A]=I.useState([]),[L,V]=I.useState(null),z=I.useRef(null),R=I.useRef(null),$=I.useRef(null),G=I.useRef(!0),[Q,W]=I.useState({carModel:"",partName:"",partNumber:"",quantity:1,shelf:"",column:"",row:"",room:"",supplier:"DF",vehicleType:"EV",category:"Garage"===o||"Parts Inventory"===o?"part":"accessory",vin:"",pdiStatus:"pending",pdiNotes:""});I.useEffect(()=>{e&&(()=>{const e=localStorage.getItem("orderedParts");if(e){const r=JSON.parse(e).filter(e=>"delivered"===e.status&&!s.some(r=>r.partNumber===e.part_number));A(r)}})()},[e,s]);const H=()=>{W({carModel:"",partName:"",partNumber:"",quantity:1,shelf:"",column:"",row:"",room:"",supplier:"DF",vehicleType:"EV",category:"Garage"===o||"Parts Inventory"===o?"part":"accessory",vin:"",pdiStatus:"pending",pdiNotes:""})},U=(e,r)=>{W(t=>i(l({},t),{[e]:r}))},J=I.useCallback(()=>d(void 0,null,function*(){try{q(!0),yield new Promise(e=>setTimeout(e,50)),"camera"!==n&&(D("camera"),yield new Promise(e=>setTimeout(e,300))),z.current||(yield new Promise(e=>setTimeout(e,500)),z.current||(yield new Promise(e=>setTimeout(e,500)),z.current));const t=new Promise((e,r)=>{setTimeout(()=>r(new Error("Camera initialization timeout")),1e4)});if(!("https:"===window.location.protocol||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname))throw new Error("Camera requires HTTPS or localhost. Current protocol: "+window.location.protocol);if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera API not supported in this browser");let a=[];try{a=yield Promise.race([navigator.mediaDevices.enumerateDevices(),t]);if(0===a.filter(e=>"videoinput"===e.kind).length)throw new Error("No camera devices found on this system")}catch(e){}const s=[{video:{facingMode:"environment",width:{ideal:1280,max:1920},height:{ideal:720,max:1080}}},{video:{facingMode:"environment",width:{ideal:640,max:1280},height:{ideal:480,max:720}}},{video:{facingMode:"user",width:{ideal:640,max:1280},height:{ideal:480,max:720}}},{video:{width:{ideal:640,max:1280},height:{ideal:480,max:720}}},{video:!0}];let o=null,l=null;for(let e=0;e<s.length;e++){const a=s[e];try{o=yield Promise.race([navigator.mediaDevices.getUserMedia(a),t]),l=a;break}catch(r){if(r instanceof DOMException&&"NotAllowedError"===r.name)throw r;continue}}if(!o)throw new Error("Failed to get camera stream with any constraints. Please check camera permissions and try again.");if($.current=o,!G.current||!z.current)return o&&o.getTracks().forEach(e=>e.stop()),q(!1),void b({title:"Camera Error",description:"Video element not found. Please ensure you are on the OCR Scanner tab and try again.",variant:"destructive"});const i=z.current;i.srcObject=null,setTimeout(()=>{i.srcObject=o,i.muted=!0,i.playsInline=!0,i.autoplay=!0,i.style.display="block",i.style.width="100%",i.style.height="100%",i.style.minHeight="300px",i.style.backgroundColor="#000",i.style.objectFit="cover";i.addEventListener("loadedmetadata",()=>{i.style.display="block",i.style.opacity="1",i.style.visibility="visible",i.play().then(()=>{O(!0),q(!1)}).catch(e=>{O(!0),q(!1),setTimeout(()=>{i&&$.current&&i.play().then(()=>{}).catch(e=>{})},1e3)})}),i.addEventListener("canplay",()=>{i.paused&&i.play().catch(console.error)}),i.addEventListener("loadstart",()=>{}),i.addEventListener("loadeddata",()=>{}),i.addEventListener("progress",()=>{}),i.addEventListener("play",()=>{O(!0),q(!1)}),i.addEventListener("playing",()=>{O(!0),q(!1)}),i.addEventListener("error",e=>{q(!1),b({title:"Video Error",description:"Video element error occurred. Check console for details.",variant:"destructive"})})},100),setTimeout(()=>{T&&!F&&(O(!0),q(!1))},8e3);const d=o.getVideoTracks();if(d.length>0){d[0]}}catch(t){q(!1);let e="Could not access camera. ",r="Camera Error";if(t instanceof DOMException)switch(t.name){case"NotAllowedError":r="Camera Permission Denied",e="Please allow camera access in your browser settings and refresh the page.";break;case"NotFoundError":r="No Camera Found",e="No camera devices were found on this device.";break;case"NotSupportedError":r="Camera Not Supported",e="Camera is not supported in this browser or device.";break;case"NotReadableError":r="Camera Not Available",e="Camera is already in use by another application or there was a hardware error.";break;case"OverconstrainedError":r="Camera Configuration Error",e="The requested camera settings are not supported by your device.";break;case"SecurityError":r="Security Error",e="Camera access blocked due to security restrictions.";break;default:e=`Camera error: ${t.name}. Please check camera permissions and ensure you are using HTTPS.`}else t instanceof Error?t.message.includes("timeout")?(r="Camera Timeout",e="Camera initialization timed out. Please check your camera permissions and try again."):e=t.message:e="Unknown camera error. Please check camera permissions and ensure you are using HTTPS.";b({title:r,description:e,variant:"destructive"})}}),[T,F]),Y=I.useCallback(()=>{$.current&&($.current.getTracks().forEach(e=>e.stop()),$.current=null),z.current&&(z.current.srcObject=null),O(!1),q(!1)},[]);I.useEffect(()=>(G.current=!0,!e&&F&&Y(),()=>{G.current=!1}),[e,F,Y]);const K=I.useCallback(()=>d(void 0,null,function*(){if(!z.current||!R.current)return;const e=R.current,r=e.getContext("2d");r&&(e.width=z.current.videoWidth,e.height=z.current.videoHeight,r.drawImage(z.current,0,0),e.toDataURL(),setTimeout(()=>{const e=`PT-${Date.now().toString().slice(-6)}`,r=s.find(r=>r.partNumber.toLowerCase()===e.toLowerCase());r?a&&(a(e,1),b({title:"Part Found & Updated",description:`Added 1 unit to existing ${r.partName}`})):(W(r=>i(l({},r),{partNumber:e})),D("manual"),b({title:"Part Number Scanned",description:`Please complete the part information for ${e}`})),Y()},1500),b({title:"Processing...",description:"Scanning part number from image..."}))}),[s,a,Y]),X={"Floor 1":["Display Storage","Customer Area","Waiting Room Storage"],"Floor 2":["Premium Display","Executive Storage","VIP Lounge Storage"],Garage:["Engine Parts Room","Maintenance Bay","Accessories Room","Tool Storage","Waste Management"],"Parts Inventory":["Main Warehouse","Parts Storage","Inventory Room","Stock Area","Distribution Center"]};return c.jsx(u,{open:e,onOpenChange:r,children:c.jsxs(m,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[c.jsxs(h,{children:[c.jsxs(p,{children:["Add Part to ",o," Inventory"]}),c.jsxs(y,{children:["Add new parts to the ",o.toLowerCase()," inventory using manual entry, camera scanning, or from delivered orders."]})]}),c.jsxs(f,{value:n,onValueChange:D,className:"w-full",children:[c.jsxs(N,{className:"grid w-full grid-cols-4",children:[c.jsxs(w,{value:"manual",className:"flex items-center gap-2",children:[c.jsx(C,{className:"h-4 w-4"}),"Manual Entry"]}),c.jsxs(w,{value:"camera",className:"flex items-center gap-2",children:[c.jsx(B,{className:"h-4 w-4"}),"OCR Scanner"]}),c.jsxs(w,{value:"ordered",className:"flex items-center gap-2",children:[c.jsx(S,{className:"h-4 w-4"}),"From Orders (",M.length,")"]}),c.jsxs(w,{value:"order",className:"flex items-center gap-2",children:[c.jsx(P,{className:"h-4 w-4"}),"Order New Part"]})]}),c.jsx(_,{value:"manual",className:"space-y-4",children:c.jsxs("form",{onSubmit:e=>{e.preventDefault();const n=s.find(e=>e.partNumber.toLowerCase()===Q.partNumber.toLowerCase());if(n&&a)a(Q.partNumber,Q.quantity),b({title:"Part Quantity Updated",description:`Added ${Q.quantity} units to existing ${n.partName}`});else{const e={carModel:Q.carModel,partName:Q.partName,partNumber:Q.partNumber,quantity:Q.quantity,location:{shelf:Q.shelf,column:Q.column,row:Q.row,room:Q.room,floor:o},supplier:Q.supplier,vehicleType:Q.vehicleType,category:Q.category,vin:Q.vin,pdiStatus:Q.pdiStatus,pdiNotes:Q.pdiNotes};t(e)}H(),r()},className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(x,{htmlFor:"carModel",children:"Car Model"}),c.jsx(g,{id:"carModel",value:Q.carModel,onChange:e=>U("carModel",e.target.value),placeholder:"e.g., Tesla Model 3",required:!0})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"vehicleType",children:"Vehicle Type"}),c.jsxs("select",{id:"vehicleType",className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Q.vehicleType,onChange:e=>U("vehicleType",e.target.value),required:!0,children:[c.jsx("option",{value:"",children:"Select vehicle type"}),c.jsx("option",{value:"EV",children:"Electric Vehicle (EV)"}),c.jsx("option",{value:"REV",children:"Range Extended EV (REV)"}),c.jsx("option",{value:"ICEV",children:"Internal Combustion (ICEV)"})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(x,{htmlFor:"partName",children:"Part Name"}),c.jsx(g,{id:"partName",value:Q.partName,onChange:e=>U("partName",e.target.value),placeholder:"e.g., Air Filter",required:!0})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"partNumber",children:"Part Number"}),c.jsx(g,{id:"partNumber",value:Q.partNumber,onChange:e=>U("partNumber",e.target.value),placeholder:"e.g., VF-2024-AF-001",required:!0})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(x,{htmlFor:"quantity",children:"Quantity"}),c.jsx(g,{id:"quantity",type:"number",min:"1",value:Q.quantity,onChange:e=>U("quantity",parseInt(e.target.value)),required:!0})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"supplier",children:"Supplier"}),c.jsxs("select",{id:"supplier",className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Q.supplier,onChange:e=>U("supplier",e.target.value),required:!0,children:[c.jsx("option",{value:"",children:"Select supplier"}),c.jsx("option",{value:"DF",children:"Dong Feng (DF)"}),c.jsx("option",{value:"AZ",children:"AutoZone (AZ)"}),c.jsx("option",{value:"BMW",children:"BMW Parts"}),c.jsx("option",{value:"TESLA",children:"Tesla Parts"}),c.jsx("option",{value:"BYD",children:"BYD Parts"}),c.jsx("option",{value:"MERCEDES",children:"Mercedes Parts"}),c.jsx("option",{value:"GENERIC",children:"Generic Parts"})]})]})]}),c.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx(x,{htmlFor:"room",children:"Room"}),c.jsxs("select",{id:"room",className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Q.room,onChange:e=>U("room",e.target.value),children:[c.jsx("option",{value:"",children:"Select room"}),X[o].map(e=>c.jsx("option",{value:e,children:e},e))]})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"shelf",children:"Shelf"}),c.jsx(g,{id:"shelf",value:Q.shelf,onChange:e=>U("shelf",e.target.value),placeholder:"P1, P2..."})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"column",children:"Column"}),c.jsx(g,{id:"column",value:Q.column,onChange:e=>U("column",e.target.value),placeholder:"1, 2, 3..."})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"row",children:"Row"}),c.jsx(g,{id:"row",value:Q.row,onChange:e=>U("row",e.target.value),placeholder:"1, 2, 3..."})]})]}),c.jsxs(v,{children:[c.jsx(j,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),c.jsx(j,{type:"submit",children:"Add Part"})]})]})}),c.jsx(_,{value:"camera",className:"space-y-4",children:c.jsxs("div",{className:"mt-6",children:[F||T?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden mx-auto max-w-lg",children:[c.jsx("video",{ref:z,autoPlay:!0,playsInline:!0,muted:!0,controls:!1,className:"w-full h-full min-h-[300px] max-h-[500px] object-cover cursor-pointer block",style:{display:"block",backgroundColor:"#000",minHeight:"300px",maxHeight:"500px"},onClick:()=>{z.current&&z.current.play().then(()=>{}).catch(e=>{})}}),T&&c.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-80 flex items-center justify-center z-20",children:c.jsxs("div",{className:"text-center text-white",children:[c.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-monza-yellow border-t-transparent rounded-full mx-auto mb-4"}),c.jsx("p",{className:"text-sm font-medium",children:"Starting camera..."}),c.jsx("p",{className:"text-xs opacity-80 mt-1",children:"Please allow camera access when prompted"}),c.jsx(j,{onClick:Y,variant:"outline",size:"sm",className:"mt-4 text-xs bg-white/10 border-white/20 text-white hover:bg-white/20",children:"Cancel"})]})}),F&&!T&&c.jsx("div",{className:"absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded z-10",children:"📹 Camera Active"}),F&&!T&&c.jsx("div",{className:"absolute inset-4 border-2 border-monza-yellow border-dashed rounded-lg flex items-center justify-center pointer-events-none",children:c.jsxs("div",{className:"bg-black/70 text-white px-4 py-2 rounded-lg text-center",children:[c.jsx("div",{className:"text-sm font-medium",children:"Position part number here"}),c.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Keep text clear and centered"})]})}),F&&!T&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute top-8 left-8 w-6 h-6 border-l-2 border-t-2 border-monza-yellow"}),c.jsx("div",{className:"absolute top-8 right-8 w-6 h-6 border-r-2 border-t-2 border-monza-yellow"}),c.jsx("div",{className:"absolute bottom-8 left-8 w-6 h-6 border-l-2 border-b-2 border-monza-yellow"}),c.jsx("div",{className:"absolute bottom-8 right-8 w-6 h-6 border-r-2 border-b-2 border-monza-yellow"})]})]}),F&&!T&&c.jsxs("div",{className:"flex gap-2 justify-center flex-wrap",children:[c.jsxs(j,{onClick:K,className:"flex items-center gap-2 bg-monza-yellow hover:bg-monza-yellow/90 text-monza-black font-semibold",children:[c.jsx(Z,{className:"h-4 w-4"}),"Scan Part Number"]}),c.jsx(j,{onClick:()=>{if(z.current&&$.current){const e=z.current;e.srcObject=null,setTimeout(()=>{e.srcObject=$.current,e.play().then(()=>{}).catch(console.error)},100)}},variant:"outline",size:"sm",className:"flex items-center gap-1 text-xs",children:"Refresh Video"}),c.jsx(j,{onClick:()=>{if(z.current){const e=z.current;$.current,e.paused&&e.play().then(()=>{}).catch(e=>{})}},variant:"outline",size:"sm",className:"flex items-center gap-1 text-xs",children:"🔬 Debug"}),c.jsxs(j,{onClick:Y,variant:"outline",className:"flex items-center gap-2 border-monza-gray text-monza-gray hover:bg-monza-gray/10",children:[c.jsx(k,{className:"h-4 w-4"}),"Stop Camera"]})]})]}):c.jsxs("div",{className:"text-center space-y-4",children:[c.jsxs("div",{className:"bg-gray-50 rounded-lg p-8",children:[c.jsx(B,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),c.jsx("h3",{className:"text-lg font-medium mb-2",children:"OCR Part Number Scanner"}),c.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Use your camera to automatically scan and detect part numbers"}),c.jsxs(j,{onClick:J,className:"flex items-center gap-2 bg-monza-yellow hover:bg-monza-yellow/90 text-monza-black font-semibold",children:[c.jsx(B,{className:"h-4 w-4"}),"Start Camera"]})]}),c.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Requirements:"})," Camera requires HTTPS and permissions"]}),c.jsxs("p",{children:["MOBILE ",c.jsx("strong",{children:"Mobile:"})," Will try to use back camera for scanning"]}),c.jsxs("p",{children:["🔒 ",c.jsx("strong",{children:"Privacy:"})," Camera data stays on your device"]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Tip:"})," Ensure good lighting for best results"]})]})]}),c.jsx("canvas",{ref:R,className:"hidden"})]})}),c.jsx(_,{value:"ordered",className:"space-y-4",children:0===M.length?c.jsxs("div",{className:"text-center py-8",children:[c.jsx(S,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),c.jsx("p",{className:"text-muted-foreground",children:"No delivered parts available"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Delivered parts from orders will appear here"})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(x,{children:"Select Delivered Part to Add to Inventory"}),c.jsx("div",{className:"grid gap-2 max-h-64 overflow-y-auto",children:M.map(e=>c.jsx("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors "+((null==L?void 0:L.id)===e.id?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"),onClick:()=>V(e),children:c.jsxs("div",{className:"flex justify-between items-start",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:e.part_name}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["#",e.part_number]}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:["Qty: ",e.quantity," | ",e.supplier]})]}),c.jsxs("div",{className:"text-right",children:[c.jsx("p",{className:"text-sm font-medium text-green-600",children:"voyah"===e.category?"Voyah":"ICEV"}),e.price&&c.jsxs("p",{className:"text-sm text-muted-foreground",children:["$",e.price]})]})]})},e.id))})]}),L&&c.jsxs("div",{className:"space-y-4 border-t pt-4",children:[c.jsx("h4",{className:"font-medium",children:"Complete Inventory Details"}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(x,{htmlFor:"carModel",children:"Car Model"}),c.jsx(g,{id:"carModel",value:Q.carModel,onChange:e=>U("carModel",e.target.value),placeholder:"e.g., Voyah Dream 2024"})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"room",children:"Storage Room"}),c.jsxs("select",{id:"room",className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Q.room,onChange:e=>U("room",e.target.value),children:[c.jsx("option",{value:"",children:"Select room"}),X[o].map(e=>c.jsx("option",{value:e,children:e},e))]})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[c.jsxs("div",{children:[c.jsx(x,{htmlFor:"shelf",children:"Shelf"}),c.jsx(g,{id:"shelf",value:Q.shelf,onChange:e=>U("shelf",e.target.value),placeholder:"P1, P2..."})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"column",children:"Column"}),c.jsx(g,{id:"column",value:Q.column,onChange:e=>U("column",e.target.value),placeholder:"1, 2, 3..."})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"row",children:"Row"}),c.jsx(g,{id:"row",value:Q.row,onChange:e=>U("row",e.target.value),placeholder:"1, 2, 3..."})]})]}),c.jsxs(v,{children:[c.jsx(j,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),c.jsx(j,{onClick:()=>{if(!L)return;const e=s.find(e=>e.partNumber.toLowerCase()===L.part_number.toLowerCase());if(e&&a)a(L.part_number,L.quantity),b({title:"Part Quantity Updated",description:`Added ${L.quantity} units to existing ${e.partName}`});else{const e={carModel:Q.carModel||"Generic",partName:L.part_name,partNumber:L.part_number,quantity:L.quantity,location:{shelf:Q.shelf,column:Q.column,row:Q.row,room:Q.room||"Main Garage",floor:o},supplier:L.supplier,vehicleType:Q.vehicleType,category:(L.category,"part"),vin:Q.vin,pdiStatus:Q.pdiStatus,pdiNotes:Q.pdiNotes};t(e)}const n=M.filter(e=>e.id!==L.id);localStorage.setItem("orderedParts",JSON.stringify([...JSON.parse(localStorage.getItem("orderedParts")||"[]").filter(e=>e.id!==L.id)])),A(n),H(),V(null),r()},children:"Add to Inventory"})]})]})]})}),c.jsx(_,{value:"order",className:"space-y-4",children:c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[c.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Order New Part"}),c.jsx("p",{className:"text-sm text-blue-700",children:"Order parts that are not currently in inventory. This will create a new order that can be tracked."})]}),c.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{if(!(Q.partName&&Q.partNumber&&Q.supplier&&Q.quantity))return void b({title:"Error",description:"Please fill in all required fields (Part Name, Part Number, Supplier, Quantity)",variant:"destructive"});const e={id:Date.now().toString(),part_name:Q.partName,part_number:Q.partNumber,quantity:Q.quantity,supplier:Q.supplier,order_reference:`ORD-${Date.now().toString().slice(-6)}`,order_date:(new Date).toISOString(),status:"ordered",category:"EV"===Q.vehicleType||"REV"===Q.vehicleType?"ev_erev":"normal_engine",notes:Q.pdiNotes,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},t=JSON.parse(localStorage.getItem("orderedParts")||"[]");localStorage.setItem("orderedParts",JSON.stringify([...t,e])),b({title:"Order Created",description:`Order for ${Q.partName} (${Q.partNumber}) has been created successfully.`}),H(),r()})()},className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(x,{htmlFor:"orderPartName",children:"Part Name *"}),c.jsx(g,{id:"orderPartName",value:Q.partName,onChange:e=>U("partName",e.target.value),placeholder:"e.g., Air Filter, Brake Pads",required:!0})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"orderPartNumber",children:"Part Number *"}),c.jsx(g,{id:"orderPartNumber",value:Q.partNumber,onChange:e=>U("partNumber",e.target.value),placeholder:"e.g., VF-2024-AF-001",required:!0})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(x,{htmlFor:"orderCarModel",children:"Compatible Car Model"}),c.jsx(g,{id:"orderCarModel",value:Q.carModel,onChange:e=>U("carModel",e.target.value),placeholder:"e.g., Tesla Model 3, Voyah Dream"})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"orderVehicleType",children:"Vehicle Type"}),c.jsxs("select",{id:"orderVehicleType",className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Q.vehicleType,onChange:e=>U("vehicleType",e.target.value),children:[c.jsx("option",{value:"",children:"Select vehicle type"}),c.jsx("option",{value:"EV",children:"Electric Vehicle (EV)"}),c.jsx("option",{value:"REV",children:"Range Extended EV (REV)"}),c.jsx("option",{value:"ICEV",children:"Internal Combustion (ICEV)"})]})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[c.jsxs("div",{children:[c.jsx(x,{htmlFor:"orderQuantity",children:"Quantity *"}),c.jsx(g,{id:"orderQuantity",type:"number",min:"1",value:Q.quantity,onChange:e=>U("quantity",parseInt(e.target.value)),required:!0})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"orderSupplier",children:"Supplier *"}),c.jsxs("select",{id:"orderSupplier",className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Q.supplier,onChange:e=>U("supplier",e.target.value),required:!0,children:[c.jsx("option",{value:"",children:"Select supplier"}),c.jsx("option",{value:"DF",children:"Dong Feng (DF)"}),c.jsx("option",{value:"AZ",children:"AutoZone (AZ)"}),c.jsx("option",{value:"BMW",children:"BMW Parts"}),c.jsx("option",{value:"TESLA",children:"Tesla Parts"}),c.jsx("option",{value:"BYD",children:"BYD Parts"}),c.jsx("option",{value:"MERCEDES",children:"Mercedes Parts"}),c.jsx("option",{value:"GENERIC",children:"Generic Parts"})]})]}),c.jsxs("div",{children:[c.jsx(x,{htmlFor:"orderCategory",children:"Category"}),c.jsxs("select",{id:"orderCategory",className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Q.category,onChange:e=>U("category",e.target.value),children:[c.jsx("option",{value:"",children:"Select category"}),c.jsx("option",{value:"part",children:"Engine Part"}),c.jsx("option",{value:"accessory",children:"Accessory"}),c.jsx("option",{value:"tool",children:"Tool"}),c.jsx("option",{value:"consumable",children:"Consumable"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(x,{htmlFor:"orderNotes",children:"Order Notes"}),c.jsx(E,{id:"orderNotes",value:Q.pdiNotes,onChange:e=>U("pdiNotes",e.target.value),placeholder:"Additional notes about the order, urgency, special requirements...",rows:3})]}),c.jsxs(v,{children:[c.jsx(j,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),c.jsx(j,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",children:"Create Order"})]})]})]})})]})]})})},J=()=>{const{parts:e,loading:r,error:t,refresh:a}=(()=>{const[e,r]=I.useState([]),[t,a]=I.useState(!0),[s,o]=I.useState(null),n=()=>d(void 0,null,function*(){try{a(!0),o(null);const{data:e,error:t}=yield D.from("parts_inventory").select("*").order("created_at",{ascending:!1});if(t)return void r([{id:"1",car_model:"General",oe_number:"VD-2024-BRK-001",product_name:"Brake Pads Front Set",quantity:15,order_date:"2025-01-20",source:"DF (Dongfeng)",storage_zone:"A1-B2",status:"In Stock",created_at:"2025-01-20T14:30:00Z",updated_at:"2025-01-20T14:30:00Z"},{id:"2",car_model:"General",oe_number:"VC-2025-FLT-002",product_name:"Air Filter",quantity:8,order_date:"2025-01-19",source:"DF (Dongfeng)",storage_zone:"B2-C3",status:"Low Stock",created_at:"2025-01-19T10:15:00Z",updated_at:"2025-01-19T10:15:00Z"},{id:"3",car_model:"General",oe_number:"VD-2024-OIL-003",product_name:"Oil Filter",quantity:25,order_date:"2025-01-18",source:"DF (Dongfeng)",storage_zone:"C3-D4",status:"In Stock",created_at:"2025-01-18T09:45:00Z",updated_at:"2025-01-18T09:45:00Z"}]);r(e||[])}catch(e){r([{id:"1",car_model:"General",oe_number:"VD-2024-BRK-001",product_name:"Brake Pads Front Set",quantity:15,order_date:"2025-01-20",source:"DF (Dongfeng)",storage_zone:"A1-B2",status:"In Stock",created_at:"2025-01-20T14:30:00Z",updated_at:"2025-01-20T14:30:00Z"},{id:"2",car_model:"General",oe_number:"VC-2025-FLT-002",product_name:"Air Filter",quantity:8,order_date:"2025-01-19",source:"DF (Dongfeng)",storage_zone:"B2-C3",status:"Low Stock",created_at:"2025-01-19T10:15:00Z",updated_at:"2025-01-19T10:15:00Z"},{id:"3",car_model:"General",oe_number:"VD-2024-OIL-003",product_name:"Oil Filter",quantity:25,order_date:"2025-01-18",source:"DF (Dongfeng)",storage_zone:"C3-D4",status:"In Stock",created_at:"2025-01-18T09:45:00Z",updated_at:"2025-01-18T09:45:00Z"}])}finally{a(!1)}});return I.useEffect(()=>{n()},[]),{parts:e,loading:t,error:s,fetchParts:n,addPart:e=>d(void 0,null,function*(){try{const{data:t,error:a}=yield D.from("parts_inventory").insert([e]).select().single();if(a){const t=i(l({},e),{id:`local-${Date.now()}`,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()});return r(e=>[t,...e]),t}return r(e=>[t,...e]),t}catch(t){const a=i(l({},e),{id:`local-${Date.now()}`,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()});return r(e=>[a,...e]),a}}),updatePart:(e,t)=>d(void 0,null,function*(){try{const{data:a,error:s}=yield D.from("parts_inventory").update(t).eq("id",e).select().single();return s?(r(r=>r.map(r=>r.id===e?i(l(l({},r),t),{updated_at:(new Date).toISOString()}):r)),i(l({},t),{id:e,updated_at:(new Date).toISOString()})):(r(r=>r.map(r=>r.id===e?a:r)),a)}catch(a){return r(r=>r.map(r=>r.id===e?i(l(l({},r),t),{updated_at:(new Date).toISOString()}):r)),i(l({},t),{id:e,updated_at:(new Date).toISOString()})}}),deletePart:e=>d(void 0,null,function*(){try{const{error:t}=yield D.from("parts_inventory").delete().eq("id",e);if(t)return void r(r=>r.filter(r=>r.id!==e));r(r=>r.filter(r=>r.id!==e))}catch(t){r(r=>r.filter(r=>r.id!==e))}}),refresh:n}})(),[s,o]=I.useState(""),[n,x]=I.useState("all"),[v,y]=I.useState("all"),[f,N]=I.useState("All Suppliers"),[w,S]=I.useState(!1),[_,k]=I.useState(null),[E,B]=I.useState(!1),[Z,J]=I.useState(!1);R();const Y=e.filter(e=>{const r=""===s||e.product_name.toLowerCase().includes(s.toLowerCase())||e.oe_number.toLowerCase().includes(s.toLowerCase())||e.car_model.toLowerCase().includes(s.toLowerCase())||e.source.toLowerCase().includes(s.toLowerCase()),t="all"===n||e.car_model===n,a="all"===v||(0===(o=e.quantity)?"Out of Stock":o<=5?"Low Stock":"In Stock")===v;var o;const l="All Suppliers"===f||e.source===f;return r&&t&&a&&l}),K=["All Suppliers",...Array.from(new Set(e.map(e=>e.source)))],X=["all",...Array.from(new Set(e.map(e=>e.car_model)))];return c.jsxs("div",{className:"space-y-6 p-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold",children:"Parts Inventory"}),c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage parts and accessories inventory"})]}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsxs(j,{variant:"outline",onClick:()=>{b({title:"Export to Excel",description:"Parts inventory exported successfully."})},children:[c.jsx(G,{className:"mr-1 h-4 w-4"}),"Export to Excel"]}),c.jsxs(j,{variant:"outline",onClick:()=>{b({title:"Excel Import",description:"Please select an Excel file to import parts data."})},children:[c.jsx(F,{className:"mr-1 h-4 w-4"}),"Import from Excel"]}),c.jsxs(j,{variant:"outline",onClick:()=>{J(!0)},children:[c.jsx(O,{className:"mr-1 h-4 w-4"}),"Scan Part"]}),c.jsxs(j,{variant:"default",onClick:()=>{B(!0)},children:[c.jsx(C,{className:"mr-1 h-4 w-4"}),"Add New Part"]}),c.jsxs(j,{variant:"outline",onClick:a,disabled:r,children:[c.jsx(Q,{className:"mr-1 h-4 w-4 "+(r?"animate-spin":"")}),"Refresh"]})]})]}),t&&c.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:c.jsx("div",{className:"flex",children:c.jsxs("div",{className:"ml-3",children:[c.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error loading parts"}),c.jsx("div",{className:"mt-2 text-sm text-red-700",children:c.jsx("p",{children:t})})]})})}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[c.jsxs("div",{className:"relative",children:[c.jsx(P,{className:"absolute left-2 top-3 h-4 w-4 text-muted-foreground"}),c.jsx(g,{placeholder:"Search parts, categories, suppliers...",className:"pl-8",value:s,onChange:e=>o(e.target.value)})]}),c.jsxs("select",{id:"categoryFilter",name:"categoryFilter",className:"h-10 rounded-md border border-input bg-background px-3 py-2",value:n,onChange:e=>x(e.target.value),children:[c.jsx("option",{value:"all",children:"All Car Models"}),X.filter(e=>"all"!==e).map(e=>c.jsx("option",{value:e,children:e},e))]}),c.jsxs("select",{id:"statusFilter",name:"statusFilter",className:"h-10 rounded-md border border-input bg-background px-3 py-2",value:v,onChange:e=>y(e.target.value),children:[c.jsx("option",{value:"all",children:"All Statuses"}),c.jsx("option",{value:"In Stock",children:"In Stock"}),c.jsx("option",{value:"Low Stock",children:"Low Stock"}),c.jsx("option",{value:"Out of Stock",children:"Out of Stock"}),c.jsx("option",{value:"Discontinued",children:"Discontinued"})]}),c.jsx("select",{id:"supplierFilter",name:"supplierFilter",className:"h-10 rounded-md border border-input bg-background px-3 py-2",value:f,onChange:e=>N(e.target.value),children:K.map(e=>c.jsx("option",{value:e,children:e},e))})]}),c.jsx("div",{className:"bg-white rounded-lg border shadow-sm",children:c.jsx("div",{className:"overflow-x-auto",children:c.jsxs(q,{children:[c.jsx(M,{children:c.jsxs(A,{children:[c.jsx(L,{children:"Part Name"}),c.jsx(L,{children:"OE Number"}),c.jsx(L,{children:"Car Model"}),c.jsx(L,{children:"Quantity"}),c.jsx(L,{children:"Storage Zone"}),c.jsx(L,{children:"Source"}),c.jsx(L,{children:"Order Date"}),c.jsx(L,{children:"Status"}),c.jsx(L,{children:"Actions"})]})}),c.jsx(V,{children:r?c.jsx(A,{children:c.jsx(z,{colSpan:9,className:"text-center py-8",children:c.jsxs("div",{className:"flex flex-col items-center gap-2",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),c.jsx("p",{className:"font-medium",children:"Loading parts inventory..."})]})})}):t?c.jsx(A,{children:c.jsx(z,{colSpan:9,className:"text-center py-8",children:c.jsxs("div",{className:"flex flex-col items-center gap-2",children:[c.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:c.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),c.jsx("p",{className:"font-medium text-red-800",children:"Error loading parts"}),c.jsx("p",{className:"text-sm text-red-600",children:t}),c.jsxs(j,{onClick:a,variant:"outline",size:"sm",children:[c.jsx(Q,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})})}):Y.length>0?Y.map(e=>c.jsxs(A,{className:"hover:bg-muted/50",children:[c.jsx(z,{className:"font-medium",children:e.product_name}),c.jsx(z,{className:"font-mono text-sm",children:e.oe_number}),c.jsx(z,{children:c.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200",children:e.car_model})}),c.jsx(z,{children:c.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+(0===e.quantity?"bg-red-100 text-red-800 border border-red-200":e.quantity<=5?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-green-100 text-green-800 border border-green-200"),children:e.quantity})}),c.jsx(z,{className:"font-mono text-sm",children:e.storage_zone}),c.jsx(z,{children:c.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800 border border-gray-200",children:e.source})}),c.jsx(z,{className:"text-sm text-muted-foreground",children:new Date(e.order_date).toLocaleDateString()}),c.jsx(z,{children:c.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("In Stock"===e.status?"bg-green-100 text-green-800 border border-green-200":"Low Stock"===e.status?"bg-yellow-100 text-yellow-800 border border-yellow-200":"Out of Stock"===e.status?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-800 border border-gray-200"),children:e.status})}),c.jsx(z,{children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx(j,{variant:"outline",size:"sm",onClick:()=>(e=>{k(e),S(!0)})(e),children:c.jsx(W,{className:"h-3 w-3"})}),c.jsx(j,{variant:"outline",size:"sm",onClick:()=>(e.id,b({title:"Part Removed",description:"Part has been removed from inventory."}),void a()),className:"text-red-600 hover:text-red-700",children:c.jsx(T,{className:"h-3 w-3"})})]})})]},e.id)):c.jsx(A,{children:c.jsx(z,{colSpan:9,className:"text-center py-8",children:c.jsxs("div",{className:"flex flex-col items-center gap-2",children:[c.jsx("p",{className:"font-medium",children:"No parts found"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"No results match your search criteria."})]})})})})]})})}),c.jsx(H,{isOpen:w,onClose:()=>S(!1),part:_,onSave:e=>{_&&(b({title:"Part Updated",description:`${_.product_name} has been updated successfully.`}),a(),onClose())}}),c.jsx(U,{isOpen:E,onClose:()=>B(!1),onAddPart:e=>{e.carModel,e.partNumber||Date.now();const r=e.partName||"New Part";e.quantity,(new Date).toISOString().split("T")[0],e.supplier,"object"==typeof e.location?(e.location.shelf,e.location.column,e.location.row):e.location;b({title:"Part Added",description:`${r} has been added to inventory.`}),a()},onIncrementPart:()=>{},existingParts:[],floor:"Parts Inventory"}),c.jsx(u,{open:Z,onOpenChange:J,children:c.jsxs(m,{className:"max-w-2xl",children:[c.jsx(h,{children:c.jsx(p,{children:"Scan Part Number"})}),c.jsx($,{onPartNumberScanned:r=>{const t=e.find(e=>e.oe_number===r||e.product_name.toLowerCase().includes(r.toLowerCase()));t?(b({title:"Part Found",description:`${t.product_name} (${t.oe_number}) - ${t.quantity} in stock`}),o(r)):b({title:"Part Not Found",description:`Part ${r} not in inventory. Would you like to add it?`}),J(!1),a()},children:c.jsx("div",{style:{display:"none"}})})]})})]})};export{J as default};
