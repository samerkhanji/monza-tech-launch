var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,n=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&l(e,a,s[a]);if(t)for(var a of t(s))i.call(s,a)&&l(e,a,s[a]);return e},c=(e,t)=>s(e,a(t)),d=(e,s,a)=>new Promise((t,r)=>{var i=e=>{try{n(a.next(e))}catch(s){r(s)}},l=e=>{try{n(a.throw(e))}catch(s){r(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,l);n((a=a.apply(e,s)).next())});import{a8 as o,t as m,j as u,I as h,k as x,p as g,q as p,r as j,C as y,s as v,K as N,y as f,z as w,E as b,F as k,W as S,a9 as C,aa as T,U as D,f as _,L as I,Y as M,Z as O,_ as E,$ as U,a0 as P,H as L,e as A,X as $,n as V,ab as W,g as q,h as H,a as z,o as R,ac as G,ad as F,c as J,R as B,w as Q,ae as K,b as Y,a2 as Z,a3 as X,x as ee,A as se,m as ae,l as te,O as re,af as ie,ag as le,ah as ne,ai as ce,aj as de,a6 as oe,d as me,v as ue}from"./index-BmUpYGrm.js";import{r as he,R as xe}from"./vendor-vN6PtkFd.js";import{R as ge}from"./refresh-cw-C6MAcERo.js";import{F as pe}from"./file-text-bXPYLusF.js";import{T as je,a as ye,b as ve,c as Ne,d as fe,e as we}from"./table-BEISn_Te.js";import{P as be,w as ke}from"./PartNumberScannerDialog-s5LV33ZH.js";import{C as Se}from"./camera-CKQtJJJ8.js";import{T as Ce}from"./table-search-Bl4Inyz2.js";import{I as Te}from"./info-CbXTqoMM.js";import{A as De}from"./arrow-right-iDmV9z1N.js";import{S as _e}from"./star-CR_sFOyJ.js";import{H as Ie,S as Me}from"./sparkles-Bv856xFH.js";import{E as Oe}from"./EnhancedSelect-sAMWtD8W.js";import{M as Ee}from"./mail-BiNlmlXL.js";import{P as Ue}from"./phone-CUmdYfuI.js";import{s as Pe}from"./errorHandling-Dc1u_gNS.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";import"./enhancedMonzaBotService-CP3UVEVb.js";import"./loader-2-BYW_3amd.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=o("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),Ae=o("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),$e=()=>{const[e,s]=he.useState([]),[a,t]=he.useState([]);return he.useEffect(()=>{const e=()=>{let e=localStorage.getItem("garageSchedules");if(e||(e=localStorage.getItem("garageSchedule")),e)try{const a=JSON.parse(e),r=Array.isArray(a)?a:[a];s(r);const i=r.flatMap(e=>(e.scheduledCars||[]).map(s=>c(n({},s),{scheduleDate:e.date,scheduleTime:`${e.startTime} - ${e.endTime}`,available:e.available,scheduleNotes:e.notes})));t(i)}catch(a){}};e();const a=s=>{"garageSchedules"!==s.key&&"garageSchedule"!==s.key||e()};return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)},[]),{schedules:e,allScheduledCars:a}},Ve=({searchTerm:e,setSearchTerm:s,isGarageManager:a,onSyncScheduledCars:t})=>u.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Garage Overview"}),u.jsx("p",{className:"text-muted-foreground",children:a?"Manage and track all garage operations":"View current garage status"})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(h,{placeholder:"Search cars...",value:e,onChange:e=>s(e.target.value),className:"w-64"}),u.jsxs(x,{variant:"outline",size:"sm",onClick:()=>{m({title:"Data Refreshed",description:"Garage overview has been updated with latest information"})},children:[u.jsx(ge,{className:"h-4 w-4 mr-2"}),"Refresh"]}),u.jsxs(x,{variant:"outline",size:"sm",onClick:()=>{null==t||t(),m({title:"Scheduled Cars Synced",description:"Cars from garage schedule have been synced to garage overview"})},className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[u.jsx(ge,{className:"h-4 w-4 mr-2"}),"Sync Schedule"]}),a&&u.jsxs(x,{variant:"outline",size:"sm",onClick:()=>{m({title:"Export Started",description:"Garage report is being generated..."})},children:[u.jsx(pe,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),We=({activeTab:e,setActiveTab:s})=>u.jsx(g,{value:e,onValueChange:s,className:"w-full sm:w-auto",children:u.jsxs(p,{children:[u.jsx(j,{value:"all",children:"All"}),u.jsx(j,{value:"in_garage",children:"In Garage"}),u.jsx(j,{value:"delivered",children:"Delivered"})]})}),qe=({cars:e,searchTerm:s,setSearchTerm:a,activeTab:t,setActiveTab:r})=>u.jsx(y,{className:"p-4",children:u.jsxs("div",{className:"flex flex-col space-y-4",children:[u.jsx("h3",{className:"font-medium",children:"Garage Status Summary"}),u.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[u.jsxs("div",{className:"border rounded-md p-3",children:[u.jsx("div",{className:"text-muted-foreground text-sm",children:"In Diagnosis"}),u.jsx("div",{className:"text-2xl font-bold",children:e.filter(e=>"in_diagnosis"===e.status).length})]}),u.jsxs("div",{className:"border rounded-md p-3",children:[u.jsx("div",{className:"text-muted-foreground text-sm",children:"In Repair"}),u.jsx("div",{className:"text-2xl font-bold",children:e.filter(e=>"in_repair"===e.status).length})]}),u.jsxs("div",{className:"border rounded-md p-3",children:[u.jsx("div",{className:"text-muted-foreground text-sm",children:"In Quality Check"}),u.jsx("div",{className:"text-2xl font-bold",children:e.filter(e=>"in_quality_check"===e.status).length})]}),u.jsxs("div",{className:"border rounded-md p-3",children:[u.jsx("div",{className:"text-muted-foreground text-sm",children:"Ready for Pickup"}),u.jsx("div",{className:"text-2xl font-bold",children:e.filter(e=>"ready"===e.status).length})]})]}),u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[u.jsx(We,{activeTab:t,setActiveTab:r}),u.jsx("div",{className:"w-full sm:w-64",children:u.jsx(h,{placeholder:"Search cars...",value:s,onChange:e=>a(e.target.value),className:"w-full"})})]})]})}),He={in_diagnosis:"In Diagnosis",in_repair:"In Repair",in_quality_check:"Quality Check",ready:"Ready for Pickup",delivered:"Delivered"},ze={trackProductivity(e){return d(this,null,function*(){try{const s=new Date(e.estimatedStart),a=new Date(s);a.setDate(s.getDate()-s.getDay());const t=Math.ceil((s.getTime()-new Date(s.getFullYear(),0,1).getTime())/6048e5),r=s.getFullYear(),{error:i}=yield v.from("productivity_tracking").insert({car_id:e.carId,car_code:e.carCode,customer_name:e.customerName,assigned_mechanics:e.assignedMechanics,work_type:e.workType,estimated_hours:e.estimatedHours,actual_hours:e.actualHours,estimated_start:e.estimatedStart,actual_start:e.actualStart,estimated_completion:e.estimatedCompletion,actual_completion:e.actualCompletion,status:e.status||"in_progress",delay_reason:e.delayReason,productivity_notes:e.productivityNotes,quality_issues:e.qualityIssues||[],week_start:a.toISOString().split("T")[0],week_number:t,year:r});if(i)throw i;yield this.generateWeeklySummary(new Date(e.estimatedStart)),yield this.generateAIInsights()}catch(s){throw s}})},updateProductivityCompletion(e,s,a,t){return d(this,null,function*(){try{const{error:r}=yield v.from("productivity_tracking").update({actual_completion:s,actual_hours:a,status:"completed",quality_issues:t||[],updated_at:(new Date).toISOString()}).eq("car_code",e).eq("status","in_progress");if(r)throw r;yield this.generateWeeklySummary(new Date(s)),yield this.generateAIInsights()}catch(r){throw r}})},generateWeeklySummary(e){return d(this,null,function*(){try{const{error:s}=yield v.rpc("generate_weekly_summary",{week_date:e.toISOString().split("T")[0]});if(s)throw s}catch(s){throw s}})},getWeeklyProductivity(e){return d(this,null,function*(){try{const{data:s,error:a}=yield v.from("weekly_productivity_summary").select("*").eq("week_start",e).single();if(a&&"PGRST116"!==a.code)throw a;return s?{weekStart:s.week_start,weekEnd:s.week_end,totalCarsWorked:s.total_cars_worked,totalEstimatedHours:s.total_estimated_hours,totalActualHours:s.total_actual_hours,overallEfficiencyPercentage:s.overall_efficiency_percentage,carsCompletedOnTime:s.cars_completed_on_time,carsDelayed:s.cars_delayed,averageDelayHours:s.average_delay_hours,electricalHours:s.electrical_hours,painterHours:s.painter_hours,detailerHours:s.detailer_hours,mechanicHours:s.mechanic_hours,bodyWorkHours:s.body_work_hours}:null}catch(s){throw s}})},getMechanicPerformance(e){return d(this,null,function*(){try{const{data:s,error:a}=yield v.from("mechanic_performance").select("*").eq("week_start",e).order("efficiency_percentage",{ascending:!1});if(a)throw a;return s||[]}catch(s){throw s}})},generateAIInsights(){return d(this,null,function*(){try{const e=new Date;e.setDate(e.getDate()-28);const{data:s,error:a}=yield v.from("weekly_productivity_summary").select("*").gte("week_start",e.toISOString().split("T")[0]).order("week_start",{ascending:!1}).limit(4);if(a||!s||s.length<2)return;const t=s[0],r=s[1],i=[];if(t.overall_efficiency_percentage&&r.overall_efficiency_percentage){const e=r.overall_efficiency_percentage-t.overall_efficiency_percentage;e>10&&i.push({insight_type:"efficiency",priority:e>20?"high":"medium",title:"Significant Efficiency Drop Detected",description:`Overall garage efficiency dropped by ${e.toFixed(1)}% this week compared to last week.`,affected_area:"overall",efficiency_drop:e,recommended_actions:["Review work allocation and scheduling","Check if mechanics need additional training","Analyze bottlenecks in the workflow","Consider equipment maintenance or upgrades"],expected_improvement:"Could improve efficiency by 15-25% within 2 weeks",week_start:t.week_start,week_end:t.week_end})}if(t.average_delay_hours&&r.average_delay_hours){const e=t.average_delay_hours-r.average_delay_hours;e>2&&i.push({insight_type:"bottleneck",priority:e>5?"high":"medium",title:"Increasing Repair Delays",description:`Average repair delays increased by ${e.toFixed(1)} hours this week.`,affected_area:"overall",delay_increase:e,recommended_actions:["Review parts inventory to prevent delays","Optimize scheduling to reduce wait times","Consider hiring additional mechanics for peak periods","Implement better project management tools"],expected_improvement:"Could reduce delays by 30-40% within 3 weeks",week_start:t.week_start,week_end:t.week_end})}const l=t.electrical_hours+t.painter_hours+t.detailer_hours+t.mechanic_hours+t.body_work_hours;if(l>0){const e=[{type:"electrical",hours:t.electrical_hours,name:"Electrical Work"},{type:"painter",hours:t.painter_hours,name:"Painting"},{type:"detailer",hours:t.detailer_hours,name:"Detailing"},{type:"mechanic",hours:t.mechanic_hours,name:"Mechanical Work"},{type:"body_work",hours:t.body_work_hours,name:"Body Work"}].reduce((e,s)=>s.hours>e.hours?s:e);e.hours/l>.6&&i.push({insight_type:"recommendation",priority:"medium",title:`${e.name} Capacity Imbalance`,description:`${e.name} accounts for ${(e.hours/l*100).toFixed(1)}% of total work hours, indicating potential capacity imbalance.`,affected_area:"work_type_specific",affected_entity:e.type,recommended_actions:[`Consider cross-training mechanics in ${e.name.toLowerCase()}`,"Hire specialized technicians for high-demand work types","Implement better work distribution strategies","Review pricing strategy for overloaded work types"],expected_improvement:"Better work distribution and reduced bottlenecks",week_start:t.week_start,week_end:t.week_end})}for(const n of i)yield v.from("ai_insights").insert(n)}catch(e){}})},getAIInsights(e=10){return d(this,null,function*(){try{const{data:s,error:a}=yield v.from("ai_insights").select("*").order("created_at",{ascending:!1}).limit(e);if(a)throw a;return s||[]}catch(s){return[]}})},acknowledgeInsight(e,s){return d(this,null,function*(){try{const{error:a}=yield v.from("ai_insights").update({status:"acknowledged",acknowledged_by:s,acknowledged_at:(new Date).toISOString()}).eq("id",e);if(a)throw a}catch(a){throw a}})}},Re=({isOpen:e,setIsOpen:s,selectedCar:a,onSave:t})=>{const{user:r}=N(),[i,l]=he.useState((null==a?void 0:a.issueDescription)||""),[n,c]=he.useState((null==a?void 0:a.workNotes)||""),[o,g]=he.useState((null==a?void 0:a.partsUsed)||[]),[p,j]=he.useState(""),[y,v]=he.useState((null==a?void 0:a.mechanics)||[]),[q,H]=he.useState(""),[z,R]=he.useState((null==a?void 0:a.startTimestamp)?new Date(a.startTimestamp).toISOString().slice(0,16):""),[G,F]=he.useState((null==a?void 0:a.endTimestamp)?new Date(a.endTimestamp).toISOString().slice(0,16):""),[J,B]=he.useState("mechanic"),[Q,K]=he.useState(8),[Y,Z]=he.useState(0),[X,ee]=he.useState(""),[se,ae]=he.useState([]),[te,re]=he.useState(""),[ie,le]=he.useState("");xe.useEffect(()=>{if(a){if(l(a.issueDescription||""),c(a.workNotes||""),g(a.partsUsed||[]),v(a.mechanics||[]),R(a.startTimestamp?new Date(a.startTimestamp).toISOString().slice(0,16):""),F(a.endTimestamp?new Date(a.endTimestamp).toISOString().slice(0,16):""),a.startTimestamp&&!X){const e=new Date(a.startTimestamp);e.setHours(e.getHours()+Q),ee(e.toISOString().slice(0,16))}if(a.startTimestamp&&a.endTimestamp){const e=new Date(a.startTimestamp),s=(new Date(a.endTimestamp).getTime()-e.getTime())/36e5;Z(Math.round(100*s)/100)}}},[a]);const ne=()=>{p.trim()&&!o.includes(p.trim())&&(g([...o,p.trim()]),j(""))},ce=()=>{q.trim()&&!y.includes(q.trim())&&(v([...y,q.trim()]),H(""))},de=()=>{te.trim()&&!se.includes(te.trim())&&(ae([...se,te.trim()]),re(""))};return a?u.jsx(f,{open:e,onOpenChange:s,children:u.jsxs(w,{className:"sm:max-w-[900px] h-[90vh] bg-white opacity-100 flex flex-col",children:[u.jsxs(b,{className:"flex-shrink-0",children:[u.jsxs(k,{className:"flex items-center gap-2",children:[u.jsx(S,{className:"h-5 w-5"}),"Edit Car Details - ",a.carModel," (",a.carCode,")"]}),u.jsx(C,{children:"Update repair details, track productivity metrics, and manage team assignments."})]}),u.jsx(T,{className:"flex-1 pr-4",children:u.jsxs("div",{className:"space-y-6 py-4",children:[u.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u.jsx(D,{className:"h-4 w-4 text-blue-600"}),u.jsx("h3",{className:"text-sm font-medium text-blue-700",children:"Customer Information"})]}),u.jsxs("p",{className:"text-sm",children:["Customer: ",a.customerName]}),u.jsxs("p",{className:"text-sm",children:["Assigned Employee: ",a.assignedEmployee]}),u.jsxs("p",{className:"text-sm",children:["Entry Date: ",new Date(a.entryDate).toLocaleDateString()]})]}),u.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-100",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[u.jsx(_,{className:"h-4 w-4 text-green-600"}),u.jsx("h3",{className:"text-sm font-medium text-green-700",children:"Productivity Tracking"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(I,{htmlFor:"workType",children:"Work Type"}),u.jsxs(M,{value:J,onValueChange:e=>B(e),children:[u.jsx(O,{children:u.jsx(E,{placeholder:"Select work type"})}),u.jsxs(U,{children:[u.jsx(P,{value:"electrical",children:"Electrical"}),u.jsx(P,{value:"painter",children:"Painting"}),u.jsx(P,{value:"detailer",children:"Detailing"}),u.jsx(P,{value:"mechanic",children:"Mechanical"}),u.jsx(P,{value:"body_work",children:"Body Work"})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(I,{htmlFor:"estimatedHours",children:"Estimated Hours"}),u.jsx(h,{id:"estimatedHours",type:"number",step:"0.5",min:"0",value:Q,onChange:e=>K(Number(e.target.value))})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(I,{htmlFor:"estimatedCompletion",children:"Estimated Completion"}),u.jsx(h,{id:"estimatedCompletion",type:"datetime-local",value:X,onChange:e=>ee(e.target.value),className:"repair-dialog"})]}),G&&u.jsxs("div",{className:"space-y-2",children:[u.jsx(I,{htmlFor:"actualHours",children:"Actual Hours"}),u.jsx(h,{id:"actualHours",type:"number",step:"0.1",min:"0",value:Y,onChange:e=>Z(Number(e.target.value))})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs(I,{htmlFor:"issueDescription",className:"flex items-center gap-2",children:[u.jsx(S,{className:"h-4 w-4"}),"Issue Description"]}),u.jsx(L,{id:"issueDescription",value:i,onChange:e=>l(e.target.value),placeholder:"Describe the issue with the vehicle...",className:"min-h-[100px]"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs(I,{htmlFor:"workNotes",className:"flex items-center gap-2",children:[u.jsx(pe,{className:"h-4 w-4"}),"Work Notes"]}),u.jsx(L,{id:"workNotes",value:n,onChange:e=>c(e.target.value),placeholder:"Detailed work notes and observations...",className:"min-h-[100px]"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs(I,{htmlFor:"productivityNotes",className:"flex items-center gap-2",children:[u.jsx(_,{className:"h-4 w-4"}),"Productivity Notes"]}),u.jsx(L,{id:"productivityNotes",value:ie,onChange:e=>le(e.target.value),placeholder:"Notes about efficiency, delays, or productivity insights...",className:"min-h-[80px]"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs(I,{className:"flex items-center gap-2",children:[u.jsx(S,{className:"h-4 w-4"}),"Quality Issues"]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(h,{value:te,onChange:e=>re(e.target.value),placeholder:"Add quality issue...",onKeyPress:e=>"Enter"===e.key&&de()}),u.jsx(x,{type:"button",onClick:de,children:"Add Issue"})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:se.map((e,s)=>u.jsxs(A,{variant:"destructive",className:"flex items-center gap-1",children:[e,u.jsx($,{className:"h-3 w-3 cursor-pointer",onClick:()=>(e=>{ae(se.filter(s=>s!==e))})(e)})]},s))})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs(I,{className:"flex items-center gap-2",children:[u.jsx(S,{className:"h-4 w-4"}),"Part Numbers Used"]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(h,{value:p,onChange:e=>j(e.target.value),placeholder:"Add part number...",onKeyPress:e=>"Enter"===e.key&&ne(),className:"flex-1"}),u.jsx(be,{onPartNumberScanned:e=>{j(e),m({title:"Part number scanned",description:`Part number ${e} ready to add`})},children:u.jsx(x,{variant:"outline",size:"sm",type:"button",title:"Scan Part Number",children:u.jsx(Se,{className:"h-4 w-4"})})}),u.jsx(x,{type:"button",onClick:ne,children:"Add Part"})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((e,s)=>u.jsxs(A,{variant:"secondary",className:"flex items-center gap-1",children:[u.jsx("span",{className:"font-mono font-semibold",children:e}),u.jsx($,{className:"h-3 w-3 cursor-pointer",onClick:()=>(e=>{g(o.filter(s=>s!==e))})(e)})]},s))})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs(I,{className:"flex items-center gap-2",children:[u.jsx(D,{className:"h-4 w-4"}),"Assigned Mechanics"]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(h,{value:q,onChange:e=>H(e.target.value),placeholder:"Add mechanic name...",onKeyPress:e=>"Enter"===e.key&&ce()}),u.jsx(x,{type:"button",onClick:ce,children:"Add Mechanic"})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:y.map((e,s)=>u.jsxs(A,{variant:"outline",className:"flex items-center gap-1",children:[e,u.jsx($,{className:"h-3 w-3 cursor-pointer",onClick:()=>(e=>{v(y.filter(s=>s!==e))})(e)})]},s))})]}),u.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-100",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[u.jsx(V,{className:"h-4 w-4 text-green-600"}),u.jsx("h3",{className:"text-sm font-medium text-green-700",children:"Time Tracking"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(I,{htmlFor:"startTime",children:"Start Time"}),u.jsx(h,{id:"startTime",type:"datetime-local",value:z,onChange:e=>R(e.target.value),className:"repair-dialog"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(I,{htmlFor:"endTime",children:"End Time"}),u.jsx(h,{id:"endTime",type:"datetime-local",value:G,onChange:e=>F(e.target.value),className:"repair-dialog"})]})]})]})]})}),u.jsxs(W,{className:"flex-shrink-0 mt-4",children:[u.jsx(x,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),u.jsx(x,{onClick:()=>d(void 0,null,function*(){if(!a)return;const e={issueDescription:i,workNotes:n,partsUsed:o,mechanics:y,startTimestamp:z?new Date(z).toISOString():a.startTimestamp,endTimestamp:G?new Date(G).toISOString():a.endTimestamp,lastUpdated:(new Date).toISOString()};if(z&&y.length>0)try{const e=G?"completed":"in_progress",s={carId:a.id,carCode:a.carCode,customerName:a.customerName,assignedMechanics:y,workType:J,estimatedHours:Q,actualHours:G?Y:void 0,estimatedStart:z,actualStart:z,estimatedCompletion:X||new Date(Date.now()+60*Q*60*1e3).toISOString(),actualCompletion:G||void 0,status:e,productivityNotes:ie,qualityIssues:se};yield ze.trackProductivity(s),m({title:"Productivity Tracked",description:"Car details and productivity metrics have been recorded for AI analysis."})}catch(s){m({title:"Productivity Tracking Failed",description:"Car details saved but productivity tracking failed.",variant:"destructive"})}t(a.id,e),yield ke.trackClientInteraction({clientName:a.customerName,clientPhone:"",clientLicensePlate:"",carVin:a.carCode,interactionType:"repair_update",notes:`Updated repair details: ${n||"No specific notes"}`,employee:(null==r?void 0:r.name)||"Unknown Employee"}),yield ke.trackWorkflowEvent({eventType:"repair_details_updated",entityType:"repair",entityId:a.id,userName:(null==r?void 0:r.name)||"Unknown User",metadata:{carCode:a.carCode,customerName:a.customerName,partsCount:o.length,mechanicsCount:y.length,workType:J,estimatedHours:Q}}),m({title:"Details Updated",description:`Details for ${a.carCode} have been saved successfully.`})}),className:"bg-green-600 hover:bg-green-700",children:"Save & Track Productivity"})]})]})}):null},Ge=({cars:e,onUpdateStatus:s,isGarageManager:a,searchTerm:t,setSearchTerm:r})=>{const[i,l]=he.useState(null),[d,o]=he.useState(!1),[h,g]=he.useState(e),{changeCarStatus:p}=((e,s)=>{const a=(e,s)=>{t(e,s),r(e,s),i(e,s)},t=(e,s)=>{const a=localStorage.getItem("carInventory");if(a)try{const t=JSON.parse(a).map(a=>{var t;return a.model===e.carModel||(null==(t=a.vinNumber)?void 0:t.includes(e.carCode))?c(n({},a),{status:"sold",soldDate:s,currentFloor:void 0,inShowroom:!1,showroomExitDate:s,showroomNote:`Delivered to client - ${e.customerName}`,clientName:e.customerName,notes:`Delivered after repair completion. Work performed: ${e.workNotes||e.issueDescription||"Repair completed"}`}):a});localStorage.setItem("carInventory",JSON.stringify(t))}catch(t){}},r=(e,s)=>{const a=e.startTimestamp?new Date(e.startTimestamp):new Date(e.entryDate),t=new Date(s),r=Math.round((t.getTime()-a.getTime())/36e5),i={id:Date.now().toString(),carCode:e.carCode,carModel:e.carModel,customerName:e.customerName,assignedEmployee:e.assignedEmployee,mechanics:e.mechanics||[],entryDate:e.entryDate,startTimestamp:e.startTimestamp,endTimestamp:s,deliveryTimestamp:s,issueDescription:e.issueDescription,workNotes:e.workNotes,partsUsed:e.partsUsed||[],repairDurationHours:r,repairDuration:`${r}h`,statusComments:e.statusComments,completedAt:s,status:"delivered"},l=localStorage.getItem("repairHistory"),n=l?JSON.parse(l):[];n.unshift(i),localStorage.setItem("repairHistory",JSON.stringify(n))},i=(e,s)=>{if(e.partsUsed&&e.partsUsed.length>0){const a=localStorage.getItem("inventoryHistory"),t=a?JSON.parse(a):[];e.partsUsed.forEach(a=>{const r={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,partId:`part-${a.replace(/\s+/g,"-").toLowerCase()}`,partName:a,partNumber:`PN-${a.replace(/\s+/g,"").toUpperCase()}`,quantity:1,carVIN:e.carCode,employee:e.assignedEmployee,timestamp:s,partType:a.includes("DF")?"DF":a.includes("BM")?"BM":void 0};t.unshift(r)}),localStorage.setItem("inventoryHistory",JSON.stringify(t))}},l=(e,s,a,t,r)=>{const i={id:`worktype-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,carCode:e.carCode,carModel:e.carModel,customerName:e.customerName,fromWorkType:s,toWorkType:a,workTypeChange:t,timestamp:r,assignedEmployee:e.assignedEmployee,mechanics:e.mechanics||[],notes:`Work type changed from ${s.replace("_"," ")} to ${a.replace("_"," ")}`,duration:x(e,s,r),partsUsed:e.partsUsed||[],partsUsedInStage:d(e),totalPartsCost:u(e.partsUsed||[]),toolsUsed:e.toolsUsed||[],toolsUsedInStage:o(e),totalToolsCost:h(e.toolsUsed||[]),workNotes:e.workNotes,issueDescription:e.issueDescription},l=localStorage.getItem("repairHistory"),m=l?JSON.parse(l):[];m.unshift(c(n({},i),{type:"work_type_change",date:new Date(r).toLocaleDateString(),description:t,technician:e.assignedEmployee,notes:i.notes,workTypeTransition:t,fromStage:s,toStage:a,transitionTimestamp:r,partsUsed:i.partsUsed,partsUsedInStage:i.partsUsedInStage,totalPartsCost:i.totalPartsCost,toolsUsed:i.toolsUsed,toolsUsedInStage:i.toolsUsedInStage,totalToolsCost:i.totalToolsCost})),localStorage.setItem("repairHistory",JSON.stringify(m));const g=localStorage.getItem("workTypeHistory"),p=g?JSON.parse(g):[];p.unshift(i),localStorage.setItem("workTypeHistory",JSON.stringify(p))},d=(e,s)=>e.partsUsed||[],o=(e,s)=>e.toolsUsed||[],u=e=>{let s=0;return e.forEach(e=>{e.toLowerCase().includes("battery")?s+=1500:e.toLowerCase().includes("brake")?s+=200:e.toLowerCase().includes("filter")?s+=50:e.toLowerCase().includes("sensor")?s+=300:e.toLowerCase().includes("motor")?s+=800:s+=100}),s},h=e=>{let s=0;return e.forEach(e=>{e.toLowerCase().includes("diagnostic")?s+=500:e.toLowerCase().includes("lift")?s+=200:e.toLowerCase().includes("scanner")?s+=300:e.toLowerCase().includes("welder")?s+=150:e.toLowerCase().includes("tester")?s+=250:e.toLowerCase().includes("meter")?s+=100:e.toLowerCase().includes("torque")?s+=80:e.toLowerCase().includes("socket")?s+=50:s+=75}),s},x=(e,s,a)=>{let t;switch(s){case"in_diagnosis":case"in_repair":case"in_quality_check":t=e.startTimestamp?new Date(e.startTimestamp):new Date(e.entryDate);break;default:t=new Date(e.entryDate)}const r=new Date(a),i=Math.round((r.getTime()-t.getTime())/36e5),l=Math.round((r.getTime()-t.getTime())/6e4);return i>0?`${i}h ${l%60}m`:`${l}m`};return{moveToNextStage:t=>{let r,i;switch(t.status){case"in_diagnosis":r="in_repair",i="Diagnosis → Repair";break;case"in_repair":r="in_quality_check",i="Repair → Quality Check";break;case"in_quality_check":r="ready",i="Quality Check → Ready";break;case"ready":r="delivered",i="Ready → Delivered";break;default:return}const d=(new Date).toISOString(),o=e.map(e=>e.id===t.id?c(n({},e),{status:r,endTimestamp:"delivered"===r?d:e.endTimestamp,lastUpdated:d}):e);s(o),localStorage.setItem("garageCars",JSON.stringify(o)),l(t,t.status,r,i,d),"delivered"===r&&a(t,d),m({title:"Status Updated",description:`${t.carCode} moved to ${r.replace("_"," ").toUpperCase()}`})},changeCarStatus:(t,r)=>{const i=(new Date).toISOString(),d=`${t.status.replace("_"," ").toUpperCase()} → ${r.replace("_"," ").toUpperCase()}`,o=e.map(e=>e.id===t.id?c(n({},e),{status:r,endTimestamp:"delivered"===r?i:e.endTimestamp,lastUpdated:i}):e);s(o),localStorage.setItem("garageCars",JSON.stringify(o)),l(t,t.status,r,d,i),"delivered"===r&&a(t,i),m({title:"Status Updated",description:`${t.carCode} moved to ${r.replace("_"," ").toUpperCase()}`})}}})(h,g),j=(e,s)=>{if(!e||!s)return"Ongoing";try{return`${Math.round((new Date(s).getTime()-new Date(e).getTime())/36e5)}h`}catch(a){return"N/A"}},v=e=>{l(e),o(!0)},N=e=>{switch(e){case"ready":return"bg-green-100 text-green-800";case"in_repair":return"bg-orange-100 text-orange-800";case"in_diagnosis":return"bg-blue-100 text-blue-800";case"in_quality_check":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},f=e.filter(e=>"delivered"!==e.status);return u.jsxs(u.Fragment,{children:[u.jsxs(y,{children:[u.jsx(q,{children:u.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[u.jsxs(H,{className:"flex items-center gap-2",children:[u.jsx(D,{className:"h-5 w-5"}),"Garage Workflow & Employee Tracking Dashboard (",f.length," active cars)"]}),void 0!==t&&r&&u.jsx(Ce,{value:t,onChange:r,placeholder:"Search cars, customers, employees, issues...",className:"w-full sm:w-auto"})]})}),u.jsx(z,{children:u.jsxs(je,{children:[u.jsx(ye,{children:u.jsxs(ve,{children:[u.jsx(Ne,{children:"Car Details"}),u.jsx(Ne,{children:"Customer"}),u.jsx(Ne,{children:"Status"}),u.jsx(Ne,{children:"Assigned Team"}),u.jsx(Ne,{children:"Issue & Work Notes"}),u.jsx(Ne,{children:"Time Tracking"}),u.jsx(Ne,{children:"Productivity"}),u.jsx(Ne,{children:"Actions"})]})}),u.jsx(fe,{children:f.length>0?f.map(t=>u.jsxs(ve,{className:"hover:bg-amber-50/30",children:[u.jsx(we,{children:u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:t.carModel}),u.jsxs("div",{className:"text-sm text-muted-foreground",children:["Code: ",t.carCode]}),u.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Entry: ",new Date(t.entryDate).toLocaleDateString(),t.expectedExitDate&&u.jsxs("div",{children:["Expected Exit: ",t.expectedExitDate]})]})]})}),u.jsx(we,{children:t.customerName}),u.jsx(we,{children:u.jsxs("div",{className:"space-y-2",children:[u.jsx(A,{className:`text-xs ${N(t.status)}`,children:He[t.status]}),t.statusComments&&u.jsx("div",{className:"text-xs bg-gray-50 p-1.5 rounded border max-w-[200px]",children:t.statusComments.length>50?t.statusComments.substring(0,50)+"...":t.statusComments}),u.jsx("div",{className:"mt-2",children:u.jsxs("select",{className:"h-7 w-full rounded-md border border-input bg-background px-2 text-xs",value:t.status,onChange:a=>((a,t)=>{const r=e.find(e=>e.id===a);r&&(p(r,t),s(a,t))})(t.id,a.target.value),children:[u.jsx("option",{disabled:!0,children:"Change Status"}),u.jsx("option",{value:"in_diagnosis",children:"In Diagnosis"}),u.jsx("option",{value:"in_repair",children:"In Repair"}),u.jsx("option",{value:"in_quality_check",children:"Quality Check"}),u.jsx("option",{value:"ready",children:"Ready for Pickup"}),u.jsx("option",{value:"delivered",children:"Delivered"})]})})]})}),u.jsx(we,{children:u.jsxs("div",{className:"space-y-2",children:[u.jsx("div",{className:"text-sm font-medium",children:t.assignedEmployee}),t.mechanics&&t.mechanics.length>0&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-medium mb-1",children:"Mechanics:"}),u.jsx("div",{className:"flex flex-wrap gap-1",children:t.mechanics.map((e,s)=>u.jsx(A,{variant:"outline",className:"text-xs",children:e},s))})]}),t.partsUsed&&t.partsUsed.length>0&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-medium mb-1",children:"Parts Used:"}),u.jsx("div",{className:"text-xs text-muted-foreground",children:t.partsUsed.join(", ")})]})]})}),u.jsx(we,{children:u.jsxs("div",{className:"space-y-2 max-w-xs",children:[t.issueDescription&&u.jsxs("div",{className:"text-sm bg-red-50 p-2 rounded border border-red-100",children:[u.jsxs("div",{className:"flex items-center gap-1 mb-1 text-xs font-semibold",children:[u.jsx(S,{className:"h-3 w-3"}),"Issue:"]}),t.issueDescription.length>100?t.issueDescription.substring(0,100)+"...":t.issueDescription]}),t.workNotes&&u.jsxs("div",{className:"text-sm bg-amber-50 p-2 rounded border border-amber-100",children:[u.jsxs("div",{className:"flex items-center gap-1 mb-1 text-xs font-semibold",children:[u.jsx(R,{className:"h-3 w-3"}),"Work Notes:"]}),t.workNotes.length>100?t.workNotes.substring(0,100)+"...":t.workNotes]}),!t.issueDescription&&!t.workNotes&&u.jsx("span",{className:"text-muted-foreground text-sm",children:"No notes available"})]})}),u.jsx(we,{children:u.jsxs("div",{className:"space-y-1 text-xs",children:[u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(V,{className:"h-3 w-3"}),u.jsxs("span",{children:["Arrived: ",new Date(t.entryDate).toLocaleDateString()]})]}),t.startTimestamp&&u.jsxs("div",{className:"text-green-600 bg-green-50 px-2 py-1 rounded border border-green-100",children:["Started: ",G.formatDateTime(t.startTimestamp)]}),t.endTimestamp&&u.jsxs("div",{className:"text-amber-600 bg-amber-50 px-2 py-1 rounded border border-amber-100",children:["Finished: ",G.formatDateTime(t.endTimestamp)]}),u.jsxs("div",{className:"text-xs text-muted-foreground",children:["Updated: ",new Date(t.lastUpdated).toLocaleDateString()]})]})}),u.jsx(we,{children:u.jsxs("div",{className:"text-sm",children:[t.startTimestamp&&t.endTimestamp?u.jsx(A,{variant:"default",children:j(t.startTimestamp,t.endTimestamp)}):t.startTimestamp?u.jsx(A,{variant:"secondary",children:"In Progress"}):u.jsx(A,{variant:"outline",children:"Not Started"}),t.repairDuration&&u.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Duration: ",t.repairDuration]})]})}),u.jsx(we,{children:u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsxs(x,{variant:"outline",size:"sm",onClick:()=>v(t),children:[u.jsx(Te,{className:"h-4 w-4 mr-1"}),"View Details"]}),a&&u.jsxs(x,{variant:"outline",size:"sm",onClick:()=>v(t),children:[u.jsx(F,{className:"h-4 w-4 mr-1"}),"Edit"]})]})})]},t.id)):u.jsx(ve,{children:u.jsx(we,{colSpan:8,className:"text-center py-6 text-muted-foreground",children:"No cars found in the garage."})})})]})})]}),i&&u.jsx(Re,{isOpen:d,setIsOpen:o,selectedCar:i,onSave:(e,s)=>{o(!1)}})]})},Fe=({cars:e,onUpdateStatus:s,isGarageManager:a})=>{const{schedules:t,allScheduledCars:r}=$e(),[i,l]=he.useState(new Date),[n,c]=he.useState(""),[d,o]=he.useState("all"),m=e.filter(e=>{var s,a,t,r,i,l,c,d,o;if(!n.trim())return!0;const m=n.toLowerCase();return(null==(s=e.carCode)?void 0:s.toLowerCase().includes(m))||(null==(a=e.carModel)?void 0:a.toLowerCase().includes(m))||(null==(t=e.customerName)?void 0:t.toLowerCase().includes(m))||(null==(r=e.assignedEmployee)?void 0:r.toLowerCase().includes(m))||(null==(i=e.issueDescription)?void 0:i.toLowerCase().includes(m))||(null==(l=e.workNotes)?void 0:l.toLowerCase().includes(m))||(null==(c=e.mechanics)?void 0:c.some(e=>e.toLowerCase().includes(m)))||(null==(d=e.partsUsed)?void 0:d.some(e=>e.toLowerCase().includes(m)))||(null==(o=e.status)?void 0:o.toLowerCase().includes(m))});he.useEffect(()=>{l(new Date)},[t,r]);(()=>{const s=r.map(e=>e.carCode),a=e.filter(e=>!s.includes(e.carCode)&&"delivered"!==e.status&&!e.endTimestamp);a.length})();const h=(new Date).toISOString().split("T")[0],g=t.find(e=>e.date===h),p=(null==g?void 0:g.scheduledCars)||[],j=e=>{switch(e){case"electrical":return u.jsx(X,{className:"h-5 w-5 text-blue-600"});case"mechanic":return u.jsx(S,{className:"h-5 w-5 text-green-600"});case"body_work":return u.jsx(Y,{className:"h-5 w-5 text-purple-600"});case"painter":return u.jsx(Z,{className:"h-5 w-5 text-orange-600"});case"detailer":return u.jsx(_e,{className:"h-5 w-5 text-pink-600"});default:return u.jsx(Y,{className:"h-5 w-5"})}},v=e=>{switch(e){case"electrical":return"Electrical";case"mechanic":return"Mechanical";case"body_work":return"Body Work";case"painter":return"Painting";case"detailer":return"Detailing";default:return e}},N=["electrical","mechanic","body_work","painter","detailer"].map(e=>{const s=p.filter(s=>s.workType===e),a=s.filter(e=>"pending"===e.status).length,t=s.filter(e=>"scheduled"===e.status).length,r=s.filter(e=>"in_progress"===e.status).length,i=s.filter(e=>"completed"===e.status).length,l=s.filter(e=>"high"===e.priority).length;return{section:e,total:s.length,pending:a,scheduled:t,inProgress:r,completed:i,highPriority:l,utilization:s.length>0?Math.round((r+i)/s.length*100):0}}),f=p.length,w=p.filter(e=>"in_progress"===e.status).length,b=p.filter(e=>"completed"===e.status).length,k=p.filter(e=>"high"===e.priority).length,C=p.filter(e=>{var s;return null==(s=e.notes)?void 0:s.includes("")}).length,T=p.filter(e=>{var s;return null==(s=e.notes)?void 0:s.includes("")}).length;return u.jsxs("div",{className:"space-y-6",children:[u.jsx(y,{className:"border-blue-200 bg-blue-50",children:u.jsx(z,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Garage Schedule Integration"}),u.jsxs("p",{className:"text-xs text-blue-600",children:["Last synced: ",i.toLocaleTimeString()]})]})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs(A,{variant:"outline",className:"text-blue-700 border-blue-300",children:[f," scheduled today"]}),u.jsxs(A,{variant:"outline",className:"text-green-700 border-green-300",children:[e.length," in garage"]})]})]})})}),u.jsxs(y,{className:"border-l-4 border-l-blue-500",children:[u.jsxs(q,{children:[u.jsxs(H,{className:"flex items-center gap-2",children:[u.jsx(J,{className:"h-5 w-5 text-blue-600"}),"Live Garage Operations Summary",u.jsxs(A,{className:"bg-green-100 text-green-700",children:[u.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse mr-1"}),"LIVE"]})]}),u.jsxs(B,{children:["Real-time summary from today's garage schedule (",h,")"]})]}),u.jsxs(z,{children:[u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[u.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg border",children:[u.jsx("div",{className:"text-2xl font-bold text-blue-600",children:f}),u.jsx("div",{className:"text-sm text-muted-foreground",children:"Cars Assigned Today"})]}),u.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg border",children:[u.jsx("div",{className:"text-2xl font-bold text-orange-600",children:w}),u.jsx("div",{className:"text-sm text-muted-foreground",children:"Currently Working"})]}),u.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border",children:[u.jsx("div",{className:"text-2xl font-bold text-green-600",children:b}),u.jsx("div",{className:"text-sm text-muted-foreground",children:"Completed Today"})]}),u.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border",children:[u.jsx("div",{className:"text-2xl font-bold text-red-600",children:k}),u.jsx("div",{className:"text-sm text-muted-foreground",children:"High Priority"})]})]}),u.jsxs("div",{className:"flex gap-4 mb-6",children:[C>0&&u.jsxs(A,{className:"bg-yellow-100 text-yellow-800",children:[C," Special Event",C>1?"s":""]}),T>0&&u.jsxs(A,{className:"bg-purple-100 text-purple-800",children:[T," Owner Request",T>1?"s":""]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"SECTION STATUS OVERVIEW"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:N.map(e=>u.jsxs(y,{className:"p-3",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[j(e.section),u.jsx("span",{className:"font-medium text-sm",children:v(e.section)}),e.highPriority>0&&u.jsxs(A,{variant:"destructive",className:"text-xs",children:[e.highPriority," HIGH"]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between text-xs",children:[u.jsx("span",{children:"Progress"}),u.jsxs("span",{children:[e.utilization,"%"]})]}),u.jsx(Q,{value:e.utilization,className:"h-1"}),u.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs text-muted-foreground",children:[u.jsxs("div",{children:["Active: ",e.inProgress]}),u.jsxs("div",{children:["Done: ",e.completed]}),u.jsxs("div",{children:["Scheduled: ",e.scheduled]}),u.jsxs("div",{children:["Pending: ",e.pending]})]})]})]},e.section))})]}),p.length>0&&u.jsxs("div",{className:"mt-6 pt-4 border-t",children:[u.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-3",children:"TODAY'S SCHEDULE HIGHLIGHTS"}),u.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:p.slice(0,5).map(e=>{var s,a,t;return u.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-sm",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[j(e.workType),u.jsx("span",{className:"font-medium",children:e.carCode}),u.jsx("span",{className:"text-muted-foreground",children:e.carModel}),"high"===e.priority&&u.jsx(Ae,{className:"h-3 w-3 text-red-500"}),(null==(s=e.notes)?void 0:s.includes(""))&&u.jsx(K,{className:"h-3 w-3 text-purple-500"}),(null==(a=e.notes)?void 0:a.includes(""))&&u.jsx("span",{className:"text-xs"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(A,{variant:"in_progress"===e.status?"default":"secondary",className:"text-xs",children:null==(t=e.status)?void 0:t.replace("_"," ").toUpperCase()}),u.jsx("span",{className:"text-muted-foreground",children:e.estimatedDuration})]})]},e.id)})}),p.length>5&&u.jsx("div",{className:"text-center mt-2",children:u.jsxs(x,{variant:"ghost",size:"sm",className:"text-xs",children:["View All ",p.length," Assignments",u.jsx(De,{className:"h-3 w-3 ml-1"})]})})]}),!g&&u.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[u.jsx("p",{className:"text-sm",children:"No garage schedule found for today"}),u.jsx("p",{className:"text-xs",children:"Visit the Garage Schedule page to create today's assignments"})]})]})]}),u.jsx(qe,{cars:m,searchTerm:n,setSearchTerm:c,activeTab:d,setActiveTab:o}),u.jsx(Ge,{cars:m,onUpdateStatus:s,isGarageManager:a,searchTerm:n,setSearchTerm:c}),u.jsxs("div",{className:"flex items-center justify-center gap-2 py-3 border-t bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),u.jsxs("span",{className:"text-xs text-muted-foreground",children:["Live sync with garage schedule • Last updated: ",i.toLocaleTimeString()]}),u.jsxs(A,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:[u.jsx(J,{className:"h-3 w-3 mr-1"}),"Connected"]})]})]})},Je=({scheduledCars:e})=>{const s=e=>{switch(e){case"electrical":return u.jsx(X,{className:"h-4 w-4"});case"painter":return u.jsx(Z,{className:"h-4 w-4"});case"detailer":return u.jsx(Me,{className:"h-4 w-4"});case"mechanic":return u.jsx(ee,{className:"h-4 w-4"});case"body_work":return u.jsx(Ie,{className:"h-4 w-4"});default:return u.jsx(S,{className:"h-4 w-4"})}},a=e=>{switch(e){case"electrical":return"bg-yellow-100 text-yellow-800";case"painter":return"bg-purple-100 text-purple-800";case"detailer":return"bg-blue-100 text-blue-800";case"mechanic":return"bg-green-100 text-green-800";case"body_work":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},t=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},r=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-orange-100 text-orange-800";case"completed":return"bg-green-100 text-green-800";case"delayed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},i=e=>{switch(e){case"completed":return u.jsx(ae,{className:"h-4 w-4"});case"delayed":return u.jsx(se,{className:"h-4 w-4"});default:return u.jsx(V,{className:"h-4 w-4"})}},l=e.reduce((e,s)=>(e[s.scheduleDate]||(e[s.scheduleDate]=[]),e[s.scheduleDate].push(s),e),{});return u.jsx("div",{className:"space-y-6",children:u.jsxs(y,{children:[u.jsx(q,{children:u.jsx(H,{className:"flex items-center gap-2",children:"Worker Schedule Overview"})}),u.jsxs(z,{children:[u.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Complete view of all scheduled work assignments and employee activities"}),0===Object.keys(l).length?u.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No scheduled work found. Cars will appear here when scheduled in the garage schedule."}):u.jsx("div",{className:"space-y-6",children:Object.entries(l).map(([e,l])=>u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center gap-2 border-b pb-2",children:[u.jsx("h3",{className:"font-medium",children:new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),u.jsxs(A,{variant:"outline",children:[l.length," scheduled"]})]}),u.jsxs(je,{children:[u.jsx(ye,{children:u.jsxs(ve,{children:[u.jsx(Ne,{children:"Car & Customer"}),u.jsx(Ne,{children:"Work Details"}),u.jsx(Ne,{children:"Assigned Worker"}),u.jsx(Ne,{children:"Schedule Time"}),u.jsx(Ne,{children:"Priority & Status"}),u.jsx(Ne,{children:"Notes"})]})}),u.jsx(fe,{children:l.map(e=>u.jsxs(ve,{children:[u.jsx(we,{children:u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:e.carCode}),u.jsx("div",{className:"text-sm text-muted-foreground",children:e.carModel}),u.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[u.jsx(R,{className:"h-3 w-3"}),u.jsx("span",{className:"text-sm",children:e.customerName})]})]})}),u.jsx(we,{children:u.jsxs("div",{className:"space-y-2",children:[u.jsxs(A,{className:`${a(e.workType)} flex items-center gap-1 w-fit`,children:[s(e.workType),e.workType.replace("_"," ")]}),u.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[u.jsx(V,{className:"h-3 w-3"}),u.jsxs("span",{children:[e.estimatedDuration,"h estimated"]})]})]})}),u.jsx(we,{children:u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(R,{className:"h-4 w-4"}),u.jsx("span",{children:e.assignedMechanic||"Unassigned"})]})}),u.jsx(we,{children:u.jsxs("div",{className:"text-sm",children:[u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(V,{className:"h-3 w-3"}),u.jsx("span",{children:e.scheduleTime})]}),!e.available&&u.jsx(A,{variant:"destructive",className:"mt-1 text-xs",children:"Unavailable"})]})}),u.jsx(we,{children:u.jsxs("div",{className:"space-y-1",children:[u.jsxs(A,{className:t(e.priority),children:[e.priority," priority"]}),u.jsx("div",{className:"flex items-center gap-1",children:u.jsxs(A,{className:`${r(e.status)} flex items-center gap-1`,children:[i(e.status),e.status.replace("_"," ")]})})]})}),u.jsx(we,{children:u.jsxs("div",{className:"max-w-xs",children:[e.notes&&u.jsx("div",{className:"text-sm bg-gray-50 p-2 rounded border",children:e.notes.length>100?e.notes.substring(0,100)+"...":e.notes}),e.scheduleNotes&&u.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Schedule: ",e.scheduleNotes]})]})})]},e.id))})]})]},e))})]})]})})},Be=({cars:e,scheduledCars:s,onScheduleUpdate:a})=>{var t,r,i,l;const{toast:o}=te(),[m,g]=he.useState(!1),[p,j]=he.useState(!1),[v,N]=he.useState(!1),[C,T]=he.useState(null),[_,M]=he.useState(!1),[O,E]=he.useState({employees:!1,skills:!1}),[U,P]=he.useState({priority:"medium",workType:"mechanic",status:"scheduled"}),[V,G]=he.useState(null),[F,J]=he.useState([{id:"pdi-setup",name:"PDI Setup",workType:"mechanic",estimatedDuration:120,requiredSkills:["mechanical","electrical","inspection"],description:"Pre-Delivery Inspection and setup",priority:"high"},{id:"battery-check",name:"Battery Check",workType:"electrical",estimatedDuration:45,requiredSkills:["electrical","battery"],description:"Battery health and charging system check",priority:"medium"},{id:"tire-rotation",name:"Tire Rotation",workType:"mechanic",estimatedDuration:60,requiredSkills:["mechanical","tires"],description:"Tire rotation and balance",priority:"low"}]),[B,Q]=he.useState({workTitle:{isValid:!0,message:""},carCode:{isValid:!0,message:""},scheduledDate:{isValid:!0,message:""},startTime:{isValid:!0,message:""},estimatedDuration:{isValid:!0,message:""},assignedMechanic:{isValid:!0,message:""}}),K=he.useRef(null),Y=he.useRef(null),ae=he.useRef(null),de=he.useRef(null),oe=he.useRef(null),me=he.useRef(null);he.useEffect(()=>{const e=()=>{M(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const ue=e.filter(e=>!s.some(s=>s.carCode===e.carCode)),xe=[{value:"mechanic",label:"Mechanical",icon:S,color:"bg-blue-100 text-blue-800"},{value:"electrical",label:"Electrical",icon:X,color:"bg-yellow-100 text-yellow-800"},{value:"body_work",label:"Bodywork",icon:Z,color:"bg-purple-100 text-purple-800"},{value:"painter",label:"Painting",icon:ee,color:"bg-green-100 text-green-800"},{value:"detailer",label:"Detailing",icon:ee,color:"bg-gray-100 text-gray-800"}],ge=[{id:"1",name:"Ahmed Hassan",skills:["mechanical","electrical","inspection"],availability:{}},{id:"2",name:"Mohammed Ali",skills:["mechanical","bodywork"],availability:{}},{id:"3",name:"Fatima Zahra",skills:["electrical","battery"],availability:{}},{id:"4",name:"Omar Khalil",skills:["inspection","cleaning"],availability:{}},{id:"5",name:"Layla Ahmed",skills:["mechanical","electrical","bodywork"],availability:{}}],pe=(e,s)=>{let a=!0,t="";switch(e){case"workTitle":s&&0!==s.trim().length?s.trim().length<3&&(a=!1,t="Work title must be at least 3 characters"):(a=!1,t="Work title is required");break;case"carCode":s||(a=!1,t="Please select a car");break;case"scheduledDate":if(s){const e=new Date(s),r=new Date;r.setHours(0,0,0,0),e<r&&(a=!1,t="Date cannot be in the past")}else a=!1,t="Please select a date";break;case"startTime":s||(a=!1,t="Please select a start time");break;case"estimatedDuration":!s||s<15?(a=!1,t="Duration must be at least 15 minutes"):s>480&&(a=!1,t="Duration cannot exceed 8 hours");break;case"assignedMechanic":s||(a=!1,t="Please assign an employee")}return Q(s=>c(n({},s),{[e]:{isValid:a,message:t}})),a},je=e=>({mechanic:["mechanical","diagnostic"],electrical:["electrical","battery"],body_work:["bodywork","mechanical"],painter:["painting","bodywork"],detailer:["cleaning","detailing"]}[e]||[]),ye=()=>{if(!(()=>{let e=!0;return["workTitle","carCode","scheduledDate","startTime","estimatedDuration","assignedMechanic"].forEach(s=>{const a=U[s];pe(s,a)||(e=!1)}),e})())return(()=>{var e,s;const a=Object.entries(B).filter(([e,s])=>!s.isValid);if(a.length>0){const t=a[0][0],r={workTitle:K,carCode:Y,scheduledDate:ae,startTime:de,estimatedDuration:oe,assignedMechanic:me}[t];(null==r?void 0:r.current)&&(r.current.scrollIntoView({behavior:"smooth",block:"center"}),null==(s=(e=r.current).focus)||s.call(e))}})(),void o({title:"Validation Error",description:"Please fix the errors in the form before submitting.",variant:"destructive"});if(!(U.workTitle&&U.carCode&&U.scheduledDate&&U.startTime&&U.estimatedDuration&&U.assignedMechanic))return void o({title:"Missing Information",description:"Please fill in all required fields.",variant:"destructive"});if(t=U.workTitle,r=U.scheduledDate,s.some(e=>e.workTitle===t&&e.scheduledDate===r))return void o({title:"Duplicate Work Title",description:"A work with this title already exists on the selected date.",variant:"destructive"});var t,r;const i=ge.find(e=>e.name===U.assignedMechanic);if(i&&((e,a,t)=>s.some(s=>{var r;return s.assignedMechanic===(null==(r=ge.find(s=>s.id===e))?void 0:r.name)&&s.scheduledDate===a&&s.startTime===t}))(i.id,U.scheduledDate,U.startTime,U.estimatedDuration))return T({employee:U.assignedMechanic,date:U.scheduledDate,time:U.startTime}),void N(!0);const l=e.find(e=>e.carCode===U.carCode),n={id:Date.now().toString(),carCode:U.carCode,carModel:(null==l?void 0:l.carModel)||"Unknown Model",customerName:(null==l?void 0:l.customerName)||"Unknown Customer",workTitle:U.workTitle,scheduledDate:U.scheduledDate,startTime:U.startTime,estimatedDuration:U.estimatedDuration,assignedMechanic:U.assignedMechanic,priority:U.priority,workType:U.workType,status:"scheduled",notes:U.notes||"",requiredSkills:U.requiredSkills||[]};var c;a(n),n.assignedMechanic&&(c=n.assignedMechanic,d(void 0,null,function*(){const e=[{type:"email",icon:Ee,label:"Email"},{type:"sms",icon:Ue,label:"SMS"},{type:"whatsapp",icon:ce,label:"WhatsApp"}];for(const s of e)yield new Promise(e=>setTimeout(e,500)),o({title:`${s.label} Notification Sent`,description:`${c} has been notified about the scheduled work.`})})),P({priority:"medium",workType:"mechanic",status:"scheduled"}),Q({workTitle:{isValid:!0,message:""},carCode:{isValid:!0,message:""},scheduledDate:{isValid:!0,message:""},startTime:{isValid:!0,message:""},estimatedDuration:{isValid:!0,message:""},assignedMechanic:{isValid:!0,message:""}}),E({employees:!1,skills:!1}),g(!1),o({title:"Work Scheduled",description:"The work has been successfully scheduled."})},ve=e=>{switch(e){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},Ne=s.reduce((e,s)=>{const a=s.workType||"other";return e[a]||(e[a]=[]),e[a].push(s),e},{});return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold",children:"Work Scheduler"}),u.jsx("p",{className:"text-gray-600",children:"Schedule and manage garage work"})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs(x,{onClick:()=>j(!0),variant:"outline",className:"flex items-center gap-2",children:[u.jsx(Le,{className:"h-4 w-4"}),"Templates"]}),u.jsxs(x,{onClick:()=>g(!0),className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:[u.jsx(re,{className:"h-4 w-4 mr-2"}),"Schedule New Work"]})]})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(Ne).map(([e,s])=>{const a=xe.find(s=>s.value===e),t=(null==a?void 0:a.icon)||S;return u.jsxs(y,{className:"hover:shadow-md transition-shadow",children:[u.jsx(q,{className:"pb-3",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(t,{className:"h-5 w-5"}),u.jsx(H,{className:"text-lg",children:(null==a?void 0:a.label)||e})]}),u.jsx(A,{className:(null==a?void 0:a.color)||"bg-gray-100 text-gray-800",children:s.length})]})}),u.jsx(z,{children:u.jsxs("div",{className:"space-y-2",children:[s.slice(0,3).map(e=>u.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("p",{className:"font-medium text-sm",children:e.workTitle||e.carCode}),u.jsx("p",{className:"text-xs text-gray-600",children:e.assignedMechanic||"Unassigned"})]}),u.jsx(A,{className:ve(e.priority),children:e.priority})]},e.id)),s.length>3&&u.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["+",s.length-3," more jobs"]})]})})]},e)})}),u.jsx(f,{open:m,onOpenChange:g,children:u.jsxs(w,{className:"work-scheduler-dialog max-w-2xl max-h-[90vh] overflow-y-auto",children:[u.jsx(b,{children:u.jsx(k,{className:"flex items-center gap-2",children:"Schedule New Work"})}),u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"space-y-3",children:[u.jsx(I,{className:"text-sm font-medium",children:"Work Type *"}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:xe.map(e=>u.jsxs(x,{variant:U.workType===e.value?"default":"outline",className:`justify-start h-auto p-3 ${U.workType===e.value?e.color:""}`,onClick:()=>{return s=e.value,void P(e=>c(n({},e),{workType:s,requiredSkills:je(s)}));var s},children:[u.jsx(e.icon,{className:"h-4 w-4 mr-2"}),u.jsx("span",{className:"text-sm",children:e.label})]},e.value))})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx(I,{className:"text-sm font-medium",children:"Select Car *"}),u.jsx("div",{ref:Y,children:u.jsx(Oe,{value:U.carCode,onValueChange:e=>{P(s=>c(n({},s),{carCode:e})),pe("carCode",e)},options:ue.map(e=>({value:e.carCode,label:`${e.carCode} - ${e.carModel}`})),placeholder:"Choose a car",searchable:!0})}),B.carCode.isValid&&U.carCode&&u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(null==(t=e.find(e=>e.carCode===U.carCode))?void 0:t.customerName)||"Unknown Customer"}),!B.carCode.isValid&&u.jsx("p",{className:"text-xs text-red-500 mt-1",children:B.carCode.message})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx(I,{className:"text-sm font-medium",children:"Work Title *"}),u.jsx(h,{value:U.workTitle||"",onChange:e=>{P(s=>c(n({},s),{workTitle:e.target.value})),pe("workTitle",e.target.value)},placeholder:"Enter work title",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow "+(B.workTitle.isValid?"":"border-red-500 focus:border-red-500 focus:ring-red-500"),ref:K}),B.workTitle.isValid&&U.workTitle&&u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:U.workTitle}),!B.workTitle.isValid&&u.jsx("p",{className:"text-xs text-red-500 mt-1",children:B.workTitle.message})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-3",children:[u.jsx(I,{className:"text-sm font-medium",children:"Date *"}),u.jsx("div",{className:"relative date-input-wrapper",children:u.jsx(h,{type:"date",value:U.scheduledDate||"",onChange:e=>{P(s=>c(n({},s),{scheduledDate:e.target.value})),pe("scheduledDate",e.target.value)},className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow "+(B.scheduledDate.isValid?"":"border-red-500 focus:border-red-500 focus:ring-red-500"),style:{zIndex:1e4},ref:ae})}),B.scheduledDate.isValid&&U.scheduledDate&&u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(U.scheduledDate).toLocaleDateString()}),!B.scheduledDate.isValid&&u.jsx("p",{className:"text-xs text-red-500 mt-1",children:B.scheduledDate.message})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx(I,{className:"text-sm font-medium",children:"Start Time *"}),u.jsx("div",{className:"relative date-input-wrapper",children:u.jsx(h,{type:"time",value:U.startTime||"",onChange:e=>{P(s=>c(n({},s),{startTime:e.target.value})),pe("startTime",e.target.value)},className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow "+(B.startTime.isValid?"":"border-red-500 focus:border-red-500 focus:ring-red-500"),style:{zIndex:1e4},ref:de})}),B.startTime.isValid&&U.startTime&&u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:U.startTime}),!B.startTime.isValid&&u.jsx("p",{className:"text-xs text-red-500 mt-1",children:B.startTime.message})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-3",children:[u.jsx(I,{className:"text-sm font-medium",children:"Estimated Duration (minutes) *"}),u.jsx(h,{type:"number",min:"15",step:"15",value:U.estimatedDuration||"",onChange:e=>{P(s=>c(n({},s),{estimatedDuration:parseInt(e.target.value)})),pe("estimatedDuration",parseInt(e.target.value))},placeholder:"60",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow "+(B.estimatedDuration.isValid?"":"border-red-500 focus:border-red-500 focus:ring-red-500"),ref:oe}),B.estimatedDuration.isValid&&U.estimatedDuration&&u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[U.estimatedDuration," minutes"]}),!B.estimatedDuration.isValid&&u.jsx("p",{className:"text-xs text-red-500 mt-1",children:B.estimatedDuration.message})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx(I,{className:"text-sm font-medium",children:"Priority *"}),u.jsx(Oe,{value:U.priority,onValueChange:e=>P(s=>c(n({},s),{priority:e})),options:[{value:"high",label:"High Priority"},{value:"medium",label:"Medium Priority"},{value:"low",label:"Low Priority"}].map(e=>({value:e.value,label:e.label})),placeholder:"Select priority"})]})]}),u.jsxs("div",{className:"space-y-3 employee-assignment-section",ref:me,children:[u.jsx(I,{className:"text-sm font-medium",children:"Assign Employees *"}),_?u.jsxs("div",{className:"border rounded-md",children:[u.jsxs(x,{variant:"ghost",className:"w-full justify-between p-3",onClick:()=>E(e=>c(n({},e),{employees:!e.employees})),children:[u.jsxs("span",{className:"flex items-center gap-2",children:[u.jsx(D,{className:"h-4 w-4"}),U.assignedMechanic?`Assigned: ${U.assignedMechanic}`:"Select Employee"]}),O.employees?u.jsx(ie,{className:"h-4 w-4"}):u.jsx(le,{className:"h-4 w-4"})]}),O.employees&&u.jsx("div",{className:"border-t p-3 max-h-40 overflow-y-auto",children:u.jsx("div",{className:"space-y-2",children:ge.map(e=>u.jsx(x,{variant:U.assignedMechanic===e.name?"default":"outline",className:"w-full justify-start h-auto p-2",onClick:()=>{P(s=>c(n({},s),{assignedMechanic:e.name})),pe("assignedMechanic",e.name)},children:u.jsxs("div",{className:"flex items-center gap-2 w-full",children:[u.jsx(R,{className:"h-4 w-4"}),u.jsxs("div",{className:"text-left flex-1",children:[u.jsx("p",{className:"font-medium text-sm",children:e.name}),u.jsxs("p",{className:"text-xs text-gray-600",children:[e.skills.slice(0,2).join(", "),e.skills.length>2&&"..."]})]}),U.assignedMechanic===e.name&&u.jsx(ne,{className:"h-4 w-4 text-green-600"})]})},e.id))})})]}):u.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-md p-3 employee-assignment-grid",children:u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:ge.map(e=>u.jsx(x,{variant:U.assignedMechanic===e.name?"default":"outline",className:"justify-start h-auto p-2",onClick:()=>{P(s=>c(n({},s),{assignedMechanic:e.name})),pe("assignedMechanic",e.name)},children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(R,{className:"h-4 w-4"}),u.jsxs("div",{className:"text-left",children:[u.jsx("p",{className:"font-medium text-sm",children:e.name}),u.jsxs("p",{className:"text-xs text-gray-600",children:[e.skills.slice(0,2).join(", "),e.skills.length>2&&"..."]})]})]})},e.id))})}),B.assignedMechanic.isValid&&U.assignedMechanic&&u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Assigned to: ",U.assignedMechanic]}),!B.assignedMechanic.isValid&&u.jsx("p",{className:"text-xs text-red-500 mt-1",children:B.assignedMechanic.message})]}),U.requiredSkills&&U.requiredSkills.length>0&&u.jsxs("div",{className:"space-y-3",children:[u.jsx(I,{className:"text-sm font-medium",children:"Required Skills"}),_?u.jsxs("div",{className:"border rounded-md",children:[u.jsxs(x,{variant:"ghost",className:"w-full justify-between p-3",onClick:()=>E(e=>c(n({},e),{skills:!e.skills})),children:[u.jsxs("span",{className:"flex items-center gap-2",children:[u.jsx(S,{className:"h-4 w-4"}),"Skills (",(null==(r=U.requiredSkills)?void 0:r.length)||0,")"]}),O.skills?u.jsx(ie,{className:"h-4 w-4"}):u.jsx(le,{className:"h-4 w-4"})]}),O.skills&&u.jsx("div",{className:"border-t p-3",children:u.jsx("div",{className:"flex flex-wrap gap-2",children:null==(i=U.requiredSkills)?void 0:i.map(e=>u.jsxs(A,{variant:"secondary",className:"flex items-center gap-1",children:[e,u.jsx($,{className:"h-3 w-3 cursor-pointer",onClick:()=>P(s=>{var a;return c(n({},s),{requiredSkills:(null==(a=s.requiredSkills)?void 0:a.filter(s=>s!==e))||[]})})})]},e))})})]}):u.jsx("div",{className:"flex flex-wrap gap-2",children:null==(l=U.requiredSkills)?void 0:l.map(e=>u.jsxs(A,{variant:"secondary",className:"flex items-center gap-1",children:[e,u.jsx($,{className:"h-3 w-3 cursor-pointer",onClick:()=>P(s=>{var a;return c(n({},s),{requiredSkills:(null==(a=s.requiredSkills)?void 0:a.filter(s=>s!==e))||[]})})})]},e))})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx(I,{className:"text-sm font-medium",children:"Notes"}),u.jsx(L,{value:U.notes||"",onChange:e=>P(s=>c(n({},s),{notes:e.target.value})),placeholder:"Enter any additional notes...",rows:3,className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]})]}),u.jsxs(W,{children:[u.jsx(x,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),u.jsx(x,{onClick:ye,className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:"Schedule Work"})]})]})}),u.jsx(f,{open:p,onOpenChange:j,children:u.jsxs(w,{className:"max-w-2xl",children:[u.jsx(b,{children:u.jsxs(k,{className:"flex items-center gap-2",children:[u.jsx(Le,{className:"h-5 w-5"}),"Work Templates"]})}),u.jsx("div",{className:"space-y-4",children:F.map(e=>u.jsx(y,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>(e=>{P(s=>c(n({},s),{workType:e.workType,estimatedDuration:e.estimatedDuration,requiredSkills:e.requiredSkills,priority:e.priority})),G(e),j(!1),o({title:"Template Applied",description:`${e.name} template has been applied to the form.`})})(e),children:u.jsx(z,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"font-semibold",children:e.name}),u.jsx("p",{className:"text-sm text-gray-600",children:e.description}),u.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[u.jsx(A,{className:ve(e.priority),children:e.priority}),u.jsxs("span",{className:"text-sm text-gray-500",children:[e.estimatedDuration," min"]})]})]}),u.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.requiredSkills.slice(0,3).map(e=>u.jsx(A,{variant:"outline",className:"text-xs",children:e},e)),e.requiredSkills.length>3&&u.jsxs(A,{variant:"outline",className:"text-xs",children:["+",e.requiredSkills.length-3]})]})]})})},e.id))})]})}),u.jsx(f,{open:v,onOpenChange:N,children:u.jsxs(w,{children:[u.jsx(b,{children:u.jsxs(k,{className:"flex items-center gap-2",children:[u.jsx(se,{className:"h-5 w-5 text-red-500"}),"Scheduling Conflict"]})}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("p",{className:"text-gray-600",children:[u.jsx("strong",{children:null==C?void 0:C.employee})," is already assigned to work during this time period."]}),u.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:u.jsxs("p",{className:"text-sm text-yellow-800",children:[u.jsx("strong",{children:"Conflict Details:"}),u.jsx("br",{}),"Employee: ",null==C?void 0:C.employee,u.jsx("br",{}),"Date: ",null==C?void 0:C.date,u.jsx("br",{}),"Time: ",null==C?void 0:C.time]})}),u.jsx("p",{className:"text-sm text-gray-600",children:"Would you like to proceed anyway or choose a different time/employee?"})]}),u.jsxs(W,{children:[u.jsx(x,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),u.jsx(x,{onClick:()=>{ye(),N(!1)},className:"bg-red-500 hover:bg-red-600",children:"Schedule Anyway"})]})]})})]})},Qe=()=>{const e=de(),[s,a]=he.useState(()=>{const e=localStorage.getItem("garageCars");if(e)try{const s=JSON.parse(e);let a=localStorage.getItem("garageSchedules");if(a||(a=localStorage.getItem("garageSchedule")),a){const e=JSON.parse(a),t=(Array.isArray(e)?e:[e]).flatMap(e=>(e.scheduledCars||[]).map(e=>e.carCode));return s.filter(e=>t.includes(e.carCode)||"delivered"===e.status||e.endTimestamp)}return s.length>0?s:[]}catch(s){return[]}return[]}),{user:t}=N(),{toast:r}=te(),i="Mark"===(null==t?void 0:t.name),l=()=>{try{let e=localStorage.getItem("garageSchedules");if(e||(e=localStorage.getItem("garageSchedule")),e){const t=JSON.parse(e),r=Array.isArray(t)?t:[t],i=(new Date).toISOString().split("T")[0],l=r.find(e=>e.date===i);if(l&&l.scheduledCars){const e=l.scheduledCars,t=s.map(e=>e.carCode),r=e.filter(e=>!t.includes(e.carCode)).map(e=>b(e));r.length>0&&a(e=>[...e,...r])}}}catch(e){}};he.useEffect(()=>{const a=new URLSearchParams(e.search).get("vin");a&&(o(a),setTimeout(()=>{const e=s.find(e=>{var s,t,r;return(null==(s=e.carCode)?void 0:s.toLowerCase().includes(a.toLowerCase()))||(null==(t=e.vinNumber)?void 0:t.toLowerCase().includes(a.toLowerCase()))||(null==(r=e.model)?void 0:r.toLowerCase().includes(a.toLowerCase()))});r(e?{title:"Car Found in Garage Repairs",description:`Showing ${e.model||"Vehicle"} (${e.carCode}) - Status: ${e.status}`,duration:5e3}:{title:"Car Not Found",description:`No car found with VIN/Code: ${a} in Garage Repairs`,variant:"destructive",duration:5e3})},500))},[e.search,s]),he.useEffect(()=>{localStorage.setItem("garageCars",JSON.stringify(s))},[s]),he.useEffect(()=>{const e=e=>{if("garageCars"===e.key&&e.newValue)try{const s=JSON.parse(e.newValue);a(s)}catch(s){}else"garageSchedules"!==e.key&&"garageSchedule"!==e.key||setTimeout(()=>l(),100)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);const{searchTerm:d,setSearchTerm:o,filteredCars:h}=((e,s)=>{const[a,t]=he.useState(""),r=e.filter(e=>(e.carModel.toLowerCase().includes(a.toLowerCase())||e.carCode.toLowerCase().includes(a.toLowerCase())||e.customerName.toLowerCase().includes(a.toLowerCase())||e.issueDescription&&e.issueDescription.toLowerCase().includes(a.toLowerCase())||e.mechanics&&e.mechanics.some(e=>e.toLowerCase().includes(a.toLowerCase())))&&"all"===s);return{searchTerm:a,setSearchTerm:t,filteredCars:r}})(s,"all"),{handleUpdateStatus:v}=((e,s)=>{const[a,t]=he.useState(null),[r,i]=he.useState(!1);return{selectedCar:a,detailsModalOpen:r,setDetailsModalOpen:i,openCarDetails:e=>{t(e),i(!0)},handleUpdateStatus:(a,t)=>{if("function"!=typeof s)return;const r=(new Date).toISOString(),i=e.map(e=>e.id===a?c(n({},e),{status:t,lastUpdated:r,endTimestamp:"ready"===t?r:e.endTimestamp}):e);s(i),localStorage.setItem("garageCars",JSON.stringify(i)),m({title:"Status Updated",description:`Car status has been updated to ${t.replace("_"," ")}`})},handleUpdateCarDetails:(a,r)=>{if("function"!=typeof s)return;const l=(new Date).toISOString(),d=e.map(e=>e.id===a?c(n(n({},e),r),{lastUpdated:l}):e);s(d),localStorage.setItem("garageCars",JSON.stringify(d)),i(!1),t(null),m({title:"Car Details Updated",description:"Car details have been updated successfully."})}}})(s,a),{scheduledCars:f,inventoryCarsWithIssues:w,convertScheduledCarToGarageCar:b,convertInventoryCarToGarageCar:k,syncScheduleWithGarage:C}=(()=>{const[e,s]=he.useState([]),[a,t]=he.useState([]);return he.useEffect(()=>{const e=()=>{let e=localStorage.getItem("garageSchedules");if(e||(e=localStorage.getItem("garageSchedule")),e)try{const a=JSON.parse(e),t=Array.isArray(a)?a:[a],r=(new Date).toISOString().split("T")[0],i=t.find(e=>e.date===r);i&&i.scheduledCars?s(i.scheduledCars):s([])}catch(a){}},a=()=>{const e=localStorage.getItem("carInventory");if(e)try{const s=JSON.parse(e).filter(e=>e.damages&&e.damages.length>0||e.notes&&e.notes.toLowerCase().includes("issue")||e.notes&&e.notes.toLowerCase().includes("problem")||e.notes&&e.notes.toLowerCase().includes("repair"));t(s)}catch(s){}};e(),a();const r=s=>{"garageSchedules"===s.key||"garageSchedule"===s.key?e():"carInventory"===s.key&&a()};return window.addEventListener("storage",r),()=>window.removeEventListener("storage",r)},[]),{scheduledCars:e,inventoryCarsWithIssues:a,convertScheduledCarToGarageCar:e=>({id:`garage-${e.id}`,carModel:e.carModel,carCode:e.carCode,customerName:e.customerName,entryDate:(new Date).toISOString(),status:"in_diagnosis",assignedEmployee:e.assignedMechanic||"Unassigned",mechanics:e.assignedMechanic?[e.assignedMechanic]:[],notes:e.notes,workNotes:`Scheduled work: ${e.workType} (${e.estimatedDuration}h)`,issueDescription:`Category: ${e.workType}, Priority: ${e.priority}`,repairDuration:e.estimatedDuration+"h",lastUpdated:(new Date).toISOString()}),convertInventoryCarToGarageCar:e=>{const s=e.damages&&e.damages.length>0?e.damages.map(e=>`${e.severity} ${e.description} at ${e.location}`).join("; "):e.notes||"General maintenance required";return{id:`garage-inv-${e.id}`,carModel:e.model,carCode:e.vinNumber,customerName:e.clientName||"Inventory Vehicle",entryDate:(new Date).toISOString(),status:"in_diagnosis",assignedEmployee:"Unassigned",mechanics:[],notes:e.notes,issueDescription:s,workNotes:"Transferred from inventory due to reported issues",lastUpdated:(new Date).toISOString()}},syncScheduleWithGarage:he.useCallback(()=>{let e=localStorage.getItem("garageSchedules");e||(e=localStorage.getItem("garageSchedule"));const s=localStorage.getItem("garageCars");if(!e)return[];try{const a=JSON.parse(e),t=Array.isArray(a)?a:[a],r=s?JSON.parse(s):[],i=t.flatMap(e=>(e.scheduledCars||[]).map(s=>c(n({},s),{scheduleDate:e.date}))),l=r.filter(e=>i.some(s=>s.carCode===e.carCode)||"delivered"===e.status||e.endTimestamp);return localStorage.setItem("garageCars",JSON.stringify(l)),l}catch(a){return[]}},[])}})(),{allScheduledCars:T}=$e();he.useEffect(()=>{const e=C();a(e)},[T,C]),he.useEffect(()=>{l()},[T]);const _=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-orange-100 text-orange-800";case"completed":return"bg-green-100 text-green-800";case"delayed":return"bg-red-100 text-red-800";case"in_diagnosis":return"bg-purple-100 text-purple-800";case"in_repair":return"bg-amber-100 text-amber-800";case"in_quality_check":return"bg-cyan-100 text-cyan-800";case"ready":return"bg-emerald-100 text-emerald-800";default:return"bg-gray-100 text-gray-800"}};return i?u.jsxs("div",{className:"space-y-6 p-6",children:[u.jsx(Ve,{searchTerm:d,setSearchTerm:o,isGarageManager:i,onSyncScheduledCars:l}),u.jsxs(g,{defaultValue:"garage",className:"w-full",children:[u.jsxs(p,{className:"grid w-full grid-cols-3",children:[u.jsx(j,{value:"garage",children:"Garage Operations"}),u.jsx(j,{value:"schedule",children:"Worker Schedule"}),u.jsx(j,{value:"scheduled-work",children:"Scheduled Work"})]}),u.jsxs(ue,{value:"garage",className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs(y,{children:[u.jsx(q,{children:u.jsxs(H,{className:"flex items-center gap-2",children:[u.jsx(V,{className:"h-5 w-5"}),"Today's Scheduled Cars (",f.length,")"]})}),u.jsx(z,{children:f.length>0?u.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:f.map(e=>u.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:e.carCode}),u.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.workType," - ",e.estimatedDuration,"h"]})]}),u.jsx(x,{size:"sm",onClick:()=>(e=>{const t=b(e);s.some(e=>e.carCode===t.carCode)?r({title:"Car Already in Garage",description:`${t.carCode} is already being worked on.`,variant:"destructive"}):(a(e=>[...e,t]),r({title:"Car Added to Garage",description:`${t.carCode} has been moved from schedule to garage.`}))})(e),disabled:s.some(s=>s.carCode===e.carCode),children:"Add to Garage"})]},e.id))}):u.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[u.jsx(V,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),u.jsx("p",{className:"text-sm",children:"No cars scheduled for today"})]})})]}),u.jsxs(y,{children:[u.jsx(q,{children:u.jsxs(H,{className:"flex items-center gap-2",children:[u.jsx(me,{className:"h-5 w-5"}),"Inventory Cars with Issues (",w.length,")"]})}),u.jsx(z,{children:w.length>0?u.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:w.map(e=>{var t;return u.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:e.vinNumber}),u.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.model," - ",(null==(t=e.damages)?void 0:t.length)||0," damage(s)"]})]}),u.jsx(x,{size:"sm",onClick:()=>(e=>{const t=k(e);s.some(e=>e.carCode===t.carCode)?r({title:"Car Already in Garage",description:`${t.carCode} is already being worked on.`,variant:"destructive"}):(a(e=>[...e,t]),r({title:"Car Added to Garage",description:`${t.carCode} has been moved from inventory to garage for repairs.`}))})(e),disabled:s.some(s=>s.carCode===e.vinNumber),children:"Add to Garage"})]},e.id)})}):u.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[u.jsx(me,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),u.jsx("p",{className:"text-sm",children:"No inventory cars with reported issues"})]})})]})]}),u.jsx(Fe,{cars:h,onUpdateStatus:v,isGarageManager:i})]}),u.jsxs(ue,{value:"schedule",className:"space-y-4",children:[u.jsxs(y,{children:[u.jsx(q,{children:u.jsxs(H,{className:"flex items-center gap-2",children:[u.jsx(D,{className:"h-5 w-5"}),"Complete Worker Schedule Overview"]})}),u.jsx(z,{children:u.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"View all scheduled work assignments, employee activities, and garage operations from the garage schedule system."})})]}),u.jsx(Je,{scheduledCars:T})]}),u.jsx(ue,{value:"scheduled-work",className:"space-y-4",children:u.jsxs(y,{children:[u.jsxs(q,{children:[u.jsxs(H,{className:"flex items-center gap-2",children:[u.jsx(V,{className:"h-5 w-5"}),"Schedule Work Appointments"]}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Create and manage work appointments based on cars, workers, time, and priority"})]}),u.jsx(z,{children:u.jsx(Be,{cars:s,scheduledCars:T,onScheduleUpdate:e=>{const s=Pe("garageSchedules",[]),a=(new Date).toISOString().split("T")[0],t=s.findIndex(e=>e.date===a);if(-1===t){const t={id:Date.now().toString(),date:a,startTime:"08:00",endTime:"17:00",available:!0,maxCarsCapacity:10,currentCarsScheduled:1,scheduledCars:[e]};s.push(t)}else{const a=s[t];a.scheduledCars=a.scheduledCars||[],a.scheduledCars.push(e),a.currentCarsScheduled=(a.currentCarsScheduled||0)+1}localStorage.setItem("garageSchedules",JSON.stringify(s)),r({title:"Appointment Scheduled",description:`${e.carCode} has been scheduled for ${e.workType} work.`,duration:5e3})}})})]})})]})]}):u.jsxs("div",{className:"space-y-6 p-6",children:[u.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-monza-red",children:"Garage Overview"}),u.jsx("p",{className:"text-sm text-monza-grey",children:"Live overview of garage operations and scheduled work"})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsxs(x,{variant:"outline",size:"sm",onClick:()=>window.location.href="/garage-schedule",className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[u.jsx(V,{className:"h-4 w-4 mr-1"}),"View Full Schedule"]}),u.jsxs(A,{className:"bg-green-100 text-green-800",children:[u.jsx(oe,{className:"h-3 w-3 mr-1"}),"Read-Only View"]})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[u.jsx(y,{children:u.jsxs(z,{className:"flex items-center justify-between p-6",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Cars Scheduled Today"}),u.jsx("p",{className:"text-2xl font-bold",children:f.length})]}),u.jsx("div",{children:u.jsx(Y,{className:"h-8 w-8 text-blue-500"})})]})}),u.jsx(y,{children:u.jsxs(z,{className:"flex items-center justify-between p-6",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Cars In Progress"}),u.jsx("p",{className:"text-2xl font-bold",children:s.filter(e=>"in_repair"===e.status||"in_diagnosis"===e.status).length})]}),u.jsx("div",{children:u.jsx(S,{className:"h-8 w-8 text-orange-500"})})]})}),u.jsx(y,{children:u.jsxs(z,{className:"flex items-center justify-between p-6",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Ready for Pickup"}),u.jsx("p",{className:"text-2xl font-bold",children:s.filter(e=>"ready"===e.status).length})]}),u.jsx("div",{children:u.jsx(ae,{className:"h-8 w-8 text-green-500"})})]})}),u.jsx(y,{children:u.jsxs(z,{className:"flex items-center justify-between p-6",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Issues Reported"}),u.jsx("p",{className:"text-2xl font-bold",children:w.length})]}),u.jsx("div",{children:u.jsx(me,{className:"h-8 w-8 text-red-500"})})]})})]}),u.jsxs(g,{defaultValue:"schedule",className:"w-full",children:[u.jsxs(p,{className:"grid w-full grid-cols-3",children:[u.jsx(j,{value:"schedule",children:"Today's Schedule"}),u.jsx(j,{value:"active",children:"Active Work"}),u.jsx(j,{value:"overview",children:"Complete Overview"})]}),u.jsx(ue,{value:"schedule",className:"space-y-4",children:u.jsxs(y,{children:[u.jsx(q,{children:u.jsxs(H,{className:"flex items-center gap-2",children:[u.jsx(V,{className:"h-5 w-5"}),"Scheduled Work for Today (",f.length," cars)"]})}),u.jsx(z,{children:f.length>0?u.jsx("div",{className:"space-y-3",children:f.map(e=>u.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:u.jsx("div",{className:"flex items-center justify-between",children:u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[u.jsx("h4",{className:"font-medium text-lg",children:e.carCode}),u.jsx(A,{className:_(e.status),children:e.status.replace("_"," ")})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-muted-foreground",children:"Vehicle & Customer"}),u.jsx("p",{className:"font-medium",children:e.carModel}),u.jsx("p",{className:"text-muted-foreground",children:e.customerName})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-muted-foreground",children:"Work Details"}),u.jsx("p",{className:"font-medium",children:e.workType}),u.jsxs("p",{className:"text-muted-foreground",children:[e.estimatedDuration,"h estimated"]})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-muted-foreground",children:"Assignment"}),u.jsx("p",{className:"font-medium",children:e.assignedMechanic||"Unassigned"}),u.jsxs(A,{variant:"high"===e.priority?"destructive":"medium"===e.priority?"default":"secondary",className:"text-xs",children:[e.priority," priority"]})]})]}),e.notes&&u.jsxs("div",{className:"mt-3 p-2 bg-white rounded border",children:[u.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Notes:"}),u.jsx("p",{className:"text-sm",children:e.notes})]})]})})},e.id))}):u.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[u.jsx(V,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"No cars scheduled for today"})]})})]})}),u.jsx(ue,{value:"active",className:"space-y-4",children:u.jsxs(y,{children:[u.jsx(q,{children:u.jsxs(H,{className:"flex items-center gap-2",children:[u.jsx(S,{className:"h-5 w-5"}),"Cars Currently Being Worked On Today"]})}),u.jsx(z,{children:(()=>{const e=(new Date).toDateString(),a=s.filter(s=>{const a=["in_repair","in_diagnosis","in_progress","scheduled"].includes(s.status),t=s.entryDate&&new Date(s.entryDate).toDateString()===e,r=f.some(e=>e.carCode===s.carCode);return a&&(t||r)});return a.length>0?u.jsx("div",{className:"space-y-3",children:a.map(e=>u.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("h4",{className:"font-medium text-lg",children:e.carCode}),u.jsx(A,{className:_(e.status),children:e.status.replace("_"," ")}),u.jsx(A,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700",children:"Working Today"})]}),u.jsxs("div",{className:"text-sm text-muted-foreground",children:["Started: ",new Date(e.entryDate).toLocaleDateString()]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-muted-foreground",children:"Vehicle & Customer"}),u.jsx("p",{className:"font-medium",children:e.carModel}),u.jsx("p",{className:"text-muted-foreground",children:e.customerName})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-muted-foreground",children:"Assigned Team"}),u.jsx("p",{className:"font-medium",children:e.assignedEmployee}),e.mechanics&&e.mechanics.length>0&&u.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.mechanics.map((e,s)=>u.jsx(A,{variant:"outline",className:"text-xs",children:e},s))})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-muted-foreground",children:"Today's Progress"}),u.jsx("p",{className:"font-medium",children:e.repairDuration||"In progress"}),e.expectedExitDate&&u.jsxs("p",{className:"text-xs text-muted-foreground",children:["Target completion: ",e.expectedExitDate]})]})]}),e.issueDescription&&u.jsxs("div",{className:"mt-3 p-2 bg-red-50 rounded border border-red-100",children:[u.jsx("p",{className:"text-xs text-red-600 font-medium mb-1",children:"Today's Work:"}),u.jsx("p",{className:"text-sm",children:e.issueDescription})]}),e.workNotes&&u.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded border border-blue-100",children:[u.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Progress Notes:"}),u.jsx("p",{className:"text-sm",children:e.workNotes})]})]},e.id))}):u.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[u.jsx(S,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"No cars being worked on today"}),u.jsx("p",{className:"text-xs mt-2",children:"Cars scheduled for today will appear here when work begins"})]})})()})]})}),u.jsx(ue,{value:"overview",className:"space-y-4",children:u.jsx(Je,{scheduledCars:T})})]})]})},Ke=()=>u.jsx(Qe,{});
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{Ke as default};
