var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,t,r)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,l=(e,a)=>{for(var t in a||(a={}))d.call(a,t)&&i(e,t,a[t]);if(r)for(var t of r(a))s.call(a,t)&&i(e,t,a[t]);return e},n=(e,r)=>a(e,t(r));import{l as y,j as c,y as _,z as m,E as x,F as p,L as o,I as v,d as h,k as u,X as j,J as b,s as f}from"./index-BmUpYGrm.js";import{r as g}from"./vendor-vN6PtkFd.js";const w=({isOpen:e,onClose:a,carId:t,tableName:r,currentWarranty:d,onSave:s})=>{const[i,w]=g.useState({delivery_date:"",vehicle_expiry_date:"",battery_expiry_date:"",dms_deadline_date:""}),[N,D]=g.useState(!1),[S,W]=g.useState({}),{toast:C}=y();g.useEffect(()=>{e&&d&&w({delivery_date:d.delivery_date||"",vehicle_expiry_date:d.vehicle_expiry_date||"",battery_expiry_date:d.battery_expiry_date||"",dms_deadline_date:d.dms_deadline_date||""})},[e,d]);const O=()=>{const e=[];if(i.vehicle_expiry_date){const a=new Date(i.delivery_date),t=new Date(i.vehicle_expiry_date),r=Math.ceil((t.getTime()-a.getTime())/2592e6);e.push(`Vehicle: ${r} months`)}if(i.battery_expiry_date){const a=new Date(i.delivery_date),t=new Date(i.battery_expiry_date),r=Math.ceil((t.getTime()-a.getTime())/2592e6);e.push(`Battery: ${r} months`)}if(i.dms_deadline_date){const a=new Date(i.delivery_date),t=new Date(i.dms_deadline_date),r=Math.ceil((t.getTime()-a.getTime())/2592e6);e.push(`DMS: ${r} months`)}return e.join(" | ")||"No warranty set"},P=(e,a)=>{w(t=>n(l({},t),{[e]:a})),S[e]&&W(a=>n(l({},a),{[e]:""}))};return c.jsx(_,{open:e,onOpenChange:a,children:c.jsxs(m,{className:"sm:max-w-md",children:[c.jsx(x,{children:c.jsx(p,{className:"flex items-center gap-2",children:"Warranty Management"})}),c.jsxs("div",{className:"space-y-4 py-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs(o,{htmlFor:"delivery_date",className:"text-sm font-medium",children:["Delivery Date ",c.jsx("span",{className:"text-red-500",children:"*"})]}),c.jsx(v,{id:"delivery_date",type:"date",value:i.delivery_date,onChange:e=>P("delivery_date",e.target.value),className:S.delivery_date?"border-red-500":""}),S.delivery_date&&c.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[c.jsx(h,{className:"h-3 w-3"}),S.delivery_date]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(o,{htmlFor:"vehicle_expiry_date",className:"text-sm font-medium",children:"Vehicle Warranty Expiry Date"}),c.jsx(v,{id:"vehicle_expiry_date",type:"date",value:i.vehicle_expiry_date,onChange:e=>P("vehicle_expiry_date",e.target.value),className:S.vehicle_expiry_date?"border-red-500":""}),S.vehicle_expiry_date&&c.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[c.jsx(h,{className:"h-3 w-3"}),S.vehicle_expiry_date]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(o,{htmlFor:"battery_expiry_date",className:"text-sm font-medium",children:"Battery Warranty Expiry Date"}),c.jsx(v,{id:"battery_expiry_date",type:"date",value:i.battery_expiry_date,onChange:e=>P("battery_expiry_date",e.target.value),className:S.battery_expiry_date?"border-red-500":""}),S.battery_expiry_date&&c.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[c.jsx(h,{className:"h-3 w-3"}),S.battery_expiry_date]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(o,{htmlFor:"dms_deadline_date",className:"text-sm font-medium",children:"DMS Warranty Deadline"}),c.jsx(v,{id:"dms_deadline_date",type:"date",value:i.dms_deadline_date,onChange:e=>P("dms_deadline_date",e.target.value),className:S.dms_deadline_date?"border-red-500":""}),S.dms_deadline_date&&c.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[c.jsx(h,{className:"h-3 w-3"}),S.dms_deadline_date]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(o,{className:"text-sm font-medium text-gray-600",children:"Warranty Summary (Auto-generated)"}),c.jsx("div",{className:"p-3 bg-gray-50 rounded-md text-sm text-gray-700",children:O()})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsxs(u,{variant:"outline",onClick:a,disabled:N,children:[c.jsx(j,{className:"h-4 w-4 mr-2"}),"Cancel"]}),c.jsxs(u,{onClick:()=>{return e=void 0,d=null,y=function*(){if((()=>{const e={},a=new Date;return i.delivery_date?new Date(i.delivery_date)>a&&(e.delivery_date="Delivery date cannot be in the future"):e.delivery_date="Delivery date is required",i.vehicle_expiry_date&&new Date(i.vehicle_expiry_date)<=(i.delivery_date?new Date(i.delivery_date):a)&&(e.vehicle_expiry_date="Vehicle warranty must expire after delivery date"),i.battery_expiry_date&&new Date(i.battery_expiry_date)<=(i.delivery_date?new Date(i.delivery_date):a)&&(e.battery_expiry_date="Battery warranty must expire after delivery date"),i.dms_deadline_date&&new Date(i.dms_deadline_date)<=(i.delivery_date?new Date(i.delivery_date):a)&&(e.dms_deadline_date="DMS deadline must be after delivery date"),W(e),0===Object.keys(e).length})()){D(!0);try{const e=O(),{error:d}=yield f.from(r).update({delivery_date:i.delivery_date||null,vehicle_expiry_date:i.vehicle_expiry_date||null,battery_expiry_date:i.battery_expiry_date||null,dms_deadline_date:i.dms_deadline_date||null,warranty_life:e}).eq("id",t);if(d)throw d;s&&s(n(l({},i),{warranty_life:e})),C({title:"Warranty Updated",description:"Warranty information has been saved successfully."}),a()}catch(e){C({title:"Update Failed",description:"Failed to update warranty information. Please try again.",variant:"destructive"})}finally{D(!1)}}},new Promise((a,t)=>{var r=e=>{try{i(y.next(e))}catch(a){t(a)}},s=e=>{try{i(y.throw(e))}catch(a){t(a)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,s);i((y=y.apply(e,d)).next())});var e,d,y},disabled:N,children:[c.jsx(b,{className:"h-4 w-4 mr-2"}),N?"Saving...":"Save Warranty"]})]})]})})},N=e=>{const[a,t]=g.useState(!1),[r,d]=g.useState(null),[s,i]=g.useState(null),[l,n]=g.useState(null),y=g.useCallback((e,a,r)=>{i(e),n(a),d(r||null),t(!0)},[]),c=g.useCallback(()=>{t(!1),i(null),n(null),d(null)},[]),_=g.useCallback(e=>{c()},[s,e,c]);return{isWarrantyDialogOpen:a,selectedCarWarranty:r,selectedCarId:s,selectedTableName:l,openWarrantyDialog:y,closeWarrantyDialog:c,handleWarrantySave:_}};export{w as W,N as u};
