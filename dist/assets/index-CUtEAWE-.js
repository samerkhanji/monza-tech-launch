var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,c=(e,s)=>{for(var a in s||(s={}))l.call(s,a)&&i(e,a,s[a]);if(t)for(var a of t(s))r.call(s,a)&&i(e,a,s[a]);return e},n=(e,t)=>s(e,a(t));import{a8 as d,bq as o,K as x,u as m,t as h,j,N as u,c as p,k as v,o as N,C as g,g as y,h as f,a as b,ac as w,p as A,q as E,r as O,B as S,f as R,v as T,R as C,e as D,L as I,S as L,I as V,Y as k,Z as P,_,$ as M,a0 as G,a5 as U,n as W,b as F,P as H,V as Y,ak as q,a6 as B,ar as $,ad as z,O as K}from"./index-BmUpYGrm.js";import{r as Z}from"./vendor-vN6PtkFd.js";import{T as J,a as Q,b as X,c as ee,d as se,e as ae}from"./table-BEISn_Te.js";import{u as te}from"./useAuditLog-BKBIiLUr.js";import{A as le}from"./arrow-left-DqrDEplE.js";import{D as re}from"./download-CLPHGjzE.js";import{F as ie}from"./file-text-bXPYLusF.js";import{S as ce}from"./scan-BkADKRli.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=d("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]),de=()=>{var e,s;const{userId:a}=o(),{user:t}=x(),l=m(),{getEmployeeAuditSummary:r,filterLogs:i,advancedSearch:d}=te(),[de,oe]=Z.useState("overview"),[xe,me]=Z.useState(""),[he,je]=Z.useState({}),[ue,pe]=Z.useState("all"),[ve,Ne]=Z.useState(null),[ge,ye]=Z.useState([]);Z.useEffect(()=>{"owner"===(null==t?void 0:t.role)||null==t||t.role},[a,t]),Z.useMemo(()=>ge?ge.filter(e=>{var s,a;return(null==(s=e.action)?void 0:s.toLowerCase().includes(xe.toLowerCase()))||(null==(a=e.details)?void 0:a.toLowerCase().includes(xe.toLowerCase()))}):[],[ge,xe]),Z.useEffect(()=>{var e,s;if(("OWNER"===(null==(e=null==t?void 0:t.role)?void 0:e.toUpperCase())||"garage_manager"===(null==(s=null==t?void 0:t.role)?void 0:s.toLowerCase()))&&a){const e=r(a);Ne(e),e||(h({title:"Employee Not Found",description:"No audit data found for this employee.",variant:"destructive"}),l("/audit-log"))}},[a,r,l]);const fe=Z.useMemo(()=>{if(!ve)return[];let e=ve.recentActivities;xe&&(e=d(xe).filter(e=>e.userId===a)),e=i(n(c({},he),{userId:a})).filter(e=>e.userId===a);const s=new Date;switch(ue){case"today":e=e.filter(e=>new Date(e.timestamp).toDateString()===s.toDateString());break;case"week":const a=new Date(s.getTime()-6048e5);e=e.filter(e=>new Date(e.timestamp)>=a);break;case"month":const t=new Date(s.getTime()-2592e6);e=e.filter(e=>new Date(e.timestamp)>=t)}return e},[ve,xe,he,ue,a,d,i]);if("OWNER"!==(null==(e=null==t?void 0:t.role)?void 0:e.toUpperCase())&&"garage_manager"!==(null==(s=null==t?void 0:t.role)?void 0:s.toLowerCase()))return j.jsx(u,{to:"/dashboard",replace:!0});const be=(e,s)=>{je(a=>n(c({},a),{[e]:s||void 0}))},we=e=>{switch(e){case"CREATE":return j.jsx(K,{className:"h-4 w-4 text-green-600"});case"UPDATE":return j.jsx(z,{className:"h-4 w-4 text-blue-600"});case"DELETE":return j.jsx($,{className:"h-4 w-4 text-red-600"});case"VIEW":return j.jsx(B,{className:"h-4 w-4 text-gray-600"});case"UPLOAD":return j.jsx(q,{className:"h-4 w-4 text-purple-600"});case"DOWNLOAD":return j.jsx(re,{className:"h-4 w-4 text-indigo-600"});case"SCAN":return j.jsx(ce,{className:"h-4 w-4 text-orange-600"});case"MOVE":return j.jsx(ne,{className:"h-4 w-4 text-cyan-600"});case"SEARCH":return j.jsx(L,{className:"h-4 w-4 text-yellow-600"});default:return j.jsx(p,{className:"h-4 w-4 text-gray-600"})}},Ae=e=>{switch(e){case"CREATE":return"bg-green-100 text-green-800 border-green-300";case"UPDATE":return"bg-blue-100 text-blue-800 border-blue-300";case"DELETE":return"bg-red-100 text-red-800 border-red-300";case"VIEW":default:return"bg-gray-100 text-gray-800 border-gray-300";case"UPLOAD":return"bg-purple-100 text-purple-800 border-purple-300";case"DOWNLOAD":return"bg-indigo-100 text-indigo-800 border-indigo-300";case"SCAN":return"bg-orange-100 text-orange-800 border-orange-300";case"MOVE":return"bg-cyan-100 text-cyan-800 border-cyan-300";case"SEARCH":return"bg-yellow-100 text-yellow-800 border-yellow-300"}},Ee=e=>({INVENTORY:"bg-yellow-100 text-yellow-800 border-yellow-300",GARAGE_INVENTORY:"bg-yellow-200 text-yellow-900 border-yellow-400",FLOOR_2_INVENTORY:"bg-yellow-50 text-yellow-700 border-yellow-200",SHOWROOM_1:"bg-blue-100 text-blue-800 border-blue-300",SHOWROOM_2:"bg-green-100 text-green-800 border-green-300",GARAGE:"bg-orange-100 text-orange-800 border-orange-300",GARAGE_CAR_INVENTORY:"bg-orange-200 text-orange-900 border-orange-400",PDI:"bg-purple-100 text-purple-800 border-purple-300",FINANCIAL:"bg-emerald-100 text-emerald-800 border-emerald-300",REPAIRS:"bg-red-100 text-red-800 border-red-300",NEW_ARRIVALS:"bg-cyan-100 text-cyan-800 border-cyan-300"}[e]||"bg-gray-100 text-gray-800 border-gray-300");return ve?j.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsxs(v,{variant:"ghost",onClick:()=>l("/audit-log"),children:[j.jsx(le,{className:"h-4 w-4 mr-2"}),"Back to Audit Log"]}),j.jsxs("div",{className:"flex items-center gap-3",children:[j.jsx(N,{className:"h-8 w-8 text-blue-600"}),j.jsxs("div",{children:[j.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:ve.userName}),j.jsxs("p",{className:"text-muted-foreground",children:[ve.userRole," • ",ve.totalActivities," total activities"]})]})]})]}),j.jsx("div",{className:"flex gap-2",children:j.jsxs(v,{variant:"outline",onClick:()=>{if(!ve)return;const e=[["Timestamp","Action","Section","Entity Type","Details","VIN","Part Number","Car Model","Location"],...fe.map(e=>[e.timestamp,e.action,e.section,e.entityType,e.details,e.vinNumber||"",e.partNumber||"",e.carModel||"",e.location||""])].map(e=>e.join(",")).join("\n"),s=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download=`${ve.userName}_audit_log_${(new Date).toISOString().split("T")[0]}.csv`,t.click(),window.URL.revokeObjectURL(a),h({title:"Export Complete",description:`${ve.userName}'s audit logs exported successfully.`})},children:[j.jsx(re,{className:"mr-2 h-4 w-4"}),"Export Logs"]})})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[j.jsxs(g,{children:[j.jsx(y,{className:"pb-2",children:j.jsx(f,{className:"text-sm font-medium",children:"Total Activities"})}),j.jsxs(b,{children:[j.jsx("div",{className:"text-2xl font-bold",children:ve.totalActivities}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"All time activities"})]})]}),j.jsxs(g,{children:[j.jsx(y,{className:"pb-2",children:j.jsx(f,{className:"text-sm font-medium",children:"Today's Activities"})}),j.jsxs(b,{children:[j.jsx("div",{className:"text-2xl font-bold",children:ve.todayActivities}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Activities today"})]})]}),j.jsxs(g,{children:[j.jsx(y,{className:"pb-2",children:j.jsx(f,{className:"text-sm font-medium",children:"Most Active Section"})}),j.jsxs(b,{children:[j.jsx("div",{className:"text-2xl font-bold",children:ve.mostActiveSection.replace("_"," ")}),j.jsx("p",{className:"text-xs text-muted-foreground",children:"Primary work area"})]})]}),j.jsxs(g,{children:[j.jsx(y,{className:"pb-2",children:j.jsx(f,{className:"text-sm font-medium",children:"Last Activity"})}),j.jsxs(b,{children:[j.jsx("div",{className:"text-2xl font-bold",children:w.formatDateTime(ve.lastActivity).split(" ")[1]}),j.jsx("p",{className:"text-xs text-muted-foreground",children:w.formatDateTime(ve.lastActivity).split(" ")[0]})]})]})]}),j.jsxs(A,{value:de,onValueChange:oe,className:"space-y-4",children:[j.jsxs(E,{className:"grid w-full grid-cols-3",children:[j.jsxs(O,{value:"overview",className:"flex items-center gap-2",children:[j.jsx(S,{className:"h-4 w-4"}),"Overview"]}),j.jsxs(O,{value:"activities",className:"flex items-center gap-2",children:[j.jsx(p,{className:"h-4 w-4"}),"Activity Log"]}),j.jsxs(O,{value:"analytics",className:"flex items-center gap-2",children:[j.jsx(R,{className:"h-4 w-4"}),"Analytics"]})]}),j.jsx(T,{value:"overview",children:j.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[j.jsxs(g,{children:[j.jsxs(y,{children:[j.jsx(f,{children:"Activity Breakdown"}),j.jsx(C,{children:"Actions performed by this employee"})]}),j.jsx(b,{children:j.jsx("div",{className:"space-y-3",children:ve.activityBreakdown.map(e=>j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-center gap-2",children:[we(e.action),j.jsx(D,{className:Ae(e.action),children:e.action})]}),j.jsxs("div",{className:"text-sm font-medium",children:[e.count," times"]})]},e.action))})})]}),j.jsxs(g,{children:[j.jsxs(y,{children:[j.jsx(f,{children:"Section Activity"}),j.jsx(C,{children:"Areas where this employee is most active"})]}),j.jsx(b,{children:j.jsx("div",{className:"space-y-3",children:ve.sectionBreakdown.map(e=>j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsx(D,{className:Ee(e.section),children:e.section.replace("_"," ")}),j.jsxs("div",{className:"text-sm font-medium",children:[e.count," activities"]})]},e.section))})})]})]})}),j.jsx(T,{value:"activities",children:j.jsxs(g,{children:[j.jsxs(y,{children:[j.jsx(f,{children:"Activity Filters"}),j.jsx(C,{children:"Search and filter this employee's activities"})]}),j.jsxs(b,{children:[j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 mb-6",children:[j.jsxs("div",{className:"space-y-2 md:col-span-2",children:[j.jsx(I,{children:"Advanced Search"}),j.jsxs("div",{className:"relative",children:[j.jsx(L,{className:"absolute left-2 top-3 h-4 w-4 text-muted-foreground"}),j.jsx(V,{placeholder:"Search VIN, part number, car model, details...",className:"pl-8",value:xe,onChange:e=>me(e.target.value)})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(I,{children:"Section"}),j.jsxs(k,{value:he.section||"all",onValueChange:e=>be("section","all"===e?"":e),children:[j.jsx(P,{children:j.jsx(_,{placeholder:"All Sections"})}),j.jsxs(M,{children:[j.jsx(G,{value:"all",children:"All Sections"}),j.jsx(G,{value:"INVENTORY",children:"Inventory"}),j.jsx(G,{value:"GARAGE_INVENTORY",children:"Garage Inventory"}),j.jsx(G,{value:"FLOOR_2_INVENTORY",children:"Floor 2 Inventory"}),j.jsx(G,{value:"GARAGE_CAR_INVENTORY",children:"Garage Car Inventory"}),j.jsx(G,{value:"SHOWROOM_1",children:"Showroom 1"}),j.jsx(G,{value:"SHOWROOM_2",children:"Showroom 2"}),j.jsx(G,{value:"GARAGE",children:"Garage"}),j.jsx(G,{value:"PDI",children:"PDI"}),j.jsx(G,{value:"FINANCIAL",children:"Financial"}),j.jsx(G,{value:"REPAIRS",children:"Repairs"})]})]})]}),j.jsxs("div",{className:"space-y-2 audit-dropdown-container",children:[j.jsx(I,{children:"Action"}),j.jsxs(k,{value:he.action||"all",onValueChange:e=>be("action","all"===e?"":e),children:[j.jsx(P,{children:j.jsx(_,{placeholder:"All Actions"})}),j.jsxs(M,{position:"popper",side:"bottom",align:"start",sideOffset:4,avoidCollisions:!0,className:"select-content-fixed",children:[j.jsx(G,{value:"all",children:"All Actions"}),j.jsx(G,{value:"CREATE",children:"Create"}),j.jsx(G,{value:"UPDATE",children:"Update"}),j.jsx(G,{value:"DELETE",children:"Delete"}),j.jsx(G,{value:"VIEW",children:"View"}),j.jsx(G,{value:"SCAN",children:"Scan"}),j.jsx(G,{value:"MOVE",children:"Move"}),j.jsx(G,{value:"SEARCH",children:"Search"}),j.jsx(G,{value:"UPLOAD",children:"Upload"}),j.jsx(G,{value:"DOWNLOAD",children:"Download"})]})]})]}),j.jsxs("div",{className:"space-y-2 audit-dropdown-container",children:[j.jsx(I,{children:"Time Range"}),j.jsxs(k,{value:ue,onValueChange:pe,children:[j.jsx(P,{children:j.jsx(_,{})}),j.jsxs(M,{position:"popper",side:"bottom",align:"start",sideOffset:4,avoidCollisions:!0,className:"select-content-fixed",children:[j.jsx(G,{value:"today",children:"Today"}),j.jsx(G,{value:"week",children:"This Week"}),j.jsx(G,{value:"month",children:"This Month"}),j.jsx(G,{value:"all",children:"All Time"})]})]})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(I,{children:" "}),j.jsxs(v,{variant:"outline",onClick:()=>{je({}),me(""),pe("all")},className:"w-full",children:[j.jsx(U,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[j.jsxs("div",{className:"space-y-2",children:[j.jsx(I,{children:"VIN Number"}),j.jsx(V,{placeholder:"Search by VIN...",value:he.vinNumber||"",onChange:e=>be("vinNumber",e.target.value)})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(I,{children:"Part Number"}),j.jsx(V,{placeholder:"Search by part number...",value:he.partNumber||"",onChange:e=>be("partNumber",e.target.value)})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(I,{children:"Car Model"}),j.jsx(V,{placeholder:"Search by car model...",value:he.carModel||"",onChange:e=>be("carModel",e.target.value)})]}),j.jsxs("div",{className:"space-y-2",children:[j.jsx(I,{children:"Location"}),j.jsx(V,{placeholder:"Search by location...",value:he.location||"",onChange:e=>be("location",e.target.value)})]})]}),j.jsx("div",{className:"border rounded-lg",children:j.jsxs(J,{children:[j.jsx(Q,{children:j.jsxs(X,{children:[j.jsx(ee,{children:"Time"}),j.jsx(ee,{children:"Action"}),j.jsx(ee,{children:"Section"}),j.jsx(ee,{children:"Entity"}),j.jsx(ee,{children:"Details"}),j.jsx(ee,{children:"Additional Info"})]})}),j.jsx(se,{children:fe.length>0?fe.slice(0,100).map(e=>j.jsxs(X,{children:[j.jsx(ae,{className:"text-sm",children:j.jsxs("div",{className:"flex items-center gap-2",children:[j.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),j.jsxs("div",{children:[j.jsx("div",{children:w.formatDateTime(e.timestamp).split(" ")[1]}),j.jsx("div",{className:"text-xs text-muted-foreground",children:w.formatDateTime(e.timestamp).split(" ")[0]})]})]})}),j.jsx(ae,{children:j.jsxs("div",{className:"flex items-center gap-2",children:[we(e.action),j.jsx(D,{className:Ae(e.action),children:e.action})]})}),j.jsx(ae,{children:j.jsx(D,{className:Ee(e.section),children:e.section.replace("_"," ")})}),j.jsx(ae,{children:j.jsxs("div",{className:"text-sm",children:[j.jsxs("div",{className:"flex items-center gap-1",children:["CAR"===e.entityType&&j.jsx(F,{className:"h-3 w-3"}),"PART"===e.entityType&&j.jsx(H,{className:"h-3 w-3"}),"VIN"===e.entityType&&j.jsx(ie,{className:"h-3 w-3"}),j.jsx("span",{children:e.entityType})]}),e.entityName&&j.jsx("div",{className:"text-xs text-muted-foreground",children:e.entityName})]})}),j.jsxs(ae,{className:"max-w-md",children:[j.jsx("p",{className:"text-sm",children:e.details}),e.changes&&e.changes.length>0&&j.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.changes.length," field(s) changed"]})]}),j.jsx(ae,{children:j.jsxs("div",{className:"text-xs space-y-1",children:[e.vinNumber&&j.jsxs("div",{className:"flex items-center gap-1",children:[j.jsx(F,{className:"h-3 w-3"}),j.jsxs("span",{children:["VIN: ",e.vinNumber]})]}),e.partNumber&&j.jsxs("div",{className:"flex items-center gap-1",children:[j.jsx(H,{className:"h-3 w-3"}),j.jsxs("span",{children:["Part: ",e.partNumber]})]}),e.location&&j.jsxs("div",{className:"flex items-center gap-1",children:[j.jsx(Y,{className:"h-3 w-3"}),j.jsx("span",{children:e.location})]}),e.carModel&&j.jsxs("div",{className:"text-muted-foreground",children:[e.carBrand," ",e.carModel]})]})})]},e.id)):j.jsx(X,{children:j.jsxs(ae,{colSpan:6,className:"text-center py-8",children:[j.jsx(ie,{className:"h-12 w-12 text-muted-foreground mx-auto mb-2"}),j.jsx("p",{className:"font-medium",children:"No activities found"}),j.jsx("p",{className:"text-sm text-muted-foreground",children:"Try adjusting your filters or search terms"})]})})})]})})]})]})}),j.jsx(T,{value:"analytics",children:j.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[j.jsxs(g,{children:[j.jsxs(y,{children:[j.jsx(f,{children:"Activity Timeline"}),j.jsx(C,{children:"Activity patterns over time"})]}),j.jsx(b,{children:j.jsx("div",{className:"space-y-4",children:j.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[j.jsx(S,{className:"h-12 w-12 mx-auto mb-2"}),j.jsx("p",{children:"Activity timeline visualization coming soon"})]})})})]}),j.jsxs(g,{children:[j.jsxs(y,{children:[j.jsx(f,{children:"Performance Metrics"}),j.jsx(C,{children:"Key performance indicators"})]}),j.jsx(b,{children:j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{className:"flex justify-between items-center",children:[j.jsx("span",{className:"text-sm",children:"Average Daily Activities"}),j.jsx("span",{className:"font-medium",children:(ve.totalActivities/30).toFixed(1)})]}),j.jsxs("div",{className:"flex justify-between items-center",children:[j.jsx("span",{className:"text-sm",children:"Most Active Day"}),j.jsx("span",{className:"font-medium",children:"Today"})]}),j.jsxs("div",{className:"flex justify-between items-center",children:[j.jsx("span",{className:"text-sm",children:"Primary Device"}),j.jsx("span",{className:"font-medium",children:"Desktop"})]}),j.jsxs("div",{className:"flex justify-between items-center",children:[j.jsx("span",{className:"text-sm",children:"Efficiency Score"}),j.jsx("span",{className:"font-medium text-green-600",children:"High"})]})]})})]})]})})]})]}):j.jsx("div",{className:"container mx-auto p-6",children:j.jsxs("div",{className:"text-center py-12",children:[j.jsx(p,{className:"h-16 w-16 text-gray-400 mx-auto mb-4 animate-spin"}),j.jsx("p",{className:"text-gray-500",children:"Loading employee audit data..."})]})})};export{de as default};
