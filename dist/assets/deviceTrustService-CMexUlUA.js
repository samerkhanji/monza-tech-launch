var e=Object.defineProperty,t=(t,r,n)=>((t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n)(t,"symbol"!=typeof r?r+"":r,n);const r=[];for(let d=0;d<256;++d)r.push((d+256).toString(16).slice(1));let n;const i=new Uint8Array(16);const o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function a(e,t,a){var s,l,d;if(o.randomUUID&&!e)return o.randomUUID();const c=null!=(d=null!=(l=(e=e||{}).random)?l:null==(s=e.rng)?void 0:s.call(e))?d:function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(i)}();if(c.length<16)throw new Error("Random bytes length must be >= 16");return c[6]=15&c[6]|64,c[8]=63&c[8]|128,function(e,t=0){return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}(c)}const s=class e{constructor(){t(this,"STORAGE_KEY","monza_trusted_owner_devices"),t(this,"DEVICE_SEED_KEY","monza_device_seed")}static getInstance(){return this.instance||(this.instance=new e),this.instance}getOrCreateDeviceSeed(){let e=localStorage.getItem(this.DEVICE_SEED_KEY);return e||(e=a(),localStorage.setItem(this.DEVICE_SEED_KEY,e)),e}getCurrentDeviceId(){var e,t;const r=[this.getOrCreateDeviceSeed(),navigator.userAgent||"",navigator.platform||"",navigator.language||"",Intl.DateTimeFormat().resolvedOptions().timeZone||"",(null==(e=window.screen)?void 0:e.width)||0,(null==(t=window.screen)?void 0:t.height)||0,(window.devicePixelRatio||1).toString()].join("|");let n=0;for(let i=0;i<r.length;i++)n=(n<<5)-n+r.charCodeAt(i),n|=0;return`mdid_${Math.abs(n)}`}readAll(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return{};const t=JSON.parse(e);return"object"==typeof t&&t?t:{}}catch(e){return{}}}writeAll(e){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}listTrustedDevices(e){return this.readAll()[e]||[]}isTrustedOwnerDevice(e){const t=this.getCurrentDeviceId();return this.listTrustedDevices(e).some(e=>e.deviceId===t)}registerCurrentDevice(e,t){var r,n;const i=this.readAll(),o=i[e]||[],a={deviceId:this.getCurrentDeviceId(),label:(null==t?void 0:t.trim())||this.defaultLabel(),userAgent:navigator.userAgent||"",platform:navigator.platform||"",screen:{width:(null==(r=window.screen)?void 0:r.width)||0,height:(null==(n=window.screen)?void 0:n.height)||0,pixelRatio:window.devicePixelRatio||1},locale:navigator.language||"",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone||"",registeredAt:(new Date).toISOString()},s=o.findIndex(e=>e.deviceId===a.deviceId);return s>=0?o[s]=a:o.push(a),i[e]=o,this.writeAll(i),a}removeTrustedDevice(e,t){const r=this.readAll(),n=(r[e]||[]).filter(e=>e.deviceId!==t);r[e]=n,this.writeAll(r)}defaultLabel(){var e,t;return`${navigator.platform||"Device"} ${(null==(e=window.screen)?void 0:e.width)||0}x${(null==(t=window.screen)?void 0:t.height)||0}`}};t(s,"instance");let l=s;export{l as D};
