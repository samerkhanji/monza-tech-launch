var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,n=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&i(e,t,s[t]);if(a)for(var t of a(s))l.call(s,t)&&i(e,t,s[t]);return e},c=(e,a)=>s(e,t(a)),d=(e,s,t)=>i(e,"symbol"!=typeof s?s+"":s,t),o=(e,s,t)=>new Promise((a,r)=>{var l=e=>{try{n(t.next(e))}catch(s){r(s)}},i=e=>{try{n(t.throw(e))}catch(s){r(s)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,i);n((t=t.apply(e,s)).next())});import{j as m,C as h,a as x,D as p,f as u,g as j,h as g,R as v,e as N,I as f,k as y,J as b,X as C,ad as w,at as S,t as P,B as F,m as M,n as D,d as R,L as k,Y as I,Z as O,_ as T,$,a0 as A,ak as L,ar as E,y as _,as as V,x as H,z as U,E as q,F as B,a9 as G,ab as z,b as W,p as J,q as K,r as Y,v as Q,P as X,O as Z,H as ee,W as se,a3 as te,U as ae,A as re}from"./index-BmUpYGrm.js";import{r as le}from"./vendor-vN6PtkFd.js";import{u as ie}from"./useAuditLog-BKBIiLUr.js";import{P as ne}from"./percent-BXF5OJaM.js";import{F as ce}from"./file-text-bXPYLusF.js";import{S as de}from"./separator-D0zOJWdq.js";import{C as oe}from"./calculator-D7ZZJlp5.js";import{D as me}from"./download-CLPHGjzE.js";import{I as he}from"./info-CbXTqoMM.js";import{C as xe}from"./calendar-DQ6SJzpq.js";import{f as pe,e as ue}from"./utils-DhcIvS4g.js";import"./charts-XrXYWaKo.js";import"./chevron-left-D5y0IByA.js";const je=({cars:e,onUpdatePricing:s})=>{const[t,a]=le.useState(null),[r,l]=le.useState(0),[i,n]=le.useState(0),c=()=>{a(null),l(0),n(0)},d=e.reduce((e,s)=>e+(s.purchasePrice||s.marketPrice||0),0),o=e.filter(e=>"in_stock"===e.status).reduce((e,s)=>e+(s.sellingPrice||s.marketPrice||0),0),F=e.filter(e=>e.profitMargin),M=F.length>0?F.reduce((e,s)=>e+(s.profitMargin||0),0)/F.length:0;return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(p,{className:"h-5 w-5 text-blue-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Investment"}),m.jsxs("p",{className:"text-2xl font-bold",children:["$",d.toLocaleString()]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(u,{className:"h-5 w-5 text-green-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Projected Revenue"}),m.jsxs("p",{className:"text-2xl font-bold",children:["$",o.toLocaleString()]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(u,{className:"h-5 w-5 text-purple-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Profit Margin"}),m.jsxs("p",{className:"text-2xl font-bold",children:[M.toFixed(1),"%"]})]})]})})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Car Pricing Management"}),m.jsx(v,{children:"Manage purchase and selling prices for all vehicles in inventory"})]}),m.jsx(x,{children:m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b",children:[m.jsx("th",{className:"text-left p-3",children:"Vehicle"}),m.jsx("th",{className:"text-left p-3",children:"VIN"}),m.jsx("th",{className:"text-left p-3",children:"Status"}),m.jsx("th",{className:"text-left p-3",children:"Purchase Price"}),m.jsx("th",{className:"text-left p-3",children:"Selling Price"}),m.jsx("th",{className:"text-left p-3",children:"Market Value"}),m.jsx("th",{className:"text-left p-3",children:"Profit Margin"}),m.jsx("th",{className:"text-left p-3",children:"Days in Stock"}),m.jsx("th",{className:"text-left p-3",children:"Actions"})]})}),m.jsx("tbody",{children:e.map(e=>{const d=t===e.id,o=(h=e.profitMargin||0)>20?{color:"bg-green-100 text-green-800",icon:u}:h>10?{color:"bg-yellow-100 text-yellow-800",icon:u}:h>0?{color:"bg-orange-100 text-orange-800",icon:u}:{color:"bg-red-100 text-red-800",icon:S};var h;const x=o.icon;return m.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[m.jsx("td",{className:"p-3",children:m.jsxs("div",{children:[m.jsxs("p",{className:"font-medium",children:[e.brand," ",e.model]}),m.jsxs("p",{className:"text-sm text-gray-600",children:[e.year," • ",e.color]})]})}),m.jsx("td",{className:"p-3",children:m.jsx("p",{className:"text-sm font-mono",children:e.vinNumber})}),m.jsx("td",{className:"p-3",children:m.jsx(N,{variant:"sold"===e.status?"default":"reserved"===e.status?"secondary":"outline",children:(e.status||"in_stock").replace("_"," ")})}),m.jsx("td",{className:"p-3",children:d?m.jsx(f,{type:"number",value:r,onChange:e=>l(parseFloat(e.target.value)||0),className:"w-24"}):m.jsx("span",{className:"font-medium",children:e.purchasePrice?`$${e.purchasePrice.toLocaleString()}`:"Not set"})}),m.jsx("td",{className:"p-3",children:d?m.jsx(f,{type:"number",value:i,onChange:e=>n(parseFloat(e.target.value)||0),className:"w-24"}):m.jsx("span",{className:"font-medium",children:e.sellingPrice?`$${e.sellingPrice.toLocaleString()}`:"Not set"})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"text-gray-600",children:["$",(e.marketPrice||0).toLocaleString()]})}),m.jsx("td",{className:"p-3",children:e.profitMargin?m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(x,{className:"h-4 w-4"}),m.jsxs(N,{className:o.color,children:[e.profitMargin.toFixed(1),"%"]})]}):m.jsx("span",{className:"text-gray-400",children:"-"})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"text-sm",children:[e.daysInInventory||0," days"]})}),m.jsx("td",{className:"p-3",children:d?m.jsxs("div",{className:"flex gap-1",children:[m.jsx(y,{size:"sm",onClick:()=>{return t=e.id,void(r<=0||i<=0?P({title:"Invalid Prices",description:"Purchase and selling prices must be greater than 0",variant:"destructive"}):(s(t,r,i),a(null)));var t},className:"h-8 w-8 p-0",children:m.jsx(b,{className:"h-4 w-4"})}),m.jsx(y,{size:"sm",variant:"outline",onClick:c,className:"h-8 w-8 p-0",children:m.jsx(C,{className:"h-4 w-4"})})]}):m.jsx(y,{size:"sm",variant:"outline",onClick:()=>(e=>{a(e.id),l(e.purchasePrice||0),n(e.sellingPrice||0)})(e),className:"h-8 w-8 p-0",children:m.jsx(w,{className:"h-4 w-4"})})})]},e.id)})})]})})})]})]})},ge=({cars:e})=>{const s=le.useMemo(()=>{const s=new Map;return e.forEach(e=>{const t=`${e.brand} ${e.model}`;s.has(t)||s.set(t,{model:e.model,brand:e.brand,inStock:0,sold:0,reserved:0,avgDaysToSell:0,demandRatio:0,recommendation:"maintain",avgPrice:0,profitability:0});const a=s.get(t);"in_stock"===e.status&&a.inStock++,"sold"===e.status&&a.sold++,"reserved"===e.status&&a.reserved++}),s.forEach((s,t)=>{const a=e.filter(e=>`${e.brand} ${e.model}`===t),r=a.filter(e=>"sold"===e.status);if(r.length>0){const e=r.reduce((e,s)=>{const t=new Date(s.arrivalDate),a=s.soldDate?new Date(s.soldDate):new Date;return e+Math.floor((a.getTime()-t.getTime())/864e5)},0);s.avgDaysToSell=e/r.length}const l=s.inStock+s.sold+s.reserved;s.demandRatio=l>0?(s.sold+s.reserved)/l:0;const i=a.filter(e=>e.sellingPrice||e.marketPrice);i.length>0&&(s.avgPrice=i.reduce((e,s)=>e+(s.sellingPrice||s.marketPrice||0),0)/i.length);const n=a.filter(e=>e.profitMargin);n.length>0&&(s.profitability=n.reduce((e,s)=>e+(s.profitMargin||0),0)/n.length),s.demandRatio>.8&&s.avgDaysToSell<30?s.recommendation="increase":s.demandRatio<.3||s.avgDaysToSell>90?s.recommendation="decrease":s.recommendation="maintain"}),Array.from(s.values()).sort((e,s)=>s.demandRatio-e.demandRatio)},[e]),t=e=>{switch(e){case"increase":return m.jsxs(N,{className:"bg-green-100 text-green-800",children:[m.jsx(u,{className:"h-3 w-3 mr-1"}),"Increase Supply"]});case"decrease":return m.jsxs(N,{className:"bg-red-100 text-red-800",children:[m.jsx(S,{className:"h-3 w-3 mr-1"}),"Decrease Supply"]});default:return m.jsxs(N,{className:"bg-blue-100 text-blue-800",children:[m.jsx(M,{className:"h-3 w-3 mr-1"}),"Maintain"]})}},a=e.length,r=e.filter(e=>"sold"===e.status).length;e.filter(e=>"in_stock"===e.status).length;const l=a>0?r/a:0;return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(F,{className:"h-5 w-5 text-blue-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Overall Demand"}),m.jsxs("p",{className:"text-2xl font-bold",children:[(100*l).toFixed(1),"%"]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(u,{className:"h-5 w-5 text-green-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Models to Increase"}),m.jsx("p",{className:"text-2xl font-bold",children:s.filter(e=>"increase"===e.recommendation).length})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(M,{className:"h-5 w-5 text-blue-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Models to Maintain"}),m.jsx("p",{className:"text-2xl font-bold",children:s.filter(e=>"maintain"===e.recommendation).length})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(S,{className:"h-5 w-5 text-red-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Models to Decrease"}),m.jsx("p",{className:"text-2xl font-bold",children:s.filter(e=>"decrease"===e.recommendation).length})]})]})})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Supply & Demand Analysis by Model"}),m.jsx(v,{children:"Analyze supply and demand patterns to optimize inventory levels"})]}),m.jsx(x,{children:m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b",children:[m.jsx("th",{className:"text-left p-3",children:"Model"}),m.jsx("th",{className:"text-left p-3",children:"Stock Levels"}),m.jsx("th",{className:"text-left p-3",children:"Demand Ratio"}),m.jsx("th",{className:"text-left p-3",children:"Avg Days to Sell"}),m.jsx("th",{className:"text-left p-3",children:"Avg Price"}),m.jsx("th",{className:"text-left p-3",children:"Profitability"}),m.jsx("th",{className:"text-left p-3",children:"Recommendation"})]})}),m.jsx("tbody",{children:s.map((e,s)=>{const a=(r=e.demandRatio)>.7?{color:"bg-green-500",label:"High Demand"}:r>.4?{color:"bg-yellow-500",label:"Medium Demand"}:{color:"bg-red-500",label:"Low Demand"};var r;return m.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[m.jsx("td",{className:"p-3",children:m.jsx("div",{children:m.jsxs("p",{className:"font-medium",children:[e.brand," ",e.model]})})}),m.jsx("td",{className:"p-3",children:m.jsxs("div",{className:"text-sm",children:[m.jsxs("p",{children:[m.jsx("span",{className:"font-medium text-green-600",children:e.sold})," sold"]}),m.jsxs("p",{children:[m.jsx("span",{className:"font-medium text-blue-600",children:e.inStock})," in stock"]}),m.jsxs("p",{children:[m.jsx("span",{className:"font-medium text-orange-600",children:e.reserved})," reserved"]})]})}),m.jsxs("td",{className:"p-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:`w-3 h-3 rounded-full ${a.color}`}),m.jsxs("span",{className:"font-medium",children:[(100*e.demandRatio).toFixed(1),"%"]})]}),m.jsx("p",{className:"text-xs text-gray-500",children:a.label})]}),m.jsx("td",{className:"p-3",children:m.jsx("span",{className:"font-medium",children:e.avgDaysToSell>0?`${Math.round(e.avgDaysToSell)} days`:"-"})}),m.jsx("td",{className:"p-3",children:m.jsx("span",{className:"font-medium",children:e.avgPrice>0?`$${Math.round(e.avgPrice).toLocaleString()}`:"-"})}),m.jsx("td",{className:"p-3",children:m.jsx("span",{className:"font-medium "+(e.profitability>15?"text-green-600":e.profitability>5?"text-yellow-600":"text-red-600"),children:e.profitability>0?`${e.profitability.toFixed(1)}%`:"-"})}),m.jsx("td",{className:"p-3",children:t(e.recommendation)})]},s)})})]})})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"3-4 Month Ordering Recommendations"}),m.jsx(v,{children:"Based on current demand patterns and inventory turnover"})]}),m.jsx(x,{children:m.jsxs("div",{className:"space-y-4",children:[s.filter(e=>"increase"===e.recommendation).map((e,s)=>m.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 rounded-lg",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(u,{className:"h-5 w-5 text-green-600"}),m.jsxs("div",{children:[m.jsxs("p",{className:"font-medium",children:[e.brand," ",e.model]}),m.jsxs("p",{className:"text-sm text-gray-600",children:["High demand (",(100*e.demandRatio).toFixed(1),"%) • Fast turnover (",Math.round(e.avgDaysToSell)," days)"]})]})]}),m.jsxs("div",{className:"text-right",children:[m.jsxs("p",{className:"font-bold text-green-700",children:["Order ",Math.max(3,Math.round(1.5*e.sold))," units"]}),m.jsx("p",{className:"text-sm text-gray-600",children:"Next quarter"})]})]},s)),s.filter(e=>"decrease"===e.recommendation).map((e,s)=>m.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(S,{className:"h-5 w-5 text-red-600"}),m.jsxs("div",{children:[m.jsxs("p",{className:"font-medium",children:[e.brand," ",e.model]}),m.jsxs("p",{className:"text-sm text-gray-600",children:["Low demand (",(100*e.demandRatio).toFixed(1),"%) • Slow turnover (",Math.round(e.avgDaysToSell)," days)"]})]})]}),m.jsxs("div",{className:"text-right",children:[m.jsxs("p",{className:"font-bold text-red-700",children:["Reduce by ",Math.max(1,Math.round(.5*e.inStock))," units"]}),m.jsx("p",{className:"text-sm text-gray-600",children:"Clear excess inventory"})]})]},s))]})})]})]})},ve=({cars:e})=>{const{forecastData:s,modelForecasts:t}=le.useMemo(()=>{const s=new Map;e.filter(e=>"sold"===e.status&&e.soldDate).forEach(e=>{const t=new Date(e.soldDate),a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;s.set(a,(s.get(a)||0)+1)});const t=Array.from(s.values()).reduce((e,s)=>e+s,0)/Math.max(1,s.size),a=[],r=new Date;for(let n=0;n<12;n++){const s=new Date(r);s.setMonth(r.getMonth()+n);let l=1;const i=s.getMonth();11!==i&&0!==i||(l=1.3),i>=3&&i<=5&&(l=1.1),i>=6&&i<=8&&(l=.9);const c=Math.round(t*l),d=Math.max(c,Math.round(1.2*c));a.push({month:s.toLocaleDateString("en-US",{year:"numeric",month:"short"}),projected_sales:c,recommended_orders:d,projected_revenue:45e3*c,inventory_turnover:c/Math.max(1,e.filter(e=>"in_stock"===e.status).length)})}const l=new Map,i=new Map;return e.forEach(e=>{const s=`${e.brand} ${e.model}`;i.has(s)||i.set(s,[]),i.get(s).push(e)}),i.forEach((e,s)=>{const t=e.filter(e=>"sold"===e.status&&e.soldDate),a=e.filter(e=>"in_stock"===e.status).length,r=new Map;t.forEach(e=>{const s=new Date(e.soldDate),t=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;r.set(t,(r.get(t)||0)+1)});const i=Array.from(r.values()).reduce((e,s)=>e+s,0)/Math.max(1,r.size),[n,c]=s.split(" ",2);l.set(s,{model:c,brand:n,current_stock:a,monthly_sales_rate:i,predicted_demand:3*i,reorder_point:Math.max(2,Math.round(1.5*i)),optimal_stock_level:Math.max(3,Math.round(2.5*i)),forecast_accuracy:Math.min(95,60+2*t.length)})}),{forecastData:a,modelForecasts:Array.from(l.values()).sort((e,s)=>s.monthly_sales_rate-e.monthly_sales_rate)}},[e]),a=s.reduce((e,s)=>e+s.projected_revenue,0),r=s.reduce((e,s)=>e+s.inventory_turnover,0)/s.length;return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(u,{className:"h-5 w-5 text-green-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"12-Month Revenue Projection"}),m.jsxs("p",{className:"text-2xl font-bold",children:["$",(a/1e6).toFixed(1),"M"]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(D,{className:"h-5 w-5 text-blue-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Inventory Turnover"}),m.jsxs("p",{className:"text-2xl font-bold",children:[r.toFixed(1),"x/month"]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(R,{className:"h-5 w-5 text-red-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Models Need Reorder"}),m.jsx("p",{className:"text-2xl font-bold",children:t.filter(e=>e.current_stock<=e.reorder_point).length})]})]})})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"12-Month Sales & Order Forecast"}),m.jsx(v,{children:"Projected sales and recommended ordering schedule"})]}),m.jsx(x,{children:m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b",children:[m.jsx("th",{className:"text-left p-3",children:"Month"}),m.jsx("th",{className:"text-left p-3",children:"Projected Sales"}),m.jsx("th",{className:"text-left p-3",children:"Recommended Orders"}),m.jsx("th",{className:"text-left p-3",children:"Projected Revenue"}),m.jsx("th",{className:"text-left p-3",children:"Inventory Turnover"})]})}),m.jsx("tbody",{children:s.map((e,s)=>m.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[m.jsx("td",{className:"p-3 font-medium",children:e.month}),m.jsxs("td",{className:"p-3",children:[e.projected_sales," units"]}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium text-blue-600",children:[e.recommended_orders," units"]})}),m.jsxs("td",{className:"p-3",children:["$",(e.projected_revenue/1e3).toFixed(0),"K"]}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium "+(e.inventory_turnover>1?"text-green-600":e.inventory_turnover>.5?"text-yellow-600":"text-red-600"),children:[e.inventory_turnover.toFixed(2),"x"]})})]},s))})]})})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Model-Specific Inventory Forecasts"}),m.jsx(v,{children:"Detailed forecasting and reorder recommendations by model"})]}),m.jsx(x,{children:m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b",children:[m.jsx("th",{className:"text-left p-3",children:"Model"}),m.jsx("th",{className:"text-left p-3",children:"Current Stock"}),m.jsx("th",{className:"text-left p-3",children:"Monthly Sales Rate"}),m.jsx("th",{className:"text-left p-3",children:"3-Month Demand"}),m.jsx("th",{className:"text-left p-3",children:"Reorder Point"}),m.jsx("th",{className:"text-left p-3",children:"Optimal Stock"}),m.jsx("th",{className:"text-left p-3",children:"Status"}),m.jsx("th",{className:"text-left p-3",children:"Forecast Accuracy"})]})}),m.jsx("tbody",{children:t.map((e,s)=>{const t=(a=e.current_stock,r=e.optimal_stock_level,l=e.reorder_point,a<=l?{status:"critical",color:"bg-red-100 text-red-800",icon:R,label:"Reorder Now"}:a<.8*r?{status:"low",color:"bg-yellow-100 text-yellow-800",icon:D,label:"Low Stock"}:a>1.5*r?{status:"excess",color:"bg-blue-100 text-blue-800",icon:u,label:"Excess Stock"}:{status:"optimal",color:"bg-green-100 text-green-800",icon:u,label:"Optimal"});var a,r,l;const i=t.icon;return m.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[m.jsx("td",{className:"p-3",children:m.jsx("div",{children:m.jsxs("p",{className:"font-medium",children:[e.brand," ",e.model]})})}),m.jsx("td",{className:"p-3",children:m.jsx("span",{className:"font-medium",children:e.current_stock})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"text-gray-700",children:[e.monthly_sales_rate.toFixed(1),"/month"]})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium text-blue-600",children:[Math.round(e.predicted_demand)," units"]})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium text-orange-600",children:[e.reorder_point," units"]})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium text-green-600",children:[e.optimal_stock_level," units"]})}),m.jsx("td",{className:"p-3",children:m.jsxs(N,{className:t.color,children:[m.jsx(i,{className:"h-3 w-3 mr-1"}),t.label]})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium "+(e.forecast_accuracy>80?"text-green-600":e.forecast_accuracy>60?"text-yellow-600":"text-red-600"),children:[e.forecast_accuracy.toFixed(0),"%"]})})]},s)})})]})})})]}),t.filter(e=>e.current_stock<=e.reorder_point).length>0&&m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(R,{className:"h-5 w-5 text-red-600"}),"Urgent Reorder Required"]}),m.jsx(v,{children:"These models have reached their reorder point and need immediate attention"})]}),m.jsx(x,{children:m.jsx("div",{className:"space-y-3",children:t.filter(e=>e.current_stock<=e.reorder_point).map((e,s)=>m.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(R,{className:"h-5 w-5 text-red-600"}),m.jsxs("div",{children:[m.jsxs("p",{className:"font-medium text-red-900",children:[e.brand," ",e.model]}),m.jsxs("p",{className:"text-sm text-red-700",children:["Current: ",e.current_stock," units • Reorder at: ",e.reorder_point," units"]})]})]}),m.jsxs("div",{className:"text-right",children:[m.jsxs("p",{className:"font-bold text-red-900",children:["Order ",Math.max(e.optimal_stock_level-e.current_stock,e.reorder_point)," units"]}),m.jsx("p",{className:"text-sm text-red-700",children:"ASAP"})]})]},s))})})]})]})},Ne=({cars:e})=>{const s=le.useMemo(()=>{const s=e.filter(e=>"sold"===e.status&&e.purchasePrice&&e.sellingPrice),t=s.reduce((e,s)=>e+(s.sellingPrice||0),0),a=s.reduce((e,s)=>e+(s.purchasePrice||0),0),r=t-a,l=s.length>0?s.reduce((e,s)=>e+(s.profitMargin||0),0)/s.length:0,i=new Map;return s.forEach(e=>{const s=`${e.brand} ${e.model}`,t=(e.sellingPrice||0)-(e.purchasePrice||0);i.has(s)||i.set(s,{profit:0,margin:0,count:0,revenue:0});const a=i.get(s);a.profit+=t,a.revenue+=e.sellingPrice||0,a.count+=1,a.margin=a.count>0?(a.revenue-(a.revenue-a.profit))/(a.revenue-a.profit)*100:0}),{totalRevenue:t,totalCost:a,totalProfit:r,avgProfitMargin:l,soldCount:s.length,modelProfitability:Array.from(i.entries()).map(([e,s])=>c(n({model:e},s),{avgProfit:s.profit/s.count})).sort((e,s)=>s.margin-e.margin)}},[e]);return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(p,{className:"h-5 w-5 text-green-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Revenue"}),m.jsxs("p",{className:"text-2xl font-bold",children:["$",s.totalRevenue.toLocaleString()]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(u,{className:"h-5 w-5 text-blue-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Profit"}),m.jsxs("p",{className:"text-2xl font-bold",children:["$",s.totalProfit.toLocaleString()]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(ne,{className:"h-5 w-5 text-purple-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Profit Margin"}),m.jsxs("p",{className:"text-2xl font-bold",children:[s.avgProfitMargin.toFixed(1),"%"]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(u,{className:"h-5 w-5 text-orange-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Cars Sold"}),m.jsx("p",{className:"text-2xl font-bold",children:s.soldCount})]})]})})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Profitability by Model"}),m.jsx(v,{children:"Analyze profit margins and performance by car model"})]}),m.jsx(x,{children:m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b",children:[m.jsx("th",{className:"text-left p-3",children:"Model"}),m.jsx("th",{className:"text-left p-3",children:"Units Sold"}),m.jsx("th",{className:"text-left p-3",children:"Total Revenue"}),m.jsx("th",{className:"text-left p-3",children:"Total Profit"}),m.jsx("th",{className:"text-left p-3",children:"Avg Profit/Unit"}),m.jsx("th",{className:"text-left p-3",children:"Profit Margin"}),m.jsx("th",{className:"text-left p-3",children:"Performance"})]})}),m.jsx("tbody",{children:s.modelProfitability.map((e,s)=>{return m.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[m.jsx("td",{className:"p-3",children:m.jsx("p",{className:"font-medium",children:e.model})}),m.jsx("td",{className:"p-3",children:m.jsx("span",{className:"font-medium",children:e.count})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium",children:["$",e.revenue.toLocaleString()]})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium "+(e.profit>0?"text-green-600":"text-red-600"),children:["$",e.profit.toLocaleString()]})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium",children:["$",Math.round(e.avgProfit).toLocaleString()]})}),m.jsx("td",{className:"p-3",children:m.jsxs("span",{className:"font-medium "+(e.margin>15?"text-green-600":e.margin>5?"text-yellow-600":"text-red-600"),children:[e.margin.toFixed(1),"%"]})}),m.jsx("td",{className:"p-3",children:(t=e.margin,t>25?m.jsx(N,{className:"bg-green-100 text-green-800",children:"Excellent"}):t>15?m.jsx(N,{className:"bg-blue-100 text-blue-800",children:"Good"}):t>5?m.jsx(N,{className:"bg-yellow-100 text-yellow-800",children:"Fair"}):m.jsx(N,{className:"bg-red-100 text-red-800",children:"Poor"}))})]},s);var t})})]})})})]})]})},fe=({cars:e,onAddReceipt:s})=>{const[t,a]=le.useState(""),[r,l]=le.useState(""),[i,n]=le.useState(""),[c,d]=le.useState(""),[o,p]=le.useState((new Date).toISOString().split("T")[0]),u=e=>{const s={purchase:"bg-blue-100 text-blue-800",customs:"bg-purple-100 text-purple-800",shipping:"bg-green-100 text-green-800",maintenance:"bg-orange-100 text-orange-800",other:"bg-gray-100 text-gray-800"};return m.jsx(N,{className:s[e]||s.other,children:e})},b=e.find(e=>e.id===t);return m.jsxs("div",{className:"space-y-6",children:[m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Upload Receipt"}),m.jsx(v,{children:"Upload receipts for purchase, customs, shipping, and maintenance costs"})]}),m.jsx(x,{className:"space-y-4",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx(k,{htmlFor:"car-select",children:"Select Car"}),m.jsxs(I,{value:t,onValueChange:a,children:[m.jsx(O,{children:m.jsx(T,{placeholder:"Choose a car..."})}),m.jsx($,{children:e.map(e=>m.jsxs(A,{value:e.id,children:[e.brand," ",e.model," - ",e.vinNumber]},e.id))})]})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"receipt-type",children:"Receipt Type"}),m.jsxs(I,{value:r,onValueChange:l,children:[m.jsx(O,{children:m.jsx(T,{placeholder:"Choose type..."})}),m.jsxs($,{children:[m.jsx(A,{value:"purchase",children:"Purchase"}),m.jsx(A,{value:"customs",children:"Customs"}),m.jsx(A,{value:"shipping",children:"Shipping"}),m.jsx(A,{value:"maintenance",children:"Maintenance"}),m.jsx(A,{value:"other",children:"Other"})]})]})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"amount",children:"Amount ($)"}),m.jsx(f,{id:"amount",type:"number",value:i,onChange:e=>n(e.target.value),placeholder:"0.00"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"date",children:"Date"}),m.jsx(f,{id:"date",type:"date",value:o,onChange:e=>p(e.target.value)})]}),m.jsxs("div",{className:"md:col-span-2",children:[m.jsx(k,{htmlFor:"description",children:"Description (Optional)"}),m.jsx(f,{id:"description",value:c,onChange:e=>d(e.target.value),placeholder:"Brief description of the expense..."})]}),m.jsxs("div",{className:"md:col-span-2",children:[m.jsx(k,{htmlFor:"receipt-file",children:"Upload Receipt File"}),m.jsxs("div",{className:"mt-2",children:[m.jsx("input",{id:"receipt-file",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:e=>{var a;const m=null==(a=e.target.files)?void 0:a[0];if(!m)return;if(!t||!r||!i)return void P({title:"Missing Information",description:"Please fill in all required fields before uploading",variant:"destructive"});const h=URL.createObjectURL(m),x={type:r,amount:parseFloat(i),date:o,description:c||`${r} receipt`,fileName:m.name,fileUrl:h};s(t,x),l(""),n(""),d(""),p((new Date).toISOString().split("T")[0])},className:"hidden"}),m.jsxs(y,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=document.getElementById("receipt-file"))?void 0:e.click()},disabled:!t||!r||!i,className:"w-full",children:[m.jsx(L,{className:"h-4 w-4 mr-2"}),"Upload Receipt File"]}),m.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Supported formats: PDF, JPG, PNG (Max 5MB)"})]})]})]})})]}),b&&m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsxs(g,{children:["Receipts for ",b.brand," ",b.model]}),m.jsxs(v,{children:["VIN: ",b.vinNumber]})]}),m.jsx(x,{children:0===b.receipts.length?m.jsx("p",{className:"text-gray-500 text-center py-8",children:"No receipts uploaded yet"}):m.jsxs("div",{className:"space-y-3",children:[b.receipts.map((e,s)=>m.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(ce,{className:"h-5 w-5 text-gray-600"}),m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u(e.type),m.jsxs("span",{className:"font-medium",children:["$",e.amount.toLocaleString()]})]}),m.jsx("p",{className:"text-sm text-gray-600",children:e.description}),m.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1",children:[m.jsx(Clock,{className:"h-3 w-3"}),new Date(e.date).toLocaleDateString(),e.fileName&&m.jsxs(m.Fragment,{children:[m.jsx("span",{children:"•"}),m.jsx("span",{children:e.fileName})]})]})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[e.fileUrl&&m.jsx(y,{size:"sm",variant:"outline",onClick:()=>window.open(e.fileUrl,"_blank"),children:"View"}),m.jsx(y,{size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700",children:m.jsx(E,{className:"h-4 w-4"})})]})]},s)),m.jsx("div",{className:"border-t pt-3 mt-4",children:m.jsxs("div",{className:"flex justify-between items-center font-medium",children:[m.jsx("span",{children:"Total Receipts:"}),m.jsxs("span",{children:["$",b.receipts.reduce((e,s)=>e+s.amount,0).toLocaleString()]})]})})]})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Receipt Summary by Car"}),m.jsx(v,{children:"Overview of all uploaded receipts across your inventory"})]}),m.jsx(x,{children:m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b",children:[m.jsx("th",{className:"text-left p-3",children:"Vehicle"}),m.jsx("th",{className:"text-left p-3",children:"VIN"}),m.jsx("th",{className:"text-left p-3",children:"Receipt Count"}),m.jsx("th",{className:"text-left p-3",children:"Total Amount"}),m.jsx("th",{className:"text-left p-3",children:"Last Updated"})]})}),m.jsx("tbody",{children:e.map(e=>{const s=e.receipts.reduce((e,s)=>e+s.amount,0),t=e.receipts.length>0?e.receipts.sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime())[0]:null;return m.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[m.jsx("td",{className:"p-3",children:m.jsxs("div",{children:[m.jsxs("p",{className:"font-medium",children:[e.brand," ",e.model]}),m.jsxs("p",{className:"text-sm text-gray-600",children:[e.year," • ",e.color]})]})}),m.jsx("td",{className:"p-3",children:m.jsx("p",{className:"text-sm font-mono",children:e.vinNumber})}),m.jsx("td",{className:"p-3",children:m.jsx("span",{className:"font-medium",children:e.receipts.length})}),m.jsx("td",{className:"p-3",children:m.jsx("span",{className:"font-medium",children:s>0?`$${s.toLocaleString()}`:"-"})}),m.jsx("td",{className:"p-3",children:m.jsx("span",{className:"text-sm text-gray-600",children:t?new Date(t.date).toLocaleDateString():"No receipts"})})]},e.id)})})]})})})]})]})};class ye{static getDefaultSettings(){return{id:"default",monthlyElectricityRate:.12,averageKwhPerHour:3.5,laborRatePerHour:75,overheadCostPerDay:150,equipmentDepreciationPerHour:5,lastUpdated:(new Date).toISOString()}}static getSettings(){try{const e=localStorage.getItem(this.SETTINGS_KEY);return e?JSON.parse(e):this.getDefaultSettings()}catch(e){return this.getDefaultSettings()}}static updateSettings(e){try{const s=this.getSettings(),t=c(n(n({},s),e),{lastUpdated:(new Date).toISOString()});localStorage.setItem(this.SETTINGS_KEY,JSON.stringify(t))}catch(s){throw s}}static recordLaborStart(e,s,t,a,r){const l=this.getSettings(),i=`labor-${Date.now()}`,n={id:i,carVin:e,carModel:s,mechanicName:t,workType:a,startTime:(new Date).toISOString(),endTime:"",actualHours:0,laborRate:l.laborRatePerHour,totalLaborCost:0,electricityUsed:0,electricityCost:0,workOrderId:r,isCompleted:!1,dateRecorded:(new Date).toISOString()};return this.saveLaborCost(n),i}static recordLaborEnd(e,s){const t=this.getSettings(),a=this.getAllData(),r=a.laborCosts.findIndex(s=>s.id===e);if(-1===r)return null;const l=a.laborCosts[r],i=new Date,d=new Date(l.startTime),o=(i.getTime()-d.getTime())/36e5,m=c(n({},l),{endTime:i.toISOString(),actualHours:Number(o.toFixed(2)),totalLaborCost:Number((o*l.laborRate).toFixed(2)),electricityUsed:Number((o*t.averageKwhPerHour).toFixed(2)),electricityCost:Number((o*t.averageKwhPerHour*t.monthlyElectricityRate).toFixed(2)),notes:s,isCompleted:!0});return a.laborCosts[r]=m,this.saveAllData(a),m}static addPartsCost(e){const s=`parts-${Date.now()}`,t=c(n({},e),{id:s,dateUsed:(new Date).toISOString()});return this.savePartsCost(t),s}static addToolsCost(e){const s=`tools-${Date.now()}`,t=c(n({},e),{id:s,dateUsed:(new Date).toISOString()});return this.saveToolsCost(t),s}static addOtherCost(e){const s=`other-${Date.now()}`,t=c(n({},e),{id:s,dateIncurred:(new Date).toISOString()});return this.saveOtherCost(t),s}static getWorkOrderSummary(e){const s=this.getAllData(),t=s.laborCosts.filter(s=>s.workOrderId===e),a=s.partsCosts.filter(s=>s.workOrderId===e),r=s.toolsCosts.filter(s=>s.workOrderId===e),l=s.otherCosts.filter(s=>s.workOrderId===e);if(0===t.length)return null;const i=t[0],n=t.reduce((e,s)=>e+s.actualHours,0),c=t.reduce((e,s)=>e+s.totalLaborCost,0),d=t.reduce((e,s)=>e+s.electricityCost,0),o=a.reduce((e,s)=>e+s.totalCost,0),m=r.reduce((e,s)=>e+s.cost,0),h=l.reduce((e,s)=>e+s.cost,0),x=c+d+o+m+h;return{workOrderId:e,carVin:i.carVin,carModel:i.carModel,customerName:"Customer",startDate:Math.min(...t.map(e=>new Date(e.startTime).getTime())).toString(),endDate:t.every(e=>e.isCompleted)?Math.max(...t.map(e=>new Date(e.endTime||e.startTime).getTime())).toString():void 0,totalLaborHours:n,totalLaborCost:c,totalElectricityCost:d,totalPartsCost:o,totalToolsCost:m,totalOtherCosts:h,grandTotal:x,isCompleted:t.every(e=>e.isCompleted)}}static getAllWorkOrderSummaries(){const e=this.getAllData();if(0===e.laborCosts.length&&0===e.partsCosts.length)return this.loadFromRepairHistory(),this.getAllWorkOrderSummaries();const s=new Set([...e.laborCosts.map(e=>e.workOrderId).filter(Boolean),...e.partsCosts.map(e=>e.workOrderId).filter(Boolean),...e.toolsCosts.map(e=>e.workOrderId).filter(Boolean),...e.otherCosts.map(e=>e.workOrderId).filter(Boolean)]);return Array.from(s).map(e=>this.getWorkOrderSummary(e)).filter(Boolean)}static getCarCosts(e){const s=this.getAllData(),t=s.laborCosts.filter(s=>s.carVin===e),a=s.partsCosts.filter(s=>s.carVin===e),r=s.toolsCosts.filter(s=>s.carVin===e),l=s.otherCosts.filter(s=>s.carVin===e),i=t.reduce((e,s)=>e+s.totalLaborCost+s.electricityCost,0)+a.reduce((e,s)=>e+s.totalCost,0)+r.reduce((e,s)=>e+s.cost,0)+l.reduce((e,s)=>e+s.cost,0);return{labor:t,parts:a,tools:r,other:l,total:i}}static calculateDailyOverheadAllocation(e){const s=this.getSettings(),t=this.getAllData(),a=new Date(e);a.setHours(0,0,0,0);const r=new Date(e);r.setHours(23,59,59,999);const l=t.laborCosts.filter(e=>{const s=new Date(e.startTime);return s>=a&&s<=r});if(0===l.length)return 0;const i=l.reduce((e,s)=>e+s.actualHours,0)*s.equipmentDepreciationPerHour;return s.overheadCostPerDay+i}static getAllData(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):{laborCosts:[],partsCosts:[],toolsCosts:[],otherCosts:[]}}catch(e){return{laborCosts:[],partsCosts:[],toolsCosts:[],otherCosts:[]}}}static saveAllData(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(s){throw s}}static saveLaborCost(e){const s=this.getAllData();s.laborCosts.push(e),this.saveAllData(s)}static savePartsCost(e){const s=this.getAllData();s.partsCosts.push(e),this.saveAllData(s)}static saveToolsCost(e){const s=this.getAllData();s.toolsCosts.push(e),this.saveAllData(s)}static saveOtherCost(e){const s=this.getAllData();s.otherCosts.push(e),this.saveAllData(s)}static exportData(){const e=this.getAllData(),s=this.getSettings();return JSON.stringify({data:e,settings:s},null,2)}static importData(e){try{const s=JSON.parse(e);s.data&&this.saveAllData(s.data),s.settings&&localStorage.setItem(this.SETTINGS_KEY,JSON.stringify(s.settings))}catch(s){throw s}}static loadFromRepairHistory(){try{const e=localStorage.getItem("repairHistory");if(!e)return;JSON.parse(e).forEach(e=>{const s=`wo-${e.id}`,t=this.getSettings(),a=Math.floor(3*Math.random())+2,r=a*t.laborRatePerHour,l=.7*e.cost,i=.1*e.cost,n=.2*e.cost,c=a*t.averageKwhPerHour*t.monthlyElectricityRate,d={id:`labor-${e.id}`,carVin:e.carVin,carModel:e.carModel,mechanicName:e.mechanic,workType:"mechanic",startTime:e.repairDate+"T09:00:00",endTime:e.repairDate+`T${9+a}:00:00`,actualHours:a,laborRate:t.laborRatePerHour,totalLaborCost:r,electricityUsed:a*t.averageKwhPerHour,electricityCost:c,notes:e.issue,workOrderId:s,isCompleted:"completed"===e.status,dateRecorded:e.repairDate},o={id:`parts-${e.id}`,carVin:e.carVin,carModel:e.carModel,partNumber:`PART-${e.id}`,partName:"Repair Parts",quantity:1,unitCost:l,totalCost:l,supplier:"Local Supplier",dateUsed:e.repairDate,mechanicName:e.mechanic,workOrderId:s,notes:e.solution},m={id:`tools-${e.id}`,carVin:e.carVin,carModel:e.carModel,toolName:"Diagnostic Tools",toolType:"equipment_usage",cost:i,quantity:1,usageHours:a,dateUsed:e.repairDate,mechanicName:e.mechanic,workOrderId:s,notes:"Equipment usage for repair"},h={id:`other-${e.id}`,carVin:e.carVin,carModel:e.carModel,costCategory:"Operations",description:"Operational costs",cost:n,dateIncurred:e.repairDate,recordedBy:e.mechanic,workOrderId:s};this.saveLaborCost(d),this.savePartsCost(o),this.saveToolsCost(m),this.saveOtherCost(h)})}catch(e){}}}d(ye,"STORAGE_KEY","garage_cost_data"),d(ye,"SETTINGS_KEY","garage_cost_settings");const be=()=>{const[e,s]=le.useState("overview"),[t,a]=le.useState(ye.getSettings()),[r,l]=le.useState([]),[i,d]=le.useState(!1),[o,u]=le.useState(!1),[C,w]=le.useState(!1),[S,F]=le.useState(!1),[M,R]=le.useState({carVin:"",carModel:"",partNumber:"",partName:"",quantity:1,unitCost:0,supplier:"",mechanicName:"",notes:""}),[E,te]=le.useState({carVin:"",carModel:"",toolName:"",toolType:"consumable",cost:0,quantity:1,usageHours:0,mechanicName:"",notes:""}),[ae,re]=le.useState({carVin:"",carModel:"",costCategory:"",description:"",cost:0,recordedBy:""});le.useEffect(()=>{ie()},[]);const ie=()=>{l(ye.getAllWorkOrderSummaries())},ne=r.reduce((e,s)=>e+s.grandTotal,0),he=r.reduce((e,s)=>e+s.totalLaborHours,0),xe=he>0?ne/he:0;return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Garage Cost Tracking"}),m.jsx("p",{className:"text-muted-foreground",children:"Track labor, parts, electricity, and other garage expenses"})]}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs(_,{open:i,onOpenChange:d,children:[m.jsx(V,{asChild:!0,children:m.jsxs(y,{variant:"outline",children:[m.jsx(H,{className:"mr-2 h-4 w-4"}),"Settings"]})}),m.jsxs(U,{className:"sm:max-w-[500px]",children:[m.jsxs(q,{children:[m.jsx(B,{children:"Garage Cost Settings"}),m.jsx(G,{children:"Configure monthly averages and rates for automatic cost calculations"})]}),m.jsxs("div",{className:"grid gap-4 py-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx(k,{htmlFor:"electricityRate",children:"Electricity Rate ($/kWh)"}),m.jsx(f,{id:"electricityRate",type:"number",step:"0.01",value:t.monthlyElectricityRate,onChange:e=>a(c(n({},t),{monthlyElectricityRate:Number(e.target.value)}))})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"kwhPerHour",children:"Avg kWh per Work Hour"}),m.jsx(f,{id:"kwhPerHour",type:"number",step:"0.1",value:t.averageKwhPerHour,onChange:e=>a(c(n({},t),{averageKwhPerHour:Number(e.target.value)}))})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx(k,{htmlFor:"laborRate",children:"Labor Rate ($/hour)"}),m.jsx(f,{id:"laborRate",type:"number",step:"1",value:t.laborRatePerHour,onChange:e=>a(c(n({},t),{laborRatePerHour:Number(e.target.value)}))})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"overheadCost",children:"Overhead Cost ($/day)"}),m.jsx(f,{id:"overheadCost",type:"number",step:"1",value:t.overheadCostPerDay,onChange:e=>a(c(n({},t),{overheadCostPerDay:Number(e.target.value)}))})]})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"equipmentDepreciation",children:"Equipment Depreciation ($/hour)"}),m.jsx(f,{id:"equipmentDepreciation",type:"number",step:"0.1",value:t.equipmentDepreciationPerHour,onChange:e=>a(c(n({},t),{equipmentDepreciationPerHour:Number(e.target.value)}))})]})]}),m.jsx(z,{children:m.jsxs(y,{onClick:()=>{ye.updateSettings(t),P({title:"Settings Updated",description:"Garage cost settings have been saved successfully"}),d(!1)},children:[m.jsx(b,{className:"mr-2 h-4 w-4"}),"Save Settings"]})})]})]})})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(p,{className:"h-8 w-8 text-green-600"}),m.jsxs("div",{className:"ml-4",children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Costs"}),m.jsxs("p",{className:"text-2xl font-bold",children:["$",ne.toFixed(2)]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(D,{className:"h-8 w-8 text-blue-600"}),m.jsxs("div",{className:"ml-4",children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Labor Hours"}),m.jsx("p",{className:"text-2xl font-bold",children:he.toFixed(1)})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(oe,{className:"h-8 w-8 text-purple-600"}),m.jsxs("div",{className:"ml-4",children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Cost/Hour"}),m.jsxs("p",{className:"text-2xl font-bold",children:["$",xe.toFixed(2)]})]})]})})}),m.jsx(h,{children:m.jsx(x,{className:"p-6",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(W,{className:"h-8 w-8 text-orange-600"}),m.jsxs("div",{className:"ml-4",children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Work Orders"}),m.jsx("p",{className:"text-2xl font-bold",children:r.length})]})]})})})]}),m.jsxs(J,{value:e,onValueChange:s,className:"space-y-4",children:[m.jsxs(K,{className:"grid w-full grid-cols-4",children:[m.jsx(Y,{value:"overview",children:"Overview"}),m.jsx(Y,{value:"add-costs",children:"Add Costs"}),m.jsx(Y,{value:"work-orders",children:"Work Orders"}),m.jsx(Y,{value:"reports",children:"Reports"})]}),m.jsx(Q,{value:"overview",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Current Settings"}),m.jsx(v,{children:"Current garage cost calculation settings"})]}),m.jsxs(x,{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{children:"Electricity Rate:"}),m.jsxs(N,{variant:"secondary",children:["$",t.monthlyElectricityRate,"/kWh"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{children:"Labor Rate:"}),m.jsxs(N,{variant:"secondary",children:["$",t.laborRatePerHour,"/hour"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{children:"Daily Overhead:"}),m.jsxs(N,{variant:"secondary",children:["$",t.overheadCostPerDay,"/day"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{children:"Equipment Depreciation:"}),m.jsxs(N,{variant:"secondary",children:["$",t.equipmentDepreciationPerHour,"/hour"]})]})]})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Recent Activity"}),m.jsx(v,{children:"Latest cost entries"})]}),m.jsx(x,{children:r.slice(0,5).map(e=>m.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-0",children:[m.jsxs("div",{children:[m.jsx("p",{className:"font-medium",children:e.carModel}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["VIN: ",e.carVin]})]}),m.jsxs("div",{className:"text-right",children:[m.jsxs("p",{className:"font-medium",children:["$",e.grandTotal.toFixed(2)]}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.totalLaborHours.toFixed(1),"h"]})]})]},e.workOrderId))})]})]})}),m.jsx(Q,{value:"add-costs",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(X,{className:"h-5 w-5"}),"Add Parts Cost"]}),m.jsx(v,{children:"Record parts used and their costs"})]}),m.jsx(x,{children:m.jsxs(_,{open:o,onOpenChange:u,children:[m.jsx(V,{asChild:!0,children:m.jsxs(y,{className:"w-full",children:[m.jsx(Z,{className:"mr-2 h-4 w-4"}),"Add Parts"]})}),m.jsxs(U,{className:"sm:max-w-[500px]",children:[m.jsxs(q,{children:[m.jsx(B,{children:"Add Parts Cost"}),m.jsx(G,{children:"Record parts used for a specific car"})]}),m.jsxs("div",{className:"grid gap-4 py-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx(k,{htmlFor:"partsCarVin",children:"Car VIN"}),m.jsx(f,{id:"partsCarVin",value:M.carVin,onChange:e=>R(c(n({},M),{carVin:e.target.value})),placeholder:"Enter VIN"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"partsCarModel",children:"Car Model"}),m.jsx(f,{id:"partsCarModel",value:M.carModel,onChange:e=>R(c(n({},M),{carModel:e.target.value})),placeholder:"Enter model"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx(k,{htmlFor:"partNumber",children:"Part Number"}),m.jsx(f,{id:"partNumber",value:M.partNumber,onChange:e=>R(c(n({},M),{partNumber:e.target.value})),placeholder:"Part #"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"partName",children:"Part Name *"}),m.jsx(f,{id:"partName",value:M.partName,onChange:e=>R(c(n({},M),{partName:e.target.value})),placeholder:"Part name"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[m.jsxs("div",{children:[m.jsx(k,{htmlFor:"quantity",children:"Quantity"}),m.jsx(f,{id:"quantity",type:"number",value:M.quantity,onChange:e=>R(c(n({},M),{quantity:Number(e.target.value)}))})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"unitCost",children:"Unit Cost ($)"}),m.jsx(f,{id:"unitCost",type:"number",step:"0.01",value:M.unitCost,onChange:e=>R(c(n({},M),{unitCost:Number(e.target.value)}))})]}),m.jsxs("div",{children:[m.jsx(k,{children:"Total Cost"}),m.jsx(f,{value:`$${(M.quantity*M.unitCost).toFixed(2)}`,disabled:!0})]})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"supplier",children:"Supplier"}),m.jsx(f,{id:"supplier",value:M.supplier,onChange:e=>R(c(n({},M),{supplier:e.target.value})),placeholder:"Supplier name"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"partsMechanic",children:"Mechanic Name *"}),m.jsx(f,{id:"partsMechanic",value:M.mechanicName,onChange:e=>R(c(n({},M),{mechanicName:e.target.value})),placeholder:"Mechanic name"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"partsNotes",children:"Notes"}),m.jsx(ee,{id:"partsNotes",value:M.notes,onChange:e=>R(c(n({},M),{notes:e.target.value})),placeholder:"Additional notes"})]})]}),m.jsx(z,{children:m.jsx(y,{type:"submit",onClick:()=>{M.carVin&&M.partName&&M.mechanicName?(ye.addPartsCost(c(n({},M),{totalCost:M.quantity*M.unitCost})),P({title:"Parts Cost Added",description:`Added ${M.partName} cost for ${M.carModel}`}),R({carVin:"",carModel:"",partNumber:"",partName:"",quantity:1,unitCost:0,supplier:"",mechanicName:"",notes:""}),u(!1),ie()):P({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"})},children:"Add Parts Cost"})})]})]})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(se,{className:"h-5 w-5"}),"Add Tools Cost"]}),m.jsx(v,{children:"Record tool usage and costs"})]}),m.jsx(x,{children:m.jsxs(_,{open:C,onOpenChange:w,children:[m.jsx(V,{asChild:!0,children:m.jsxs(y,{className:"w-full",children:[m.jsx(Z,{className:"mr-2 h-4 w-4"}),"Add Tools"]})}),m.jsxs(U,{className:"sm:max-w-[500px]",children:[m.jsxs(q,{children:[m.jsx(B,{children:"Add Tools Cost"}),m.jsx(G,{children:"Record tool usage for a specific car"})]}),m.jsxs("div",{className:"grid gap-4 py-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx(k,{htmlFor:"toolsCarVin",children:"Car VIN"}),m.jsx(f,{id:"toolsCarVin",value:E.carVin,onChange:e=>te(c(n({},E),{carVin:e.target.value})),placeholder:"Enter VIN"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"toolsCarModel",children:"Car Model"}),m.jsx(f,{id:"toolsCarModel",value:E.carModel,onChange:e=>te(c(n({},E),{carModel:e.target.value})),placeholder:"Enter model"})]})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"toolName",children:"Tool Name *"}),m.jsx(f,{id:"toolName",value:E.toolName,onChange:e=>te(c(n({},E),{toolName:e.target.value})),placeholder:"Tool name"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"toolType",children:"Tool Type"}),m.jsxs(I,{value:E.toolType,onValueChange:e=>te(c(n({},E),{toolType:e})),children:[m.jsx(O,{children:m.jsx(T,{})}),m.jsxs($,{children:[m.jsx(A,{value:"consumable",children:"Consumable"}),m.jsx(A,{value:"equipment_usage",children:"Equipment Usage"}),m.jsx(A,{value:"rental",children:"Rental"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[m.jsxs("div",{children:[m.jsx(k,{htmlFor:"toolCost",children:"Cost ($)"}),m.jsx(f,{id:"toolCost",type:"number",step:"0.01",value:E.cost,onChange:e=>te(c(n({},E),{cost:Number(e.target.value)}))})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"toolQuantity",children:"Quantity"}),m.jsx(f,{id:"toolQuantity",type:"number",value:E.quantity,onChange:e=>te(c(n({},E),{quantity:Number(e.target.value)}))})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"usageHours",children:"Usage Hours"}),m.jsx(f,{id:"usageHours",type:"number",step:"0.1",value:E.usageHours,onChange:e=>te(c(n({},E),{usageHours:Number(e.target.value)}))})]})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"toolsMechanic",children:"Mechanic Name *"}),m.jsx(f,{id:"toolsMechanic",value:E.mechanicName,onChange:e=>te(c(n({},E),{mechanicName:e.target.value})),placeholder:"Mechanic name"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"toolsNotes",children:"Notes"}),m.jsx(ee,{id:"toolsNotes",value:E.notes,onChange:e=>te(c(n({},E),{notes:e.target.value})),placeholder:"Additional notes"})]})]}),m.jsx(z,{children:m.jsx(y,{type:"submit",onClick:()=>{E.carVin&&E.toolName&&E.mechanicName?(ye.addToolsCost(E),P({title:"Tools Cost Added",description:`Added ${E.toolName} cost for ${E.carModel}`}),te({carVin:"",carModel:"",toolName:"",toolType:"consumable",cost:0,quantity:1,usageHours:0,mechanicName:"",notes:""}),w(!1),ie()):P({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"})},children:"Add Tools Cost"})})]})]})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(ce,{className:"h-5 w-5"}),"Add Other Costs"]}),m.jsx(v,{children:"Record miscellaneous expenses"})]}),m.jsx(x,{children:m.jsxs(_,{open:S,onOpenChange:F,children:[m.jsx(V,{asChild:!0,children:m.jsxs(y,{className:"w-full",children:[m.jsx(Z,{className:"mr-2 h-4 w-4"}),"Add Other"]})}),m.jsxs(U,{className:"sm:max-w-[500px]",children:[m.jsxs(q,{children:[m.jsx(B,{children:"Add Other Cost"}),m.jsx(G,{children:"Record miscellaneous expenses for a specific car"})]}),m.jsxs("div",{className:"grid gap-4 py-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx(k,{htmlFor:"otherCarVin",children:"Car VIN"}),m.jsx(f,{id:"otherCarVin",value:ae.carVin,onChange:e=>re(c(n({},ae),{carVin:e.target.value})),placeholder:"Enter VIN"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"otherCarModel",children:"Car Model"}),m.jsx(f,{id:"otherCarModel",value:ae.carModel,onChange:e=>re(c(n({},ae),{carModel:e.target.value})),placeholder:"Enter model"})]})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"costCategory",children:"Cost Category"}),m.jsx(f,{id:"costCategory",value:ae.costCategory,onChange:e=>re(c(n({},ae),{costCategory:e.target.value})),placeholder:"e.g., Materials, Services, etc."})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"description",children:"Description *"}),m.jsx(ee,{id:"description",value:ae.description,onChange:e=>re(c(n({},ae),{description:e.target.value})),placeholder:"Describe the expense"})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"otherCost",children:"Cost ($)"}),m.jsx(f,{id:"otherCost",type:"number",step:"0.01",value:ae.cost,onChange:e=>re(c(n({},ae),{cost:Number(e.target.value)}))})]}),m.jsxs("div",{children:[m.jsx(k,{htmlFor:"recordedBy",children:"Recorded By *"}),m.jsx(f,{id:"recordedBy",value:ae.recordedBy,onChange:e=>re(c(n({},ae),{recordedBy:e.target.value})),placeholder:"Your name"})]})]}),m.jsx(z,{children:m.jsx(y,{type:"submit",onClick:()=>{ae.carVin&&ae.description&&ae.recordedBy?(ye.addOtherCost(ae),P({title:"Other Cost Added",description:`Added ${ae.costCategory} cost for ${ae.carModel}`}),re({carVin:"",carModel:"",costCategory:"",description:"",cost:0,recordedBy:""}),F(!1),ie()):P({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"})},children:"Add Other Cost"})})]})]})})]})]})}),m.jsx(Q,{value:"work-orders",children:m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Work Order Cost Summaries"}),m.jsx(v,{children:"Detailed cost breakdown for each work order"})]}),m.jsx(x,{children:m.jsxs("div",{className:"space-y-4",children:[r.map(e=>m.jsxs(h,{className:"p-4",children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold",children:e.carModel}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["VIN: ",e.carVin]}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:["Work Order: ",e.workOrderId]})]}),m.jsxs("div",{className:"text-right",children:[m.jsxs("p",{className:"text-2xl font-bold",children:["$",e.grandTotal.toFixed(2)]}),m.jsx(N,{variant:e.isCompleted?"default":"secondary",children:e.isCompleted?"Completed":"In Progress"})]})]}),m.jsx(de,{className:"my-4"}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-muted-foreground",children:"Labor"}),m.jsxs("p",{className:"font-medium",children:["$",e.totalLaborCost.toFixed(2)]}),m.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.totalLaborHours.toFixed(1),"h"]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-muted-foreground",children:"Electricity"}),m.jsxs("p",{className:"font-medium",children:["$",e.totalElectricityCost.toFixed(2)]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-muted-foreground",children:"Parts"}),m.jsxs("p",{className:"font-medium",children:["$",e.totalPartsCost.toFixed(2)]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-muted-foreground",children:"Tools"}),m.jsxs("p",{className:"font-medium",children:["$",e.totalToolsCost.toFixed(2)]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-muted-foreground",children:"Other"}),m.jsxs("p",{className:"font-medium",children:["$",e.totalOtherCosts.toFixed(2)]})]})]})]},e.workOrderId)),0===r.length&&m.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No work orders found. Costs will appear here when labor is tracked."})]})})]})}),m.jsx(Q,{value:"reports",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Export Data"}),m.jsx(v,{children:"Download all garage cost data"})]}),m.jsx(x,{children:m.jsxs(y,{onClick:()=>{const e=ye.exportData(),s=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`garage-costs-${(new Date).toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(t)},className:"w-full",children:[m.jsx(me,{className:"mr-2 h-4 w-4"}),"Export Data"]})})]}),m.jsxs(h,{children:[m.jsxs(j,{children:[m.jsx(g,{children:"Import Data"}),m.jsx(v,{children:"Upload previously exported data"})]}),m.jsx(x,{children:m.jsxs(y,{onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t){const e=new FileReader;e.onload=e=>{var s;try{const t=null==(s=e.target)?void 0:s.result;ye.importData(t),ie(),P({title:"Data Imported",description:"Garage cost data has been imported successfully"})}catch(t){P({title:"Import Failed",description:"Failed to import data. Please check the file format.",variant:"destructive"})}},e.readAsText(t)}},e.click()},className:"w-full",variant:"outline",children:[m.jsx(L,{className:"mr-2 h-4 w-4"}),"Import Data"]})})]})]})})]})]})},Ce=({isOpen:e,onClose:s,onSave:t,initialData:a={},mode:r="create",title:l})=>{var i;const[d,o]=le.useState(n({type:"car_sale",entityId:"",entityName:"",date:(new Date).toISOString().split("T")[0],currency:"USD",status:"draft"},a)),[v,b]=le.useState("basic"),[C,w]=le.useState({totalCost:0,grossProfit:0,netProfit:0,profitMargin:0,roi:0}),S="view"===r;le.useEffect(()=>{(()=>{const{purchasePrice:e=0,shippingCost:s=0,importDuty:t=0,customsClearance:a=0,inspectionFees:r=0,registrationFees:l=0,insuranceCost:i=0,transportCost:m=0,storageCost:h=0,preparationCost:x=0,totalLaborCost:p=0,totalPartsCost:u=0,electricityCost:j=0,equipmentUsageCost:g=0,toolsUsageCost:v=0,facilityRentAllocation:N=0,overheadCost:f=0,finalSalePrice:y=0,discountGiven:b=0,salesCommission:C=0,marketingCost:S=0}=d,P=e+s+t+a+r+l+i+m+h+x+p+u+j+g+v+N+f,F=y-b,M=F-P,D=M-C-S,R=F>0?M/F*100:0,k=P>0?D/P*100:0;w({totalCost:P,grossProfit:M,netProfit:D,profitMargin:R,roi:k}),o(e=>c(n({},e),{totalCost:P,grossProfit:M,netProfit:D,profitMargin:R,roi:k}))})()},[d.purchasePrice,d.shippingCost,d.importDuty,d.customsClearance,d.inspectionFees,d.registrationFees,d.insuranceCost,d.transportCost,d.storageCost,d.preparationCost,d.totalLaborCost,d.totalPartsCost,d.electricityCost,d.equipmentUsageCost,d.toolsUsageCost,d.facilityRentAllocation,d.overheadCost,d.finalSalePrice,d.discountGiven,d.salesCommission,d.marketingCost]),le.useEffect(()=>{const{laborHours:e=0,laborRate:s=0,overtimeHours:t=0,overtimeRate:a=0}=d,r=e*s+t*(a||1.5*s);r!==d.totalLaborCost&&o(e=>c(n({},e),{totalLaborCost:r}))},[d.laborHours,d.laborRate,d.overtimeHours,d.overtimeRate]),le.useEffect(()=>{const{partsCost:e=0,partsMarkup:s=0}=d,t=e*(1+s/100);t!==d.totalPartsCost&&o(e=>c(n({},e),{totalPartsCost:t}))},[d.partsCost,d.partsMarkup]);const F=(e,s)=>{o(t=>c(n({},t),{[e]:s}))},D=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:d.currency||"USD"}).format(e),R=e=>e>0?"text-green-600":e<0?"text-red-600":"text-gray-600",L=e=>e>=20?"default":e>=10?"secondary":e>=0?"outline":"destructive";return m.jsx(_,{open:e,onOpenChange:s,children:m.jsxs(U,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[m.jsx(q,{children:m.jsxs(B,{className:"flex items-center gap-2",children:[m.jsx(p,{className:"h-5 w-5"}),l||("create"===r?"Add":"edit"===r?"Edit":"View")+" Financial Information"]})}),m.jsxs(J,{value:v,onValueChange:b,className:"w-full",children:[m.jsxs(K,{className:"grid w-full grid-cols-5",children:[m.jsx(Y,{value:"basic",children:"Basic Info"}),m.jsx(Y,{value:"costs",children:"Costs"}),m.jsx(Y,{value:"labor",children:"Labor"}),m.jsx(Y,{value:"sale",children:"Sale Info"}),m.jsx(Y,{value:"summary",children:"Summary"})]}),m.jsxs(Q,{value:"basic",className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"type",children:"Transaction Type"}),m.jsxs(I,{value:d.type,onValueChange:e=>F("type",e),disabled:S,children:[m.jsx(O,{children:m.jsx(T,{})}),m.jsxs($,{children:[m.jsx(A,{value:"car_sale",children:"Car Sale"}),m.jsx(A,{value:"repair",children:"Repair Service"}),m.jsx(A,{value:"parts",children:"Parts Sale"}),m.jsx(A,{value:"service",children:"General Service"}),m.jsx(A,{value:"other",children:"Other"})]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"date",children:"Date"}),m.jsx(f,{id:"date",type:"date",value:d.date,onChange:e=>F("date",e.target.value),disabled:S,className:"pdi-date-input"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"entityName",children:"Item/Service Name"}),m.jsx(f,{id:"entityName",placeholder:"e.g., BMW X5 2024, Engine Repair, etc.",value:d.entityName,onChange:e=>F("entityName",e.target.value),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"currency",children:"Currency"}),m.jsxs(I,{value:d.currency,onValueChange:e=>F("currency",e),disabled:S,children:[m.jsx(O,{children:m.jsx(T,{})}),m.jsxs($,{children:[m.jsx(A,{value:"USD",children:"USD ($)"}),m.jsx(A,{value:"EUR",children:"EUR (€)"}),m.jsx(A,{value:"LBP",children:"LBP (ل.ل)"})]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"clientName",children:"Client Name"}),m.jsx(f,{id:"clientName",placeholder:"Client or customer name",value:d.clientName||"",onChange:e=>F("clientName",e.target.value),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"clientContact",children:"Client Contact"}),m.jsx(f,{id:"clientContact",placeholder:"Phone or email",value:d.clientContact||"",onChange:e=>F("clientContact",e.target.value),disabled:S})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"notes",children:"Notes"}),m.jsx(ee,{id:"notes",placeholder:"Additional notes or comments",value:d.notes||"",onChange:e=>F("notes",e.target.value),disabled:S,rows:3})]})]}),m.jsxs(Q,{value:"costs",className:"space-y-6",children:[m.jsxs(h,{children:[m.jsx(j,{children:m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(W,{className:"h-4 w-4"}),"Acquisition & Import Costs"]})}),m.jsxs(x,{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"purchasePrice",children:"Purchase Price"}),m.jsx(f,{id:"purchasePrice",type:"number",placeholder:"0",value:d.purchasePrice||"",onChange:e=>F("purchasePrice",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"shippingCost",children:"Shipping Cost"}),m.jsx(f,{id:"shippingCost",type:"number",placeholder:"0",value:d.shippingCost||"",onChange:e=>F("shippingCost",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"importDuty",children:"Import Duty"}),m.jsx(f,{id:"importDuty",type:"number",placeholder:"0",value:d.importDuty||"",onChange:e=>F("importDuty",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"customsClearance",children:"Customs Clearance"}),m.jsx(f,{id:"customsClearance",type:"number",placeholder:"0",value:d.customsClearance||"",onChange:e=>F("customsClearance",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"inspectionFees",children:"Inspection Fees"}),m.jsx(f,{id:"inspectionFees",type:"number",placeholder:"0",value:d.inspectionFees||"",onChange:e=>F("inspectionFees",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"registrationFees",children:"Registration Fees"}),m.jsx(f,{id:"registrationFees",type:"number",placeholder:"0",value:d.registrationFees||"",onChange:e=>F("registrationFees",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"insuranceCost",children:"Insurance Cost"}),m.jsx(f,{id:"insuranceCost",type:"number",placeholder:"0",value:d.insuranceCost||"",onChange:e=>F("insuranceCost",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"transportCost",children:"Transport Cost"}),m.jsx(f,{id:"transportCost",type:"number",placeholder:"0",value:d.transportCost||"",onChange:e=>F("transportCost",parseFloat(e.target.value)||0),disabled:S})]})]})]}),m.jsxs(h,{children:[m.jsx(j,{children:m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(X,{className:"h-4 w-4"}),"Parts & Materials"]})}),m.jsxs(x,{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"partsCost",children:"Parts Cost (Base)"}),m.jsx(f,{id:"partsCost",type:"number",placeholder:"0",value:d.partsCost||"",onChange:e=>F("partsCost",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"partsMarkup",children:"Markup (%)"}),m.jsx(f,{id:"partsMarkup",type:"number",placeholder:"0",value:d.partsMarkup||"",onChange:e=>F("partsMarkup",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"totalPartsCost",children:"Total Parts Cost"}),m.jsx(f,{id:"totalPartsCost",type:"number",value:d.totalPartsCost||0,disabled:!0,className:"bg-gray-50"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"partsSupplier",children:"Parts Supplier"}),m.jsx(f,{id:"partsSupplier",placeholder:"Supplier name",value:d.partsSupplier||"",onChange:e=>F("partsSupplier",e.target.value),disabled:S})]})]})]}),m.jsxs(h,{children:[m.jsx(j,{children:m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(te,{className:"h-4 w-4"}),"Operational Costs"]})}),m.jsxs(x,{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"electricityCost",children:"Electricity Cost"}),m.jsx(f,{id:"electricityCost",type:"number",placeholder:"0",value:d.electricityCost||"",onChange:e=>F("electricityCost",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"equipmentUsageCost",children:"Equipment Usage"}),m.jsx(f,{id:"equipmentUsageCost",type:"number",placeholder:"0",value:d.equipmentUsageCost||"",onChange:e=>F("equipmentUsageCost",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"storageCost",children:"Storage Cost"}),m.jsx(f,{id:"storageCost",type:"number",placeholder:"0",value:d.storageCost||"",onChange:e=>F("storageCost",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"overheadCost",children:"Overhead Allocation"}),m.jsx(f,{id:"overheadCost",type:"number",placeholder:"0",value:d.overheadCost||"",onChange:e=>F("overheadCost",parseFloat(e.target.value)||0),disabled:S})]})]})]})]}),m.jsx(Q,{value:"labor",className:"space-y-4",children:m.jsxs(h,{children:[m.jsx(j,{children:m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(ae,{className:"h-4 w-4"}),"Labor Information"]})}),m.jsxs(x,{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"laborHours",children:"Regular Hours"}),m.jsx(f,{id:"laborHours",type:"number",step:"0.1",placeholder:"0",value:d.laborHours||"",onChange:e=>F("laborHours",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"laborRate",children:"Hourly Rate"}),m.jsx(f,{id:"laborRate",type:"number",placeholder:"0",value:d.laborRate||"",onChange:e=>F("laborRate",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"overtimeHours",children:"Overtime Hours"}),m.jsx(f,{id:"overtimeHours",type:"number",step:"0.1",placeholder:"0",value:d.overtimeHours||"",onChange:e=>F("overtimeHours",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"overtimeRate",children:"Overtime Rate"}),m.jsx(f,{id:"overtimeRate",type:"number",placeholder:"Auto (1.5x regular)",value:d.overtimeRate||"",onChange:e=>F("overtimeRate",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2 col-span-2",children:[m.jsx(k,{htmlFor:"totalLaborCost",children:"Total Labor Cost"}),m.jsx(f,{id:"totalLaborCost",type:"number",value:d.totalLaborCost||0,disabled:!0,className:"bg-gray-50 text-lg font-semibold"})]})]})]})}),m.jsx(Q,{value:"sale",className:"space-y-4",children:m.jsxs(h,{children:[m.jsx(j,{children:m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(u,{className:"h-4 w-4"}),"Sale & Revenue Information"]})}),m.jsxs(x,{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"quotedPrice",children:"Quoted Price"}),m.jsx(f,{id:"quotedPrice",type:"number",placeholder:"0",value:d.quotedPrice||"",onChange:e=>F("quotedPrice",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"listingPrice",children:"Listing Price"}),m.jsx(f,{id:"listingPrice",type:"number",placeholder:"0",value:d.listingPrice||"",onChange:e=>F("listingPrice",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"finalSalePrice",children:"Final Sale Price"}),m.jsx(f,{id:"finalSalePrice",type:"number",placeholder:"0",value:d.finalSalePrice||"",onChange:e=>F("finalSalePrice",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"discountGiven",children:"Discount Given"}),m.jsx(f,{id:"discountGiven",type:"number",placeholder:"0",value:d.discountGiven||"",onChange:e=>F("discountGiven",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"salesCommission",children:"Sales Commission"}),m.jsx(f,{id:"salesCommission",type:"number",placeholder:"0",value:d.salesCommission||"",onChange:e=>F("salesCommission",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"marketingCost",children:"Marketing Cost"}),m.jsx(f,{id:"marketingCost",type:"number",placeholder:"0",value:d.marketingCost||"",onChange:e=>F("marketingCost",parseFloat(e.target.value)||0),disabled:S})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"paymentMethod",children:"Payment Method"}),m.jsxs(I,{value:d.paymentMethod||"",onValueChange:e=>F("paymentMethod",e),disabled:S,children:[m.jsx(O,{children:m.jsx(T,{placeholder:"Select payment method"})}),m.jsxs($,{children:[m.jsx(A,{value:"cash",children:"Cash"}),m.jsx(A,{value:"bank_transfer",children:"Bank Transfer"}),m.jsx(A,{value:"check",children:"Check"}),m.jsx(A,{value:"credit_card",children:"Credit Card"}),m.jsx(A,{value:"financing",children:"Financing"}),m.jsx(A,{value:"trade_in",children:"Trade-in"})]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"paymentTerms",children:"Payment Terms"}),m.jsx(f,{id:"paymentTerms",placeholder:"e.g., Net 30, COD, etc.",value:d.paymentTerms||"",onChange:e=>F("paymentTerms",e.target.value),disabled:S})]})]})]})}),m.jsx(Q,{value:"summary",className:"space-y-4",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs(h,{children:[m.jsx(j,{children:m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(oe,{className:"h-4 w-4"}),"Financial Summary"]})}),m.jsxs(x,{className:"space-y-4",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-sm text-gray-600",children:"Total Cost:"}),m.jsx("span",{className:"font-semibold text-red-600",children:D(C.totalCost)})]}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-sm text-gray-600",children:"Gross Revenue:"}),m.jsx("span",{className:"font-semibold",children:D((d.finalSalePrice||0)-(d.discountGiven||0))})]}),m.jsx(de,{}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-sm text-gray-600",children:"Gross Profit:"}),m.jsx("span",{className:`font-semibold ${R(C.grossProfit)}`,children:D(C.grossProfit)})]}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-sm text-gray-600",children:"Net Profit:"}),m.jsx("span",{className:`font-semibold ${R(C.netProfit)}`,children:D(C.netProfit)})]}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-sm text-gray-600",children:"Profit Margin:"}),m.jsxs(N,{variant:L(C.profitMargin),children:[C.profitMargin.toFixed(1),"%"]})]}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-sm text-gray-600",children:"ROI:"}),m.jsxs(N,{variant:L(C.roi),children:[C.roi.toFixed(1),"%"]})]})]})]}),m.jsxs(h,{children:[m.jsx(j,{children:m.jsxs(g,{className:"flex items-center gap-2",children:[m.jsx(ce,{className:"h-4 w-4"}),"Status & Information"]})}),m.jsxs(x,{className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{htmlFor:"status",children:"Status"}),m.jsxs(I,{value:d.status,onValueChange:e=>F("status",e),disabled:S,children:[m.jsx(O,{children:m.jsx(T,{})}),m.jsxs($,{children:[m.jsx(A,{value:"draft",children:"Draft"}),m.jsx(A,{value:"pending",children:"Pending Approval"}),m.jsx(A,{value:"approved",children:"Approved"}),m.jsx(A,{value:"completed",children:"Completed"}),m.jsx(A,{value:"cancelled",children:"Cancelled"})]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{children:"Transaction Type"}),m.jsxs("div",{className:"flex items-center gap-2",children:["car_sale"===d.type&&m.jsx(W,{className:"h-4 w-4"}),"repair"===d.type&&m.jsx(se,{className:"h-4 w-4"}),"parts"===d.type&&m.jsx(X,{className:"h-4 w-4"}),m.jsx("span",{className:"capitalize",children:null==(i=d.type)?void 0:i.replace("_"," ")})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{children:"Date"}),m.jsx("div",{className:"text-sm text-gray-600",children:new Date(d.date).toLocaleDateString()})]}),d.clientName&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(k,{children:"Client"}),m.jsxs("div",{className:"text-sm text-gray-600",children:[d.clientName,d.clientContact&&m.jsx("div",{className:"text-xs text-gray-500",children:d.clientContact})]})]}),m.jsxs("div",{className:"pt-4 border-t",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx(he,{className:"h-4 w-4 text-blue-500"}),m.jsx("span",{className:"text-sm font-medium",children:"Performance"})]}),m.jsxs("div",{className:"space-y-2 text-xs",children:[C.profitMargin>=20&&m.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[m.jsx(M,{className:"h-3 w-3"}),"Excellent profit margin"]}),C.profitMargin<10&&C.profitMargin>0&&m.jsxs("div",{className:"flex items-center gap-1 text-yellow-600",children:[m.jsx(re,{className:"h-3 w-3"}),"Low profit margin"]}),C.profitMargin<0&&m.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[m.jsx(re,{className:"h-3 w-3"}),"Loss on transaction"]})]})]})]})]})]})})]}),m.jsxs(z,{className:"flex gap-2",children:[m.jsx(y,{variant:"outline",onClick:s,children:"Cancel"}),!S&&m.jsxs(y,{onClick:()=>{if(!d.entityName.trim())return void P({title:"Validation Error",description:"Entity name is required",variant:"destructive"});if("car_sale"===d.type&&!d.purchasePrice&&!d.finalSalePrice)return void P({title:"Validation Error",description:"Either purchase price or sale price is required for car sales",variant:"destructive"});const e=c(n({},d),{lastUpdated:(new Date).toISOString(),id:d.id||`fin-${Date.now()}`});t(e),P({title:"Financial Data Saved",description:`${d.entityName} financial information has been saved successfully`}),s()},className:"bg-blue-600 hover:bg-blue-700",children:[m.jsx(p,{className:"h-4 w-4 mr-2"}),"Save Financial Data"]})]})]})})},we=()=>{const[e,s]=le.useState(new Date),[t,a]=le.useState([{id:"1",title:"Social Media Campaign",date:new Date,type:"campaign",budget:5e3,actualCost:4800,expectedROI:15e3,status:"active",description:"Instagram and Facebook advertising for new EV models",profitMargin:68,costPerLead:24,conversionRate:12.5},{id:"2",title:"Trade Show Participation",date:new Date(Date.now()+6048e5),type:"event",budget:12e3,actualCost:0,expectedROI:5e4,status:"planned",description:"Auto show booth and demonstrations",profitMargin:75,costPerLead:120,conversionRate:8.2},{id:"3",title:"Digital Marketing Campaign",date:new Date(Date.now()-12096e5),type:"advertising",budget:8e3,actualCost:7200,expectedROI:28e3,status:"completed",description:"Google Ads and YouTube advertising",profitMargin:72,costPerLead:18,conversionRate:15.3}]),[r,l]=le.useState(!1),[i,d]=le.useState({title:"",type:"campaign",budget:0,expectedROI:0,description:""}),o=e=>t.filter(s=>ue(s.date,e)),v=e=>{switch(e){case"active":return"bg-green-100 text-green-700";case"completed":return"bg-blue-100 text-blue-700";case"planned":return"bg-yellow-100 text-yellow-700";case"cancelled":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}},f=()=>t.reduce((e,s)=>e+s.budget,0),b=()=>t.reduce((e,s)=>e+s.actualCost,0),C=()=>t.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.expectedROI,0),w=()=>{const e=b(),s=C();return e>0?(s-e)/e*100:0};return m.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Marketing Budget Calendar"}),m.jsx("p",{className:"text-muted-foreground mt-2",children:"Track marketing spend, ROI, and campaign financial performance"})]}),m.jsxs(y,{onClick:()=>l(!0),className:"flex items-center gap-2",children:[m.jsx(Z,{className:"h-4 w-4"}),"Add Campaign"]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[m.jsxs(h,{children:[m.jsx(j,{className:"pb-2",children:m.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(p,{className:"h-4 w-4"}),"Total Budget"]})}),m.jsx(x,{children:m.jsxs("div",{className:"text-2xl font-bold",children:["$",f().toLocaleString()]})})]}),m.jsxs(h,{children:[m.jsx(j,{className:"pb-2",children:m.jsx(g,{className:"text-sm font-medium",children:"Actual Spend"})}),m.jsx(x,{children:m.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["$",b().toLocaleString()]})})]}),m.jsxs(h,{children:[m.jsx(j,{className:"pb-2",children:m.jsx(g,{className:"text-sm font-medium",children:"Expected ROI"})}),m.jsx(x,{children:m.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",t.reduce((e,s)=>e+s.expectedROI,0).toLocaleString()]})})]}),m.jsxs(h,{children:[m.jsx(j,{className:"pb-2",children:m.jsx(g,{className:"text-sm font-medium",children:"Remaining Budget"})}),m.jsx(x,{children:m.jsxs("div",{className:"text-2xl font-bold",children:["$",(f()-b()).toLocaleString()]})})]}),m.jsxs(h,{children:[m.jsx(j,{className:"pb-2",children:m.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(u,{className:"h-4 w-4"}),"ROI Percentage"]})}),m.jsx(x,{children:m.jsxs("div",{className:"text-2xl font-bold "+(w()>0?"text-green-600":"text-red-600"),children:[w().toFixed(1),"%"]})})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsxs(h,{children:[m.jsx(j,{className:"pb-2",children:m.jsx(g,{className:"text-sm font-medium",children:"Actual ROI"})}),m.jsxs(x,{children:[m.jsxs("div",{className:"text-xl font-bold text-green-600",children:["$",C().toLocaleString()]}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"From completed campaigns"})]})]}),m.jsxs(h,{children:[m.jsx(j,{className:"pb-2",children:m.jsx(g,{className:"text-sm font-medium",children:"Avg Cost Per Lead"})}),m.jsxs(x,{children:[m.jsxs("div",{className:"text-xl font-bold",children:["$",(()=>{const e=t.filter(e=>e.costPerLead&&"completed"===e.status);return 0===e.length?0:e.reduce((e,s)=>e+(s.costPerLead||0),0)/e.length})().toFixed(2)]}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"Across completed campaigns"})]})]}),m.jsxs(h,{children:[m.jsx(j,{className:"pb-2",children:m.jsx(g,{className:"text-sm font-medium",children:"Budget Utilization"})}),m.jsxs(x,{children:[m.jsxs("div",{className:"text-xl font-bold",children:[(b()/f()*100).toFixed(1),"%"]}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"Of total allocated budget"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[m.jsxs(h,{children:[m.jsx(j,{children:m.jsx(g,{children:"Marketing Budget Calendar"})}),m.jsx(x,{children:m.jsx(xe,{mode:"single",selected:e,onSelect:s,className:"rounded-md border",modifiers:{hasEvents:e=>(e=>o(e).length>0)(e)},modifiersStyles:{hasEvents:{backgroundColor:"#3b82f6",color:"white",fontWeight:"bold"}}})})]}),m.jsxs(h,{children:[m.jsx(j,{children:m.jsxs(g,{children:["Campaigns for ",e?pe(e,"MMMM d, yyyy"):"Selected Date"]})}),m.jsx(x,{children:m.jsxs("div",{className:"space-y-4",children:[e&&o(e).length>0?o(e).map(e=>m.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h3",{className:"font-semibold",children:e.title}),m.jsx(N,{className:v(e.status),children:e.status})]}),m.jsx("p",{className:"text-sm text-muted-foreground",children:e.description}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm bg-gray-50 p-3 rounded-md",children:[m.jsxs("div",{children:[m.jsx("span",{className:"font-medium",children:"Budget:"})," $",e.budget.toLocaleString()]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-medium",children:"Spent:"})," $",e.actualCost.toLocaleString()]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-medium",children:"Expected ROI:"})," $",e.expectedROI.toLocaleString()]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-medium",children:"Type:"})," ",e.type]}),e.profitMargin&&m.jsxs("div",{children:[m.jsx("span",{className:"font-medium",children:"Profit Margin:"})," ",e.profitMargin,"%"]}),e.costPerLead&&m.jsxs("div",{children:[m.jsx("span",{className:"font-medium",children:"Cost/Lead:"})," $",e.costPerLead]})]})]},e.id)):m.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No campaigns scheduled for this date"}),r&&m.jsxs("div",{className:"border rounded-lg p-4 space-y-4 bg-gray-50",children:[m.jsx("h3",{className:"font-semibold",children:"Add New Campaign"}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("input",{type:"text",placeholder:"Campaign title",value:i.title,onChange:e=>d(s=>c(n({},s),{title:e.target.value})),className:"w-full px-3 py-2 border rounded-md"}),m.jsxs("select",{value:i.type,onChange:e=>d(s=>c(n({},s),{type:e.target.value})),className:"w-full px-3 py-2 border rounded-md",children:[m.jsx("option",{value:"campaign",children:"Campaign"}),m.jsx("option",{value:"event",children:"Event"}),m.jsx("option",{value:"promotion",children:"Promotion"}),m.jsx("option",{value:"advertising",children:"Advertising"})]}),m.jsx("input",{type:"number",placeholder:"Budget ($)",value:i.budget||"",onChange:e=>d(s=>c(n({},s),{budget:parseFloat(e.target.value)||0})),className:"w-full px-3 py-2 border rounded-md"}),m.jsx("input",{type:"number",placeholder:"Expected ROI ($)",value:i.expectedROI||"",onChange:e=>d(s=>c(n({},s),{expectedROI:parseFloat(e.target.value)||0})),className:"w-full px-3 py-2 border rounded-md"}),m.jsx("textarea",{placeholder:"Description",value:i.description,onChange:e=>d(s=>c(n({},s),{description:e.target.value})),className:"w-full px-3 py-2 border rounded-md",rows:3}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(y,{onClick:()=>{if(!e||!i.title)return;const s={id:Date.now().toString(),title:i.title,date:e,type:i.type,budget:i.budget,actualCost:0,expectedROI:i.expectedROI,status:"planned",description:i.description};a(e=>[...e,s]),d({title:"",type:"campaign",budget:0,expectedROI:0,description:""}),l(!1)},size:"sm",children:"Add Campaign"}),m.jsx(y,{onClick:()=>l(!1),variant:"outline",size:"sm",children:"Cancel"})]})]})]})]})})]})]}),m.jsxs(h,{children:[m.jsx(j,{children:m.jsx(g,{children:"Marketing Campaign Financial Performance"})}),m.jsx(x,{children:m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b",children:[m.jsx("th",{className:"text-left p-2",children:"Campaign"}),m.jsx("th",{className:"text-left p-2",children:"Date"}),m.jsx("th",{className:"text-left p-2",children:"Type"}),m.jsx("th",{className:"text-left p-2",children:"Budget"}),m.jsx("th",{className:"text-left p-2",children:"Spent"}),m.jsx("th",{className:"text-left p-2",children:"Expected ROI"}),m.jsx("th",{className:"text-left p-2",children:"Profit Margin"}),m.jsx("th",{className:"text-left p-2",children:"Cost/Lead"}),m.jsx("th",{className:"text-left p-2",children:"Status"})]})}),m.jsx("tbody",{children:t.map(e=>m.jsxs("tr",{className:"border-b",children:[m.jsx("td",{className:"p-2 font-medium",children:e.title}),m.jsx("td",{className:"p-2",children:pe(e.date,"MMM d, yyyy")}),m.jsx("td",{className:"p-2 capitalize",children:e.type}),m.jsxs("td",{className:"p-2",children:["$",e.budget.toLocaleString()]}),m.jsxs("td",{className:"p-2 text-red-600",children:["$",e.actualCost.toLocaleString()]}),m.jsxs("td",{className:"p-2 text-green-600",children:["$",e.expectedROI.toLocaleString()]}),m.jsx("td",{className:"p-2",children:e.profitMargin?`${e.profitMargin}%`:"-"}),m.jsx("td",{className:"p-2",children:e.costPerLead?`$${e.costPerLead}`:"-"}),m.jsx("td",{className:"p-2",children:m.jsx(N,{className:v(e.status),children:e.status})})]},e.id))})]})})})]})]})},Se=()=>{const[e,s]=le.useState("pricing"),[t,a]=le.useState([]),[r,l]=le.useState(!0),[i,d]=le.useState(!1),[x,j]=le.useState(null),{logActivity:g}=ie();le.useEffect(()=>{v()},[]);const v=()=>o(void 0,null,function*(){try{l(!0);const e=localStorage.getItem("carInventory");if(e){const s=JSON.parse(e).map(e=>{const s=new Date(e.arrivalDate),t=e.soldDate?new Date(e.soldDate):null,a=new Date,r=t?Math.floor((t.getTime()-s.getTime())/864e5):Math.floor((a.getTime()-s.getTime())/864e5);return{id:e.id,vinNumber:e.vinNumber,model:e.model,brand:e.brand||"Unknown",year:e.year,color:e.color,arrivalDate:e.arrivalDate,soldDate:e.soldDate,purchasePrice:e.purchasePrice,sellingPrice:e.sellingPrice,marketPrice:N(e),receipts:e.receipts||[],status:e.status,daysInInventory:r,profitMargin:b(e.purchasePrice,e.sellingPrice)}});a(s)}}catch(e){P({title:"Error",description:"Failed to load financial data",variant:"destructive"})}finally{l(!1)}}),N=e=>{const s=f(e.model,e.category),t=Math.max(.7,1-.05*((new Date).getFullYear()-e.year));return Math.round(s*t)},f=(e,s)=>({"Voyah Free":45e3,"Voyah Dream":55e3,"Voyah Passion":65e3,"Voyah Courage":75e3,"MHero 917":85e3,"Tesla Model 3":35e3,"Tesla Model Y":45e3,"BMW X3":5e4}[e]||("EV"===s?4e4:35e3)),b=(e,s)=>e&&s?(s-e)/e*100:0;return r?m.jsx("div",{className:"container mx-auto p-4",children:m.jsx("div",{className:"flex items-center justify-center h-64",children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),m.jsx("p",{className:"mt-2 text-gray-600",children:"Loading financial data..."})]})})}):m.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Financial Management"}),m.jsx("p",{className:"text-muted-foreground",children:"Manage car pricing, analyze supply & demand, and forecast inventory needs"})]}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs(y,{onClick:()=>(j(null),void d(!0)),className:"bg-blue-600 hover:bg-blue-700",children:[m.jsx(Z,{className:"mr-1 h-4 w-4"}),"Add Financial Record"]}),m.jsx(h,{className:"p-4",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(p,{className:"h-5 w-5 text-green-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Inventory Value"}),m.jsxs("p",{className:"text-lg font-semibold",children:["$",t.reduce((e,s)=>e+(s.marketPrice||0),0).toLocaleString()]})]})]})}),m.jsx(h,{className:"p-4",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(W,{className:"h-5 w-5 text-blue-600"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Cars in Stock"}),m.jsx("p",{className:"text-lg font-semibold",children:t.filter(e=>"in_stock"===e.status).length})]})]})})]})]}),m.jsxs(J,{value:e,onValueChange:s,className:"space-y-4",children:[m.jsxs(K,{className:"grid w-full grid-cols-6",children:[m.jsxs(Y,{value:"pricing",className:"flex items-center gap-2",children:[m.jsx(p,{className:"h-4 w-4"}),"Pricing & Receipts"]}),m.jsxs(Y,{value:"analytics",className:"flex items-center gap-2",children:[m.jsx(F,{className:"h-4 w-4"}),"Supply & Demand"]}),m.jsxs(Y,{value:"forecast",className:"flex items-center gap-2",children:[m.jsx(u,{className:"h-4 w-4"}),"Inventory Forecast"]}),m.jsxs(Y,{value:"profitability",className:"flex items-center gap-2",children:[m.jsx(S,{className:"h-4 w-4"}),"Profitability"]}),m.jsxs(Y,{value:"garage-costs",className:"flex items-center gap-2",children:[m.jsx(W,{className:"h-4 w-4"}),"Garage Costs"]}),m.jsxs(Y,{value:"receipts",className:"flex items-center gap-2",children:[m.jsx(ce,{className:"h-4 w-4"}),"Receipt Manager"]}),m.jsxs(Y,{value:"marketing-budget",className:"flex items-center gap-2",children:[m.jsx(Clock,{className:"h-4 w-4"}),"Marketing Budget"]})]}),m.jsx(Q,{value:"pricing",children:m.jsx(je,{cars:t,onUpdatePricing:(e,s,t)=>{a(a=>a.map(a=>a.id===e?c(n({},a),{purchasePrice:s,sellingPrice:t,profitMargin:b(s,t)}):a));const r=localStorage.getItem("carInventory");if(r){const a=JSON.parse(r).map(a=>a.id===e?c(n({},a),{purchasePrice:s,sellingPrice:t}):a);localStorage.setItem("carInventory",JSON.stringify(a))}P({title:"Pricing Updated",description:"Car pricing has been successfully updated"})}})}),m.jsx(Q,{value:"analytics",children:m.jsx(ge,{cars:t})}),m.jsx(Q,{value:"forecast",children:m.jsx(ve,{cars:t})}),m.jsx(Q,{value:"profitability",children:m.jsx(Ne,{cars:t})}),m.jsx(Q,{value:"garage-costs",children:m.jsx(be,{})}),m.jsx(Q,{value:"receipts",children:m.jsx(fe,{cars:t,onAddReceipt:(e,s)=>{const r=t.find(s=>s.id===e),l=c(n({},s),{id:Date.now().toString()});a(s=>s.map(s=>s.id===e?c(n({},s),{receipts:[...s.receipts,l]}):s)),g("UPLOAD","FINANCIAL","RECEIPT",`Uploaded ${s.type} receipt for ${null==r?void 0:r.model} (VIN: ${null==r?void 0:r.vinNumber}) - Amount: $${s.amount.toLocaleString()}`,{entityId:l.id,entityName:`${s.type} receipt - ${null==r?void 0:r.model}`,changes:[{field:"receiptType",oldValue:null,newValue:s.type},{field:"amount",oldValue:null,newValue:s.amount},{field:"description",oldValue:null,newValue:s.description}]}),P({title:"Receipt Added",description:"Receipt has been uploaded and saved"})}})}),m.jsx(Q,{value:"marketing-budget",children:m.jsx(we,{})})]}),m.jsx(Ce,{isOpen:i,onClose:()=>d(!1),onSave:e=>o(void 0,null,function*(){try{if(x){a(s=>s.map(s=>s.id===x.id?c(n({},s),{purchasePrice:e.purchasePrice||s.purchasePrice,sellingPrice:e.finalSalePrice||s.sellingPrice,profitMargin:b(e.purchasePrice||s.purchasePrice,e.finalSalePrice||s.sellingPrice)}):s));const s=localStorage.getItem("carInventory");if(s){const t=JSON.parse(s).map(s=>s.id===x.id?c(n({},s),{purchasePrice:e.purchasePrice||s.purchasePrice,sellingPrice:e.finalSalePrice||s.sellingPrice}):s);localStorage.setItem("carInventory",JSON.stringify(t))}}yield g(x?"UPDATE":"CREATE","FINANCIAL","FINANCIAL_RECORD",`${x?"Updated":"Created"} comprehensive financial record for ${e.entityName}`,{entityId:e.entityId,entityName:e.entityName,metadata:{pageUrl:window.location.href,deviceType:"desktop"}}),P({title:"Financial Data Saved",description:`Comprehensive financial information for ${e.entityName} has been saved successfully.`}),d(!1),j(null)}catch(s){P({title:"Error",description:"Failed to save financial data. Please try again.",variant:"destructive"})}}),initialData:x?{entityId:x.id,entityName:`${x.brand} ${x.model}`,type:"car_sale",date:(new Date).toISOString().split("T")[0],purchasePrice:x.purchasePrice,finalSalePrice:x.sellingPrice,currency:"USD",status:"draft"}:void 0})]})};export{Se as default};
