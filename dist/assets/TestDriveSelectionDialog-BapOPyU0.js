import{a8 as e,j as s,y as t,z as r,E as a,F as l,b as i,e as n,o as c,C as d,g as o,h as m,a as x,am as h,L as u,Y as g,Z as p,_ as j,$ as v,a0 as y,I as N,k as b,n as f,H as w,ab as S,t as C,a9 as D,m as T,W as k}from"./index-BmUpYGrm.js";import{r as P}from"./vendor-vN6PtkFd.js";import"./CarStatusSelectionDialog-BKEPwv76.js";import{B as I}from"./briefcase-BNfZZfKX.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=e("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),F=({isOpen:e,onClose:D,car:T,onScheduleTestDrive:k,isClientTestDrive:F=!1})=>{var L;const O=(()=>{try{const{useAuth:e}=require("@/contexts/AuthContext");return e()}catch(e){return{user:null}}})(),{user:q}=O,[M,B]=P.useState(""),[R,V]=P.useState(""),[$,A]=P.useState(""),[z,H]=P.useState(()=>{const e=new Date;return e.setMinutes(e.getMinutes()+5),e.toISOString().slice(0,16)}),[_,U]=P.useState(!1),[G,W]=P.useState(""),[Y,Z]=P.useState(""),[J,K]=P.useState(""),[Q,X]=P.useState(""),ee=()=>{var e;if(!T)return;if(!M||!R||!$)return void C({title:"Missing Information",description:"Please fill in all required fields.",variant:"destructive"});if(!F&&!Y)return void C({title:"Purpose Required",description:"Please select the purpose for this employee test drive.",variant:"destructive"});const s=_?new Date:new Date(z),t={isOnTestDrive:!0,testDriveStartTime:s.toISOString(),actualStartTime:_?s.toISOString():null,scheduledStartTime:_?null:s.toISOString(),testDriverName:M,testDriverPhone:R,testDriverLicense:$,notes:G,purpose:F?"Customer test drive":Y,isClientTestDrive:F,startMethod:_?"immediate":"scheduled",realTimeCapture:_,loggedBy:(null==q?void 0:q.email)||"System",loggedByName:(null==(e=null==q?void 0:q.user_metadata)?void 0:e.full_name)||(null==q?void 0:q.email)||"System User",loggedAt:(new Date).toISOString(),emergencyContact:J,emergencyContactPhone:Q,vehicleVin:T.vinNumber,vehicleModel:T.model};k(T.id,t);const r=_?"started immediately":"scheduled",a=_?`at ${s.toLocaleTimeString()}`:`for ${s.toLocaleString()}`;C({title:"Test Drive "+(_?"Started":"Scheduled"),description:`${F?"Client":"Employee"} test drive ${r} for ${T.model} with ${M} ${a}`,duration:5e3}),D(),B(""),V(""),A(""),H(()=>{const e=new Date;return e.setMinutes(e.getMinutes()+5),e.toISOString().slice(0,16)}),W(""),Z(""),K(""),X(""),U(!1)};return T?s.jsx(t,{open:e,onOpenChange:D,children:s.jsxs(r,{className:"sm:max-w-[600px] w-[95vw] bg-white car-status-dialog flex flex-col",overlayClassName:"bg-black/30 backdrop-blur-0",style:{height:"85vh",maxHeight:"85vh"},children:[s.jsx(a,{className:"flex-shrink-0 border-b border-gray-200 pb-4",children:s.jsxs(l,{className:"text-center text-lg font-semibold",children:["Schedule ",F?"Client":"Employee"," Test Drive"]})}),s.jsx("div",{className:"flex-1 overflow-y-scroll pr-2 car-status-dialog",style:{height:"calc(85vh - 200px)",minHeight:"400px",scrollbarWidth:"auto",scrollbarColor:"#ffd700 #f8fafc"},children:s.jsxs("div",{className:"space-y-6 mt-4 pb-8",style:{minHeight:"600px",paddingRight:"8px"},children:[s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(i,{className:"h-4 w-4 text-gray-600"}),s.jsx("span",{className:"font-medium text-gray-900",children:"Vehicle Information"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"VIN:"})," ",T.vinNumber]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Model:"})," ",T.model," (",T.year,")"]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Color:"})," ",T.color]}),T.batteryPercentage&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Battery:"})," ",T.batteryPercentage,"%"]})]})]}),s.jsx("div",{className:"flex justify-center",children:s.jsx(n,{variant:F?"default":"outline",className:"px-4 py-2 text-sm "+(F?"bg-blue-100 text-blue-800 border-blue-300":"bg-orange-100 text-orange-800 border-orange-300"),children:F?s.jsxs(s.Fragment,{children:[s.jsx(c,{className:"h-4 w-4 mr-2"}),"Client Test Drive"]}):s.jsxs(s.Fragment,{children:[s.jsx(I,{className:"h-4 w-4 mr-2"}),"Employee Test Drive"]})})}),s.jsxs(d,{className:"bg-blue-50 border-blue-200",children:[s.jsx(o,{className:"pb-2",children:s.jsxs(m,{className:"flex items-center gap-2 text-sm",children:[s.jsx(E,{className:"h-4 w-4 text-blue-600"}),"Test Drive Logged By"]})}),s.jsx(x,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{className:"h-4 w-4 text-blue-600"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-blue-900",children:(null==(L=null==q?void 0:q.user_metadata)?void 0:L.full_name)||(null==q?void 0:q.email)||"System User"}),s.jsx("p",{className:"text-sm text-blue-700",children:(null==q?void 0:q.email)||"System access"}),s.jsxs("p",{className:"text-xs text-blue-600",children:["Logged on ",(new Date).toLocaleString()]})]})]})})]}),!F&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"purpose",children:"Purpose/Reason *"}),s.jsxs(g,{value:Y,onValueChange:Z,children:[s.jsx(p,{id:"purpose",children:s.jsx(j,{placeholder:"Select the purpose for this test drive"})}),s.jsx(v,{children:["Post-repair verification","PDI quality check","Customer delivery preparation","Technical inspection","Performance testing","Battery/charging system test","Brake system verification","General maintenance check","Pre-sale inspection","Other"].map(e=>s.jsx(y,{value:e,children:e},e))})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"font-medium text-gray-900",children:[F?"Client":"Employee"," Information"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(u,{htmlFor:"driverName",children:[F?"Client":"Employee"," Name *"]}),s.jsx(N,{id:"driverName",value:M,onChange:e=>B(e.target.value),placeholder:`Enter ${F?"client":"employee"}'s full name`})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"driverPhone",children:"Phone Number"}),s.jsx(N,{id:"driverPhone",value:R,onChange:e=>V(e.target.value),placeholder:"Enter phone number"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"driverLicense",children:"Driver License Number *"}),s.jsx(N,{id:"driverLicense",value:$,onChange:e=>A(e.target.value),placeholder:"Enter driver's license number"})]}),F&&s.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-yellow-800 mb-3",children:"Emergency Contact Information"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"emergencyContact",children:"Emergency Contact Name"}),s.jsx(N,{id:"emergencyContact",placeholder:"Enter emergency contact name",value:J,onChange:e=>K(e.target.value)})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"emergencyContactPhone",children:"Emergency Contact Phone"}),s.jsx(N,{id:"emergencyContactPhone",placeholder:"Enter emergency contact phone",value:Q,onChange:e=>X(e.target.value)})]})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Test Drive Details"}),s.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg border border-blue-200",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Current Time"}),s.jsx("div",{className:"text-xl font-mono font-bold text-blue-600",children:(new Date).toLocaleTimeString()}),s.jsx("div",{className:"text-xs text-gray-500",children:(new Date).toLocaleDateString()})]}),s.jsxs("div",{className:"p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border-2 border-green-300",children:[s.jsxs("div",{className:"text-center mb-3",children:[s.jsx("div",{className:"text-lg font-bold text-green-800",children:"Ready to Start Test Drive Now?"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Real-time timestamp will be captured instantly"})]}),s.jsxs(b,{onClick:()=>{U(!0),ee()},className:"w-full bg-green-600 hover:bg-green-700 text-white py-4 text-lg font-semibold",disabled:!M||!R||!$||!F&&!Y,children:[s.jsx(f,{className:"h-5 w-5 mr-2"}),"ðŸš— Take Car Now - Real Time Start"]})]}),s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[s.jsxs("div",{className:"text-center mb-3",children:[s.jsx("div",{className:"text-base font-semibold text-gray-700",children:"Or Schedule for Later"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Set a specific start time"})]}),s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"startTime",children:"Scheduled Start Time"}),s.jsx(N,{id:"startTime",type:"datetime-local",value:z,onChange:e=>H(e.target.value),min:(new Date).toISOString().slice(0,16),className:"test-drive-dialog cursor-pointer"}),s.jsxs("p",{className:"text-xs text-gray-500",children:["Scheduled for: ",new Date(z).toLocaleString()]})]})})]}),s.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-700",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsxs("span",{children:[s.jsx("strong",{children:"Duration Tracking:"})," The system automatically calculates actual duration regardless of start method (immediate or scheduled)."]})]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"notes",children:"Additional Notes"}),s.jsx(w,{id:"notes",value:G,onChange:e=>W(e.target.value),placeholder:F?"Any special requirements or notes for the client...":"Specific areas to test or inspect during the drive...",rows:3})]})]}),s.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(f,{className:"h-4 w-4 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"Important Reminders:"}),s.jsxs("ul",{className:"space-y-1 text-xs",children:[s.jsx("li",{children:"â€¢ Verify vehicle has sufficient fuel/battery charge"}),s.jsx("li",{children:"â€¢ Check driver's license validity before departure"}),F?s.jsxs(s.Fragment,{children:[s.jsx("li",{children:"â€¢ Record client information for sales follow-up"}),s.jsx("li",{children:"â€¢ Explain vehicle features during the drive"})]}):s.jsxs(s.Fragment,{children:[s.jsx("li",{children:"â€¢ Focus on the specific inspection purpose"}),s.jsx("li",{children:"â€¢ Document any issues or findings"})]})]})]})]})}),s.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("div",{className:"text-sm text-red-800",children:[s.jsx("p",{className:"font-medium mb-2",children:"ðŸ”’ Safety Requirements:"}),s.jsxs("ul",{className:"space-y-1 text-xs",children:[s.jsx("li",{children:"â€¢ Driver must be 21+ years old with valid license"}),s.jsx("li",{children:"â€¢ Vehicle inspection must be completed before test drive"}),s.jsx("li",{children:"â€¢ Insurance verification required for client test drives"}),s.jsx("li",{children:"â€¢ Emergency contact information is mandatory"}),s.jsx("li",{children:"â€¢ Test drive route must stay within designated areas"}),s.jsx("li",{children:"â€¢ Maximum duration: 60 minutes for clients, 30 minutes for employees"})]})]})}),s.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsx("p",{className:"font-medium mb-2",children:"ðŸ“‹ Legal & Insurance Notes:"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"â€¢ Test driver assumes full responsibility during test drive period"}),s.jsx("li",{children:"â€¢ Any damages during test drive will be charged to the driver"}),s.jsx("li",{children:"â€¢ Dealership insurance covers liability only"}),s.jsx("li",{children:"â€¢ GPS tracking is active during all test drives"}),s.jsx("li",{children:"â€¢ By proceeding, driver agrees to all terms and conditions"})]})]})})]})}),s.jsxs(S,{className:"flex gap-3 mt-6 flex-shrink-0 border-t border-gray-200 pt-4",children:[s.jsx(b,{variant:"outline",onClick:D,className:"flex-1",children:"Cancel"}),s.jsx(b,{onClick:()=>{U(!1),ee()},className:"flex-1 bg-monza-yellow text-monza-black hover:bg-monza-yellow/90 font-semibold",disabled:!M||!R||!$||!F&&!Y,children:"Schedule Test Drive"})]})]})}):null},L=({isOpen:e,onClose:n,onSelectTestDriveType:h,carModel:u,carVin:g})=>s.jsx(t,{open:e,onOpenChange:n,children:s.jsxs(r,{className:"max-w-5xl w-[95vw] max-h-[95vh] overflow-y-auto px-6 py-5",children:[s.jsxs(a,{className:"sticky top-0 bg-white z-10 border-b pb-4",children:[s.jsxs(l,{className:"flex items-center gap-2",children:[s.jsx(i,{className:"h-5 w-5 text-blue-600"}),"Schedule Test Drive"]}),s.jsx(D,{children:u&&g?s.jsxs(s.Fragment,{children:["Choose the type of test drive for ",s.jsx("strong",{children:u})," (VIN: ",g,")"]}):"Choose the type of test drive for this vehicle"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-4 px-1",children:[s.jsxs(d,{className:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-300 rounded-none",children:[s.jsx(o,{className:"pb-3 px-4",children:s.jsxs(m,{className:"flex items-center gap-2 text-lg",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(c,{className:"h-5 w-5 text-blue-600"})}),"Client Test Drive"]})}),s.jsxs(x,{className:"space-y-3 px-4 pb-4",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"For potential customers who want to experience the vehicle before making a purchase decision."}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(T,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Sales opportunity"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(f,{className:"h-4 w-4 text-blue-500"}),s.jsx("span",{children:"Typically 30-60 minutes"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(c,{className:"h-4 w-4 text-purple-500"}),s.jsx("span",{children:"Customer information required"})]})]}),s.jsx(b,{className:"w-full mt-4",onClick:()=>h(!0),children:"Schedule Client Test Drive"})]})]}),s.jsxs(d,{className:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-orange-300 rounded-none",children:[s.jsx(o,{className:"pb-3 px-4",children:s.jsxs(m,{className:"flex items-center gap-2 text-lg",children:[s.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:s.jsx(I,{className:"h-5 w-5 text-orange-600"})}),"Employee Test Drive"]})}),s.jsxs(x,{className:"space-y-3 px-4 pb-4",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"For internal purposes such as post-repair testing, PDI verification, or quality control checks."}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(k,{className:"h-4 w-4 text-orange-500"}),s.jsx("span",{children:"Post-repair verification"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(T,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"PDI quality checks"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(f,{className:"h-4 w-4 text-blue-500"}),s.jsx("span",{children:"Usually 15-30 minutes"})]})]}),s.jsx(b,{variant:"outline",className:"w-full mt-4 border-orange-300 hover:bg-orange-50",onClick:()=>h(!1),children:"Schedule Employee Test Drive"})]})]})]}),s.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-none",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(i,{className:"h-4 w-4 text-gray-500 mt-0.5"}),s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsx("p",{className:"font-medium mb-1",children:"Important Notes:"}),s.jsxs("ul",{className:"space-y-1 text-xs",children:[s.jsx("li",{children:"â€¢ Ensure the vehicle has sufficient fuel/battery charge"}),s.jsx("li",{children:"â€¢ Valid driver's license is required for all test drives"}),s.jsx("li",{children:"â€¢ Employee test drives require manager approval for luxury vehicles"}),s.jsx("li",{children:"â€¢ Client test drives automatically create a sales lead record"})]})]})]})}),s.jsx("div",{className:"flex justify-end mt-4",children:s.jsx(b,{variant:"outline",onClick:n,children:"Cancel"})})]})});export{L as T,F as a};
