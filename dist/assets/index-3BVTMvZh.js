var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,n=(e,n)=>{for(var r in n||(n={}))a.call(n,r)&&s(e,r,n[r]);if(t)for(var r of t(n))i.call(n,r)&&s(e,r,n[r]);return e},r=(e,t,a)=>new Promise((i,s)=>{var n=e=>{try{o(a.next(e))}catch(t){s(t)}},r=e=>{try{o(a.throw(e))}catch(t){s(t)}},o=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,r);o((a=a.apply(e,t)).next())});import{l as o,a1 as l,j as c,Q as d,A as h,k as m,X as u,u as g,p as v,q as p,r as f,v as y,C as x,g as w,h as j,a as b,L as N,I as S,S as _,b as C,e as E,a2 as V,V as I,P,W as D,a3 as O}from"./index-BmUpYGrm.js";import{r as $}from"./vendor-vN6PtkFd.js";import{s as R}from"./errorHandling-Dc1u_gNS.js";import{e as k}from"./ocrUtils-boR-SCDU.js";import{C as T}from"./camera-CKQtJJJ8.js";import{F as M}from"./file-text-bXPYLusF.js";import{A as L}from"./arrow-left-DqrDEplE.js";import{G as F}from"./gauge-Cy8s4FVS.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";import"./index-dUlNy-FG.js";import"./enhancedMonzaBotService-CP3UVEVb.js";const A=(e,t,a,i,s)=>({foundCar:{id:crypto.randomUUID(),vinNumber:e,model:t,color:a,year:i,arrivalDate:(new Date).toISOString(),status:"in_stock",notes:s||"",category:"EV",customs:"not paid",batteryPercentage:50,lastUpdated:(new Date).toISOString(),inShowroom:!1},isNewCar:!0,fromDatabase:!1}),U=()=>{const{toast:e}=o(),[t,a]=$.useState({scanning:!1,manualVIN:"",vehicleCategory:"EV",showDestinationDialog:!1,foundCar:null}),i=e=>{a(t=>n(n({},t),e))},s=(t,a)=>r(void 0,null,function*(){try{const a=(e=>{const t=R("orderedCars",[]),a=t.find(t=>t.vin_number===e);if(a){const i=t.filter(t=>t.vin_number!==e);return localStorage.setItem("orderedCars",JSON.stringify(i)),A(e,a.model,a.color||"Unknown",a.year,`Arrived from order ${a.order_reference}`)}return A(e,"Unknown Model","Unknown",(new Date).getFullYear(),"New arrival - please update details")})(t);if(a.foundCar){if(a.isNewCar){const i=(()=>{try{return!0}catch(e){return!1}})(a.foundCar);e(i?{title:"New VIN Detected",description:`VIN ${t} saved as new arrival. Please specify destination.`}:{title:"VIN Detected",description:`VIN ${t} found but couldn't save to database. Please specify destination.`,variant:"destructive"})}else{const i=a.fromDatabase?"database":"local storage";e({title:"Existing Car Found",description:`VIN ${t} found in ${i}. Current status: ${a.foundCar.status}`})}i({foundCar:a.foundCar,showDestinationDialog:!0})}else e({title:"VIN Processing Failed",description:"Could not process the VIN. Please try again.",variant:"destructive"})}catch(a){e({title:"Processing Error",description:"An error occurred while processing the VIN.",variant:"destructive"})}});return $.useEffect(()=>{const a=a=>{const i=a.detail;/^[A-HJ-NPR-Z0-9]{17}$/i.test(i)?s(i,t.vehicleCategory):e({title:"Invalid VIN Format",description:"The scanned code doesn't appear to be a valid VIN number.",variant:"destructive"})},n=a=>{const n=a.detail,r=n.match(/[A-HJ-NPR-Z0-9]{17}/i);r?s(r[0],t.vehicleCategory):(i({manualVIN:n}),e({title:"Code Scanned",description:"Scanned code has been entered in the manual field. Please verify if it's a valid VIN."}))};return window.addEventListener("vinScanned",a),window.addEventListener("codeScanned",n),()=>{window.removeEventListener("vinScanned",a),window.removeEventListener("codeScanned",n)}},[t.vehicleCategory,e]),{state:t,updateState:i,processVIN:e=>{s(e,t.vehicleCategory)},handleDestinationSelect:a=>{t.foundCar&&(e({title:"Destination Selected",description:`Vehicle ${t.foundCar.vinNumber} routed to ${a}`}),i({showDestinationDialog:!1,foundCar:null,manualVIN:""}))},toast:e}};class H{constructor(e,t,a,i,s){this._legacyCanvasSize=H.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),a&&"object"==typeof a?this._onDecode=t:this._legacyOnDecode=t,t="object"==typeof a?a:{},this._onDecodeError=t.onDecodeError||("function"==typeof a?a:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||("function"==typeof i?i:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||s||this._preferredCamera,this._legacyCanvasSize="number"==typeof a?a:"number"==typeof i?i:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let n=!1;if(e.hidden&&(e.hidden=!1,n=!0),document.body.contains(e)||(document.body.appendChild(e),n=!0),a=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(i=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),(s=this.$overlay.style).position="absolute",s.display="none",s.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!i&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch(r){}a.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let t=window.getComputedStyle(e);"none"===t.display&&(e.style.setProperty("display","block","important"),n=!0),"visible"!==t.visibility&&(e.style.setProperty("visibility","visible","important"),n=!0),n&&(e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=H.createQrEngine()}static set WORKER_PATH(e){}static hasCamera(){return r(this,null,function*(){try{return!!(yield H.listCameras(!1)).length}catch(e){return!1}})}static listCameras(e=!1){return r(this,null,function*(){if(!navigator.mediaDevices)return[];let t,a=()=>r(this,null,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind)});try{e&&(yield a()).every(e=>!e.label)&&(t=yield navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch(i){}try{return(yield a()).map((e,t)=>({id:e.deviceId,label:e.label||(0===t?"Default Camera":`Camera ${t+1}`)}))}finally{t&&H._stopVideoStream(t)}})}hasFlash(){return r(this,null,function*(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(yield this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch(t){return!1}finally{e&&e!==this.$video.srcObject&&H._stopVideoStream(e)}})}isFlashOn(){return this._flashOn}toggleFlash(){return r(this,null,function*(){this._flashOn?yield this.turnFlashOff():yield this.turnFlashOn()})}turnFlashOn(){return r(this,null,function*(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!(yield this.hasFlash()))throw"No flash available";yield this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(e){throw this._flashOn=!1,e}})}turnFlashOff(){return r(this,null,function*(){this._flashOn&&(this._flashOn=!1,yield this._restartVideoStream())})}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),H._postWorkerMessage(this._qrEnginePromise,"close")}start(){return r(this,null,function*(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol,this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)yield this.$video.play();else try{let{stream:e,facingMode:t}=yield this._getCameraStream();!this._active||this._paused?H._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,yield this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(e){if(!this._paused)throw this._active=!1,e}})}stop(){this.pause(),this._active=!1}pause(e=!1){return r(this,null,function*(){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(H._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(yield new Promise(e=>setTimeout(e,300)),!!this._paused&&(t(),!0))})}setCamera(e){return r(this,null,function*(){e!==this._preferredCamera&&(this._preferredCamera=e,yield this._restartVideoStream())})}static scanImage(e,t,a,i,s=!1,n=!1){return r(this,null,function*(){let o,l=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)&&(o=t.scanRegion,a=t.qrEngine,i=t.canvas,s=t.disallowCanvasResizing||!1,n=t.alsoTryWithoutScanRegion||!1,l=!0),t=!!a;try{let c,d,h;if([a,c]=yield Promise.all([a||H.createQrEngine(),H._loadImage(e)]),[i,d]=H._drawToCanvas(c,o,i,s),a instanceof Worker){let e=a;t||H._postWorkerMessageSync(e,"inversionMode","both"),h=yield new Promise((t,a)=>{let s,n,r,l=-1;n=i=>{i.data.id===l&&(e.removeEventListener("message",n),e.removeEventListener("error",r),clearTimeout(s),null!==i.data.data?t({data:i.data.data,cornerPoints:H._convertPoints(i.data.cornerPoints,o)}):a(H.NO_QR_CODE_FOUND))},r=t=>{e.removeEventListener("message",n),e.removeEventListener("error",r),clearTimeout(s),a("Scanner error: "+(t?t.message||t:"Unknown Error"))},e.addEventListener("message",n),e.addEventListener("error",r),s=setTimeout(()=>r("timeout"),1e4);let c=d.getImageData(0,0,i.width,i.height);l=H._postWorkerMessageSync(e,"decode",c,[c.data.buffer])})}else h=yield Promise.race([new Promise((e,t)=>window.setTimeout(()=>t("Scanner error: timeout"),1e4)),(()=>r(this,null,function*(){try{var[t]=yield a.detect(i);if(!t)throw H.NO_QR_CODE_FOUND;return{data:t.rawValue,cornerPoints:H._convertPoints(t.cornerPoints,o)}}catch(r){if(t=r.message||r,/not implemented|service unavailable/.test(t))return H._disableBarcodeDetector=!0,H.scanImage(e,{scanRegion:o,canvas:i,disallowCanvasResizing:s,alsoTryWithoutScanRegion:n});throw`Scanner error: ${t}`}}))()]);return l?h:h.data}catch(c){if(!o||!n)throw c;let t=yield H.scanImage(e,{qrEngine:a,canvas:i,disallowCanvasResizing:s});return l?t:t.data}finally{t||H._postWorkerMessage(a,"close")}})}setGrayscaleWeights(e,t,a,i=!0){H._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:a,useIntegerApproximation:i})}setInversionMode(e){H._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static createQrEngine(e){return r(this,null,function*(){if(e=()=>l(()=>import("./qr-scanner-worker.min-k9yJ__Ac.js"),[]).then(e=>e.createWorker()),H._disableBarcodeDetector||!("BarcodeDetector"in window)||!BarcodeDetector.getSupportedFormats||!(yield BarcodeDetector.getSupportedFormats()).includes("qr_code"))return e();let t=navigator.userAgentData;return t&&t.brands.some(({brand:e})=>/Chromium/i.test(e))&&/mac ?OS/i.test(t.platform)&&(yield t.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:e,platformVersion:t})=>/arm/i.test(e||"arm")&&13<=parseInt(t||"13")).catch(()=>!0))?e():new BarcodeDetector({formats:["qr_code"]})})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(2/3*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,a=e.videoHeight,i=e.offsetWidth,s=e.offsetHeight,n=e.offsetLeft,r=e.offsetTop,o=window.getComputedStyle(e),l=o.objectFit,c=t/a,d=i/s;switch(l){case"none":var h=t,m=a;break;case"fill":h=i,m=s;break;default:("cover"===l?c>d:c<d)?h=(m=s)*c:m=(h=i)/c,"scale-down"===l&&(h=Math.min(h,t),m=Math.min(m,a))}var[u,g]=o.objectPosition.split(" ").map((e,t)=>{const a=parseFloat(e);return e.endsWith("%")?(t?s-m:i-h)*a/100:a});o=this._scanRegion.width||t,d=this._scanRegion.height||a,l=this._scanRegion.x||0;var v=this._scanRegion.y||0;(c=this.$overlay.style).width=o/t*h+"px",c.height=d/a*m+"px",c.top=`${r+g+v/a*m}px`,a=/scaleX\(-1\)/.test(e.style.transform),c.left=`${n+(a?i-u-h:u)+(a?t-l-o:l)/t*h}px`,c.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let a=t.x||0,i=t.y||0,s=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;for(let n of e)n.x=n.x*s+a,n.y=n.y*t+i;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(()=>r(this,null,function*(){if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&(yield new Promise(a=>setTimeout(a,t-e))),this._lastScanTimestamp=Date.now();try{var a=yield H.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(i){if(!this._active)return;this._onDecodeError(i)}!H._disableBarcodeDetector||(yield this._qrEnginePromise)instanceof Worker||(this._qrEnginePromise=H.createQrEngine()),a?(this._onDecode?this._onDecode(a):this._legacyOnDecode&&this._legacyOnDecode(a.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",a.cornerPoints.map(({x:e,y:t})=>`${e},${t}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()}))}_onDecodeError(e){H.NO_QR_CODE_FOUND}_getCameraStream(){return r(this,null,function*(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}],a=t.map(t=>Object.assign({},t,{[e]:{exact:this._preferredCamera}}));for(let s of[...a,...t])try{let e=yield navigator.mediaDevices.getUserMedia({video:s,audio:!1});return{stream:e,facingMode:this._getFacingMode(e)||(s.facingMode?this._preferredCamera:"environment"===this._preferredCamera?"user":"environment")}}catch(i){}throw"Camera not found."})}_restartVideoStream(){return r(this,null,function*(){let e=this._paused;(yield this.pause(!0))&&!e&&this._active&&(yield this.start())})}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+("user"===e?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,a,i=!1){a=a||document.createElement("canvas");let s=t&&t.x?t.x:0,n=t&&t.y?t.y:0,r=t&&t.width?t.width:e.videoWidth||e.width,o=t&&t.height?t.height:e.videoHeight||e.height;return i||(i=t&&t.downScaledWidth?t.downScaledWidth:r,t=t&&t.downScaledHeight?t.downScaledHeight:o,a.width!==i&&(a.width=i),a.height!==t&&(a.height=t)),(t=a.getContext("2d",{alpha:!1})).imageSmoothingEnabled=!1,t.drawImage(e,s,n,r,o,0,0,a.width,a.height),[a,t]}static _loadImage(e){return r(this,null,function*(){if(e instanceof Image)return yield H._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(!(e instanceof File||e instanceof Blob||e instanceof URL||"string"==typeof e))throw"Unsupported image type.";{let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return yield H._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}})}static _awaitImageLoad(e){return r(this,null,function*(){e.complete&&0!==e.naturalWidth||(yield new Promise((t,a)=>{let i=s=>{e.removeEventListener("load",i),e.removeEventListener("error",i),s instanceof ErrorEvent?a("Image load error"):t()};e.addEventListener("load",i),e.addEventListener("error",i)}))})}static _postWorkerMessage(e,t,a,i){return r(this,null,function*(){return H._postWorkerMessageSync(yield e,t,a,i)})}static _postWorkerMessageSync(e,t,a,i){if(!(e instanceof Worker))return-1;let s=H._workerMessageId++;return e.postMessage({id:s,type:t,data:a},i),s}}H.DEFAULT_CANVAS_SIZE=400,H.NO_QR_CODE_FOUND="No QR code found",H._disableBarcodeDetector=!1,H._workerMessageId=0;const W=({scanning:e,onStartScanner:t,onStopScanner:a,toast:i})=>{const s=$.useRef(null),n=$.useRef(null),[o,l]=$.useState(null),[g,v]=$.useState(null),[p,f]=$.useState(!1),[y,x]=$.useState(!1),[w,j]=$.useState(null),[b,N]=$.useState(null),[S,_]=$.useState(!1);$.useEffect(()=>{r(void 0,null,function*(){try{const e=yield navigator.permissions.query({name:"camera"});N("granted"===e.state),e.addEventListener("change",()=>{N("granted"===e.state)})}catch(e){N(null)}})},[]);const C=e=>{const t=/^[A-HJ-NPR-Z0-9]{17}$/i.test(e);t?(i({title:"VIN Detected!",description:`Scanned VIN: ${e}`}),window.dispatchEvent(new CustomEvent("vinScanned",{detail:e}))):(i({title:"Code Detected",description:`Scanned: ${e}`}),window.dispatchEvent(new CustomEvent("codeScanned",{detail:e})));const a=(new Date).toISOString(),s=R("scanResults",[]);s.push({id:Date.now().toString(),data:e,timestamp:a,type:t?"vin":"general"}),localStorage.setItem("scanResults",JSON.stringify(s))},E=()=>{if(s.current&&s.current.srcObject){s.current.srcObject.getTracks().forEach(e=>{e.stop()}),s.current.srcObject=null,a(),l(null)}g&&(g.stop(),g.destroy(),v(null),f(!1)),j(null),_(!1)};return $.useEffect(()=>()=>{E()},[]),c.jsxs("div",{className:"bg-white rounded-lg border shadow-sm p-4 md:p-6",children:[c.jsxs("div",{className:"text-center mb-4 md:mb-6",children:[c.jsx(d,{className:"mx-auto h-8 w-8 md:h-12 md:w-12 text-primary mb-2"}),c.jsx("h2",{className:"text-lg md:text-xl font-semibold",children:"Camera Scanner"}),c.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Use your device camera to scan VIN numbers or capture photos for OCR text extraction"})]}),w&&c.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md flex items-start gap-2",children:[c.jsx(h,{className:"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0"}),c.jsxs("div",{className:"text-sm text-red-700",children:[c.jsx("p",{className:"font-medium",children:"Camera Error"}),c.jsx("p",{children:w}),!1===b&&c.jsx("p",{className:"mt-1 text-xs",children:"Please check your browser settings and allow camera access for this site."})]})]}),c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsxs("div",{className:"w-full aspect-video bg-slate-100 rounded-md overflow-hidden mb-4 relative",children:[c.jsx("video",{ref:s,className:"w-full h-full object-cover",playsInline:!0,muted:!0,autoPlay:!0,style:{display:"block"}}),!e&&c.jsxs("div",{className:"flex items-center justify-center h-full flex-col gap-2",children:[c.jsx(T,{className:"h-8 w-8 md:h-12 md:w-12 text-muted-foreground opacity-30"}),c.jsx("p",{className:"text-xs text-muted-foreground text-center px-4",children:S?"Starting camera...":!1===b?"Camera permission required":"Click 'Start Camera' to begin scanning"})]}),e&&p&&c.jsx("div",{className:"absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded text-xs",children:"Scanning..."}),o&&c.jsx("div",{className:"absolute top-2 right-2 w-16 h-16 md:w-20 md:h-20 border-2 border-white rounded-md overflow-hidden",children:c.jsx("img",{src:o,alt:"Captured VIN",className:"w-full h-full object-cover"})}),c.jsx("canvas",{ref:n,className:"hidden"})]}),c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full",children:[c.jsx(m,{onClick:e?E:()=>r(void 0,null,function*(){if(_(!0),j(null),yield new Promise(e=>setTimeout(e,100)),!s.current)return j("Camera interface not ready. Please try again."),_(!1),void i({title:"Camera error",description:"Camera interface not ready. Please try again.",variant:"destructive"});try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported on this device or browser");let o,l={video:{facingMode:"environment"}};try{o=yield navigator.mediaDevices.getUserMedia(l)}catch(e){l={video:{facingMode:"user"}};try{o=yield navigator.mediaDevices.getUserMedia(l)}catch(a){l={video:!0},o=yield navigator.mediaDevices.getUserMedia(l)}}if(!o)throw new Error("Failed to get camera stream");const c=s.current;if(!c)throw new Error("Video element became unavailable");c.srcObject=o,yield new Promise((e,t)=>{c.onloadedmetadata=()=>{e(!0)},c.onerror=e=>{t(new Error("Failed to load video"))},setTimeout(()=>{t(new Error("Video loading timeout"))},1e4)});try{yield c.play()}catch(n){throw new Error("Failed to start video playback")}t(),N(!0),_(!1);try{const e=new H(c,e=>{C(e.data)},{highlightScanRegion:!0,highlightCodeOutline:!0,preferredCamera:"environment",maxScansPerSecond:2});v(e),yield e.start(),f(!0)}catch(r){}i({title:"Camera activated",description:"Point your camera at a VIN number or capture a photo for OCR text extraction."})}catch(o){_(!1);let e="Could not access the camera.";"NotAllowedError"===o.name?(e="Camera permission denied. Please allow camera access and try again.",N(!1)):"NotFoundError"===o.name?e="No camera found on this device.":"NotSupportedError"===o.name?e="Camera not supported on this browser.":o.message&&(e=o.message),j(e),i({title:"Camera error",description:e,variant:"destructive"})}}),variant:e?"destructive":"default",className:"flex-1 text-sm md:text-base",disabled:y||S,children:S?"Starting Camera...":e?"Stop Camera":"Start Camera"}),e&&c.jsxs(m,{onClick:()=>{if(!s.current||!n.current)return void i({title:"Camera not ready",description:"Please ensure the camera is active before capturing.",variant:"destructive"});const e=s.current,t=n.current,a=t.getContext("2d");if(!a)return void i({title:"Canvas error",description:"Unable to capture photo. Please try again.",variant:"destructive"});t.width=e.videoWidth,t.height=e.videoHeight,a.drawImage(e,0,0,t.width,t.height);const r=t.toDataURL("image/jpeg",.9);l(r);const o=(new Date).toISOString(),c=R("vinPhotos",[]);c.push({id:Date.now().toString(),photo:r,timestamp:o,type:"vin"}),localStorage.setItem("vinPhotos",JSON.stringify(c)),i({title:"Photo captured",description:"VIN photo captured! Click 'Extract VIN' to read the text using OCR, or 'Clear Photo' to retake."})},variant:"secondary",className:"flex-1 text-sm md:text-base",disabled:y,children:[c.jsx(T,{className:"mr-2 h-4 w-4"}),"Capture Photo"]})]}),o&&c.jsxs("div",{className:"w-full flex flex-col sm:flex-row gap-2 mt-2",children:[c.jsxs(m,{onClick:()=>r(void 0,null,function*(){if(o){x(!0);try{i({title:"Processing...",description:"Extracting text from image using OCR. This may take a few seconds."});const e=yield k(o);if(e&&e.length>=5){const t=/[A-HJ-NPR-Z0-9]{17}/g,a=e.match(t);if(a&&a.length>0){const e=a[0];i({title:"VIN Extracted Successfully!",description:`Found VIN: ${e}`}),window.dispatchEvent(new CustomEvent("vinScanned",{detail:e}))}else{const t=e.replace(/\s+/g,"").toUpperCase();i({title:"Text Extracted",description:`Extracted: ${t}. Please verify if this is correct.`}),window.dispatchEvent(new CustomEvent("codeScanned",{detail:t}))}const s=(new Date).toISOString(),n=R("ocrResults",[]);n.push({id:Date.now().toString(),extractedText:e,timestamp:s,photo:o,type:a?"vin":"text"}),localStorage.setItem("ocrResults",JSON.stringify(n))}else i({title:"No text found",description:"Could not extract readable text from the image. Try capturing a clearer, well-lit photo with the VIN clearly visible.",variant:"destructive"})}catch(e){i({title:"OCR Error",description:e.message||"Failed to extract text from image. Please try again or enter VIN manually.",variant:"destructive"})}finally{x(!1)}}else i({title:"No photo",description:"Please capture a photo first.",variant:"destructive"})}),disabled:y,className:"flex-1 text-sm md:text-base bg-blue-600 hover:bg-blue-700",children:[c.jsx(M,{className:"mr-2 h-4 w-4"}),y?"Extracting VIN...":"Extract VIN with OCR"]}),c.jsxs(m,{onClick:()=>{l(null),i({title:"Photo cleared",description:"Photo cleared. You can now capture a new photo."})},disabled:y,variant:"outline",className:"flex-1 text-sm md:text-base",children:[c.jsx(u,{className:"mr-2 h-4 w-4"}),"Clear Photo"]})]}),e&&c.jsx("p",{className:"text-xs text-muted-foreground mt-2 text-center",children:"Position a VIN clearly in the camera view for automatic scanning, or capture a photo for OCR text extraction"})]})]})};const B=new class{constructor(){var e;s(this,"symbol"!=typeof(e="vinDatabase")?e+"":e,new Map),this.initializeVINDatabase()}initializeVINDatabase(){[["LVGBB22E",{make:"Voyah",model:"FREE",manufacturer:"Dongfeng Motor Corporation",country:"China",bodyStyle:"SUV",engineType:"Range Extended Electric",fuelType:"Hybrid",category:"REV",transmission:"Single-Speed Automatic",driveType:"AWD",estimatedPrice:85e3,specifications:{horsePower:510,torque:1040,topSpeed:200,acceleration:"4.4s",range:860,batteryCapacity:88,chargingTime:"30min (10-80%)"},features:["Air Suspension","Panoramic Roof","Premium Audio System","Advanced Driver Assistance"],colors:{exterior:["Pearl White","Midnight Black","Space Silver","Aurora Blue","Ruby Red"],interior:["Black","Beige","Brown"]}}],["LVGBB22D",{make:"Voyah",model:"DREAM",manufacturer:"Dongfeng Motor Corporation",country:"China",bodyStyle:"Sedan",engineType:"Pure Electric",fuelType:"Electric",category:"EV",transmission:"Single-Speed Automatic",driveType:"RWD",estimatedPrice:125e3,specifications:{horsePower:520,torque:820,topSpeed:200,acceleration:"3.8s",range:605,batteryCapacity:108,chargingTime:"28min (10-80%)"},features:["Executive Seating Package","Massage Seats","Premium Sound System","Advanced Autopilot"],colors:{exterior:["Phantom Black","Pearl White","Champagne Gold","Deep Blue"],interior:["Black","White","Brown","Red"]}}]].forEach(([e,t])=>{this.vinDatabase.set(e,t)})}decodeVIN(e){return r(this,null,function*(){try{const t=this.validateAndCleanVIN(e);if(!t)throw new Error("Invalid VIN format");const a=this.extractBasicVINInfo(t),i=this.findSpecificVehicleData(t);return n({vin:t,make:(null==i?void 0:i.make)||"Unknown",model:(null==i?void 0:i.model)||"Unknown Model",year:a.year,bodyStyle:(null==i?void 0:i.bodyStyle)||"Unknown",engineType:(null==i?void 0:i.engineType)||"Unknown",fuelType:(null==i?void 0:i.fuelType)||"Gasoline",transmission:(null==i?void 0:i.transmission)||"Unknown",driveType:(null==i?void 0:i.driveType)||"Unknown",country:(null==i?void 0:i.country)||a.country,manufacturer:(null==i?void 0:i.manufacturer)||"Unknown",category:(null==i?void 0:i.category)||"ICEV"},i)}catch(t){return null}})}validateAndCleanVIN(e){const t=e.toUpperCase().replace(/[^A-HJ-NPR-Z0-9]/g,"");return 17!==t.length||/[IOQ]/.test(t)?null:t}extractBasicVINInfo(e){const t=e.charAt(0),a=e.charAt(9),i=parseInt(a);let s={A:2010,B:2011,C:2012,D:2013,E:2014,F:2015,G:2016,H:2017,J:2018,K:2019,L:2020,M:2021,N:2022,P:2023,R:2024,S:2025,T:2026,V:2027,W:2028,X:2029,Y:2030}[a]||(new Date).getFullYear();return isNaN(i)||i>=1&&i<=9&&(s=2001+i-1),{country:{1:"USA",2:"Canada",3:"Mexico",J:"Japan",K:"South Korea",L:"China",V:"France",W:"Germany",Z:"Italy"}[t]||"Unknown",year:s}}findSpecificVehicleData(e){for(const[t,a]of this.vinDatabase.entries())if(e.startsWith(t))return a;return e.startsWith("5YJ")?{make:"Tesla",manufacturer:"Tesla Inc.",country:"USA",fuelType:"Electric",category:"EV",engineType:"Electric Motor"}:null}getVINPattern(e){return e.length<8?"Unknown":e.substring(0,8)}isElectricVehicle(e){const t=this.findSpecificVehicleData(e);return"EV"===(null==t?void 0:t.category)||"Electric"===(null==t?void 0:t.fuelType)}isHybridVehicle(e){const t=this.findSpecificVehicleData(e);return"REV"===(null==t?void 0:t.category)||"Hybrid"===(null==t?void 0:t.fuelType)}},q=()=>{var e,t,a,i;const s=g(),{state:n,updateState:o,processVIN:l,handleDestinationSelect:h,toast:u}=U(),[R,k]=$.useState(!1),[M,A]=$.useState(null),[H,q]=$.useState(!1),z=e=>r(void 0,null,function*(){q(!0);try{const t=yield B.decodeVIN(e);t?(A(t),u({title:"VIN Decoded Successfully!",description:`${t.year} ${t.make} ${t.model} detected`})):(A(null),u({title:"VIN Decoded",description:"Basic VIN information processed"})),l(e)}catch(t){u({title:"Processing Error",description:"An error occurred while processing the VIN.",variant:"destructive"})}finally{q(!1)}});$.useEffect(()=>{const e=e=>{const t=e.detail;o({manualVIN:t}),z(t)},t=e=>{const t=e.detail;o({manualVIN:t}),17===t.length&&z(t)};return window.addEventListener("vinScanned",e),window.addEventListener("codeScanned",t),()=>{window.removeEventListener("vinScanned",e),window.removeEventListener("codeScanned",t)}},[]);const J=[{id:"inventory",name:"Car Inventory",description:"Add to main inventory system",icon:P,color:"bg-blue-500"},{id:"showroom",name:"Showroom Display",description:"Move to showroom for display",icon:C,color:"bg-green-500"},{id:"garage",name:"Garage/Repairs",description:"Send to garage for maintenance",icon:D,color:"bg-orange-500"}];return c.jsxs("div",{className:"container mx-auto py-4 md:py-6 px-4 max-w-6xl",children:[c.jsxs("div",{className:"flex items-center mb-6",children:[c.jsxs(m,{variant:"outline",size:"sm",className:"mr-4",onClick:()=>s(-1),children:[c.jsx(L,{className:"mr-1 h-4 w-4"}),"Back"]}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Scan VIN"}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Scan vehicle identification numbers to route vehicles to different locations"})]})]}),c.jsxs(v,{defaultValue:"manual",className:"space-y-6",children:[c.jsxs(p,{className:"grid w-full grid-cols-2",children:[c.jsx(f,{value:"manual",children:"Manual Entry"}),c.jsx(f,{value:"camera",children:"OCR Camera"})]}),c.jsx(y,{value:"manual",children:c.jsxs(x,{children:[c.jsx(w,{children:c.jsxs(j,{className:"flex items-center gap-2",children:[c.jsx(d,{className:"h-5 w-5 text-monza-yellow"}),"Enter Vehicle VIN"]})}),c.jsx(b,{children:c.jsxs("form",{onSubmit:e=>r(void 0,null,function*(){e.preventDefault(),n.manualVIN.trim().length<5?u({title:"Invalid VIN",description:"Please enter a valid VIN number.",variant:"destructive"}):yield z(n.manualVIN.trim())}),className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(N,{htmlFor:"vin",className:"text-sm font-medium",children:"VIN Number"}),c.jsx(S,{id:"vin",type:"text",value:n.manualVIN,onChange:e=>o({manualVIN:e.target.value.toUpperCase()}),placeholder:"e.g., 1HGCM82633A123456",className:"w-full h-12 text-base",maxLength:17}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the full 17-character Vehicle Identification Number"})]}),c.jsxs(m,{type:"submit",className:"w-full h-12 bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",disabled:H,children:[c.jsx(_,{className:"mr-2 h-4 w-4"}),H?"Processing VIN...":"Find Vehicle"]})]})})]})}),c.jsx(y,{value:"camera",children:c.jsxs(x,{children:[c.jsx(w,{children:c.jsxs(j,{className:"flex items-center gap-2",children:[c.jsx(T,{className:"h-5 w-5 text-blue-600"}),"OCR Camera Scanner"]})}),c.jsx(b,{children:c.jsx(W,{scanning:R,onStartScanner:()=>k(!0),onStopScanner:()=>k(!1),toast:u})})]})})]}),M&&c.jsxs(x,{className:"mb-6",children:[c.jsx(w,{children:c.jsxs(j,{className:"flex items-center gap-2",children:[c.jsx(C,{className:"h-5 w-5 text-blue-600"}),"Detailed Vehicle Information"]})}),c.jsx(b,{children:c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:"Basic Information"}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"VIN:"}),c.jsx("p",{className:"font-mono text-sm",children:M.vin})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Make:"}),c.jsx("p",{className:"font-semibold",children:M.make})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Model:"}),c.jsx("p",{className:"font-semibold",children:M.model})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Year:"}),c.jsx("p",{children:M.year})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Body Style:"}),c.jsx("p",{children:M.bodyStyle})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Category:"}),c.jsxs("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"EV":return c.jsx(O,{className:"h-4 w-4 text-green-600"});case"REV":return c.jsx(F,{className:"h-4 w-4 text-blue-600"});case"ICEV":return c.jsx(C,{className:"h-4 w-4 text-gray-600"});default:return c.jsx(C,{className:"h-4 w-4"})}})(M.category),c.jsx(E,{variant:"outline",children:M.category})]})]})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:"Technical Specifications"}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Engine Type:"}),c.jsx("p",{children:M.engineType})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Fuel Type:"}),c.jsx("p",{children:M.fuelType})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Transmission:"}),c.jsx("p",{children:M.transmission})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Drive Type:"}),c.jsx("p",{children:M.driveType})]}),(null==(e=M.specifications)?void 0:e.horsePower)&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Power:"}),c.jsxs("p",{children:[M.specifications.horsePower," HP"]})]}),(null==(t=M.specifications)?void 0:t.range)&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Range:"}),c.jsxs("p",{children:[M.specifications.range," km"]})]})]})]}),M.estimatedPrice&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:"Pricing Information"}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Estimated Price:"}),c.jsxs("p",{className:"font-bold text-lg text-green-600",children:["$",M.estimatedPrice.toLocaleString()]})]})]}),M.features&&M.features.length>0&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:"Features"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:M.features.map((e,t)=>c.jsx(E,{variant:"secondary",className:"text-xs",children:e},t))})]}),M.colors&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:"Available Colors"}),c.jsx("div",{className:"space-y-2",children:c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Exterior:"}),c.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:null==(a=M.colors.exterior)?void 0:a.map((e,t)=>c.jsxs(E,{variant:"outline",className:"text-xs",children:[c.jsx(V,{className:"h-3 w-3 mr-1"}),e]},t))})]})})]})]})})]}),n.foundCar&&c.jsxs(x,{className:"mb-6",children:[c.jsx(w,{children:c.jsxs(j,{className:"flex items-center gap-2",children:[c.jsx(C,{className:"h-5 w-5 text-blue-600"}),"Current Vehicle Status"]})}),c.jsx(b,{children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"VIN:"}),c.jsx("p",{className:"font-mono text-sm",children:n.foundCar.vinNumber})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Model:"}),c.jsx("p",{className:"font-semibold",children:n.foundCar.model})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Year:"}),c.jsx("p",{children:n.foundCar.year})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Color:"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:null==(i=n.foundCar.color)?void 0:i.toLowerCase()}}),c.jsx("p",{children:n.foundCar.color})]})]})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Category:"}),c.jsx(E,{variant:"outline",className:"ml-2",children:n.foundCar.category})]}),c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Status:"}),c.jsx(E,{className:`ml-2 ${Q=n.foundCar.status,{in_stock:"bg-green-100 text-green-800",sold:"bg-red-100 text-red-800",reserved:"bg-yellow-100 text-yellow-800"}[Q]||"bg-gray-100 text-gray-800"}`,children:"in_stock"===n.foundCar.status?"Available":n.foundCar.status.toUpperCase()})]}),n.foundCar.batteryPercentage&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Battery:"}),c.jsxs("p",{children:[n.foundCar.batteryPercentage,"%"]})]}),n.foundCar.currentFloor&&c.jsxs("div",{children:[c.jsx("span",{className:"font-medium text-gray-600",children:"Current Location:"}),c.jsx(E,{variant:"secondary",className:"ml-2",children:n.foundCar.currentFloor})]})]})]})})]}),n.foundCar&&c.jsxs(x,{children:[c.jsx(w,{children:c.jsxs(j,{className:"flex items-center gap-2",children:[c.jsx(I,{className:"h-5 w-5 text-green-600"}),"Choose Destination"]})}),c.jsx(b,{children:c.jsx("div",{className:"grid grid-cols-1 gap-3",children:J.map(e=>{const t=e.icon;return c.jsxs(m,{variant:"outline",className:"h-auto p-4 justify-start hover:bg-gray-50 border-2 hover:border-monza-yellow",onClick:()=>h(e.name),children:[c.jsx("div",{className:`w-10 h-10 rounded-full ${e.color} flex items-center justify-center mr-4`,children:c.jsx(t,{className:"h-5 w-5 text-white"})}),c.jsxs("div",{className:"text-left",children:[c.jsx("div",{className:"font-medium",children:e.name}),c.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})]},e.id)})})})]})]});var Q};export{q as default};
