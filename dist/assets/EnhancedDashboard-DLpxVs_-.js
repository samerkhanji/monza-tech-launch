import{s as e,j as s,C as a,a as t,A as r,b as l,W as n,T as o,c as i,d as c,D as d,B as m,e as x,f as u,P as h,g,h as p,U as j}from"./index-BmUpYGrm.js";import{r as v}from"./vendor-vN6PtkFd.js";import{T as N}from"./target-dshlZX_X.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";function w(){var w,f,S,k,T;const D={name:"Samer"},[I,A]=v.useState(null),[M,U]=v.useState([]),[O,F]=v.useState([]),[P,q]=v.useState([]),[J,C]=v.useState([]),[E,R]=v.useState([]),[H,L]=v.useState(!0),[$,B]=v.useState(null);v.useEffect(()=>{G()},[]);const G=()=>{return s=this,a=null,t=function*(){try{L(!0),B(null);try{const[{data:s,error:a},{data:t,error:r},{data:l,error:n},{data:o,error:i},{data:c,error:d},{data:m,error:x}]=yield Promise.all([e.from("view_dashboard_kpis").select("*").single(),e.from("view_inventory_by_model").select("*"),e.from("view_garage_backlog").select("*"),e.from("view_today_schedule").select("*"),e.from("view_sales_pipeline").select("*"),e.from("view_parts_low_stock").select("*")]);if(!(a||r||n||i||d||x))return s&&A(s),U(t||[]),F(l||[]),q(o||[]),C(c||[]),void R(m||[])}catch(s){}const a=(()=>{try{return JSON.parse(localStorage.getItem("carInventory")||"[]"),JSON.parse(localStorage.getItem("garageSchedule")||"[]"),JSON.parse(localStorage.getItem("repairHistory")||"[]"),JSON.parse(localStorage.getItem("testDrives")||"[]"),JSON.parse(localStorage.getItem("clientRequests")||"[]"),JSON.parse(localStorage.getItem("sales")||"[]"),(new Date).toISOString().split("T")[0],new Date(Date.now()-6048e5),(new Date).getMonth(),(new Date).getFullYear(),{data:{inventory_total:0,garage_active:0,avg_repair_hours_7d:0,test_drives_today:0,open_urgent:0,open_medium:0,open_low:0,won_this_month:0},error:null}}catch($){return{data:null,error:"Failed to calculate KPIs"}}})(),t=(()=>{try{return{data:[],error:null}}catch($){return{data:[],error:"Failed to get inventory data"}}})(),r=(()=>{try{return{data:[],error:null}}catch($){return{data:[],error:"Failed to get garage backlog"}}})(),l=(()=>{try{return{data:[],error:null}}catch($){return{data:[],error:"Failed to get schedule"}}})(),n=(()=>{try{return{data:[],error:null}}catch($){return{data:[],error:"Failed to get sales data"}}})(),o=(()=>{try{return{data:[],error:null}}catch($){return{data:[],error:"Failed to get parts data"}}})();a.data&&A(a.data),U(t.data),F(r.data),q(l.data),C(n.data),R(o.data)}catch(a){B("Failed to load dashboard data")}finally{L(!1)}},new Promise((e,r)=>{var l=e=>{try{o(t.next(e))}catch(s){r(s)}},n=e=>{try{o(t.throw(e))}catch(s){r(s)}},o=s=>s.done?e(s.value):Promise.resolve(s.value).then(l,n);o((t=t.apply(s,a)).next())});var s,a,t};if(H)return s.jsx("div",{className:"p-6",children:s.jsx("div",{className:"animate-pulse space-y-6",children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 xl:grid-cols-6 gap-4",children:[...Array(6)].map((e,a)=>s.jsx("div",{className:"h-24 bg-gray-200 rounded-lg"},a))})})});if($)return s.jsx("div",{className:"p-6",children:s.jsx(a,{className:"border-red-200 bg-red-50",children:s.jsx(t,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(r,{className:"h-5 w-5 text-red-500"}),s.jsx("span",{className:"text-red-700",children:$})]})})})});const K=(null!=(w=null==I?void 0:I.open_urgent)?w:0)+(null!=(f=null==I?void 0:I.open_medium)?f:0)+(null!=(S=null==I?void 0:I.open_low)?S:0);return s.jsxs("div",{className:"p-3 sm:p-6 space-y-4 sm:space-y-6",children:[s.jsx("div",{className:"mb-4 sm:mb-6",children:s.jsxs("div",{children:[s.jsxs("h1",{className:"text-xl sm:text-3xl font-bold text-gray-900",children:["Welcome back, ",null==D?void 0:D.name,"!"]}),s.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Here's what's happening at Monza TECH today."})]})}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 sm:gap-4",children:[s.jsx(y,{title:"Inventory",value:null==I?void 0:I.inventory_total,icon:s.jsx(l,{className:"h-5 w-5"}),color:"blue"}),s.jsx(y,{title:"Garage Active",value:null==I?void 0:I.garage_active,icon:s.jsx(n,{className:"h-5 w-5"}),color:"orange"}),s.jsx(y,{title:"Avg Repair (7d)",value:`${null!=(k=null==I?void 0:I.avg_repair_hours_7d)?k:0}h`,icon:s.jsx(o,{className:"h-5 w-5"}),color:"green"}),s.jsx(y,{title:"Test Drives Today",value:null==I?void 0:I.test_drives_today,icon:s.jsx(i,{className:"h-5 w-5"}),color:"purple"}),s.jsx(y,{title:"Open Requests",value:K,icon:s.jsx(c,{className:"h-5 w-5"}),color:K>5?"red":"yellow",subtitle:`${null!=(T=null==I?void 0:I.open_urgent)?T:0} urgent`}),s.jsx(y,{title:"Sales (This Month)",value:null==I?void 0:I.won_this_month,icon:s.jsx(d,{className:"h-5 w-5"}),color:"green"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[s.jsx(b,{title:"Inventory by Model",icon:s.jsx(m,{className:"h-5 w-5"}),columns:["Model","Trim","Total","S1","S2"],rows:M.map(e=>[e.model||"Unknown",e.trim||"-",e.qty,e.showroom1,e.showroom2])}),s.jsx(b,{title:"Garage Backlog (Next 10)",icon:s.jsx(n,{className:"h-5 w-5"}),columns:["VIN","Model","Status","Assigned","ETA","SLA"],rows:O.map(e=>{var a;return[(null==(a=e.vin)?void 0:a.slice(-6))||"Unknown",e.model||"Unknown",e.status,e.assigned_to||"-",e.eta_finish?new Date(e.eta_finish).toLocaleDateString():"-",e.sla_breached?s.jsx(x,{variant:"destructive",className:"text-xs",children:"BREACHED"}):s.jsx(x,{variant:"secondary",className:"text-xs",children:"OK"})]})}),s.jsx(b,{title:"Today's Schedule",columns:["Type","Customer","Model","Time"],rows:P.map(e=>[s.jsx(x,{variant:"Test Drive"===e.type?"default":"Delivery"===e.type?"secondary":"outline",className:"text-xs",children:e.type},e.type),e.customer_name||"Unknown",e.model||"Unknown",e.at_time?new Date(e.at_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"-"])}),s.jsx(b,{title:"Sales Pipeline",icon:s.jsx(u,{className:"h-5 w-5"}),columns:["Stage","Quantity"],rows:J.map(e=>[e.status||"Unknown",s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"mr-2",children:e.qty}),s.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${Math.min(100,e.qty/Math.max(...J.map(e=>e.qty))*100)}%`}})})]},e.status)])}),s.jsx(b,{title:"Low-Stock Parts Alert",icon:s.jsx(h,{className:"h-5 w-5"}),columns:["Part #","Name","Stock","Min"],rows:E.map(e=>[e.part_number||"Unknown",e.name||"Unknown",s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"mr-2 "+(0===e.in_stock?"text-red-600 font-bold":e.in_stock<=e.min_level?"text-yellow-600":""),children:e.in_stock}),0===e.in_stock&&s.jsx(r,{className:"h-4 w-4 text-red-500"})]},e.id),e.min_level])})]}),s.jsxs(a,{className:"rounded-2xl shadow-sm",children:[s.jsx(g,{children:s.jsxs(p,{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-5 w-5"}),"Quick Actions"]})}),s.jsx(t,{children:s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[s.jsx(_,{title:"Add New Car",href:"/car-inventory",icon:s.jsx(l,{className:"h-6 w-6"})}),s.jsx(_,{title:"Schedule Service",href:"/garage-schedule",icon:s.jsx(n,{className:"h-6 w-6"})}),s.jsx(_,{title:"View Reports",href:"/reports",icon:s.jsx(m,{className:"h-6 w-6"})}),s.jsx(_,{title:"Manage Users",href:"/user-management",icon:s.jsx(j,{className:"h-6 w-6"})})]})})]})]})}function y({title:e,value:r,icon:l,color:n="blue",subtitle:o}){const i={blue:"border-blue-200 bg-blue-50 text-blue-700",green:"border-green-200 bg-green-50 text-green-700",orange:"border-orange-200 bg-orange-50 text-orange-700",purple:"border-purple-200 bg-purple-50 text-purple-700",red:"border-red-200 bg-red-50 text-red-700",yellow:"border-yellow-200 bg-yellow-50 text-yellow-700"};return s.jsxs(a,{className:`rounded-xl sm:rounded-2xl shadow-sm transition-all hover:shadow-md p-4 sm:p-6 ${i[n]||i.blue}`,children:[s.jsx(g,{className:"pb-2 p-0",children:s.jsxs(p,{className:"text-xs sm:text-sm text-muted-foreground flex items-center gap-2",children:[l,e]})}),s.jsxs(t,{className:"p-0 pt-2",children:[s.jsx("div",{className:"text-2xl sm:text-3xl font-semibold",children:null!=r?r:"—"}),o&&s.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:o})]})]})}function b({title:e,columns:r,rows:l,icon:n}){return s.jsxs(a,{className:"rounded-xl sm:rounded-2xl shadow-sm p-3 sm:p-6",children:[s.jsx(g,{className:"pb-2 p-0",children:s.jsxs(p,{className:"text-sm sm:text-base flex items-center gap-2",children:[n,e]})}),s.jsx(t,{className:"p-0 pt-3",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-xs sm:text-sm",children:[s.jsx("thead",{className:"text-left border-b",children:s.jsx("tr",{children:r.map(e=>s.jsx("th",{className:"py-2 pr-4 font-medium text-gray-600",children:e},e))})}),s.jsx("tbody",{children:0===l.length?s.jsx("tr",{children:s.jsx("td",{className:"py-8 text-center text-muted-foreground",colSpan:r.length,children:"No data available"})}):l.map((e,a)=>s.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:e.map((e,a)=>s.jsx("td",{className:"py-3 pr-4",children:null!=e?e:"—"},a))},a))})]})})})]})}function _({title:e,href:a,icon:t}){return s.jsxs("a",{href:a,className:"flex items-center gap-3 p-4 rounded-lg border border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-colors",children:[s.jsx("div",{className:"text-blue-600",children:t}),s.jsx("span",{className:"font-medium text-gray-900",children:e})]})}export{w as default};
