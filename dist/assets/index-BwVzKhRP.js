import{a8 as e,j as s,L as a,S as l,I as t,k as r,a5 as i,C as n,a as c,b as d,e as o,o as x,n as m,f as h,P as j,D as p,x as N,W as g,a6 as u,g as v,h as f,y,z as b,E as w,F as C,p as T,q as _,r as k,v as S,m as U,A as $,ap as P}from"./index-BmUpYGrm.js";import{r as D}from"./vendor-vN6PtkFd.js";import{W as L,E as R}from"./enhancedRepairHistoryManager-DsLnTI82.js";import{A as W}from"./arrow-right-iDmV9z1N.js";import{F as A}from"./file-text-bXPYLusF.js";import{I as V}from"./image-CTGCnaT4.js";import{D as M}from"./download-CLPHGjzE.js";import{S as E}from"./star-CR_sFOyJ.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=e("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),I=({carVin:e,showAll:U=!1})=>{var $,P;const[R,V]=D.useState([]),[M,E]=D.useState(""),[H,I]=D.useState([]),[q,B]=D.useState(null),[O,z]=D.useState(null),[F,Q]=D.useState(!1);D.useEffect(()=>{G()},[e]),D.useEffect(()=>{if(M.trim()){const e=R.filter(e=>e.carModel.toLowerCase().includes(M.toLowerCase())||e.workTypeChange.toLowerCase().includes(M.toLowerCase())||e.changedBy.toLowerCase().includes(M.toLowerCase()));I(e)}else I(R)},[M,R]);const G=()=>{let s;s=e?L.getCarWorkTypeHistory(e):U?L.getWorkTypeHistory():L.getRecentWorkTypeChanges(10),V(s),I(s);const a=L.getWorkTypeAnalytics();B(a)},Z=e=>new Date(e).toLocaleString(),J=e=>{switch(e){case"in_diagnosis":return"bg-blue-100 text-blue-800";case"in_repair":return"bg-orange-100 text-orange-800";case"in_quality_check":return"bg-purple-100 text-purple-800";case"ready":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Work Type History"}),s.jsx("p",{className:"text-gray-600",children:e?`Showing work type changes for car ${e}`:"Recent work type transitions"})]}),q&&s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:q.totalTransitions}),s.jsx("div",{className:"text-sm text-gray-600",children:"Total Transitions"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:q.uniqueCars}),s.jsx("div",{className:"text-sm text-gray-600",children:"Unique Cars"})]})]})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(a,{htmlFor:"search",children:"Search Work Type History"}),s.jsxs("div",{className:"relative",children:[s.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx(t,{id:"search",placeholder:"Search by car model, work type, or employee...",value:M,onChange:e=>E(e.target.value),className:"pl-10"})]})]}),s.jsxs(r,{onClick:G,variant:"outline",className:"self-end",children:[s.jsx(i,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),s.jsx("div",{className:"space-y-4",children:0===H.length?s.jsx(n,{children:s.jsxs(c,{className:"p-6 text-center",children:[s.jsx(d,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"No work type history found"})]})}):H.map(e=>{var a,l;return s.jsx(n,{className:"hover:shadow-md transition-shadow",children:s.jsx(c,{className:"p-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(d,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"font-medium",children:e.carModel}),e.carVin&&s.jsx(o,{variant:"outline",className:"text-xs",children:e.carVin})]}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(o,{className:J(e.fromWorkType),children:e.fromWorkType.replace("_"," ").toUpperCase()}),s.jsx(W,{className:"h-4 w-4 text-gray-400"}),s.jsx(o,{className:J(e.toWorkType),children:e.toWorkType.replace("_"," ").toUpperCase()})]}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"h-3 w-3"}),s.jsx("span",{children:e.changedBy})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(m,{className:"h-3 w-3"}),s.jsx("span",{children:Z(e.timestamp)})]}),e.duration&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(h,{className:"h-3 w-3"}),s.jsx("span",{children:e.duration})]})]}),e.partsUsed&&e.partsUsed.length>0&&s.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(j,{className:"h-4 w-4 text-blue-600"}),s.jsx("span",{className:"font-medium text-blue-800",children:"Parts Used"}),s.jsxs(o,{variant:"outline",className:"text-xs",children:[e.partsUsed.length," parts"]})]}),s.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:e.partsUsed.map((e,a)=>s.jsx(o,{variant:"secondary",className:"text-xs",children:e},a))}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(p,{className:"h-3 w-3 text-green-600"}),s.jsxs("span",{className:"font-medium text-green-700",children:["Total Parts Cost: $",(null==(a=e.totalPartsCost)?void 0:a.toLocaleString())||"0"]})]})]}),e.toolsUsed&&e.toolsUsed.length>0&&s.jsxs("div",{className:"mt-3 p-3 bg-orange-50 rounded-lg border border-orange-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{className:"h-4 w-4 text-orange-600"}),s.jsx("span",{className:"font-medium text-orange-800",children:"Tools Used"}),s.jsxs(o,{variant:"outline",className:"text-xs",children:[e.toolsUsed.length," tools"]})]}),s.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:e.toolsUsed.map((e,a)=>s.jsx(o,{variant:"secondary",className:"text-xs",children:e},a))}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(p,{className:"h-3 w-3 text-green-600"}),s.jsxs("span",{className:"font-medium text-green-700",children:["Total Tools Cost: $",(null==(l=e.totalToolsCost)?void 0:l.toLocaleString())||"0"]})]})]}),e.workNotes&&s.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[s.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[s.jsx(g,{className:"h-3 w-3 text-gray-500"}),s.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Work Notes:"})]}),s.jsx("p",{className:"text-xs text-gray-600",children:e.workNotes})]}),e.notes&&s.jsx("p",{className:"text-sm text-gray-600 mt-2",children:e.notes})]}),s.jsx("div",{className:"ml-4 flex-shrink-0",children:s.jsxs(r,{size:"sm",variant:"outline",onClick:()=>{z(e),Q(!0)},className:"flex items-center gap-1",children:[s.jsx(u,{className:"h-4 w-4"}),"View Details"]})})]})})},e.id)})}),q&&q.transitionCounts&&Object.keys(q.transitionCounts).length>0&&s.jsxs(n,{children:[s.jsx(v,{children:s.jsxs(f,{className:"flex items-center gap-2",children:[s.jsx(h,{className:"h-5 w-5"}),"Work Type Transition Analytics"]})}),s.jsx(c,{children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(q.transitionCounts).sort(([,e],[,s])=>s-e).slice(0,6).map(([e,a])=>s.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600",children:e}),s.jsx("div",{className:"text-lg font-bold text-gray-900",children:a})]},e))})})]}),R.length>0&&s.jsxs(n,{children:[s.jsx(v,{children:s.jsxs(f,{className:"flex items-center gap-2",children:[s.jsx(j,{className:"h-5 w-5"}),"Parts & Tools Usage Analytics"]})}),s.jsx(c,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(j,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{className:"font-medium text-blue-800",children:"Total Parts"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-900",children:R.reduce((e,s)=>{var a;return e+((null==(a=s.partsUsed)?void 0:a.length)||0)},0)}),s.jsx("div",{className:"text-sm text-blue-600",children:"parts used"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(p,{className:"h-5 w-5 text-green-600"}),s.jsx("span",{className:"font-medium text-green-800",children:"Parts Cost"})]}),s.jsxs("div",{className:"text-2xl font-bold text-green-900",children:["$",R.reduce((e,s)=>e+(s.totalPartsCost||0),0).toLocaleString()]}),s.jsx("div",{className:"text-sm text-green-600",children:"total parts cost"})]}),s.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{className:"h-5 w-5 text-orange-600"}),s.jsx("span",{className:"font-medium text-orange-800",children:"Total Tools"})]}),s.jsx("div",{className:"text-2xl font-bold text-orange-900",children:R.reduce((e,s)=>{var a;return e+((null==(a=s.toolsUsed)?void 0:a.length)||0)},0)}),s.jsx("div",{className:"text-sm text-orange-600",children:"tools used"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(p,{className:"h-5 w-5 text-purple-600"}),s.jsx("span",{className:"font-medium text-purple-800",children:"Tools Cost"})]}),s.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:["$",R.reduce((e,s)=>e+(s.totalToolsCost||0),0).toLocaleString()]}),s.jsx("div",{className:"text-sm text-purple-600",children:"total tools cost"})]}),s.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(g,{className:"h-5 w-5 text-indigo-600"}),s.jsx("span",{className:"font-medium text-indigo-800",children:"Avg Parts"})]}),s.jsx("div",{className:"text-2xl font-bold text-indigo-900",children:R.length>0?Math.round(R.reduce((e,s)=>{var a;return e+((null==(a=s.partsUsed)?void 0:a.length)||0)},0)/R.length):0}),s.jsx("div",{className:"text-sm text-indigo-600",children:"parts per transition"})]}),s.jsxs("div",{className:"bg-teal-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{className:"h-5 w-5 text-teal-600"}),s.jsx("span",{className:"font-medium text-teal-800",children:"Avg Tools"})]}),s.jsx("div",{className:"text-2xl font-bold text-teal-900",children:R.length>0?Math.round(R.reduce((e,s)=>{var a;return e+((null==(a=s.toolsUsed)?void 0:a.length)||0)},0)/R.length):0}),s.jsx("div",{className:"text-sm text-teal-600",children:"tools per transition"})]})]})})]}),O&&s.jsx(y,{open:F,onOpenChange:Q,children:s.jsxs(b,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsx(w,{children:s.jsxs(C,{className:"flex items-center gap-2",children:[s.jsx(A,{className:"h-5 w-5"}),"Work Type History Details - ",O.carModel," (",O.carVin,")"]})}),s.jsxs(T,{defaultValue:"overview",className:"space-y-4",children:[s.jsxs(_,{className:"grid w-full grid-cols-4",children:[s.jsx(k,{value:"overview",children:"Overview"}),s.jsx(k,{value:"transition",children:"Transition Details"}),s.jsx(k,{value:"resources",children:"Parts & Tools"}),s.jsx(k,{value:"notes",children:"Notes & Timeline"})]}),s.jsx(S,{value:"overview",className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"Vehicle Information"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Model:"}),s.jsx("span",{children:O.carModel})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"VIN:"}),s.jsx("span",{className:"font-mono",children:O.carVin})]}),O.customerName&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Customer:"}),s.jsx("span",{children:O.customerName})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"Work Type Transition"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Date:"}),s.jsx("span",{children:Z(O.timestamp)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"font-medium",children:"From:"}),s.jsx(o,{className:J(O.fromWorkType),children:O.fromWorkType.replace("_"," ").toUpperCase()})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"font-medium",children:"To:"}),s.jsx(o,{className:J(O.toWorkType),children:O.toWorkType.replace("_"," ").toUpperCase()})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Changed By:"}),s.jsx("span",{children:O.changedBy})]}),O.duration&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Duration:"}),s.jsx("span",{children:O.duration})]})]})]})]})}),s.jsx(S,{value:"transition",className:"space-y-4",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"text-center",children:s.jsxs("div",{className:"inline-flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[s.jsx(o,{className:`${J(O.fromWorkType)} text-lg px-3 py-1`,children:O.fromWorkType.replace("_"," ").toUpperCase()}),s.jsx(W,{className:"h-6 w-6 text-gray-400"}),s.jsx(o,{className:`${J(O.toWorkType)} text-lg px-3 py-1`,children:O.toWorkType.replace("_"," ").toUpperCase()})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(x,{className:"h-4 w-4 text-blue-600"}),s.jsx("span",{className:"font-medium",children:"Changed By"})]}),s.jsx("p",{className:"text-lg",children:O.changedBy})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(m,{className:"h-4 w-4 text-green-600"}),s.jsx("span",{className:"font-medium",children:"Date & Time"})]}),s.jsx("p",{className:"text-lg",children:Z(O.timestamp)})]})}),O.duration&&s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(h,{className:"h-4 w-4 text-purple-600"}),s.jsx("span",{className:"font-medium",children:"Duration"})]}),s.jsx("p",{className:"text-lg",children:O.duration})]})})]})]})}),s.jsx(S,{value:"resources",className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[s.jsx(j,{className:"h-5 w-5 text-blue-600"}),"Parts Used"]}),O.partsUsed&&O.partsUsed.length>0?s.jsxs("div",{className:"space-y-2",children:[O.partsUsed.map((e,a)=>s.jsx("div",{className:"p-3 border rounded-lg bg-blue-50",children:s.jsx("div",{className:"font-medium",children:e})},a)),s.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{className:"h-4 w-4 text-green-600"}),s.jsxs("span",{className:"font-semibold text-green-800",children:["Total Parts Cost: $",(null==($=O.totalPartsCost)?void 0:$.toLocaleString())||"0"]})]})})]}):s.jsx("p",{className:"text-gray-500",children:"No parts used in this transition"})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[s.jsx(N,{className:"h-5 w-5 text-orange-600"}),"Tools Used"]}),O.toolsUsed&&O.toolsUsed.length>0?s.jsxs("div",{className:"space-y-2",children:[O.toolsUsed.map((e,a)=>s.jsxs("div",{className:"p-3 border rounded-lg bg-orange-50 flex items-center gap-2",children:[s.jsx(g,{className:"h-4 w-4 text-orange-600"}),s.jsx("span",{children:e})]},a)),s.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{className:"h-4 w-4 text-green-600"}),s.jsxs("span",{className:"font-semibold text-green-800",children:["Total Tools Cost: $",(null==(P=O.totalToolsCost)?void 0:P.toLocaleString())||"0"]})]})})]}):s.jsx("p",{className:"text-gray-500",children:"No tools used in this transition"})]})]})}),s.jsx(S,{value:"notes",className:"space-y-4",children:s.jsxs("div",{className:"space-y-6",children:[O.workNotes&&s.jsxs("div",{children:[s.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[s.jsx(g,{className:"h-5 w-5 text-gray-600"}),"Work Notes"]}),s.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border",children:s.jsx("p",{className:"text-gray-700",children:O.workNotes})})]}),O.notes&&s.jsxs("div",{children:[s.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[s.jsx(A,{className:"h-5 w-5 text-blue-600"}),"Additional Notes"]}),s.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border",children:s.jsx("p",{className:"text-gray-700",children:O.notes})})]}),!O.workNotes&&!O.notes&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-500",children:"No notes available for this work type transition"})]})]})})]})]})})]})},q=({carVin:e,showAll:P=!1})=>{const[R,W]=D.useState([]),[V,M]=D.useState(""),[E,I]=D.useState([]),[q,B]=D.useState(null),[O,z]=D.useState(null),[F,Q]=D.useState(!1);D.useEffect(()=>{G()},[e]),D.useEffect(()=>{if(V.trim()){const e=Z(R).filter(e=>e.label.toLowerCase().includes(V.toLowerCase())||e.entries.some(e=>e.carModel.toLowerCase().includes(V.toLowerCase())||e.changedBy.toLowerCase().includes(V.toLowerCase())));I(e)}else I(Z(R))},[V,R]);const G=()=>{let s;s=e?L.getCarWorkTypeHistory(e):P?L.getWorkTypeHistory():L.getRecentWorkTypeChanges(20),W(s),I(Z(s));const a=L.getWorkTypeAnalytics();B(a)},Z=e=>{const s={};return e.forEach(e=>{var a,l;const t=e.fromWorkType;s[t]||(s[t]={workType:t,label:J(t),color:K(t),icon:X(t),entries:[],totalPartsCost:0,totalToolsCost:0,totalParts:0,totalTools:0,duration:"",notes:[],mechanics:[]});const r=s[t];r.entries.push(e),r.totalPartsCost+=e.totalPartsCost||0,r.totalToolsCost+=e.totalToolsCost||0,r.totalParts+=(null==(a=e.partsUsed)?void 0:a.length)||0,r.totalTools+=(null==(l=e.toolsUsed)?void 0:l.length)||0,e.notes&&r.notes.push(e.notes),e.mechanics&&r.mechanics.push(...e.mechanics)}),Object.values(s).sort((e,s)=>Y(e.workType)-Y(s.workType))},J=e=>{switch(e){case"in_diagnosis":return"Diagnosis Stage";case"in_repair":return"Repair Stage";case"in_quality_check":return"Quality Check Stage";case"ready":return"Ready Stage";case"delivered":return"Delivery Stage";default:return e.replace("_"," ").toUpperCase()}},K=e=>{switch(e){case"in_diagnosis":return"bg-blue-100 text-blue-800 border-blue-200";case"in_repair":return"bg-orange-100 text-orange-800 border-orange-200";case"in_quality_check":return"bg-purple-100 text-purple-800 border-purple-200";case"ready":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},X=e=>{switch(e){case"in_diagnosis":return $;case"in_repair":return g;case"in_quality_check":case"delivered":return U;case"ready":return H;default:return N}},Y=e=>{switch(e){case"in_diagnosis":return 1;case"in_repair":return 2;case"in_quality_check":return 3;case"ready":return 4;case"delivered":return 5;default:return 999}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Work Type Based Repair History"}),s.jsx("p",{className:"text-gray-600",children:e?`Complete repair history for car ${e} organized by work types`:"Repair history organized by work type stages"})]}),q&&s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:q.totalTransitions}),s.jsx("div",{className:"text-sm text-gray-600",children:"Total Transitions"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:q.uniqueCars}),s.jsx("div",{className:"text-sm text-gray-600",children:"Unique Cars"})]})]})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(a,{htmlFor:"search",children:"Search Work Type History"}),s.jsxs("div",{className:"relative",children:[s.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx(t,{id:"search",placeholder:"Search by work type, car model, or employee...",value:V,onChange:e=>M(e.target.value),className:"pl-10"})]})]}),s.jsxs(r,{onClick:G,variant:"outline",className:"self-end",children:[s.jsx(i,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),s.jsx("div",{className:"space-y-6",children:0===E.length?s.jsx(n,{children:s.jsxs(c,{className:"p-6 text-center",children:[s.jsx(d,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"No work type history found"})]})}):E.map(e=>{const a=e.icon;return s.jsxs(n,{className:"border-2",children:[s.jsx(v,{className:`${e.color} border-b`,children:s.jsxs(f,{className:"flex items-center gap-3",children:[s.jsx(a,{className:"h-6 w-6"}),s.jsx("span",{children:e.label}),s.jsxs(o,{variant:"outline",className:"ml-auto",children:[e.entries.length," entries"]})]})}),s.jsxs(c,{className:"p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(j,{className:"h-4 w-4 text-blue-600"}),s.jsx("span",{className:"font-medium text-blue-800",children:"Parts Used"})]}),s.jsx("div",{className:"text-xl font-bold text-blue-900",children:e.totalParts}),s.jsxs("div",{className:"text-sm text-blue-600",children:["Total Cost: $",e.totalPartsCost.toLocaleString()]})]}),s.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-4 w-4 text-orange-600"}),s.jsx("span",{className:"font-medium text-orange-800",children:"Tools Used"})]}),s.jsx("div",{className:"text-xl font-bold text-orange-900",children:e.totalTools}),s.jsxs("div",{className:"text-sm text-orange-600",children:["Total Cost: $",e.totalToolsCost.toLocaleString()]})]}),s.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(x,{className:"h-4 w-4 text-green-600"}),s.jsx("span",{className:"font-medium text-green-800",children:"Mechanics"})]}),s.jsx("div",{className:"text-xl font-bold text-green-900",children:new Set(e.mechanics).size}),s.jsx("div",{className:"text-sm text-green-600",children:"Unique mechanics"})]}),s.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(A,{className:"h-4 w-4 text-purple-600"}),s.jsx("span",{className:"font-medium text-purple-800",children:"Notes"})]}),s.jsx("div",{className:"text-xl font-bold text-purple-900",children:e.notes.length}),s.jsx("div",{className:"text-sm text-purple-600",children:"Total notes"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Detailed Entries"}),e.entries.map(a=>{var l,t,i;return s.jsx(n,{className:"border border-gray-200",children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"font-medium",children:a.carModel}),a.carVin&&s.jsx(o,{variant:"outline",className:"text-xs",children:a.carVin})]}),s.jsx("div",{className:"text-sm text-gray-500",children:(i=a.timestamp,new Date(i).toLocaleString())})]}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"h-3 w-3"}),s.jsx("span",{children:a.changedBy})]}),a.duration&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(m,{className:"h-3 w-3"}),s.jsx("span",{children:a.duration})]})]}),a.partsUsed&&a.partsUsed.length>0&&s.jsxs("div",{className:"mb-3 p-3 bg-blue-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(j,{className:"h-4 w-4 text-blue-600"}),s.jsx("span",{className:"font-medium text-blue-800",children:"Parts Used"}),s.jsxs(o,{variant:"outline",className:"text-xs",children:[a.partsUsed.length," parts"]})]}),s.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:a.partsUsed.map((e,a)=>s.jsx(o,{variant:"secondary",className:"text-xs",children:e},a))}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(p,{className:"h-3 w-3 text-green-600"}),s.jsxs("span",{className:"font-medium text-green-700",children:["Cost: $",(null==(l=a.totalPartsCost)?void 0:l.toLocaleString())||"0"]})]})]}),a.toolsUsed&&a.toolsUsed.length>0&&s.jsxs("div",{className:"mb-3 p-3 bg-orange-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(N,{className:"h-4 w-4 text-orange-600"}),s.jsx("span",{className:"font-medium text-orange-800",children:"Tools Used"}),s.jsxs(o,{variant:"outline",className:"text-xs",children:[a.toolsUsed.length," tools"]})]}),s.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:a.toolsUsed.map((e,a)=>s.jsx(o,{variant:"secondary",className:"text-xs",children:e},a))}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(p,{className:"h-3 w-3 text-green-600"}),s.jsxs("span",{className:"font-medium text-green-700",children:["Cost: $",(null==(t=a.totalToolsCost)?void 0:t.toLocaleString())||"0"]})]})]}),a.workNotes&&s.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(A,{className:"h-4 w-4 text-gray-600"}),s.jsx("span",{className:"font-medium text-gray-800",children:"Work Notes"})]}),s.jsx("p",{className:"text-sm text-gray-700",children:a.workNotes})]}),a.issueDescription&&s.jsxs("div",{className:"mb-3 p-3 bg-red-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx($,{className:"h-4 w-4 text-red-600"}),s.jsx("span",{className:"font-medium text-red-800",children:"Issue Description"})]}),s.jsx("p",{className:"text-sm text-red-700",children:a.issueDescription})]}),a.notes&&s.jsx("p",{className:"text-sm text-gray-600 mt-2",children:a.notes}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsxs(r,{size:"sm",variant:"outline",onClick:()=>{z(e),Q(!0)},className:"flex items-center gap-1",children:[s.jsx(u,{className:"h-4 w-4"}),"View Stage Details"]})})]})},a.id)})]})]})]},e.workType)})}),O&&s.jsx(y,{open:F,onOpenChange:Q,children:s.jsxs(b,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[s.jsx(w,{children:s.jsxs(C,{className:"flex items-center gap-2",children:[s.jsx(A,{className:"h-5 w-5"}),O.label," Stage Details - ",O.entries.length," Entries"]})}),s.jsxs(T,{defaultValue:"overview",className:"space-y-4",children:[s.jsxs(_,{className:"grid w-full grid-cols-4",children:[s.jsx(k,{value:"overview",children:"Overview"}),s.jsx(k,{value:"entries",children:"All Entries"}),s.jsx(k,{value:"resources",children:"Resources Used"}),s.jsx(k,{value:"analytics",children:"Analytics"})]}),s.jsxs(S,{value:"overview",className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"Stage Information"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Work Type:"}),s.jsx(o,{className:"text-white bg-blue-600",children:O.workType.replace("_"," ").toUpperCase()})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Total Entries:"}),s.jsx("span",{children:O.entries.length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Unique Mechanics:"}),s.jsx("span",{children:new Set(O.mechanics).size})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Total Duration:"}),s.jsx("span",{children:O.duration||"Not specified"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"Resource Summary"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Parts Used:"}),s.jsxs("span",{children:[O.totalParts," parts"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Parts Cost:"}),s.jsxs("span",{className:"font-mono",children:["$",O.totalPartsCost.toLocaleString()]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Tools Used:"}),s.jsxs("span",{children:[O.totalTools," tools"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Tools Cost:"}),s.jsxs("span",{className:"font-mono",children:["$",O.totalToolsCost.toLocaleString()]})]})]})]})]}),s.jsxs("div",{className:"mt-6",children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Mechanics Involved"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Set(O.mechanics)).map((e,a)=>s.jsxs(o,{variant:"outline",className:"flex items-center gap-1",children:[s.jsx(x,{className:"h-3 w-3"}),e]},a))})]})]}),s.jsx(S,{value:"entries",className:"space-y-4",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"font-semibold text-lg",children:["All Stage Entries (",O.entries.length,")"]}),s.jsx("div",{className:"space-y-3",children:O.entries.map((e,a)=>{var l,t,r,i;return s.jsx(n,{className:"border",children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"Vehicle Information"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{className:"h-3 w-3"}),s.jsx("span",{children:e.carModel})]}),e.carVin&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-gray-500",children:"VIN:"}),s.jsx("span",{className:"font-mono text-xs",children:e.carVin})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"Work Details"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(x,{className:"h-3 w-3"}),s.jsx("span",{children:e.changedBy})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(m,{className:"h-3 w-3"}),s.jsx("span",{children:new Date(e.timestamp).toLocaleDateString()})]}),e.duration&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{className:"h-3 w-3"}),s.jsx("span",{children:e.duration})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"Resources"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(j,{className:"h-3 w-3 text-blue-600"}),s.jsxs("span",{children:[(null==(l=e.partsUsed)?void 0:l.length)||0," parts"]}),s.jsxs("span",{className:"text-green-600 font-mono",children:["$",(null==(t=e.totalPartsCost)?void 0:t.toLocaleString())||"0"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-3 w-3 text-orange-600"}),s.jsxs("span",{children:[(null==(r=e.toolsUsed)?void 0:r.length)||0," tools"]}),s.jsxs("span",{className:"text-green-600 font-mono",children:["$",(null==(i=e.totalToolsCost)?void 0:i.toLocaleString())||"0"]})]})]})]})]}),(e.workNotes||e.notes)&&s.jsxs("div",{className:"mt-4 pt-4 border-t",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),e.workNotes&&s.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.workNotes}),e.notes&&s.jsx("p",{className:"text-sm text-gray-600",children:e.notes})]})]})},e.id)})})]})}),s.jsx(S,{value:"resources",className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[s.jsx(j,{className:"h-5 w-5 text-blue-600"}),"Parts Used Across Stage"]}),s.jsxs("div",{className:"space-y-2",children:[Array.from(new Set(O.entries.flatMap(e=>e.partsUsed||[]))).map((e,a)=>s.jsxs("div",{className:"p-3 border rounded-lg bg-blue-50",children:[s.jsx("div",{className:"font-medium",children:e}),s.jsxs("div",{className:"text-sm text-gray-600",children:["Used in ",O.entries.filter(s=>{var a;return null==(a=s.partsUsed)?void 0:a.includes(e)}).length," entries"]})]},a)),s.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{className:"h-4 w-4 text-green-600"}),s.jsxs("span",{className:"font-semibold text-green-800",children:["Total Parts Cost: $",O.totalPartsCost.toLocaleString()]})]})})]})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[s.jsx(N,{className:"h-5 w-5 text-orange-600"}),"Tools Used Across Stage"]}),s.jsxs("div",{className:"space-y-2",children:[Array.from(new Set(O.entries.flatMap(e=>e.toolsUsed||[]))).map((e,a)=>s.jsxs("div",{className:"p-3 border rounded-lg bg-orange-50 flex items-center gap-2",children:[s.jsx(g,{className:"h-4 w-4 text-orange-600"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:e}),s.jsxs("div",{className:"text-sm text-gray-600",children:["Used in ",O.entries.filter(s=>{var a;return null==(a=s.toolsUsed)?void 0:a.includes(e)}).length," entries"]})]})]},a)),s.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{className:"h-4 w-4 text-green-600"}),s.jsxs("span",{className:"font-semibold text-green-800",children:["Total Tools Cost: $",O.totalToolsCost.toLocaleString()]})]})})]})]})]})}),s.jsxs(S,{value:"analytics",className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(d,{className:"h-4 w-4 text-blue-600"}),s.jsx("span",{className:"font-medium",children:"Cars Processed"})]}),s.jsx("div",{className:"text-2xl font-bold",children:new Set(O.entries.map(e=>e.carVin)).size}),s.jsx("div",{className:"text-sm text-gray-600",children:"unique vehicles"})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(x,{className:"h-4 w-4 text-green-600"}),s.jsx("span",{className:"font-medium",children:"Mechanics"})]}),s.jsx("div",{className:"text-2xl font-bold",children:new Set(O.mechanics).size}),s.jsx("div",{className:"text-sm text-gray-600",children:"involved"})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(j,{className:"h-4 w-4 text-blue-600"}),s.jsx("span",{className:"font-medium",children:"Avg Parts"})]}),s.jsx("div",{className:"text-2xl font-bold",children:O.entries.length>0?Math.round(O.totalParts/O.entries.length):0}),s.jsx("div",{className:"text-sm text-gray-600",children:"per entry"})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(p,{className:"h-4 w-4 text-green-600"}),s.jsx("span",{className:"font-medium",children:"Total Cost"})]}),s.jsxs("div",{className:"text-2xl font-bold",children:["$",(O.totalPartsCost+O.totalToolsCost).toLocaleString()]}),s.jsx("div",{className:"text-sm text-gray-600",children:"parts + tools"})]})})]}),s.jsxs("div",{className:"mt-6",children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Timeline"}),s.jsx("div",{className:"space-y-2",children:O.entries.sort((e,s)=>new Date(e.timestamp).getTime()-new Date(s.timestamp).getTime()).map((e,a)=>s.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold",children:a+1}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:e.carModel}),s.jsx("div",{className:"text-sm text-gray-600",children:e.changedBy})]}),s.jsx("div",{className:"text-sm text-gray-600",children:new Date(e.timestamp).toLocaleDateString()})]},e.id))})]})]})]})]})})]})},B=({searchQuery:e="",carVin:a,showAll:l=!0})=>{const[t,i]=D.useState([]),[m,h]=D.useState(null),[p,N]=D.useState(!1),[U,$]=D.useState(!1),[P,L]=D.useState([]),[W,H]=D.useState("");D.useEffect(()=>{I()},[e,a]);const I=()=>{let s=R.getRepairHistory();a&&!l&&(s=s.filter(e=>e.car_vin.toLowerCase().includes(a.toLowerCase()))),e&&(s=R.searchRepairHistory(e)),s.sort((e,s)=>new Date(s.completion_date||s.created_at).getTime()-new Date(e.completion_date||e.created_at).getTime()),i(s)},q=e=>{const s={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-orange-100 text-orange-800",expert:"bg-red-100 text-red-800"};return s[e]||s.medium},B=e=>s.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(a=>s.jsx(E,{className:"h-4 w-4 "+(a<=e?"text-yellow-400 fill-current":"text-gray-300")},a)),s.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",e,"/5)"]})]}),O=(e,s)=>{L(e),H(s),$(!0)};return 0===t.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(A,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Enhanced Repair History"}),s.jsx("p",{className:"text-gray-600",children:e||a?"No repair records match your search criteria":"Enhanced repair history will appear here when repairs are completed through the new system"})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(d,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{className:"font-medium text-blue-800",children:"Total Repairs"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-900",children:R.getRepairStatistics().totalRepairs})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(j,{className:"h-5 w-5 text-green-600"}),s.jsx("span",{className:"font-medium text-green-800",children:"Parts Used"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-900",children:R.getRepairStatistics().totalParts})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(x,{className:"h-5 w-5 text-purple-600"}),s.jsx("span",{className:"font-medium text-purple-800",children:"Mechanics"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-900",children:R.getRepairStatistics().totalMechanics})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(d,{className:"h-5 w-5 text-orange-600"}),s.jsx("span",{className:"font-medium text-orange-800",children:"Cars Serviced"})]}),s.jsx("div",{className:"text-2xl font-bold text-orange-900",children:R.getRepairStatistics().totalCars})]})})]}),s.jsx("div",{className:"space-y-4",children:t.map(e=>{var a,l,t,i;return s.jsxs(n,{className:"hover:shadow-lg transition-shadow",children:[s.jsx(v,{className:"pb-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:(i=e.work_type||"mechanical",{mechanical:s.jsx(g,{className:"h-4 w-4"}),electrical:s.jsx(E,{className:"h-4 w-4"}),body_work:s.jsx(d,{className:"h-4 w-4"}),painter:s.jsx(E,{className:"h-4 w-4"}),detailer:s.jsx(E,{className:"h-4 w-4"})}[i]||s.jsx(g,{className:"h-4 w-4"}))}),s.jsxs("div",{children:[s.jsxs(f,{className:"text-lg",children:[e.car_model," (",e.car_vin,")"]}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mt-1",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"h-4 w-4"}),e.client_name]}),s.jsx("div",{className:"flex items-center gap-1",children:new Date(e.repair_date).toLocaleDateString()}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(g,{className:"h-4 w-4"}),e.technician_name]})]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(o,{className:q(e.difficulty_level||"medium"),children:null==(a=e.difficulty_level)?void 0:a.toUpperCase()}),s.jsxs(r,{size:"sm",variant:"outline",onClick:()=>{h(e),N(!0)},children:[s.jsx(u,{className:"h-4 w-4 mr-1"}),"View Details"]})]})]})}),s.jsxs(c,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Issue Description"}),s.jsx("p",{className:"text-sm text-gray-600 bg-red-50 p-3 rounded-lg border-l-4 border-red-200",children:e.issue_description})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Solution"}),s.jsx("p",{className:"text-sm text-gray-600 bg-green-50 p-3 rounded-lg border-l-4 border-green-200",children:e.solution_description})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Quality Rating"}),B(e.quality_rating||0)]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Client Satisfaction"}),B(e.client_satisfaction||0)]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Performance"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Labor Hours:"}),s.jsxs("span",{className:"font-medium",children:[e.labor_hours||0,"h"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Total Cost:"}),s.jsxs("span",{className:"font-medium",children:["$",e.total_cost||0]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Warranty:"}),s.jsxs("span",{className:"font-medium",children:[e.warranty_period||0," months"]})]})]})]})]}),((null==(l=e.before_photos)?void 0:l.length)||(null==(t=e.after_photos)?void 0:t.length))&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Photo Documentation"}),s.jsxs("div",{className:"flex gap-4",children:[e.before_photos&&e.before_photos.length>0&&s.jsxs(r,{size:"sm",variant:"outline",onClick:()=>O(e.before_photos,"Before Photos"),className:"flex items-center gap-2",children:[s.jsx(V,{className:"h-4 w-4"}),"Before Photos (",e.before_photos.length,")"]}),e.after_photos&&e.after_photos.length>0&&s.jsxs(r,{size:"sm",variant:"outline",onClick:()=>O(e.after_photos,"After Photos"),className:"flex items-center gap-2",children:[s.jsx(V,{className:"h-4 w-4"}),"After Photos (",e.after_photos.length,")"]})]})]}),s.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(j,{className:"h-4 w-4"}),e.parts_used.length," parts used"]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(g,{className:"h-4 w-4"}),e.tools_used.length," tools used"]}),e.follow_up_required&&s.jsx(o,{variant:"outline",className:"bg-yellow-50 text-yellow-700",children:"Follow-up Required"})]}),s.jsxs(r,{size:"sm",variant:"outline",onClick:()=>(e=>{const s=`\nMONZA TECH - REPAIR COMPLETION REPORT\n=====================================\n\nCar Information:\n- VIN: ${e.car_vin}\n- Model: ${e.car_model}\n- Customer: ${e.client_name}\n\nRepair Details:\n- Issue: ${e.issue_description}\n- Solution: ${e.solution_description}\n- Work Type: ${e.work_type||"N/A"}\n- Mechanic: ${e.technician_name}\n- Date: ${e.repair_date}\n- Completion: ${e.completion_date||"N/A"}\n\nRepair Steps:\n${e.repair_steps.map((e,s)=>`${s+1}. ${e}`).join("\n")}\n\nParts Used:\n${e.parts_used.map(e=>`- ${e.part_name} (${e.quantity}x) - $${e.cost}`).join("\n")}\n\nTools Used:\n${e.tools_used.map(e=>`- ${e}`).join("\n")}\n\nPerformance:\n- Labor Hours: ${e.labor_hours||0}\n- Total Cost: $${e.total_cost||0}\n- Difficulty: ${e.difficulty_level}\n- Quality Rating: ${e.quality_rating}/5\n- Client Satisfaction: ${e.client_satisfaction}/5\n- Warranty: ${e.warranty_period} months\n\nMechanic Notes:\n${e.mechanic_notes||"No additional notes"}\n\nRecommendations:\n${e.recommendation||"No specific recommendations"}\n\nGenerated on: ${(new Date).toLocaleString()}\n    `,a=new Blob([s],{type:"text/plain"}),l=URL.createObjectURL(a),t=document.createElement("a");t.href=l,t.download=`repair_report_${e.car_vin}_${e.repair_date}.txt`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(l)})(e),children:[s.jsx(M,{className:"h-4 w-4 mr-1"}),"Download Report"]})]})]})]},e.id)})}),m&&s.jsx(y,{open:p,onOpenChange:N,children:s.jsxs(b,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsx(w,{children:s.jsxs(C,{className:"flex items-center gap-2",children:[s.jsx(A,{className:"h-5 w-5"}),"Repair Details - ",m.car_model," (",m.car_vin,")"]})}),s.jsxs(T,{defaultValue:"overview",className:"space-y-4",children:[s.jsxs(_,{className:"grid w-full grid-cols-4",children:[s.jsx(k,{value:"overview",children:"Overview"}),s.jsx(k,{value:"parts-tools",children:"Parts & Tools"}),s.jsx(k,{value:"notes",children:"Notes & Steps"}),s.jsx(k,{value:"photos",children:"Photos"})]}),s.jsx(S,{value:"overview",className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"Customer Information"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Name:"}),s.jsx("span",{children:m.client_name})]}),m.client_phone&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Phone:"}),s.jsx("span",{children:m.client_phone})]}),m.client_email&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Email:"}),s.jsx("span",{children:m.client_email})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"Repair Information"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Repair Date:"}),s.jsx("span",{children:new Date(m.repair_date).toLocaleDateString()})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Completion:"}),s.jsx("span",{children:m.completion_date?new Date(m.completion_date).toLocaleDateString():"In Progress"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Work Type:"}),s.jsx(o,{variant:"outline",children:m.work_type})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"font-medium",children:"Difficulty:"}),s.jsx(o,{className:q(m.difficulty_level||"medium"),children:m.difficulty_level})]})]})]})]})}),s.jsx(S,{value:"parts-tools",className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Parts Used"}),s.jsx("div",{className:"space-y-2",children:m.parts_used.map((e,a)=>s.jsx("div",{className:"p-3 border rounded-lg",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.part_name}),s.jsxs("div",{className:"text-sm text-gray-600",children:["#",e.part_number]}),s.jsxs("div",{className:"text-sm text-gray-600",children:["Supplier: ",e.supplier]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"font-medium",children:["Qty: ",e.quantity]}),s.jsxs("div",{className:"text-sm text-gray-600",children:["$",e.cost]})]})]})},a))})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Tools Used"}),s.jsx("div",{className:"space-y-2",children:m.tools_used.map((e,a)=>s.jsxs("div",{className:"p-2 border rounded-lg flex items-center gap-2",children:[s.jsx(g,{className:"h-4 w-4 text-gray-600"}),s.jsx("span",{children:e})]},a))})]})]})}),s.jsx(S,{value:"notes",className:"space-y-4",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Repair Steps"}),s.jsx("div",{className:"space-y-2",children:m.repair_steps.map((e,a)=>s.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:a+1}),s.jsx("span",{children:e})]},a))})]}),m.mechanic_notes&&s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Mechanic Notes"}),s.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border-l-4 border-blue-200",children:m.mechanic_notes})]}),m.recommendation&&s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Recommendations"}),s.jsx("div",{className:"p-4 bg-green-50 rounded-lg border-l-4 border-green-200",children:m.recommendation})]})]})}),s.jsx(S,{value:"photos",className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Before Photos"}),m.before_photos&&m.before_photos.length>0?s.jsx("div",{className:"grid grid-cols-2 gap-2",children:m.before_photos.map((e,a)=>s.jsx("img",{src:e,alt:`Before ${a+1}`,className:"w-full h-32 object-cover rounded-lg border cursor-pointer hover:opacity-75",onClick:()=>O([e],`Before Photo ${a+1}`)},a))}):s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(V,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),"No before photos"]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-lg mb-3",children:"After Photos"}),m.after_photos&&m.after_photos.length>0?s.jsx("div",{className:"grid grid-cols-2 gap-2",children:m.after_photos.map((e,a)=>s.jsx("img",{src:e,alt:`After ${a+1}`,className:"w-full h-32 object-cover rounded-lg border cursor-pointer hover:opacity-75",onClick:()=>O([e],`After Photo ${a+1}`)},a))}):s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(V,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),"No after photos"]})]})]})})]})]})}),s.jsx(y,{open:U,onOpenChange:$,children:s.jsxs(b,{className:"max-w-3xl",children:[s.jsx(w,{children:s.jsx(C,{children:W})}),s.jsx("div",{className:"grid grid-cols-1 gap-4 max-h-96 overflow-y-auto",children:P.map((e,a)=>s.jsx("img",{src:e,alt:`${W} ${a+1}`,className:"w-full max-h-80 object-contain rounded-lg border"},a))})]})})]})},O=()=>{const[e,o]=D.useState(""),[h,p]=D.useState(""),[g,u]=D.useState("work-type-based");return s.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Repair History"}),s.jsx("p",{className:"text-gray-600",children:"Comprehensive repair history with work type tracking, parts, and tools"})]}),s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.jsx(P,{className:"h-8 w-8 mx-auto mb-2"})}),s.jsx("div",{className:"text-sm text-gray-600",children:"Complete History"})]})})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(a,{htmlFor:"search",children:"Search Repair History"}),s.jsxs("div",{className:"relative",children:[s.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx(t,{id:"search",placeholder:"Search by car VIN, model, or employee...",value:e,onChange:e=>o(e.target.value),className:"pl-10"})]})]}),s.jsxs("div",{className:"w-64",children:[s.jsx(a,{htmlFor:"carVin",children:"Filter by Car VIN"}),s.jsx(t,{id:"carVin",placeholder:"Enter car VIN...",value:h,onChange:e=>p(e.target.value)})]}),s.jsxs(r,{variant:"outline",className:"self-end",onClick:()=>{o(""),p("")},children:[s.jsx(i,{className:"h-4 w-4 mr-2"}),"Clear Filters"]})]}),s.jsxs(T,{value:g,onValueChange:u,className:"w-full",children:[s.jsxs(_,{className:"grid w-full grid-cols-3",children:[s.jsxs(k,{value:"enhanced",className:"flex items-center gap-2",children:[s.jsx(A,{className:"h-4 w-4"}),"Enhanced History"]}),s.jsxs(k,{value:"work-type-based",className:"flex items-center gap-2",children:[s.jsx(P,{className:"h-4 w-4"}),"Work Type Based"]}),s.jsxs(k,{value:"chronological",className:"flex items-center gap-2",children:[s.jsx(m,{className:"h-4 w-4"}),"Chronological"]})]}),s.jsx(S,{value:"enhanced",className:"mt-6",children:s.jsxs(n,{children:[s.jsx(v,{children:s.jsxs(f,{className:"flex items-center gap-2",children:[s.jsx(A,{className:"h-5 w-5"}),"Enhanced Repair History with Photos & Details"]})}),s.jsx(c,{children:s.jsx(B,{searchQuery:e,carVin:h||void 0,showAll:!h})})]})}),s.jsx(S,{value:"work-type-based",className:"mt-6",children:s.jsxs(n,{children:[s.jsx(v,{children:s.jsxs(f,{className:"flex items-center gap-2",children:[s.jsx(P,{className:"h-5 w-5"}),"Work Type Based Repair History"]})}),s.jsx(c,{children:s.jsx(q,{carVin:h||void 0,showAll:!h})})]})}),s.jsx(S,{value:"chronological",className:"mt-6",children:s.jsxs(n,{children:[s.jsx(v,{children:s.jsxs(f,{className:"flex items-center gap-2",children:[s.jsx(m,{className:"h-5 w-5"}),"Chronological Repair History"]})}),s.jsx(c,{children:s.jsx(I,{carVin:h||void 0,showAll:!h})})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{className:"font-medium text-blue-800",children:"Total Cars"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-900",children:"-"}),s.jsx("div",{className:"text-sm text-blue-600",children:"in repair history"})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(j,{className:"h-5 w-5 text-green-600"}),s.jsx("span",{className:"font-medium text-green-800",children:"Total Parts"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-900",children:"-"}),s.jsx("div",{className:"text-sm text-green-600",children:"used across all repairs"})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-5 w-5 text-orange-600"}),s.jsx("span",{className:"font-medium text-orange-800",children:"Total Tools"})]}),s.jsx("div",{className:"text-2xl font-bold text-orange-900",children:"-"}),s.jsx("div",{className:"text-sm text-orange-600",children:"used across all repairs"})]})}),s.jsx(n,{children:s.jsxs(c,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(x,{className:"h-5 w-5 text-purple-600"}),s.jsx("span",{className:"font-medium text-purple-800",children:"Total Mechanics"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-900",children:"-"}),s.jsx("div",{className:"text-sm text-purple-600",children:"involved in repairs"})]})})]})]})};export{O as default};
