const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cleanMoveCarService-W7bZHGm6.js","assets/index-BmUpYGrm.js","assets/vendor-vN6PtkFd.js","assets/charts-XrXYWaKo.js","assets/utils-DhcIvS4g.js","assets/index-wQIKT8W8.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,n=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&l(e,t,s[t]);if(a)for(var t of a(s))i.call(s,t)&&l(e,t,s[t]);return e},o=(e,a)=>s(e,t(a)),d=(e,s,t)=>new Promise((a,r)=>{var i=e=>{try{n(t.next(e))}catch(s){r(s)}},l=e=>{try{n(t.throw(e))}catch(s){r(s)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,l);n((t=t.apply(e,s)).next())});import{j as c,y as m,z as h,E as x,F as u,o as p,C as g,g as v,h as j,b as y,a as f,e as N,n as b,I as w,H as C,k as S,V as D,ab as P,d as _,L as I,t as F,l as O,a9 as V,ao as E,P as k,W as M,s as $,aj as A,Q as T,O as L,c as R,m as q,X as U,a1 as z}from"./index-BmUpYGrm.js";import{r as W,R as H}from"./vendor-vN6PtkFd.js";import{V as B}from"./VinScannerDialog-C38X97Jl.js";import{M as J,E as G}from"./MoveCarDialog-DOaKAUng.js";import{P as Y}from"./PdiViewDialog-C6B7h77-.js";import{C as K,P as Q}from"./PdiChecklistDialog-BFpzxMj8.js";import{u as X,F as Z,a as ee,b as se,c as te,d as ae,e as re}from"./form-D18p6wVs.js";import{t as ie,o as le,s as ne,l as oe}from"./zod-Cunv6AlR.js";import{S as de}from"./separator-D0zOJWdq.js";import{P as ce}from"./phone-CUmdYfuI.js";import{M as me}from"./mail-BiNlmlXL.js";import{F as he}from"./file-text-bXPYLusF.js";import{f as xe}from"./utils-DhcIvS4g.js";import{T as ue,a as pe,b as ge,c as ve,d as je,e as ye,S as fe}from"./table-BEISn_Te.js";import{S as Ne}from"./SmartActionDropdown-CocWn_7w.js";import{C as be}from"./CarStatusSelectionDialog-BKEPwv76.js";import{C as we}from"./CustomsManagementDialog-CpmILlI3.js";import{T as Ce}from"./table-search-Bl4Inyz2.js";import{a as Se}from"./errorHandling-Dc1u_gNS.js";import{c as De}from"./carService-BlnIAupl.js";import{u as Pe,W as _e}from"./useWarrantyEditor-C-QeEmwQ.js";import{W as Ie,S as Fe}from"./StandardWarrantyButton-EBT9bBYI.js";import{B as Oe}from"./battery-zPCpHw5W.js";import{F as Ve}from"./fuel-DD7FDLWK.js";import"./charts-XrXYWaKo.js";import"./cameraPermissionManager-D3sOAAEG.js";import"./ocrUtils-boR-SCDU.js";import"./index-dUlNy-FG.js";import"./enhancedMonzaBotService-CP3UVEVb.js";import"./camera-CKQtJJJ8.js";import"./arrow-left-DqrDEplE.js";import"./PdiChecklistPdf-B4FKiplK.js";import"./checkbox-CbEst83x.js";import"./index-DNyRc51V.js";import"./datetime-input-Dxp48WV8.js";import"./carClientLinkingService-K_T_il58.js";const Ee=le({clientName:ne().min(1,"Client name is required"),clientPhone:ne().optional(),clientLicensePlate:ne().min(1,"License plate is required"),clientEmail:ne().email("Valid email is required").optional().or(oe("")),clientAddress:ne().optional(),notes:ne().optional()}),ke=({car:e,isOpen:s,onClose:t,onSave:a})=>{const[r,i]=W.useState(!1),l=X({resolver:ie(Ee),defaultValues:{clientName:e.clientName||"",clientPhone:e.clientPhone||"",clientLicensePlate:e.clientLicensePlate||"",clientEmail:e.clientEmail||"",clientAddress:e.clientAddress||"",notes:e.notes||""}}),d=e=>{a(e),i(!1)};return c.jsx(m,{open:s,onOpenChange:t,children:c.jsxs(h,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[c.jsx(x,{children:c.jsxs(u,{className:"flex items-center gap-2",children:[c.jsx(p,{className:"h-5 w-5 text-blue-600"}),"sold"===e.status?"Customer Information":"Reserved Customer Information"]})}),c.jsxs("div",{className:"space-y-6",children:[c.jsxs(g,{children:[c.jsx(v,{className:"pb-3",children:c.jsxs(j,{className:"flex items-center gap-2 text-lg",children:[c.jsx(y,{className:"h-5 w-5 text-gray-600"}),"Vehicle Details - Showroom Floor 1"]})}),c.jsx(f,{className:"space-y-3",children:c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Model:"}),c.jsxs("p",{className:"font-medium",children:[e.model," (",e.year,")"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"VIN:"}),c.jsx("p",{className:"font-mono text-sm",children:e.vinNumber})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Color:"}),c.jsx("p",{children:e.color})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Status:"}),c.jsx(N,{variant:"outline",className:(e=>{switch(e){case"sold":return"bg-green-100 text-green-800 border-green-200";case"reserved":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})(e.status),children:e.status.toUpperCase()})]}),e.price&&c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Price:"}),c.jsxs("p",{className:"font-semibold text-green-600",children:["$",e.price.toLocaleString()]})]}),e.batteryPercentage&&c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Battery:"}),c.jsxs("p",{children:[e.batteryPercentage,"%"]})]})]})})]}),c.jsxs(g,{children:[c.jsx(v,{className:"pb-3",children:c.jsxs(j,{className:"flex items-center gap-2 text-lg",children:[c.jsx(b,{className:"h-5 w-5 text-gray-600"}),"Sale Information"]})}),c.jsx(f,{className:"space-y-3",children:c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.reservedDate&&c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Reserved Date:"}),c.jsx("p",{children:xe(new Date(e.reservedDate),"PPP")})]}),e.soldDate&&c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Sold Date:"}),c.jsx("p",{children:xe(new Date(e.soldDate),"PPP")})]}),e.arrivalDate&&c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Arrival Date:"}),c.jsx("p",{children:xe(new Date(e.arrivalDate),"PPP")})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Last Updated:"}),c.jsx("p",{children:e.lastUpdated?xe(new Date(e.lastUpdated),"PPP p"):"Not available"})]})]})})]}),c.jsx(de,{}),r?c.jsx(Z,o(n({},l),{children:c.jsx("form",{onSubmit:l.handleSubmit(d),className:"space-y-4",children:c.jsxs(g,{children:[c.jsx(v,{children:c.jsx(j,{className:"text-lg",children:"Edit Client Information"})}),c.jsxs(f,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsx(ee,{control:l.control,name:"clientName",render:({field:e})=>c.jsxs(se,{children:[c.jsx(te,{children:"Client Name *"}),c.jsx(ae,{children:c.jsx(w,n({id:"clientName",placeholder:"Enter client name"},e))}),c.jsx(re,{})]})}),c.jsx(ee,{control:l.control,name:"clientPhone",render:({field:e})=>c.jsxs(se,{children:[c.jsx(te,{children:"Phone Number"}),c.jsx(ae,{children:c.jsx(w,n({id:"clientPhone",placeholder:"Enter phone number"},e))}),c.jsx(re,{})]})}),c.jsx(ee,{control:l.control,name:"clientEmail",render:({field:e})=>c.jsxs(se,{children:[c.jsx(te,{children:"Email Address"}),c.jsx(ae,{children:c.jsx(w,n({id:"clientEmail",placeholder:"Enter email address"},e))}),c.jsx(re,{})]})}),c.jsx(ee,{control:l.control,name:"clientLicensePlate",render:({field:e})=>c.jsxs(se,{children:[c.jsx(te,{children:"License Plate *"}),c.jsx(ae,{children:c.jsx(w,n({id:"clientLicensePlate",placeholder:"Enter license plate"},e))}),c.jsx(re,{})]})})]}),c.jsx(ee,{control:l.control,name:"clientAddress",render:({field:e})=>c.jsxs(se,{children:[c.jsx(te,{children:"Address"}),c.jsx(ae,{children:c.jsx(C,n({placeholder:"Enter client address",className:"resize-none",rows:2},e))}),c.jsx(re,{})]})}),c.jsx(ee,{control:l.control,name:"notes",render:({field:e})=>c.jsxs(se,{children:[c.jsx(te,{children:"Additional Notes"}),c.jsx(ae,{children:c.jsx(C,n({placeholder:"Enter any additional notes",className:"resize-none",rows:3},e))}),c.jsx(re,{})]})})]})]})})})):c.jsxs(g,{children:[c.jsx(v,{className:"pb-3",children:c.jsxs(j,{className:"flex items-center justify-between text-lg",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(p,{className:"h-5 w-5 text-gray-600"}),"Client Information"]}),c.jsx(S,{variant:"outline",size:"sm",onClick:()=>i(!0),children:"Edit"})]})}),c.jsxs(f,{className:"space-y-4",children:[e.clientName?c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(p,{className:"h-4 w-4 text-gray-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Name"}),c.jsx("p",{className:"font-medium",children:e.clientName})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ce,{className:"h-4 w-4 text-gray-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Phone"}),c.jsx("p",{children:(_=e.clientPhone||"",_?_.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3"):"Not provided")})]})]}),e.clientEmail&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(me,{className:"h-4 w-4 text-gray-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),c.jsx("p",{children:e.clientEmail})]})]})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(y,{className:"h-4 w-4 text-gray-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"License Plate"}),c.jsx("p",{className:"font-mono",children:e.clientLicensePlate||"Not provided"})]})]}),e.clientAddress&&c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(D,{className:"h-4 w-4 text-gray-500 mt-1"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Address"}),c.jsx("p",{className:"text-sm",children:e.clientAddress})]})]})]})]}):c.jsxs("div",{className:"text-center py-6",children:[c.jsx(p,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),c.jsx("p",{className:"text-gray-500 mb-4",children:"No client information available"}),c.jsx(S,{onClick:()=>i(!0),children:"Add Client Information"})]}),e.notes&&c.jsx("div",{className:"border-t pt-4",children:c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(he,{className:"h-4 w-4 text-gray-500 mt-1"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm font-medium text-gray-500 mb-1",children:"Notes"}),c.jsx("p",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded-md",children:e.notes})]})]})})]})]}),e.testDriveHistory&&e.testDriveHistory.length>0&&c.jsxs(g,{children:[c.jsx(v,{children:c.jsxs(j,{className:"flex items-center gap-2 text-lg",children:[c.jsx(b,{className:"h-5 w-5 text-gray-600"}),"Test Drive History"]})}),c.jsx(f,{children:c.jsx("div",{className:"space-y-3",children:e.testDriveHistory.map((e,s)=>c.jsxs("div",{className:"border rounded-md p-3 bg-gray-50",children:[c.jsxs("div",{className:"flex justify-between items-start mb-2",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:e.testDriverName}),c.jsx("p",{className:"text-sm text-gray-500",children:e.testDriverPhone})]}),c.jsx(N,{variant:e.isClientTestDrive?"default":"outline",children:e.isClientTestDrive?"Client":"Employee"})]}),c.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Start:"})," ",e.testDriveStartTime?xe(new Date(e.testDriveStartTime),"PPP p"):"Not recorded"]}),e.testDriveEndTime&&c.jsxs("p",{children:[c.jsx("strong",{children:"End:"})," ",xe(new Date(e.testDriveEndTime),"PPP p")]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Duration:"})," ",e.testDriveDuration," minutes"]}),e.notes&&c.jsxs("p",{children:[c.jsx("strong",{children:"Notes:"})," ",e.notes]})]})]},s))})})]})]}),c.jsx(P,{children:r?c.jsxs("div",{className:"flex gap-2",children:[c.jsx(S,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),c.jsx(S,{type:"submit",onClick:l.handleSubmit(d),children:"Save Changes"})]}):c.jsx(S,{variant:"outline",onClick:t,children:"Close"})})]})});var _},Me=({open:e,onOpenChange:s,car:t,onSave:a})=>{const[r,i]=W.useState((null==t?void 0:t.deliveryDate)||""),[l,n]=W.useState((null==t?void 0:t.deliveryNotes)||"");H.useEffect(()=>{t&&(i(t.deliveryDate||""),n(t.deliveryNotes||""))},[t]);const o=(()=>{if(!r)return null;const e=new Date,s=new Date(r).getTime()-e.getTime();return Math.ceil(s/864e5)})(),d=null!==o&&o<=3&&o>=0,p=null!==o&&o<0;return c.jsx(m,{open:e,onOpenChange:s,children:c.jsxs(h,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto bg-white border border-gray-300 shadow-xl",children:[c.jsx(x,{className:"border-b border-gray-200 pb-4",children:c.jsxs(u,{className:"flex items-center gap-2 text-xl font-bold text-gray-900",children:[c.jsx(b,{className:"w-5 h-5 text-monza-yellow"}),"Set Delivery Date"]})}),t&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[c.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Vehicle Details"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"Model:"}),c.jsx("span",{className:"ml-2 font-medium",children:t.model})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"VIN:"}),c.jsx("span",{className:"ml-2 font-mono",children:t.vinNumber})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"Status:"}),c.jsx(N,{variant:"sold"===t.status?"default":"secondary",className:"ml-2",children:"sold"===t.status?"Sold":"Reserved"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"PDI Status:"}),c.jsx(N,{variant:t.pdiCompleted?"default":"secondary",className:"ml-2 "+(t.pdiCompleted?"bg-green-600 text-white":"bg-yellow-600 text-white"),children:t.pdiCompleted?c.jsx(c.Fragment,{children:"Complete"}):c.jsx(c.Fragment,{children:"Pending"})})]}),t.clientName&&c.jsxs("div",{className:"col-span-2",children:[c.jsx("span",{className:"text-gray-600",children:"Client:"}),c.jsx("span",{className:"ml-2 font-medium",children:t.clientName})]})]})]}),!t.pdiCompleted&&c.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded-lg",children:[c.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[c.jsx(_,{className:"w-4 h-4"}),c.jsx("span",{className:"font-medium",children:"PDI Required"})]}),c.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Pre-Delivery Inspection must be completed before vehicle delivery"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(I,{htmlFor:"deliveryDate",children:"Delivery Date *"}),c.jsxs("div",{className:"relative",children:[c.jsx(w,{id:"deliveryDate",type:"date",value:r,onChange:e=>{i(e.target.value)},min:(new Date).toISOString().split("T")[0],className:"w-full bg-yellow-50 border-2 border-yellow-300 focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500/20 text-black pr-12",placeholder:"Select delivery date",style:{colorScheme:"light",fontSize:"14px"}}),c.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"})]}),null!==o&&c.jsx("div",{className:"text-sm",children:p?c.jsxs("span",{className:"text-red-600 font-medium",children:["Overdue by ",Math.abs(o)," day(s)"]}):d?c.jsxs("span",{className:"text-yellow-600 font-medium",children:["Delivery in ",o," day(s) - PDI urgent!"]}):c.jsxs("span",{className:"text-gray-600",children:[o," day(s) until delivery"]})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(I,{htmlFor:"deliveryNotes",children:"Delivery Notes"}),c.jsx(C,{id:"deliveryNotes",placeholder:"Special delivery instructions, location, time preferences, etc.",value:l,onChange:e=>n(e.target.value),rows:3})]})]}),c.jsxs(P,{className:"flex gap-3 mt-6 pt-4 border-t border-gray-200",children:[c.jsx(S,{type:"button",variant:"outline",onClick:e=>{e.preventDefault(),e.stopPropagation(),i((null==t?void 0:t.deliveryDate)||""),n((null==t?void 0:t.deliveryNotes)||""),s(!1)},className:"flex-1 h-11 border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-all",children:"Cancel"}),c.jsx(S,{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),r?t&&r?(a(t.id,{deliveryDate:r,deliveryNotes:l}),F({title:"Delivery Date Set",description:`Delivery scheduled for ${new Date(r).toLocaleDateString()} for ${t.model}`}),s(!1)):F({title:"Error",description:"Please select a delivery date",variant:"destructive"}):F({title:"Missing Date",description:"Please select a delivery date",variant:"destructive"})},disabled:!r||!r.trim(),className:"flex-1 h-11 bg-monza-yellow text-monza-black hover:bg-monza-yellow/90 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed border-2 border-monza-yellow hover:border-monza-yellow/90 font-semibold transition-all",children:r?"Save Delivery Date":"Select Date First"})]})]})})},$e=({isOpen:e,onClose:s,car:t,currentLocation:a,onMoveComplete:r})=>{var i;const[l,n]=W.useState(""),[o,p]=W.useState(""),[v,j]=W.useState(!1),{toast:f}=O(),N=[{id:"showroom-floor-1",label:"Showroom Floor 1",description:"Main showroom display area",icon:E,floorValue:"SHOWROOM_1"},{id:"showroom-floor-2",label:"Showroom Floor 2",description:"Premium showroom display area",icon:E,floorValue:"SHOWROOM_2"},{id:"car-inventory",label:"Car Inventory",description:"General inventory storage",icon:k,floorValue:"CAR_INVENTORY"},{id:"garage-inventory",label:"Garage Inventory",description:"Service and repair area inventory",icon:M,floorValue:"GARAGE_INVENTORY"},{id:"schedule",label:"Schedule",description:"Scheduled for service or delivery",icon:K,floorValue:"SCHEDULE"}].filter(e=>e.floorValue!==a);H.useEffect(()=>{},[e,t,a,N]),H.useEffect(()=>{},[l,v]);const b=()=>d(void 0,null,function*(){if(!l)return void f({title:"Error",description:"Please select a destination.",variant:"destructive"});const e=N.find(e=>e.id===l);if(e){j(!0);try{const{data:l,error:d}=yield $.from("car_inventory").select("count").limit(1);if(d)throw new Error(`Database connection failed: ${d.message}`);const{data:c,error:m}=yield $.from("car_inventory").select("id, vin, model, current_floor, current_location").eq("id",t.id).single();if(m)throw new Error(`Car not found in database: ${m.message}`);let h,x;try{if(o&&o.trim()){const s=yield $.rpc("move_car_manual",{p_car_id:t.id,p_to:e.floorValue,p_notes:o});h=s.data,x=s.error}else{const s=yield $.rpc("move_car",{p_car_id:t.id,p_to:e.floorValue});h=s.data,x=s.error}}catch(a){try{const s={location:e.floorValue,updated_at:(new Date).toISOString(),notes:o?`${o} (Moved on ${(new Date).toLocaleDateString()})`:void 0},a=yield $.from("car_inventory").update(s).eq("id",t.id).select().single();h=a.data,x=a.error}catch(i){x=a}}if(x){if(x.message&&x.message.includes("audit_log"))throw new Error("Database audit system needs to be configured. Please run the complete-database-fix.sql script in Supabase.");if(x.message&&x.message.includes("car_inventory"))throw new Error("Database table structure mismatch. Please run the complete-database-fix.sql script in Supabase to create the required views.");if(x.message&&x.message.includes("move_car"))throw new Error("Database RPC functions missing. Please run the complete-database-fix.sql script in Supabase.");throw x}f({title:"Car Moved Successfully",description:`${t.brand||""} ${t.model} has been moved to ${e.label}.`}),r&&r(),s(),n(""),p(""),setTimeout(()=>{window.location.reload()},500)}catch(d){f({title:"Move Failed",description:d.message||"Failed to move car. Please try again.",variant:"destructive"})}finally{j(!1)}}else f({title:"Error",description:"Invalid destination selected.",variant:"destructive"})}),w=()=>{n(""),p(""),s()};return c.jsx(m,{open:e,onOpenChange:w,children:c.jsxs(h,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto",children:[c.jsxs(x,{children:[c.jsxs(u,{className:"flex items-center gap-2",children:[c.jsx(y,{className:"h-5 w-5"}),"Move Car"]}),c.jsx(V,{id:"move-car-desc",children:"Choose where to move this vehicle. This updates its current location in the system."})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[c.jsx("h3",{className:"font-medium text-sm text-gray-700 mb-1",children:"Moving Vehicle:"}),c.jsxs("p",{className:"text-sm",children:[c.jsxs("span",{className:"font-medium",children:[t.brand||""," ",t.model]}),t.year&&c.jsxs("span",{className:"text-gray-600",children:[" (",t.year,")"]})]}),c.jsxs("p",{className:"text-xs text-gray-600 font-mono",children:["VIN: ",t.vinNumber]}),t.color&&c.jsxs("p",{className:"text-xs text-gray-600",children:["Color: ",t.color]})]}),c.jsxs("div",{children:[c.jsx(I,{className:"text-sm font-medium",children:"Select Destination *"}),l&&c.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["âœ… Selected: ",null==(i=N.find(e=>e.id===l))?void 0:i.label]}),c.jsx("div",{className:"grid gap-2 mt-2",children:N.map(e=>{const s=e.icon;return c.jsx(g,{className:"p-3 cursor-pointer transition-all hover:bg-gray-50 "+(l===e.id?"ring-2 ring-blue-500 bg-blue-50":"border-gray-200"),onClick:()=>{n(e.id)},children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(s,{className:"h-5 w-5 text-gray-600"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"font-medium text-sm",children:e.label}),c.jsx("p",{className:"text-xs text-gray-600",children:e.description})]}),c.jsx("div",{className:"w-4 h-4 rounded-full border-2 "+(l===e.id?"bg-blue-500 border-blue-500":"border-gray-300"),children:l===e.id&&c.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})})]})},e.id)})})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"move-notes",className:"text-sm font-medium",children:"Move Notes (Optional)"}),c.jsx(C,{id:"move-notes",placeholder:"Add any notes about this move...",value:o,onChange:e=>p(e.target.value),className:"mt-1 resize-none",rows:3})]}),c.jsxs("div",{className:"flex gap-2 pt-2",children:[c.jsx(S,{variant:"outline",onClick:w,disabled:v,className:"flex-1",children:"Cancel"}),c.jsx(S,{onClick:e=>{e.preventDefault(),e.stopPropagation(),b()},onMouseDown:e=>{},disabled:v||!l,className:"flex-1 bg-blue-600 hover:bg-blue-700 !cursor-pointer",style:{pointerEvents:"auto"},children:v?"Moving...":"Move Car"})]}),c.jsx("div",{className:"mt-2",children:c.jsx("button",{onClick:()=>{b()},disabled:v||!l,className:"w-full p-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-400",children:"ðŸ§ª TEST: Move Car (Alternative Button)"})}),c.jsxs("div",{className:"text-xs text-gray-500 mt-2 p-2 bg-gray-50 rounded",children:[c.jsxs("p",{children:['ðŸ” Debug: selectedDestination = "',l,'"']}),c.jsxs("p",{children:["ðŸ” Debug: isMoving = ",v.toString()]}),c.jsxs("p",{children:["ðŸ” Debug: buttonDisabled = ",(v||!l).toString()]})]})]})]})})},Ae=()=>{const e=A(),[s,t]=W.useState([]),[a,r]=W.useState(null),[i,l]=W.useState(!1),[p,b]=W.useState(!1),[C,D]=W.useState(!0),[P,_]=W.useState(!1),[O,V]=W.useState(!1),[E,k]=W.useState(!1),[M,$]=W.useState(!1),[H,K]=W.useState(!1),[X,Z]=W.useState(!1),[ee,se]=W.useState(!1),[te,ae]=W.useState(!1),[re,ie]=W.useState(null),[le,ne]=W.useState(!1),[oe,de]=W.useState(null),[ce,me]=W.useState(!1),[he,xe]=W.useState(null),[Ee,Ae]=W.useState(!1),[Te,Le]=W.useState(!1),[Re,qe]=W.useState(null),[Ue,ze]=W.useState(!1),[We,He]=W.useState(null),[Be,Je]=W.useState(!1),[Ge,Ye]=W.useState(null),[Ke,Qe]=W.useState(""),Xe=Pe(),Ze=s.filter(e=>{var s,t,a,r,i,l,n,o,d,c,m;if(!Ke.trim())return!0;const h=Ke.toLowerCase();return(null==(s=e.vinNumber)?void 0:s.toLowerCase().includes(h))||(null==(t=e.model)?void 0:t.toLowerCase().includes(h))||(null==(a=e.color)?void 0:a.toLowerCase().includes(h))||(null==(r=e.category)?void 0:r.toLowerCase().includes(h))||(null==(i=e.status)?void 0:i.toLowerCase().includes(h))||(null==(l=e.brand)?void 0:l.toLowerCase().includes(h))||(null==(n=e.clientName)?void 0:n.toLowerCase().includes(h))||(null==(o=e.clientPhone)?void 0:o.toLowerCase().includes(h))||(null==(d=e.notes)?void 0:d.toLowerCase().includes(h))||(null==(c=e.year)?void 0:c.toString().includes(h))||(null==(m=e.price)?void 0:m.toString().includes(h))}),[es,ss]=W.useState({vinNumber:"",model:"Voyah Dream",brand:"Voyah",year:(new Date).getFullYear(),color:"",price:0,batteryPercentage:100,range:0,status:"available",customs:"not paid",pdiStatus:"pending",category:"EV",horsePower:0,torque:0,acceleration:"",topSpeed:0,chargingTime:"",warranty:"",location:"Showroom Floor 1"}),[ts,as]=W.useState(0),rs=()=>d(void 0,null,function*(){try{const{getCarsByFloor:e}=yield z(()=>d(void 0,null,function*(){const{getCarsByFloor:e}=yield import("./cleanMoveCarService-W7bZHGm6.js");return{getCarsByFloor:e}}),__vite__mapDeps([0,1,2,3,4,5])),s=yield e("SHOWROOM_1");if(s&&s.length>0){const e=s.map(e=>({id:e.id,vinNumber:e.vin,model:e.model,year:e.year,color:e.color,brand:e.brand,category:e.vehicle_type||"EV",price:e.selling_price||0,status:e.status||"in_stock",batteryPercentage:e.battery_percentage||100,range:520,features:[],arrivalDate:e.delivery_date||e.created_at,pdiCompleted:e.pdi_completed||!1,pdiStatus:e.pdi_completed?"completed":"pending",pdiTechnician:e.pdi_technician,pdiDate:e.pdi_date,pdiNotes:e.pdi_notes,customs:"not paid",currentFloor:e.current_floor,notes:e.notes,lastModified:e.updated_at,warranty_life:e.warranty_life||null,delivery_date:e.delivery_date||null,vehicle_expiry_date:e.vehicle_expiry_date||null,battery_expiry_date:e.battery_expiry_date||null,dms_deadline_date:e.dms_deadline_date||null}));t(e)}else t([])}catch(e){t([])}});W.useEffect(()=>{rs()},[]),W.useEffect(()=>{const t=new URLSearchParams(e.search).get("vin");t&&setTimeout(()=>{const e=s.find(e=>{var s;return null==(s=e.vinNumber)?void 0:s.toLowerCase().includes(t.toLowerCase())});F(e?{title:"Car Found in Showroom Floor 1",description:`Showing ${e.brand||"Vehicle"} ${e.model} (VIN: ${e.vinNumber})`,duration:5e3}:{title:"Car Not Found",description:`No car found with VIN: ${t} in Showroom Floor 1`,variant:"destructive",duration:5e3})},500)},[e.search,s]);const is=e=>{de(e),ne(!0)},ls=e=>{switch(e){case"in_stock":return"bg-green-100 text-green-800";case"reserved":return"bg-yellow-100 text-yellow-800";case"sold":return"bg-red-100 text-red-800";case"in_repair":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},ns=e=>{switch(e){case"in_stock":return"Available";case"reserved":return"Reserved";case"sold":return"Sold";case"in_repair":return"In Repair";default:return e}},os=e=>{switch(String(e)){case"EV":default:return"category-ev";case"REV":return"category-rev";case"ICEV":return"category-icev"}},ds=e=>{const s="reserved"===e.status||"sold"===e.status,t="in_repair"===e.status,a=e.deliveryDate;(s||t)&&a&&!e.pdiCompleted||!e.pdiCompleted?(r(e),Ae(!0)):(e=>{r(e),se(!0)})(e)};return c.jsx(Ie,{onSaved:()=>{},children:c.jsxs("div",{className:"container mx-auto py-6",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(y,{className:"h-8 w-8 text-monza-grey"}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Showroom Floor 1"}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Main showroom display area"})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(S,{onClick:()=>k(!0),variant:"outline",className:"flex items-center gap-2 border-green-200 text-green-700 hover:bg-green-50",size:"sm",children:[c.jsx(T,{className:"h-4 w-4"}),"VIN Scanner"]}),c.jsxs(S,{onClick:()=>V(!0),variant:"default",className:"flex items-center gap-2 bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",size:"sm",children:[c.jsx(L,{className:"h-4 w-4"}),"Add Car Manually"]})]})]}),c.jsxs(g,{children:[c.jsx(v,{children:c.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[c.jsxs(j,{children:["Cars on Display (",Ze.length," ",Ke?`of ${s.length}`:"",")"]}),c.jsx(Ce,{id:"showroom-floor1-search",value:Ke,onChange:Qe,placeholder:"Search VINs, models, clients, colors...",className:"w-full sm:w-auto"})]})}),c.jsx(f,{children:c.jsx("div",{className:"overflow-x-auto",children:c.jsxs(ue,{children:[c.jsx(pe,{children:c.jsxs(ge,{children:[c.jsx(ve,{children:"VIN"}),c.jsx(ve,{children:"Model"}),c.jsx(ve,{children:"Category"}),c.jsx(ve,{children:"Year"}),c.jsx(ve,{children:"Color"}),c.jsx(ve,{children:"Color interior"}),c.jsx(ve,{children:"Price"}),c.jsx(ve,{children:"Status"}),c.jsx(ve,{children:"Warranty Life"}),c.jsx(ve,{children:"Battery"}),c.jsx(ve,{children:"Range Capacity"}),c.jsx(ve,{children:"Km Driven"}),c.jsx(ve,{children:"Test Drive"}),c.jsx(ve,{children:"PDI"}),c.jsx(ve,{children:"Customs"}),c.jsx(ve,{children:"Software Model"}),c.jsx(ve,{children:"Actions"})]})}),c.jsx(je,{children:Ze.map(e=>{var t,a;return c.jsxs(ge,{children:[c.jsx(ye,{className:"font-mono text-sm",children:e.vinNumber}),c.jsx(ye,{className:"font-medium",children:e.model}),c.jsx(ye,{children:c.jsx(N,{className:os(e.category),children:e.category})}),c.jsx(ye,{children:e.year||e.modelYear||"N/A"}),c.jsx(ye,{children:e.color}),c.jsx(ye,{children:e.interiorColor||e.interior_color||"-"}),c.jsxs(ye,{children:["$",e.price?e.price.toLocaleString():"0"]}),c.jsx(ye,{children:"sold"===e.status||"reserved"===e.status?c.jsx(N,{className:`${ls(e.status)} cursor-pointer hover:opacity-80 transition-opacity`,onClick:s=>{s.preventDefault(),s.stopPropagation(),is(e)},title:"Click to view client information",children:ns(e.status)}):c.jsx(N,{className:`${ls(e.status)} cursor-pointer hover:opacity-80 transition-opacity`,onClick:s=>{s.preventDefault(),s.stopPropagation(),is(e)},title:"Click to add client information",children:ns(e.status)})}),c.jsx(Fe,{car:e}),c.jsx(ye,{children:c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Oe,{className:"h-4 w-4"}),e.batteryPercentage||0,"%"]})}),c.jsx(ye,{children:c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Ve,{className:"h-4 w-4"}),e.range||0," km"]})}),c.jsx(ye,{children:c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(R,{className:"h-4 w-4"}),e.mileage||e.kmDriven||0," km"]})}),c.jsx(ye,{children:(null==(t=e.testDriveInfo)?void 0:t.isOnTestDrive)?c.jsx(N,{variant:"outline",className:"bg-blue-50 text-blue-600",children:"On Test Drive"}):"sold"===e.status||"reserved"===e.status?c.jsx(N,{variant:"outline",className:"bg-gray-50 text-gray-500",children:"Not Available"}):c.jsx(N,{variant:"outline",className:"bg-gray-50 text-gray-500 cursor-pointer hover:bg-blue-50 hover:text-blue-600 transition-colors",onClick:t=>{t.preventDefault(),t.stopPropagation(),(e=>{const t=s.find(s=>s.id===e);t&&(l(!1),r(t),b(!0))})(e.id,(e.model,e.vinNumber))},title:"Click to schedule test drive",children:"Available"})}),c.jsx(ye,{children:c.jsx("div",{className:"cursor-pointer",onClick:()=>ds(e),children:c.jsx(fe,{variant:(a=e.pdiCompleted,a?"success":"warning"),children:e.pdiCompleted?c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"mr-1 text-lg",children:"â˜º"})," Complete"]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"mr-1 text-lg",children:"â˜¹"})," Pending"]})})})}),c.jsx(ye,{children:c.jsx(N,{variant:"paid"===e.customs?"default":"destructive",className:"cursor-pointer hover:opacity-80 transition-opacity active:scale-95",onClick:()=>(e=>{Ye(e),Je(!0)})(e),title:"Click to manage customs payment",children:"paid"===e.customs?c.jsxs(c.Fragment,{children:[c.jsx(q,{className:"mr-1 h-4 w-4"})," paid"]}):c.jsxs(c.Fragment,{children:[c.jsx(U,{className:"mr-1 h-4 w-4"})," ",e.customs||"not paid"]})})}),c.jsx(ye,{children:c.jsx("div",{className:"flex items-center gap-1 text-xs cursor-pointer",onClick:()=>(e=>{He(e),ze(!0)})(e),title:"Click to manage software updates",children:e.softwareVersion?c.jsxs(c.Fragment,{children:[c.jsxs(N,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:["v",e.softwareVersion]}),e.softwareLastUpdated&&c.jsx("span",{className:"text-gray-500",children:new Date(e.softwareLastUpdated).toLocaleDateString()})]}):c.jsx(N,{variant:"secondary",className:"text-xs text-yellow-700 bg-yellow-100 hover:bg-yellow-200 transition-colors",children:"Update Needed"})})}),c.jsx(ye,{children:c.jsx("div",{className:"flex gap-2 items-center",children:c.jsx(Ne,{options:[{value:"details",label:"View Details"},{value:"edit",label:"Edit Car"},{value:"move",label:"Move Car"}],onAction:s=>{"details"===s?(e=>{qe(e),Le(!0)})(e):"edit"===s?(r(e),$(!0)):"move"===s&&(r(e),Z(!0))},id:`actions-${e.id}`,ariaLabel:`Actions for ${e.model} ${e.vinNumber}`})})})]},e.id)})})]})})})]}),c.jsx(m,{open:O,onOpenChange:V,children:c.jsxs(h,{className:"sm:max-w-[700px] w-[95vw] px-6 py-6","aria-describedby":"add-car-floor1-description",children:[c.jsxs(x,{children:[c.jsxs(u,{className:"flex items-center gap-2",children:[c.jsx(y,{className:"h-5 w-5"}),"Add Car to Showroom Floor 1"]}),c.jsx("p",{id:"add-car-floor1-description",className:"text-sm text-gray-600",children:"Add a new vehicle to the showroom floor 1 inventory with complete details"})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx(I,{htmlFor:"vinNumber",children:"VIN Number *"}),c.jsx(w,{id:"vinNumber",value:es.vinNumber,onChange:e=>ss(s=>o(n({},s),{vinNumber:e.target.value})),placeholder:"Enter VIN number",required:!0})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"model",children:"Model *"}),c.jsxs("select",{id:"model",value:es.model,onChange:e=>ss(s=>o(n({},s),{model:e.target.value})),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",required:!0,children:[c.jsx("option",{value:"Voyah Dream",children:"Voyah Dream"}),c.jsx("option",{value:"Voyah Free",children:"Voyah Free"}),c.jsx("option",{value:"Voyah Passion",children:"Voyah Passion"}),c.jsx("option",{value:"Voyah Free 318",children:"Voyah Free 318"}),c.jsx("option",{value:"Mhero",children:"Mhero"})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx(I,{htmlFor:"year",children:"Year *"}),c.jsx(w,{id:"year",type:"number",min:"2020",max:"2030",value:es.year,onChange:e=>ss(s=>o(n({},s),{year:Se(e.target.value,2024)})),required:!0})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"color",children:"Color *"}),c.jsx(w,{id:"color",value:es.color,onChange:e=>ss(s=>o(n({},s),{color:e.target.value})),placeholder:"e.g., Midnight Silver",required:!0})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx(I,{htmlFor:"category",children:"Category *"}),c.jsxs("select",{id:"category",value:es.category,onChange:e=>ss(s=>o(n({},s),{category:e.target.value})),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",required:!0,children:[c.jsx("option",{value:"EV",children:"EV (Electric Vehicle)"}),c.jsx("option",{value:"REV",children:"REV (Range Extended Vehicle)"}),c.jsx("option",{value:"ICEV",children:"ICEV (Internal Combustion Engine)"})]})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"price",children:"Price (USD) *"}),c.jsx(w,{id:"price",type:"number",min:"0",value:es.price,onChange:e=>ss(s=>o(n({},s),{price:Se(e.target.value,0)})),placeholder:"e.g., 85000",required:!0})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx(I,{htmlFor:"status",children:"Status"}),c.jsxs("select",{id:"status",value:es.status,onChange:e=>ss(s=>o(n({},s),{status:e.target.value})),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",children:[c.jsx("option",{value:"available",children:"Available"}),c.jsx("option",{value:"sold",children:"Sold"}),c.jsx("option",{value:"reserved",children:"Reserved"}),c.jsx("option",{value:"pending",children:"Pending"})]})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"batteryPercentage",children:"Battery %"}),c.jsx(w,{id:"batteryPercentage",type:"number",min:"0",max:"100",value:es.batteryPercentage,onChange:e=>ss(s=>o(n({},s),{batteryPercentage:Se(e.target.value,85)}))})]})]}),c.jsx("div",{className:"grid grid-cols-1 gap-6",children:c.jsxs("div",{children:[c.jsx(I,{htmlFor:"range",children:"Range (km)"}),c.jsx(w,{id:"range",type:"number",min:"0",value:es.range,onChange:e=>ss(s=>o(n({},s),{range:Se(e.target.value,520)})),placeholder:"e.g., 520"})]})}),c.jsxs("details",{className:"border rounded-none p-4",children:[c.jsx("summary",{className:"font-medium cursor-pointer",children:"Technical Specifications (Optional)"}),c.jsxs("div",{className:"grid grid-cols-2 gap-6 mt-4",children:[c.jsxs("div",{children:[c.jsx(I,{htmlFor:"horsePower",children:"Horse Power"}),c.jsx(w,{id:"horsePower",type:"number",min:"0",value:es.horsePower,onChange:e=>ss(s=>o(n({},s),{horsePower:Se(e.target.value,0)})),placeholder:"e.g., 408"})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"torque",children:"Torque (Nm)"}),c.jsx(w,{id:"torque",type:"number",min:"0",value:es.torque,onChange:e=>ss(s=>o(n({},s),{torque:Se(e.target.value,0)})),placeholder:"e.g., 700"})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"acceleration",children:"0-100 km/h (seconds)"}),c.jsx(w,{id:"acceleration",value:es.acceleration,onChange:e=>ss(s=>o(n({},s),{acceleration:e.target.value})),placeholder:"e.g., 4.5"})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"topSpeed",children:"Top Speed (km/h)"}),c.jsx(w,{id:"topSpeed",type:"number",min:"0",value:es.topSpeed,onChange:e=>ss(s=>o(n({},s),{topSpeed:Se(e.target.value,0)})),placeholder:"e.g., 200"})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"chargingTime",children:"Charging Time (10-80%)"}),c.jsx(w,{id:"chargingTime",value:es.chargingTime,onChange:e=>ss(s=>o(n({},s),{chargingTime:e.target.value})),placeholder:"e.g., 30 minutes"})]}),c.jsxs("div",{children:[c.jsx(I,{htmlFor:"warranty",children:"Warranty"}),c.jsx(w,{id:"warranty",value:es.warranty,onChange:e=>ss(s=>o(n({},s),{warranty:e.target.value})),placeholder:"e.g., 4 years / 80,000 km"})]})]})]})]}),c.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t mt-4",children:[c.jsx(S,{variant:"outline",onClick:()=>V(!1),children:"Cancel"}),c.jsx(S,{onClick:()=>{if(!es.vinNumber||!es.model||!es.color)return void F({title:"Missing Information",description:"Please fill in VIN, model, and color",variant:"destructive"});if(s.find(e=>e.vinNumber===es.vinNumber))return void F({title:"VIN Already Exists",description:"A car with this VIN is already in Floor 1",variant:"destructive"});const e=es.vinNumber&&es.model&&es.color&&es.price>0&&es.batteryPercentage>0&&es.range>0,a=o(n({id:`floor1-manual-${Date.now()}`},es),{status:"in_stock",features:[],arrivalDate:(new Date).toISOString(),pdiCompleted:e,pdiStatus:e?"completed":"pending",pdiDate:e?(new Date).toISOString():void 0,pdiTechnician:e?"System Auto-Complete":void 0,pdiNotes:e?"PDI auto-completed - all required fields filled during registration":void 0}),r=[...s,a];t(r),V(!1),ss({vinNumber:"",model:"Voyah Dream",brand:"Voyah",year:(new Date).getFullYear(),color:"",price:0,batteryPercentage:100,range:0,status:"available",customs:"not paid",pdiStatus:"pending",category:"EV",horsePower:0,torque:0,acceleration:"",topSpeed:0,chargingTime:"",warranty:"",location:"Showroom Floor 1"}),as(0),F({title:"Car Added",description:`${es.model} added to Floor 1${e?" - PDI auto-completed":" - PDI pending"}`})},className:"bg-monza-yellow hover:bg-monza-yellow/90 text-black",children:"Add Car to Showroom"})]})]})}),E&&c.jsx(B,{isOpen:E,onClose:()=>k(!1),onVinScanned:e=>{rs(),F({title:"VIN Scanned Successfully",description:`VIN ${e} has been processed for Floor 1.`})},targetLocation:"Showroom Floor 1",onCarMoved:(e,s,a)=>{F({title:"Car Moved",description:`Car moved from ${s} to ${a}`});t((()=>{const e=localStorage.getItem("showroomFloor1Cars");if(e)try{return JSON.parse(e).map(e=>o(n({},e),{category:e.category||"EV"}))}catch(s){}return[]})())},onCarAdded:e=>{}}),c.jsx(J,{isOpen:H,onClose:()=>K(!1),car:a,onMoveCar:(e,i)=>{if(!a)return;const l=(new Date).toISOString(),d=e=>e.filter(e=>e.vinNumber!==a.vinNumber),c=()=>{const e=s.filter(e=>e.id!==a.id);t(e)};if("garage-schedule"===e){const e=localStorage.getItem("garageSchedule"),s=e?JSON.parse(e):{scheduledCars:[]},t={id:Date.now().toString(),vinNumber:a.vinNumber,model:a.model,brand:a.brand,year:a.year,color:a.color,status:"waiting",priority:"normal",estimatedDuration:120,notes:i||"Moved from Showroom Floor 1",clientName:a.clientName||"",clientPhone:a.clientPhone||"",arrivalTime:l,scheduledTime:l};s.scheduledCars=d(s.scheduledCars||[]),s.scheduledCars.push(t),localStorage.setItem("garageSchedule",JSON.stringify(s)),F({title:"Car Added to Garage Schedule",description:`${a.model} added to schedule.`}),c()}else if("garage"===e){const e=d(JSON.parse(localStorage.getItem("garageCars")||"[]"));e.push(o(n({},a),{id:`garage-${Date.now()}`,currentFloor:"Garage",lastModified:l})),localStorage.setItem("garageCars",JSON.stringify(e)),F({title:"Car Moved",description:`${a.model} moved to Garage Inventory.`}),c()}else if("inventory"===e){const e=d(JSON.parse(localStorage.getItem("carInventory")||"[]"));e.push(o(n({},a),{id:`inventory-${Date.now()}`,lastModified:l})),localStorage.setItem("carInventory",JSON.stringify(e)),F({title:"Car Moved",description:`${a.model} moved to Car Inventory.`}),c()}else if("floor2"===e){const e=d(JSON.parse(localStorage.getItem("showroomFloor2Cars")||"[]"));e.push(o(n({},a),{id:`floor2-${Date.now()}`,currentFloor:"Showroom Floor 2",lastModified:l})),localStorage.setItem("showroomFloor2Cars",JSON.stringify(e)),F({title:"Car Moved",description:`${a.model} moved to Showroom Floor 2.`}),c()}else{if("new-arrivals"===e)return F({title:"Not Allowed",description:"Existing cars cannot be moved to New Arrivals.",variant:"destructive"}),K(!1),void r(null);F({title:"Move Failed",description:"Unknown destination.",variant:"destructive"})}K(!1),r(null)}}),c.jsx(G,{isOpen:M,onClose:()=>$(!1),car:a,onSave:(e,a)=>{const r=s.map(s=>s.id===e?n(n({},s),a):s);t(r),F({title:"Car Updated",description:"Car information has been updated"})}}),c.jsx(Y,{isOpen:ee,onClose:()=>se(!1),car:a,onPdiComplete:(e,a)=>{const r=s.map(s=>s.id===e?o(n({},s),{pdiCompleted:!0,pdiTechnician:a.technician,pdiNotes:a.notes,pdiPhotos:a.photos,pdiDate:(new Date).toISOString()}):s);t(r),F({title:"PDI Completed",description:"Pre-Delivery Inspection has been completed successfully."})}}),te&&re&&c.jsx(ke,{car:re,isOpen:te,onClose:()=>{ae(!1),ie(null)},onSave:e=>{if(!re)return;const a=s.map(s=>s.id===re.id?o(n(n({},s),e),{lastUpdated:(new Date).toISOString(),status:"in_stock"===s.status?"reserved":s.status}):s);t(a),F({title:"Client Information Updated",description:`Customer details updated for ${re.model}`})}}),le&&oe&&c.jsx(be,{isOpen:le,onClose:()=>{ne(!1),de(null)},car:oe,onStatusUpdate:(e,a,r)=>{var i;const l=s.map(s=>s.id===e?o(n(o(n({},s),{status:a}),r||{}),{lastUpdated:(new Date).toISOString()}):s);t(l),F({title:"Car Status Updated",description:`${null==(i=s.find(s=>s.id===e))?void 0:i.model} status updated to ${a.replace("_"," ")}`})}}),Ge&&c.jsx(we,{open:Be,onOpenChange:Je,car:Ge,onCustomsUpdate:(e,a)=>d(void 0,null,function*(){try{const r={customsStatus:a.customs_status,customsCost:a.customs_cost,shippingCost:a.shipping_cost,processedBy:a.processed_by,paymentDate:a.payment_date,customsDocRef:a.customs_doc_ref,customsNotes:a.customs_notes,shippingStatus:a.shipping_status,currentFloor:a.current_location,status:a.status,conditionOnArrival:a.condition_on_arrival},{data:i,error:l}=yield De.updateCar(e,r);if(l)throw l;const d=s.map(s=>s.id===e?o(n(n({},s),a),{lastUpdated:(new Date).toISOString()}):s);t(d),localStorage.setItem("showroomFloor1Cars",JSON.stringify(d)),F({title:"Customs Updated",description:"Customs information has been updated successfully and saved to database"})}catch(r){F({title:"Update Failed",description:"Failed to update customs information. Please try again.",variant:"destructive"})}})}),c.jsx(Me,{open:ce,onOpenChange:me,car:he,onSave:(e,a)=>{const r=s.map(s=>s.id===e?o(n({},s),{deliveryDate:a.deliveryDate,deliveryNotes:a.deliveryNotes,lastUpdated:(new Date).toISOString()}):s);t(r),me(!1),F({title:"Delivery Date Updated",description:"Delivery date has been set successfully."})}}),c.jsx(Q,{isOpen:Ee,onClose:()=>Ae(!1),car:a,onSave:(e,s)=>{Ae(!1),F({title:"PDI Checklist Saved",description:`PDI checklist has been ${s?"completed":"saved"} successfully.`})}}),c.jsx(_e,{isOpen:Xe.isWarrantyDialogOpen,onClose:Xe.closeWarrantyDialog,carId:Xe.selectedCarId||"",tableName:Xe.selectedTableName||"cars",currentWarranty:Xe.selectedCarWarranty||void 0,onSave:Xe.handleWarrantySave}),c.jsx($e,{isOpen:X,onClose:()=>Z(!1),car:a||{id:"",vinNumber:"",model:""},currentLocation:"SHOWROOM_1",onMoveComplete:()=>{Z(!1),r(null),rs()}})]})})};export{Ae as default};
