var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,n=(e,n)=>{for(var c in n||(n={}))s.call(n,c)&&r(e,c,n[c]);if(t)for(var c of t(n))a.call(n,c)&&r(e,c,n[c]);return e},c=(e,t,s)=>r(e,"symbol"!=typeof t?t+"":t,s),i=(e,t,s)=>new Promise((a,r)=>{var n=e=>{try{i(s.next(e))}catch(t){r(t)}},c=e=>{try{i(s.throw(e))}catch(t){r(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,c);i((s=s.apply(e,t)).next())});import{a8 as l,j as o,C as d,g as u,h as y,aV as h,R as g,a as m,k as x,e as p,w as b,c as f,d as v,n as S,m as T}from"./index-BmUpYGrm.js";import{r as j}from"./vendor-vN6PtkFd.js";import{c as N}from"./carClientLinkingService-K_T_il58.js";import{s as w,c as k}from"./errorHandling-Dc1u_gNS.js";import{R as D}from"./refresh-cw-C6MAcERo.js";import{A as L}from"./arrow-right-iDmV9z1N.js";import{X as C}from"./x-circle-HKM8FhbF.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=l("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const I=new class{constructor(){c(this,"STORAGE_KEY","tabDataLinks"),c(this,"SYNC_LOG_KEY","tabSyncLog"),c(this,"CROSS_TAB_DATA_KEY","crossTabData")}getAllTabLinks(){try{return w(this.STORAGE_KEY,[])}catch(e){return[]}}createTabLink(e,t,s,a="bidirectional"){try{const r=(new Date).toISOString(),n={sourceTab:e,targetTab:t,dataType:s,syncDirection:a,lastSync:r,syncStatus:"pending"},c=this.getAllTabLinks(),i=c.findIndex(a=>a.sourceTab===e&&a.targetTab===t&&a.dataType===s);i>=0?c[i]=n:c.push(n),k(this.STORAGE_KEY,c)}catch(r){}}syncDataBetweenTabs(e,t,s,a){return i(this,null,function*(){try{const n=(new Date).toISOString();this.updateTabLinkStatus(e,t,s,"pending");let c=!1;try{switch(s){case"car":c=yield this.syncCarData(e,t,a);break;case"client":c=yield this.syncClientData(e,t,a);break;case"part":c=yield this.syncPartData(e,t,a);break;case"repair":c=yield this.syncRepairData(e,t,a);break;case"test_drive":c=yield this.syncTestDriveData(e,t,a);break;case"order":c=yield this.syncOrderData(e,t,a);break;default:return!1}const r=c?"success":"error";return this.updateTabLinkStatus(e,t,s,r),this.logTabSync(e,t,s,c,n),c}catch(r){return this.updateTabLinkStatus(e,t,s,"error",r instanceof Error?r.message:"Unknown error"),this.logTabSync(e,t,s,!1,n),!1}}catch(r){return!1}})}syncCarData(e,t,s){return i(this,null,function*(){try{const e=this.getStorageKeyForTab(t);if(!e)return!1;const a=w(e,[]),r=a.findIndex(e=>e.id===s.id||e.vinNumber===s.vinNumber);return r>=0?a[r]=n(n({},a[r]),s):a.push(s),k(e,a),!0}catch(e){return!1}})}syncClientData(e,t,s){return i(this,null,function*(){try{return s.carId&&(yield N.linkCarWithClient(s.carId,s,s,`tab_sync_${e}_to_${t}`)),!0}catch(a){return!1}})}syncPartData(e,t,s){return i(this,null,function*(){try{const e=this.getStorageKeyForTab(t);if(!e)return!1;const a=w(e,[]),r=a.findIndex(e=>e.id===s.id||e.partNumber===s.partNumber);return r>=0?a[r]=n(n({},a[r]),s):a.push(s),k(e,a),!0}catch(e){return!1}})}syncRepairData(e,t,s){return i(this,null,function*(){try{const e=this.getStorageKeyForTab(t);if(!e)return!1;const a=w(e,[]),r=a.findIndex(e=>e.id===s.id||e.carId===s.carId);return r>=0?a[r]=n(n({},a[r]),s):a.push(s),k(e,a),!0}catch(e){return!1}})}syncTestDriveData(e,t,s){return i(this,null,function*(){try{const e=this.getStorageKeyForTab(t);if(!e)return!1;const a=w(e,[]),r=a.findIndex(e=>e.id===s.id||e.carId===s.carId);return r>=0?a[r]=n(n({},a[r]),s):a.push(s),k(e,a),!0}catch(e){return!1}})}syncOrderData(e,t,s){return i(this,null,function*(){try{const e=this.getStorageKeyForTab(t);if(!e)return!1;const a=w(e,[]),r=a.findIndex(e=>e.id===s.id||e.orderReference===s.orderReference);return r>=0?a[r]=n(n({},a[r]),s):a.push(s),k(e,a),!0}catch(e){return!1}})}getStorageKeyForTab(e){return{"car-inventory":"carInventory","showroom-floor-1":"showroomFloor1Cars","showroom-floor-2":"showroomFloor2Cars","inventory-floor-2":"inventoryFloor2","garage-schedule":"garageSchedule","repair-history":"repairHistory","inventory-garage":"garageCars","scan-vin":"scannedVins","test-drive-logs":"testDriveLogs","test-drive-scanner":"testDriveScanner","scan-part":"scannedParts","part-management":"partsInventory","inventory-history":"inventoryHistory","ordered-cars":"orderedCars","ordered-parts":"orderedParts","shipping-eta":"shippingEta","financial-dashboard":"financialData"}[e]||null}updateTabLinkStatus(e,t,s,a,r){try{const n=this.getAllTabLinks(),c=n.findIndex(a=>a.sourceTab===e&&a.targetTab===t&&a.dataType===s);-1!==c&&(n[c].syncStatus=a,n[c].lastSync=(new Date).toISOString(),r&&(n[c].errorMessage=r),k(this.STORAGE_KEY,n))}catch(n){}}logTabSync(e,t,s,a,r){try{const n=w(this.SYNC_LOG_KEY,[]),c={id:crypto.randomUUID(),sourceTab:e,targetTab:t,dataType:s,success:a,timestamp:r,errorMessage:a?void 0:"Sync failed"};n.push(c),k(this.SYNC_LOG_KEY,n)}catch(n){}}getCrossTabData(e){try{return w(this.CROSS_TAB_DATA_KEY,[]).find(t=>t.carId===e)||null}catch(t){return null}}updateCrossTabData(e){try{const t=w(this.CROSS_TAB_DATA_KEY,[]),s=t.findIndex(t=>t.carId===e.carId);s>=0?t[s]=e:t.push(e),k(this.CROSS_TAB_DATA_KEY,t)}catch(t){}}getTabSyncStatus(){try{const e=this.getAllTabLinks(),t=e.filter(e=>"success"===e.syncStatus).length,s=e.filter(e=>"error"===e.syncStatus).length,a=e.filter(e=>"pending"===e.syncStatus).length,r=e.sort((e,t)=>new Date(t.lastSync).getTime()-new Date(e.lastSync).getTime()).slice(0,10);return{totalLinks:e.length,successfulSyncs:t,failedSyncs:s,pendingSyncs:a,recentActivity:r}}catch(e){return{totalLinks:0,successfulSyncs:0,failedSyncs:0,pendingSyncs:0,recentActivity:[]}}}initializeTabLinks(){try{[{source:"car-inventory",target:"showroom-floor-1",type:"car"},{source:"car-inventory",target:"showroom-floor-2",type:"car"},{source:"car-inventory",target:"inventory-garage",type:"car"},{source:"car-inventory",target:"repair-history",type:"car"},{source:"showroom-floor-1",target:"showroom-floor-2",type:"car"},{source:"showroom-floor-2",target:"showroom-floor-1",type:"car"},{source:"showroom-floor-1",target:"car-inventory",type:"car"},{source:"showroom-floor-2",target:"car-inventory",type:"car"},{source:"inventory-garage",target:"garage-schedule",type:"car"},{source:"garage-schedule",target:"repair-history",type:"repair"},{source:"repair-history",target:"inventory-garage",type:"car"},{source:"scan-vin",target:"car-inventory",type:"car"},{source:"scan-part",target:"part-management",type:"part"},{source:"test-drive-scanner",target:"test-drive-logs",type:"test_drive"},{source:"test-drive-logs",target:"car-inventory",type:"car"},{source:"ordered-cars",target:"car-inventory",type:"order"},{source:"ordered-parts",target:"part-management",type:"order"},{source:"shipping-eta",target:"ordered-cars",type:"order"}].forEach(e=>{this.createTabLink(e.source,e.target,e.type)})}catch(e){}}},_=()=>{const[e,t]=j.useState([]),[s,a]=j.useState({totalLinks:0,successfulSyncs:0,failedSyncs:0,pendingSyncs:0,recentActivity:[]}),[r,n]=j.useState(!1),c=j.useCallback(()=>{I.initializeTabLinks(),n(!0)},[]),l=j.useCallback(()=>{const e=I.getAllTabLinks();t(e)},[]),o=j.useCallback(()=>{const e=I.getTabSyncStatus();a(e)},[]),d=j.useCallback((e,t,s,a)=>i(void 0,null,function*(){const r=yield I.syncDataBetweenTabs(e,t,s,a);return l(),o(),r}),[l,o]),u=j.useCallback((e,t,s,a="bidirectional")=>{I.createTabLink(e,t,s,a),l()},[l]),y=j.useCallback(e=>I.getCrossTabData(e),[]),h=j.useCallback(e=>{I.updateCrossTabData(e)},[]),g=j.useCallback((t,s,a)=>i(void 0,null,function*(){const r=e.filter(e=>e.sourceTab===t&&e.dataType===a).map(e=>d(t,e.targetTab,a,s)),n=yield Promise.all(r);n.filter(e=>e).length;return n}),[e,d]),m=j.useCallback((t,s)=>e.filter(e=>{const a=e.sourceTab===t||e.targetTab===t,r=!s||e.dataType===s;return a&&r}),[e]),x=j.useCallback(e=>{const t=m(e);return{successful:t.filter(e=>"success"===e.syncStatus).length,failed:t.filter(e=>"error"===e.syncStatus).length,pending:t.filter(e=>"pending"===e.syncStatus).length,total:t.length}},[m]);return j.useEffect(()=>{r||c(),l(),o()},[r,c,l,o]),j.useEffect(()=>{const e=setInterval(()=>{o()},5e3);return()=>clearInterval(e)},[o]),{tabLinks:e,syncStatus:s,isInitialized:r,initializeTabLinks:c,syncDataBetweenTabs:d,createTabLink:u,autoSyncTabData:g,getCrossTabData:y,updateCrossTabData:h,getLinkedTabs:m,getTabSyncStatus:x,loadTabLinks:l,loadSyncStatus:o}},O=({className:e="",showDetails:t=!0,onRefresh:s})=>{const{syncStatus:a,loadSyncStatus:r,isInitialized:n}=_(),[c,l]=j.useState(!1),N=()=>0===a.totalLinks?0:Math.round(a.successfulSyncs/a.totalLinks*100),w=e=>{switch(e){case"success":return"bg-green-100 text-green-800 border-green-200";case"error":return"bg-red-100 text-red-800 border-red-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},k=e=>{switch(e){case"success":return o.jsx(T,{className:"h-4 w-4"});case"error":return o.jsx(C,{className:"h-4 w-4"});case"pending":return o.jsx(S,{className:"h-4 w-4"});default:return o.jsx(v,{className:"h-4 w-4"})}};return n?o.jsxs(d,{className:e,children:[o.jsx(u,{children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs(y,{className:"flex items-center gap-2",children:[o.jsx(A,{className:"h-5 w-5"}),"Tab Data Linking"]}),o.jsx(g,{children:"Data synchronization status across all tabs"})]}),o.jsxs(x,{variant:"outline",size:"sm",onClick:()=>i(void 0,null,function*(){l(!0),yield r(),null==s||s(),setTimeout(()=>l(!1),1e3)}),disabled:c,children:[o.jsx(D,{className:"h-4 w-4 mr-2 "+(c?"animate-spin":"")}),"Refresh"]})]})}),o.jsxs(m,{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-sm font-medium",children:"Overall Sync Status"}),o.jsxs(p,{variant:"outline",className:w("success"),children:[N(),"% Complete"]})]}),o.jsx(b,{value:N(),className:"h-2"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.successfulSyncs}),o.jsx("div",{className:"text-xs text-gray-500",children:"Successful"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:a.failedSyncs}),o.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:a.pendingSyncs}),o.jsx("div",{className:"text-xs text-gray-500",children:"Pending"})]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.totalLinks}),o.jsx("div",{className:"text-xs text-gray-500",children:"Total Links"})]})]}),t&&a.recentActivity.length>0&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(f,{className:"h-4 w-4"}),o.jsx("span",{className:"text-sm font-medium",children:"Recent Activity"})]}),o.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:a.recentActivity.map((e,t)=>o.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[k(e.syncStatus),o.jsxs("div",{className:"text-xs",children:[o.jsx("div",{className:"font-medium",children:e.sourceTab}),o.jsx("div",{className:"text-gray-500",children:e.dataType})]})]}),o.jsx(L,{className:"h-3 w-3 text-gray-400"}),o.jsxs("div",{className:"text-xs",children:[o.jsx("div",{className:"font-medium",children:e.targetTab}),o.jsx("div",{className:"text-gray-500",children:new Date(e.lastSync).toLocaleTimeString()})]}),o.jsx(p,{variant:"outline",className:w(e.syncStatus),children:e.syncStatus})]},`${e.sourceTab}-${e.targetTab}-${e.dataType}-${t}`))})]}),t&&a.recentActivity.some(e=>"error"===e.syncStatus)&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(v,{className:"h-4 w-4 text-red-600"}),o.jsx("span",{className:"text-sm font-medium text-red-600",children:"Sync Errors"})]}),o.jsx("div",{className:"space-y-1",children:a.recentActivity.filter(e=>"error"===e.syncStatus).slice(0,3).map((e,t)=>o.jsxs("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded",children:[e.sourceTab," → ",e.targetTab,": ",e.errorMessage||"Sync failed"]},t))})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(x,{variant:"outline",size:"sm",className:"flex-1",children:[o.jsx(A,{className:"h-4 w-4 mr-2"}),"View All Links"]}),o.jsxs(x,{variant:"outline",size:"sm",className:"flex-1",children:[o.jsx(h,{className:"h-4 w-4 mr-2"}),"Sync All"]})]})]})]}):o.jsxs(d,{className:e,children:[o.jsxs(u,{children:[o.jsxs(y,{className:"flex items-center gap-2",children:[o.jsx(h,{className:"h-5 w-5"}),"Tab Data Linking"]}),o.jsx(g,{children:"Initializing data synchronization between tabs..."})]}),o.jsx(m,{children:o.jsx("div",{className:"flex items-center justify-center py-4",children:o.jsx(D,{className:"h-6 w-6 animate-spin text-blue-600"})})})]})};export{A as L,O as T,_ as u};
