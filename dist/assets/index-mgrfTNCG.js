var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,c=(e,s)=>{for(var t in s||(s={}))i.call(s,t)&&r(e,t,s[t]);if(a)for(var t of a(s))l.call(s,t)&&r(e,t,s[t]);return e},n=(e,a)=>s(e,t(a));import{K as d,u as o,j as x,N as m,am as h,k as j,ar as u,C as v,g as p,h as g,a as N,p as f,q as b,r as y,B as w,c as A,U as O,v as D,R as E,e as S,ac as R,L as T,S as L,I,Y as C,Z as U,_ as k,$ as P,a0 as _,a5 as V,o as W,t as M,ak as F,a6 as G,ad as H,O as Y}from"./index-BmUpYGrm.js";import{r as $}from"./vendor-vN6PtkFd.js";import{T as B,a as q,b as z,c as K,d as Z,e as J}from"./table-BEISn_Te.js";import{u as Q}from"./useAuditLog-BKBIiLUr.js";import{D as X}from"./download-CLPHGjzE.js";import{F as ee}from"./file-text-bXPYLusF.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";const se=()=>{var e,s,t,a;const{user:i}=d(),{auditLogs:l,filterLogs:r,getAuditStats:se,clearOldLogs:te}=Q(),[ae,ie]=$.useState("overview"),[le,re]=$.useState({}),[ce,ne]=$.useState(""),[de,oe]=$.useState("today");if(o(),$.useMemo(()=>[],[]),$.useMemo(()=>[],[]),"OWNER"!==(null==(e=null==i?void 0:i.role)?void 0:e.toUpperCase())&&"garage_manager"!==(null==(s=null==i?void 0:i.role)?void 0:s.toLowerCase()))return x.jsx(m,{to:"/dashboard",replace:!0});const xe=$.useMemo(()=>se(),[se]),me=$.useMemo(()=>{let e=l;const s=new Date;switch(de){case"today":e=l.filter(e=>new Date(e.timestamp).toDateString()===s.toDateString());break;case"week":const t=new Date(s.getTime()-6048e5);e=l.filter(e=>new Date(e.timestamp)>=t);break;case"month":const a=new Date(s.getTime()-2592e6);e=l.filter(e=>new Date(e.timestamp)>=a)}return r(n(c({},le),{searchTerm:ce})).filter(s=>e.includes(s))},[l,le,ce,de,r]),he=(e,s)=>{re(t=>n(c({},t),{[e]:s||void 0}))},je=e=>{switch(e){case"CREATE":return x.jsx(Y,{className:"h-4 w-4 text-green-600"});case"UPDATE":return x.jsx(H,{className:"h-4 w-4 text-blue-600"});case"DELETE":return x.jsx(u,{className:"h-4 w-4 text-red-600"});case"VIEW":return x.jsx(G,{className:"h-4 w-4 text-gray-600"});case"UPLOAD":return x.jsx(F,{className:"h-4 w-4 text-purple-600"});case"DOWNLOAD":return x.jsx(X,{className:"h-4 w-4 text-indigo-600"});default:return x.jsx(A,{className:"h-4 w-4 text-gray-600"})}},ue=e=>{switch(e){case"CREATE":return"bg-green-100 text-green-800 border-green-300";case"UPDATE":return"bg-blue-100 text-blue-800 border-blue-300";case"DELETE":return"bg-red-100 text-red-800 border-red-300";case"VIEW":default:return"bg-gray-100 text-gray-800 border-gray-300";case"UPLOAD":return"bg-purple-100 text-purple-800 border-purple-300";case"DOWNLOAD":return"bg-indigo-100 text-indigo-800 border-indigo-300"}},ve=e=>({INVENTORY:"bg-yellow-100 text-yellow-800 border-yellow-300",SHOWROOM_1:"bg-blue-100 text-blue-800 border-blue-300",SHOWROOM_2:"bg-green-100 text-green-800 border-green-300",GARAGE:"bg-orange-100 text-orange-800 border-orange-300",PDI:"bg-purple-100 text-purple-800 border-purple-300",FINANCIAL:"bg-emerald-100 text-emerald-800 border-emerald-300",REPAIRS:"bg-red-100 text-red-800 border-red-300",NEW_ARRIVALS:"bg-cyan-100 text-cyan-800 border-cyan-300"}[e]||"bg-gray-100 text-gray-800 border-gray-300");return x.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx(h,{className:"h-8 w-8 text-blue-600"}),x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Activity Monitor"}),x.jsx("p",{className:"text-muted-foreground",children:"Track all user activities and changes across the CMS"})]})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsxs(j,{variant:"outline",onClick:()=>{const e=[["Timestamp","User","Role","Action","Section","Entity Type","Details"],...me.map(e=>[e.timestamp,e.userName,e.userRole,e.action,e.section,e.entityType,e.details])].map(e=>e.join(",")).join("\n"),s=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`audit_log_${(new Date).toISOString().split("T")[0]}.csv`,a.click(),window.URL.revokeObjectURL(t),M({title:"Export Complete",description:"Audit logs have been exported to CSV file."})},children:[x.jsx(X,{className:"mr-2 h-4 w-4"}),"Export Logs"]}),x.jsxs(j,{variant:"outline",onClick:te,children:[x.jsx(u,{className:"mr-2 h-4 w-4"}),"Clear Old Logs"]})]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[x.jsxs(v,{children:[x.jsx(p,{className:"pb-2",children:x.jsx(g,{className:"text-sm font-medium",children:"Total Activities"})}),x.jsxs(N,{children:[x.jsx("div",{className:"text-2xl font-bold",children:xe.totalActivities.toLocaleString()}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"All time activities"})]})]}),x.jsxs(v,{children:[x.jsx(p,{className:"pb-2",children:x.jsx(g,{className:"text-sm font-medium",children:"Today's Activities"})}),x.jsxs(N,{children:[x.jsx("div",{className:"text-2xl font-bold",children:xe.todayActivities}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Activities today"})]})]}),x.jsxs(v,{children:[x.jsx(p,{className:"pb-2",children:x.jsx(g,{className:"text-sm font-medium",children:"Active Users"})}),x.jsxs(N,{children:[x.jsx("div",{className:"text-2xl font-bold",children:xe.activeUsers}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Users active today"})]})]}),x.jsxs(v,{children:[x.jsx(p,{className:"pb-2",children:x.jsx(g,{className:"text-sm font-medium",children:"Most Active Section"})}),x.jsxs(N,{children:[x.jsx("div",{className:"text-2xl font-bold",children:(null==(t=xe.sectionsActivity[0])?void 0:t.section.replace("_"," "))||"None"}),x.jsxs("p",{className:"text-xs text-muted-foreground",children:[(null==(a=xe.sectionsActivity[0])?void 0:a.count)||0," activities"]})]})]})]}),x.jsxs(f,{value:ae,onValueChange:ie,className:"space-y-4",children:[x.jsxs(b,{className:"grid w-full grid-cols-3",children:[x.jsxs(y,{value:"overview",className:"flex items-center gap-2",children:[x.jsx(w,{className:"h-4 w-4"}),"Overview"]}),x.jsxs(y,{value:"activities",className:"flex items-center gap-2",children:[x.jsx(A,{className:"h-4 w-4"}),"Activity Log"]}),x.jsxs(y,{value:"users",className:"flex items-center gap-2",children:[x.jsx(O,{className:"h-4 w-4"}),"User Activity"]})]}),x.jsx(D,{value:"overview",children:x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[x.jsxs(v,{children:[x.jsxs(p,{children:[x.jsx(g,{children:"Section Activity"}),x.jsx(E,{children:"Activity breakdown by system sections"})]}),x.jsx(N,{children:x.jsx("div",{className:"space-y-3",children:xe.sectionsActivity.slice(0,8).map(e=>x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("div",{className:"flex items-center gap-2",children:x.jsx(S,{className:ve(e.section),children:e.section.replace("_"," ")})}),x.jsxs("div",{className:"text-right",children:[x.jsxs("div",{className:"text-sm font-medium",children:[e.count," activities"]}),x.jsxs("div",{className:"text-xs text-muted-foreground",children:["Last: ",R.formatDateTime(e.lastActivity)]})]})]},e.section))})})]}),x.jsxs(v,{children:[x.jsxs(p,{children:[x.jsx(g,{children:"Recent Activities"}),x.jsx(E,{children:"Latest 10 system activities"})]}),x.jsx(N,{children:x.jsx("div",{className:"space-y-3",children:l.slice(0,10).map(e=>x.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[x.jsx("div",{className:"flex items-center gap-2",children:je(e.action)}),x.jsxs("div",{className:"flex-1",children:[x.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[x.jsx("span",{className:"font-medium text-sm",children:e.userName}),x.jsx(S,{className:ue(e.action),children:e.action}),x.jsx(S,{className:ve(e.section),children:e.section.replace("_"," ")})]}),x.jsx("p",{className:"text-sm text-muted-foreground",children:e.details}),x.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:R.formatDateTime(e.timestamp)})]})]},e.id))})})]})]})}),x.jsx(D,{value:"activities",children:x.jsxs(v,{children:[x.jsxs(p,{children:[x.jsx(g,{children:"Activity Filters"}),x.jsx(E,{children:"Filter activities by section, action, user, and time range"})]}),x.jsxs(N,{children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(T,{children:"Search"}),x.jsxs("div",{className:"relative",children:[x.jsx(L,{className:"absolute left-2 top-3 h-4 w-4 text-muted-foreground"}),x.jsx(I,{placeholder:"Search activities...",className:"pl-8",value:ce,onChange:e=>ne(e.target.value)})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(T,{children:"Section"}),x.jsxs(C,{value:le.section||"all",onValueChange:e=>he("section","all"===e?"":e),children:[x.jsx(U,{children:x.jsx(k,{placeholder:"All Sections"})}),x.jsxs(P,{children:[x.jsx(_,{value:"all",children:"All Sections"}),x.jsx(_,{value:"INVENTORY",children:"Inventory"}),x.jsx(_,{value:"SHOWROOM_1",children:"Showroom 1"}),x.jsx(_,{value:"SHOWROOM_2",children:"Showroom 2"}),x.jsx(_,{value:"GARAGE",children:"Garage"}),x.jsx(_,{value:"PDI",children:"PDI"}),x.jsx(_,{value:"FINANCIAL",children:"Financial"}),x.jsx(_,{value:"REPAIRS",children:"Repairs"}),x.jsx(_,{value:"NEW_ARRIVALS",children:"New Arrivals"})]})]})]}),x.jsxs("div",{className:"space-y-2 audit-dropdown-container",children:[x.jsx(T,{children:"Action"}),x.jsxs(C,{value:le.action||"all",onValueChange:e=>he("action","all"===e?"":e),children:[x.jsx(U,{children:x.jsx(k,{placeholder:"All Actions"})}),x.jsxs(P,{position:"popper",side:"bottom",align:"start",sideOffset:4,avoidCollisions:!0,className:"select-content-fixed",children:[x.jsx(_,{value:"all",children:"All Actions"}),x.jsx(_,{value:"CREATE",children:"Create"}),x.jsx(_,{value:"UPDATE",children:"Update"}),x.jsx(_,{value:"DELETE",children:"Delete"}),x.jsx(_,{value:"VIEW",children:"View"}),x.jsx(_,{value:"UPLOAD",children:"Upload"}),x.jsx(_,{value:"DOWNLOAD",children:"Download"})]})]})]}),x.jsxs("div",{className:"space-y-2 audit-dropdown-container",children:[x.jsx(T,{children:"Time Range"}),x.jsxs(C,{value:de,onValueChange:oe,children:[x.jsx(U,{children:x.jsx(k,{})}),x.jsxs(P,{position:"popper",side:"bottom",align:"start",sideOffset:4,avoidCollisions:!0,className:"select-content-fixed",children:[x.jsx(_,{value:"today",children:"Today"}),x.jsx(_,{value:"week",children:"This Week"}),x.jsx(_,{value:"month",children:"This Month"}),x.jsx(_,{value:"all",children:"All Time"})]})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(T,{children:" "}),x.jsxs(j,{variant:"outline",onClick:()=>{re({}),ne(""),oe("today")},className:"w-full",children:[x.jsx(V,{className:"mr-2 h-4 w-4"}),"Clear Filters"]})]})]}),x.jsx("div",{className:"border rounded-lg",children:x.jsxs(B,{children:[x.jsx(q,{children:x.jsxs(z,{children:[x.jsx(K,{children:"Time"}),x.jsx(K,{children:"User"}),x.jsx(K,{children:"Action"}),x.jsx(K,{children:"Section"}),x.jsx(K,{children:"Entity"}),x.jsx(K,{children:"Details"})]})}),x.jsx(Z,{children:me.length>0?me.slice(0,100).map(e=>x.jsxs(z,{children:[x.jsx(J,{className:"text-sm",children:R.formatDateTime(e.timestamp)}),x.jsx(J,{children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(W,{className:"h-4 w-4 text-muted-foreground"}),x.jsxs("div",{children:[x.jsx("div",{className:"font-medium",children:e.userName}),x.jsx("div",{className:"text-xs text-muted-foreground",children:e.userRole})]})]})}),x.jsx(J,{children:x.jsx(S,{className:ue(e.action),children:e.action})}),x.jsx(J,{children:x.jsx(S,{className:ve(e.section),children:e.section.replace("_"," ")})}),x.jsx(J,{children:x.jsxs("div",{className:"text-sm",children:[x.jsx("div",{children:e.entityType}),e.entityName&&x.jsx("div",{className:"text-xs text-muted-foreground",children:e.entityName})]})}),x.jsxs(J,{className:"max-w-md",children:[x.jsx("p",{className:"text-sm truncate",children:e.details}),e.changes&&e.changes.length>0&&x.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.changes.length," field(s) changed"]})]})]},e.id)):x.jsx(z,{children:x.jsxs(J,{colSpan:6,className:"text-center py-8",children:[x.jsx(ee,{className:"h-12 w-12 text-muted-foreground mx-auto mb-2"}),x.jsx("p",{className:"font-medium",children:"No activities found"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Try adjusting your filters or time range"})]})})})]})})]})]})}),x.jsx(D,{value:"users",children:x.jsxs(v,{children:[x.jsxs(p,{children:[x.jsx(g,{children:"Employee Activity Summary"}),x.jsx(E,{children:"Click on any employee to view their detailed audit logs"})]}),x.jsx(N,{children:x.jsx("div",{className:"space-y-4",children:Object.entries(me.reduce((e,s)=>(e[s.userId]||(e[s.userId]={userName:s.userName,userRole:s.userRole,totalActivities:0,lastActivity:s.timestamp,actions:{}}),e[s.userId].totalActivities++,e[s.userId].actions[s.action]=(e[s.userId].actions[s.action]||0)+1,new Date(s.timestamp)>new Date(e[s.userId].lastActivity)&&(e[s.userId].lastActivity=s.timestamp),e),{})).map(([e,s])=>x.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>window.open(`/employee-audit/${e}`,"_blank"),children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx(W,{className:"h-5 w-5 text-muted-foreground"}),x.jsxs("div",{children:[x.jsx("div",{className:"font-medium",children:s.userName}),x.jsx("div",{className:"text-sm text-muted-foreground",children:s.userRole})]})]}),x.jsxs("div",{className:"text-right",children:[x.jsxs("div",{className:"font-medium",children:[s.totalActivities," activities"]}),x.jsxs("div",{className:"text-xs text-muted-foreground",children:["Last: ",R.formatDateTime(s.lastActivity)]}),x.jsx(j,{variant:"outline",size:"sm",className:"mt-2",children:"View Details"})]})]}),x.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(s.actions).map(([e,s])=>x.jsxs(S,{variant:"outline",className:ue(e),children:[e,": ",s]},e))})]},e))})})]})})]})]})};export{se as default};
