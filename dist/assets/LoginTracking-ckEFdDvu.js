var e=(e,s,i)=>new Promise((a,t)=>{var n=e=>{try{l(i.next(e))}catch(s){t(s)}},c=e=>{try{l(i.throw(e))}catch(s){t(s)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,c);l((i=i.apply(e,s)).next())});import{K as s,br as i,j as a,aY as t,am as n,aZ as c,k as l,C as r,g as o,h as d,d as x,a as m,V as h,U as j,p as u,q as p,r as v,v as f,R as g,e as N,S as w,I as y,Y as b,Z as L,_,$ as S,a0 as k}from"./index-BmUpYGrm.js";import{r as U}from"./vendor-vN6PtkFd.js";import{T as C,a as R,b as M,c as D,d as A,e as H}from"./table-BEISn_Te.js";import{R as $}from"./refresh-cw-C6MAcERo.js";import{D as E}from"./download-CLPHGjzE.js";import{G as P}from"./globe-DlCryj_B.js";import{S as F}from"./smartphone-Cgftoe1I.js";import{f as O}from"./utils-DhcIvS4g.js";import"./charts-XrXYWaKo.js";function z(){var z;const{user:I}=s(),[V,B]=U.useState([]),[T,W]=U.useState([]),[G,Y]=U.useState([]),[Z,q]=U.useState(!0),[J,K]=U.useState("suspicious"),[Q,X]=U.useState(""),[ee,se]=U.useState("all"),ie="OWNER"===(null==(z=null==I?void 0:I.role)?void 0:z.toUpperCase());U.useEffect(()=>{ie&&ae()},[ie]);const ae=()=>e(this,null,function*(){q(!0);try{const[e,s,a]=yield Promise.all([i.getSuspiciousLogins(),te(),i.getLoginNotifications()]);B(e),W(s),Y(a)}catch(e){}finally{q(!1)}}),te=()=>e(this,null,function*(){try{return[]}catch(e){return[]}}),ne=e=>[["Date","Email","Role","IP Address","Location","Device","Status","Flags"],...e.map(e=>[O(new Date(e.login_time),"yyyy-MM-dd HH:mm:ss"),e.email,e.role||"Unknown",e.ip_address,`${e.city||"Unknown"}, ${e.country||"Unknown"}`,`${e.device_type||"Unknown"} - ${e.browser||"Unknown"}`,e.success?"Success":"Failed",[e.is_suspicious&&"Suspicious",e.is_new_location&&"New Location"].filter(Boolean).join(", ")])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),ce=e=>{switch(e){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-blue-500";default:return"bg-gray-500"}},le=e=>{const s=[e.city,e.region,e.country].filter(Boolean);return s.length>0?s.join(", "):"Unknown Location"},re=G.filter(e=>{var s;const i=e.message.toLowerCase().includes(Q.toLowerCase())||(null==(s=e.login_tracking)?void 0:s.email.toLowerCase().includes(Q.toLowerCase())),a="all"===ee||e.severity===ee;return i&&a});return ie?Z?a.jsx("div",{className:"container mx-auto p-6",children:a.jsxs("div",{className:"flex items-center justify-center min-h-[400px]",children:[a.jsx($,{className:"h-8 w-8 animate-spin"}),a.jsx("span",{className:"ml-2",children:"Loading login tracking data..."})]})}):a.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Login Tracking & Security"}),a.jsx("p",{className:"text-muted-foreground",children:"Monitor employee login activity and security events"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(l,{onClick:ae,variant:"outline",size:"sm",children:[a.jsx($,{className:"h-4 w-4 mr-2"}),"Refresh"]}),a.jsxs(l,{onClick:()=>{const e=ne(V),s=new Blob([e],{type:"text/csv"}),i=window.URL.createObjectURL(s),a=document.createElement("a");a.href=i,a.download=`login-tracking-${O(new Date,"yyyy-MM-dd")}.csv`,a.click(),window.URL.revokeObjectURL(i)},variant:"outline",size:"sm",children:[a.jsx(E,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs(r,{children:[a.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(d,{className:"text-sm font-medium",children:"Suspicious Logins"}),a.jsx(x,{className:"h-4 w-4 text-orange-500"})]}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold",children:V.filter(e=>e.is_suspicious).length}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 7 days"})]})]}),a.jsxs(r,{children:[a.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(d,{className:"text-sm font-medium",children:"New Locations"}),a.jsx(h,{className:"h-4 w-4 text-blue-500"})]}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold",children:V.filter(e=>e.is_new_location).length}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 7 days"})]})]}),a.jsxs(r,{children:[a.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(d,{className:"text-sm font-medium",children:"Failed Logins"}),a.jsx(n,{className:"h-4 w-4 text-red-500"})]}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold",children:V.filter(e=>!e.success).length}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 7 days"})]})]}),a.jsxs(r,{children:[a.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(d,{className:"text-sm font-medium",children:"Active Users"}),a.jsx(j,{className:"h-4 w-4 text-green-500"})]}),a.jsxs(m,{children:[a.jsx("div",{className:"text-2xl font-bold",children:new Set(V.filter(e=>e.success).map(e=>e.email)).size}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 7 days"})]})]})]}),a.jsxs(u,{value:J,onValueChange:K,children:[a.jsxs(p,{children:[a.jsx(v,{value:"suspicious",children:"Suspicious Activity"}),a.jsx(v,{value:"notifications",children:"Security Alerts"}),a.jsx(v,{value:"locations",children:"Login Locations"})]}),a.jsx(f,{value:"suspicious",className:"space-y-4",children:a.jsxs(r,{children:[a.jsxs(o,{children:[a.jsx(d,{children:"Recent Suspicious Login Activity"}),a.jsx(g,{children:"Login attempts flagged for security review"})]}),a.jsxs(m,{children:[a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(C,{children:[a.jsx(R,{children:a.jsxs(M,{children:[a.jsx(D,{children:"Time"}),a.jsx(D,{children:"User"}),a.jsx(D,{children:"Role"}),a.jsx(D,{children:"Location"}),a.jsx(D,{children:"Device"}),a.jsx(D,{children:"IP Address"}),a.jsx(D,{children:"Status"}),a.jsx(D,{children:"Flags"})]})}),a.jsx(A,{children:V.map(e=>a.jsxs(M,{children:[a.jsx(H,{className:"font-mono text-sm",children:O(new Date(e.login_time),"MMM dd, HH:mm")}),a.jsx(H,{children:a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:e.user_name||e.email.split("@")[0]}),a.jsx("div",{className:"text-sm text-muted-foreground",children:e.email})]})}),a.jsx(H,{children:a.jsx(N,{variant:"outline",children:e.role||"Unknown"})}),a.jsx(H,{children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(P,{className:"h-4 w-4 mr-1"}),le(e)]})}),a.jsx(H,{children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(F,{className:"h-4 w-4 mr-1"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm",children:e.device_type||"Unknown"}),a.jsx("div",{className:"text-xs text-muted-foreground",children:e.browser})]})]})}),a.jsx(H,{className:"font-mono text-sm",children:e.ip_address}),a.jsx(H,{children:a.jsx(N,{variant:e.success?"secondary":"destructive",children:e.success?"Success":"Failed"})}),a.jsx(H,{children:a.jsxs("div",{className:"flex gap-1",children:[e.is_suspicious&&a.jsx(N,{variant:"destructive",className:"text-xs",children:"Suspicious"}),e.is_new_location&&a.jsx(N,{variant:"secondary",className:"text-xs",children:"New Location"})]})})]},e.id))})]})}),0===V.length&&a.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[a.jsx(n,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"No suspicious login activity detected"})]})]})]})}),a.jsx(f,{value:"notifications",className:"space-y-4",children:a.jsxs(r,{children:[a.jsx(o,{children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx(d,{children:"Security Notifications"}),a.jsx(g,{children:"Real-time alerts for security events"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(w,{className:"h-4 w-4"}),a.jsx(y,{placeholder:"Search notifications...",value:Q,onChange:e=>X(e.target.value),className:"w-64"})]}),a.jsxs(b,{value:ee,onValueChange:se,children:[a.jsx(L,{className:"w-32",children:a.jsx(_,{})}),a.jsxs(S,{children:[a.jsx(k,{value:"all",children:"All Levels"}),a.jsx(k,{value:"critical",children:"Critical"}),a.jsx(k,{value:"high",children:"High"}),a.jsx(k,{value:"medium",children:"Medium"}),a.jsx(k,{value:"low",children:"Low"})]})]})]})]})}),a.jsxs(m,{children:[a.jsx("div",{className:"space-y-3",children:re.map(e=>a.jsx("div",{className:"border rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(N,{className:`${ce(e.severity)} text-white`,children:e.severity.toUpperCase()}),a.jsx(N,{variant:"outline",children:e.notification_type.replace("_"," ").toUpperCase()}),a.jsx("span",{className:"text-sm text-muted-foreground",children:O(new Date(e.created_at),"MMM dd, yyyy HH:mm")})]}),a.jsx("p",{className:"text-sm",children:e.message}),e.login_tracking&&a.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["IP: ",e.login_tracking.ip_address," â€¢ Location: ",e.login_tracking.city||"Unknown",", ",e.login_tracking.country||"Unknown"]})]}),a.jsx(x,{className:"h-5 w-5 text-orange-500 mt-1"})]})},e.id))}),0===re.length&&a.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[a.jsx(x,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"No security notifications found"})]})]})]})}),a.jsx(f,{value:"locations",className:"space-y-4",children:a.jsxs(r,{children:[a.jsxs(o,{children:[a.jsx(d,{children:"Login Locations"}),a.jsx(g,{children:"Geographic distribution of login attempts"})]}),a.jsx(m,{children:a.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[a.jsx(h,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"Location visualization coming soon"}),a.jsx("p",{className:"text-xs",children:"Will show login attempts on a world map"})]})})]})})]})]}):a.jsx("div",{className:"container mx-auto p-6",children:a.jsxs(t,{children:[a.jsx(n,{className:"h-4 w-4"}),a.jsx(c,{children:"Access Denied: Only OWNER users can view login tracking data."})]})})}export{z as default};
