var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,r,t)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,n=(e,s)=>{for(var r in s||(s={}))a.call(s,r)&&l(e,r,s[r]);if(t)for(var r of t(s))i.call(s,r)&&l(e,r,s[r]);return e},c=(e,t)=>s(e,r(t));import{K as d,t as o,j as x,N as m,am as h,k as u,a6 as j,C as f,g as p,h as g,b as v,a as N,f as y,D as b,p as P,q as w,r as M,v as S,R as D,e as O,L as I,I as F,m as k,X as C}from"./index-BmUpYGrm.js";import{r as U}from"./vendor-vN6PtkFd.js";import{b as $}from"./errorHandling-Dc1u_gNS.js";import{E}from"./eye-off-DKxk6IZx.js";import{P as T}from"./percent-BXF5OJaM.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";const _=()=>{var e;const{user:s}=d(),[r,t]=U.useState({}),[a,i]=U.useState(!0),[l,I]=U.useState([]),[F,k]=U.useState("overview"),[C,$]=U.useState(!0);if(U.useEffect(()=>{var e;"OWNER"===(null==(e=null==s?void 0:s.role)?void 0:e.toUpperCase())&&_(),i(!1)},[s]),"OWNER"!==(null==(e=null==s?void 0:s.role)?void 0:e.toUpperCase()))return o({title:"Access Denied",description:"Only owners can access financial data.",variant:"destructive"}),x.jsx(m,{to:"/dashboard"});const _=()=>{return e=void 0,s=null,r=function*(){try{i(!0);const e=localStorage.getItem("carInventory");if(e){const s=JSON.parse(e).map(e=>{const s=new Date(e.arrivalDate),r=e.soldDate?new Date(e.soldDate):null,t=new Date,a=r?Math.floor((r.getTime()-s.getTime())/864e5):Math.floor((t.getTime()-s.getTime())/864e5),i=e.purchasePrice||0,l=e.sellingPrice||0,n=i>0&&l>0?(l-i)/i*100:0,c=l-i;return{id:e.id,vinNumber:e.vinNumber,model:e.model,brand:e.brand||"Unknown",year:e.year,color:e.color,status:e.status||"in_stock",purchasePrice:i,sellingPrice:l,soldDate:e.soldDate,arrivalDate:e.arrivalDate,daysInInventory:a,profitMargin:n,totalCost:i,netProfit:c}});I(s)}}catch(e){o({title:"Error",description:"Failed to load financial data",variant:"destructive"})}finally{i(!1)}},new Promise((t,a)=>{var i=e=>{try{n(r.next(e))}catch(s){a(s)}},l=e=>{try{n(r.throw(e))}catch(s){a(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,l);n((r=r.apply(e,s)).next())});var e,s,r},B=(e,s,r)=>{I(t=>t.map(t=>t.id===e?c(n({},t),{purchasePrice:s,sellingPrice:r,profitMargin:s>0?(r-s)/s*100:0,netProfit:r-s}):t));const t=localStorage.getItem("carInventory");if(t){const a=JSON.parse(t).map(t=>t.id===e?c(n({},t),{purchasePrice:s,sellingPrice:r}):t);localStorage.setItem("carInventory",JSON.stringify(a))}o({title:"Pricing Updated",description:"Purchase and selling prices have been updated"})},L=l.reduce((e,s)=>e+(s.purchasePrice||0),0),z=l.filter(e=>"in_stock"===e.status).reduce((e,s)=>e+(s.sellingPrice||0),0),A=l.filter(e=>"sold"===e.status).reduce((e,s)=>e+(s.sellingPrice||0),0)-l.filter(e=>"sold"===e.status).reduce((e,s)=>e+(s.purchasePrice||0),0),J=l.filter(e=>e.profitMargin&&"sold"===e.status).reduce((e,s)=>e+(s.profitMargin||0),0)/Math.max(1,l.filter(e=>e.profitMargin&&"sold"===e.status).length),V=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),H=e=>e>20?"text-green-600":e>10?"text-yellow-600":e>0?"text-orange-600":"text-red-600";return a?x.jsx("div",{className:"container mx-auto p-4",children:x.jsx("div",{className:"flex items-center justify-center h-64",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),x.jsx("p",{className:"mt-2 text-gray-600",children:"Loading financial data..."})]})})}):x.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[x.jsx(h,{className:"h-8 w-8 text-blue-600"}),"Owner Finances"]}),x.jsx("p",{className:"text-muted-foreground",children:"Confidential financial data and purchase prices - Owner access only"})]}),x.jsxs(u,{variant:"outline",onClick:()=>$(!C),className:"flex items-center gap-2",children:[C?x.jsx(E,{className:"h-4 w-4"}):x.jsx(j,{className:"h-4 w-4"}),C?"Hide Prices":"Show Prices"]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[x.jsxs(f,{children:[x.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(g,{className:"text-sm font-medium",children:"Total Inventory Value"}),x.jsx(v,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(N,{children:[x.jsx("div",{className:"text-2xl font-bold",children:C?V(L):"•••••••"}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Based on purchase prices"})]})]}),x.jsxs(f,{children:[x.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(g,{className:"text-sm font-medium",children:"Projected Revenue"}),x.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(N,{children:[x.jsx("div",{className:"text-2xl font-bold",children:C?V(z):"•••••••"}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"From current inventory"})]})]}),x.jsxs(f,{children:[x.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(g,{className:"text-sm font-medium",children:"Actual Profit"}),x.jsx(b,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(N,{children:[x.jsx("div",{className:`text-2xl font-bold ${H(J)}`,children:C?V(A):"•••••••"}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"From sold vehicles"})]})]}),x.jsxs(f,{children:[x.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(g,{className:"text-sm font-medium",children:"Avg Profit Margin"}),x.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(N,{children:[x.jsxs("div",{className:`text-2xl font-bold ${H(J)}`,children:[J.toFixed(1),"%"]}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"On sold vehicles"})]})]})]}),x.jsxs(P,{value:F,onValueChange:k,className:"space-y-4",children:[x.jsxs(w,{children:[x.jsx(M,{value:"overview",children:"Financial Overview"}),x.jsx(M,{value:"details",children:"Car Details"}),x.jsx(M,{value:"pricing",children:"Pricing Management"})]}),x.jsx(S,{value:"overview",className:"space-y-4",children:x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[x.jsxs(f,{children:[x.jsxs(p,{children:[x.jsx(g,{children:"Inventory Status Breakdown"}),x.jsx(D,{children:"Financial breakdown by car status"})]}),x.jsx(N,{className:"space-y-4",children:["in_stock","sold","reserved"].map(e=>{const s=l.filter(s=>s.status===e),r=s.reduce((e,s)=>e+(s.purchasePrice||0),0),t=s.reduce((e,s)=>e+(s.sellingPrice||0),0);return x.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[x.jsx("div",{children:x.jsxs(O,{variant:"sold"===e?"default":"reserved"===e?"secondary":"outline",children:[e.replace("_"," ")," (",s.length,")"]})}),x.jsxs("div",{className:"text-right",children:[x.jsx("div",{className:"font-medium",children:C?V(r):"•••••••"}),"sold"===e&&x.jsxs("div",{className:"text-sm text-muted-foreground",children:["Revenue: ",C?V(t):"•••••••"]})]})]},e)})})]}),x.jsxs(f,{children:[x.jsxs(p,{children:[x.jsx(g,{children:"Top Profit Margins"}),x.jsx(D,{children:"Best performing sold vehicles"})]}),x.jsx(N,{children:x.jsx("div",{className:"space-y-3",children:l.filter(e=>"sold"===e.status&&e.profitMargin).sort((e,s)=>(s.profitMargin||0)-(e.profitMargin||0)).slice(0,5).map(e=>x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsxs("div",{className:"font-medium",children:[e.brand," ",e.model]}),x.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.year," • ",e.color]})]}),x.jsxs("div",{className:"text-right",children:[x.jsxs("div",{className:`font-bold ${H(e.profitMargin||0)}`,children:[(e.profitMargin||0).toFixed(1),"%"]}),x.jsx("div",{className:"text-sm text-muted-foreground",children:C?V(e.netProfit||0):"•••••••"})]})]},e.id))})})]})]})}),x.jsx(S,{value:"details",className:"space-y-4",children:x.jsxs(f,{children:[x.jsxs(p,{children:[x.jsx(g,{children:"Detailed Financial Data"}),x.jsx(D,{children:"Complete financial breakdown for all vehicles"})]}),x.jsx(N,{children:x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full text-sm",children:[x.jsx("thead",{children:x.jsxs("tr",{className:"border-b",children:[x.jsx("th",{className:"text-left p-2",children:"Vehicle"}),x.jsx("th",{className:"text-left p-2",children:"Status"}),x.jsx("th",{className:"text-left p-2",children:"Purchase Price"}),x.jsx("th",{className:"text-left p-2",children:"Selling Price"}),x.jsx("th",{className:"text-left p-2",children:"Net Profit"}),x.jsx("th",{className:"text-left p-2",children:"Margin"}),x.jsx("th",{className:"text-left p-2",children:"Days in Inventory"})]})}),x.jsx("tbody",{children:l.map(e=>x.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[x.jsx("td",{className:"p-2",children:x.jsxs("div",{children:[x.jsxs("div",{className:"font-medium",children:[e.brand," ",e.model]}),x.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.year," • ",e.color]})]})}),x.jsx("td",{className:"p-2",children:x.jsx(O,{variant:"sold"===e.status?"default":"reserved"===e.status?"secondary":"outline",children:(e.status||"in_stock").replace("_"," ")})}),x.jsx("td",{className:"p-2 font-medium",children:C?V(e.purchasePrice||0):"••••••"}),x.jsx("td",{className:"p-2 font-medium",children:C?V(e.sellingPrice||0):"••••••"}),x.jsx("td",{className:`p-2 font-medium ${H(e.profitMargin||0)}`,children:C?V(e.netProfit||0):"••••••"}),x.jsxs("td",{className:`p-2 font-bold ${H(e.profitMargin||0)}`,children:[(e.profitMargin||0).toFixed(1),"%"]}),x.jsxs("td",{className:"p-2",children:[e.daysInInventory," days"]})]},e.id))})]})})})]})}),x.jsx(S,{value:"pricing",className:"space-y-4",children:x.jsxs(f,{children:[x.jsxs(p,{children:[x.jsx(g,{children:"Pricing Management"}),x.jsx(D,{children:"Update purchase and selling prices for vehicles"})]}),x.jsx(N,{children:x.jsx("div",{className:"space-y-4",children:l.filter(e=>"sold"!==e.status).map(e=>x.jsx(R,{car:e,onUpdatePricing:B,showPrices:C},e.id))})})]})})]})]})},R=({car:e,onUpdatePricing:s,showPrices:r})=>{const[t,a]=U.useState(!1),[i,l]=U.useState(e.purchasePrice||0),[n,c]=U.useState(e.sellingPrice||0);return x.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[x.jsxs("div",{className:"flex-1",children:[x.jsxs("div",{className:"font-medium",children:[e.brand," ",e.model]}),x.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.year," • ",e.color," • ",e.vinNumber]})]}),x.jsx("div",{className:"flex items-center gap-4",children:t?x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"space-y-1",children:[x.jsx(I,{className:"text-xs",children:"Purchase Price"}),x.jsx(F,{type:"number",value:i,onChange:e=>l($(e.target.value,0)),className:"w-32"})]}),x.jsxs("div",{className:"space-y-1",children:[x.jsx(I,{className:"text-xs",children:"Selling Price"}),x.jsx(F,{type:"number",value:n,onChange:e=>c($(e.target.value,0)),className:"w-32"})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(u,{size:"sm",onClick:()=>{i<=0||n<=0?o({title:"Invalid Prices",description:"Both purchase and selling prices must be greater than 0",variant:"destructive"}):(s(e.id,i,n),a(!1))},children:x.jsx(k,{className:"h-4 w-4"})}),x.jsx(u,{size:"sm",variant:"outline",onClick:()=>{l(e.purchasePrice||0),c(e.sellingPrice||0),a(!1)},children:x.jsx(C,{className:"h-4 w-4"})})]})]}):x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"text-right",children:[x.jsx("div",{className:"text-sm text-muted-foreground",children:"Purchase"}),x.jsx("div",{className:"font-medium",children:r?`$${(e.purchasePrice||0).toLocaleString()}`:"••••••"})]}),x.jsxs("div",{className:"text-right",children:[x.jsx("div",{className:"text-sm text-muted-foreground",children:"Selling"}),x.jsx("div",{className:"font-medium",children:r?`$${(e.sellingPrice||0).toLocaleString()}`:"••••••"})]}),x.jsxs("div",{className:"text-right",children:[x.jsx("div",{className:"text-sm text-muted-foreground",children:"Margin"}),x.jsxs("div",{className:"font-bold "+(e.profitMargin&&e.profitMargin>0?"text-green-600":"text-red-600"),children:[(e.profitMargin||0).toFixed(1),"%"]})]}),x.jsx(u,{size:"sm",variant:"outline",onClick:()=>a(!0),children:"Edit"})]})})]})};export{_ as default};
