var e=(e,t,o)=>new Promise((s,r)=>{var n=e=>{try{c(o.next(e))}catch(t){r(t)}},a=e=>{try{c(o.throw(e))}catch(t){r(t)}},c=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);c((o=o.apply(e,t)).next())});import{u as t,w as o,r as s}from"./excel-DF0p_WFv.js";import{c as r}from"./vendor-vN6PtkFd.js";import{s as n}from"./index-BmUpYGrm.js";var a,c={exports:{}};a=c,function(){function e(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function t(e,t,o){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="blob",s.onload=function(){i(s.response,t,o)},s.onerror=function(){},s.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(o){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(o){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r&&r.global===r?r:void 0,c=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!c?function(e,r,a){var c=n.URL||n.webkitURL,i=document.createElement("a");r=r||e.name||"download",i.download=r,i.rel="noopener","string"==typeof e?(i.href=e,i.origin===location.origin?s(i):o(i.href)?t(e,r,a):s(i,i.target="_blank")):(i.href=c.createObjectURL(e),setTimeout(function(){c.revokeObjectURL(i.href)},4e4),setTimeout(function(){s(i)},0))}:"msSaveOrOpenBlob"in navigator?function(r,n,a){if(n=n||r.name||"download","string"!=typeof r)navigator.msSaveOrOpenBlob(e(r,a),n);else if(o(r))t(r,n,a);else{var c=document.createElement("a");c.href=r,c.target="_blank",setTimeout(function(){s(c)})}}:function(e,o,s,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return t(e,o,s);var a="application/octet-stream"===e.type,i=/constructor/i.test(n.HTMLElement)||n.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||a&&i||c)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},u.readAsDataURL(e)}else{var d=n.URL||n.webkitURL,f=d.createObjectURL(e);r?r.location=f:location.href=f,r=null,setTimeout(function(){d.revokeObjectURL(f)},4e4)}});n.saveAs=i.saveAs=i,a.exports=i}();var i=c.exports;class l{static exportToExcel(s){return e(this,arguments,function*(e,s={}){try{const{fileName:r="export",sheetName:n="Data",includeTimestamp:a=!0,uploadToSupabase:c=!0}=s;if(!e||0===e.length)return{success:!1,message:"No data to export"};const l=t.book_new(),u=t.json_to_sheet(e);t.book_append_sheet(l,u,n);const d=a?(new Date).toISOString().slice(0,19).replace(/:/g,"-"):"",f=`${r}${d?`_${d}`:""}.xlsx`,p=o(l,{bookType:"xlsx",type:"array"}),m=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return i.saveAs(m,f),c&&(yield this.uploadBackupToSupabase(p,f)),{success:!0,message:`Successfully exported ${e.length} records to ${f}`,fileName:f}}catch(r){return{success:!1,message:`Export failed: ${r instanceof Error?r.message:"Unknown error"}`}}})}static importFromExcel(o,r){return e(this,null,function*(){return new Promise(e=>{try{const n=new FileReader;n.onload=o=>{var n;try{const a=new Uint8Array(null==(n=o.target)?void 0:n.result),c=s(a,{type:"array"}),i=c.SheetNames[0],l=c.Sheets[i],u=t.sheet_to_json(l),d=[];let f=0;if(r&&u.length>0){const e=Object.keys(u[0]),t=r.filter(t=>!e.includes(t));t.length>0&&d.push(`Missing required columns: ${t.join(", ")}`)}f=u.filter(e=>Object.values(e).some(e=>null!=e&&""!==e)).length,e({data:u,errors:d,totalRows:u.length,successfulRows:f})}catch(a){e({data:[],errors:[`Failed to parse Excel file: ${a instanceof Error?a.message:"Unknown error"}`],totalRows:0,successfulRows:0})}},n.onerror=()=>{e({data:[],errors:["Failed to read file"],totalRows:0,successfulRows:0})},n.readAsArrayBuffer(o)}catch(n){e({data:[],errors:[`Import failed: ${n instanceof Error?n.message:"Unknown error"}`],totalRows:0,successfulRows:0})}})})}static uploadBackupToSupabase(t,o){return e(this,null,function*(){try{const{data:e,error:s}=yield n.storage.from("excel-backups").upload(`backups/${o}`,t,{contentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",upsert:!0});if(s)return{success:!1};const{data:r}=n.storage.from("excel-backups").getPublicUrl(e.path);return{success:!0,url:r.publicUrl}}catch(e){return{success:!1}}})}static listBackups(){return e(this,null,function*(){try{const{data:e,error:t}=yield n.storage.from("excel-backups").list("backups/",{limit:100,offset:0,sortBy:{column:"created_at",order:"desc"}});return t?{files:[],error:t.message}:{files:e||[]}}catch(e){return{files:[],error:e instanceof Error?e.message:"Unknown error"}}})}static downloadBackup(t){return e(this,null,function*(){try{const{data:e,error:o}=yield n.storage.from("excel-backups").download(`backups/${t}`);return o||!e?{success:!1,message:"Failed to download backup"}:(i.saveAs(e,t),{success:!0,message:"Backup downloaded successfully"})}catch(e){return{success:!1,message:e instanceof Error?e.message:"Download failed"}}})}}export{l as R};
