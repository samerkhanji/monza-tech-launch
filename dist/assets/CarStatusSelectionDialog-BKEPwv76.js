var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,n=(e,s)=>{for(var a in s||(s={}))l.call(s,a)&&r(e,a,s[a]);if(t)for(var a of t(s))i.call(s,a)&&r(e,a,s[a]);return e},c=(e,t)=>s(e,a(t));import{a8 as o,j as d,o as m,L as h,e as x,I as p,D as v,H as u,k as g,t as N}from"./index-BmUpYGrm.js";import{r as j}from"./vendor-vN6PtkFd.js";import{A as b}from"./PdiChecklistPdf-B4FKiplK.js";import{D as y}from"./datetime-input-Dxp48WV8.js";import{c as f}from"./carClientLinkingService-K_T_il58.js";import{P}from"./phone-CUmdYfuI.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=o("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),D=({isOpen:e,onClose:s,car:a,onStatusUpdate:t})=>{const l=j.useRef(null),[i,r]=j.useState(a.status),[o,D]=j.useState({clientName:a.clientName||"",clientPhone:a.clientPhone||"",clientEmail:a.clientEmail||"",clientLicensePlate:a.clientLicensePlate||"",sellingPrice:a.sellingPrice||0,reservationDate:a.reservationDate?new Date(a.reservationDate):void 0,saleDate:a.saleDate?new Date(a.saleDate):void 0,notes:a.notes||""}),[C,S]=j.useState(!1),[E,k]=j.useState(!1);j.useEffect(()=>{e&&(r(a.status),D({clientName:a.clientName||"",clientPhone:a.clientPhone||"",clientEmail:a.clientEmail||"",clientLicensePlate:a.clientLicensePlate||"",sellingPrice:a.sellingPrice||0,reservationDate:a.reservationDate?new Date(a.reservationDate):void 0,saleDate:a.saleDate?new Date(a.saleDate):void 0,notes:a.notes||""}))},[e,a]);const L=(e,s)=>{D(a=>c(n({},a),{[e]:s}))},O=e=>{switch(e){case"sold":return"bg-green-500 text-white";case"reserved":return"bg-blue-500 text-white";default:return"bg-gray-500 text-white"}};return d.jsx(b,{open:e,onClose:s,maxWidth:"max-w-2xl",children:d.jsxs("div",{ref:l,className:"max-h-[70vh] bg-white shadow-xl car-status-dialog flex flex-col rounded-none",style:{height:"70vh",border:"1px solid #e5e7eb",boxShadow:"none"},children:[d.jsxs("div",{className:"border-b border-gray-200 pb-4 flex-shrink-0",children:[d.jsxs("h2",{className:"flex items-center gap-2 text-xl font-bold text-gray-900",children:[d.jsx(m,{className:"h-5 w-5 text-monza-yellow"}),"Update Vehicle Status - ",a.brand," ",a.model]}),d.jsx("div",{className:"mt-3",children:d.jsxs("span",{className:"flex items-center gap-4 flex-wrap",children:[d.jsxs("span",{className:"font-mono text-sm bg-monza-yellow/10 text-monza-black px-3 py-1 rounded border border-monza-yellow/30",children:["VIN: ",a.vinNumber]}),a.year&&d.jsxs("span",{className:"text-sm text-gray-600 font-medium",children:["Year: ",a.year]}),a.color&&d.jsxs("span",{className:"text-sm text-gray-600 font-medium",children:["Color: ",a.color]})]})})]}),d.jsx("div",{className:"overflow-y-auto max-h-[65vh] pr-2",style:{scrollbarWidth:"auto",scrollbarColor:"#ffd700 #f8fafc"},children:d.jsxs("div",{className:"pt-4 pb-20 space-y-6",style:{minHeight:"80vh",paddingRight:"10px"},children:[d.jsx("div",{className:"py-2",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(h,{className:"text-sm font-medium text-gray-700",children:"Current Status:"}),d.jsx(x,{className:`${O(a.status)} px-3 py-1 text-sm font-semibold`,children:a.status.replace("_"," ").toUpperCase()})]}),a.clientName&&d.jsxs("div",{className:"text-sm text-gray-600",children:[d.jsx("span",{className:"font-medium",children:"Client:"})," ",a.clientName]})]})}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(h,{htmlFor:"status",className:"text-sm font-medium",children:"New Status"}),d.jsxs("select",{id:"status",value:i,onChange:e=>r(e.target.value),className:"w-full h-10 rounded-none border border-input bg-background px-3 py-2",children:[d.jsx("option",{value:"in_stock",children:"Available (In Stock)"}),d.jsx("option",{value:"reserved",children:"Reserved"}),d.jsx("option",{value:"sold",children:"Sold"})]})]}),("reserved"===i||"sold"===i)&&d.jsxs("div",{className:"pt-2 space-y-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[d.jsx(m,{className:"h-4 w-4"}),d.jsx("h3",{className:"font-medium",children:"Client Information"}),d.jsx("span",{className:"text-red-500 text-sm",children:"*Required"})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(h,{htmlFor:"clientName",className:"text-sm",children:"Full Name *"}),d.jsx(p,{id:"clientName",value:o.clientName,onChange:e=>L("clientName",e.target.value),placeholder:"Enter client full name",className:"border-gray-300"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(h,{htmlFor:"clientPhone",className:"text-sm",children:"Phone Number"}),d.jsxs("div",{className:"relative",children:[d.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsx(p,{id:"clientPhone",value:o.clientPhone,onChange:e=>L("clientPhone",e.target.value),placeholder:"(555) 123-4567",className:"pl-10 border-gray-300"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(h,{htmlFor:"clientEmail",className:"text-sm",children:"Email Address"}),d.jsx(p,{id:"clientEmail",type:"email",value:o.clientEmail,onChange:e=>L("clientEmail",e.target.value),placeholder:"client@example.com",className:"border-gray-300"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(h,{htmlFor:"clientLicensePlate",className:"text-sm",children:"License Plate"}),d.jsxs("div",{className:"relative",children:[d.jsx(w,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsx(p,{id:"clientLicensePlate",value:o.clientLicensePlate,onChange:e=>L("clientLicensePlate",e.target.value.toUpperCase()),placeholder:"ABC-1234",className:"pl-10 border-gray-300 uppercase"})]})]})]}),"sold"===i&&d.jsxs("div",{className:"space-y-2",children:[d.jsx(h,{htmlFor:"sellingPrice",className:"text-sm",children:"Selling Price *"}),d.jsxs("div",{className:"relative",children:[d.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsx(p,{id:"sellingPrice",type:"number",value:o.sellingPrice,onChange:e=>L("sellingPrice",Number(e.target.value)),placeholder:"0",className:"pl-10 border-gray-300",min:"0",step:"1000"})]})]}),"reserved"===i&&d.jsx(y,{label:"Reservation Date",value:o.reservationDate,onChange:e=>L("reservationDate",e),required:!0,showTime:!0}),"sold"===i&&d.jsx(y,{label:"Sale Date",value:o.saleDate,onChange:e=>L("saleDate",e),required:!0,showTime:!0})]}),d.jsxs("div",{className:"space-y-2 pt-2",children:[d.jsx(h,{htmlFor:"notes",className:"text-sm",children:"Notes"}),d.jsx(u,{id:"notes",value:o.notes,onChange:e=>L("notes",e.target.value),placeholder:"Additional notes or comments...",className:"border-gray-300 min-h-[80px]"})]}),d.jsxs("div",{className:"p-0",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[d.jsx(x,{className:`${O(i)} px-3 py-1 text-sm font-semibold`,children:i.replace("_"," ").toUpperCase()}),d.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"Status Preview"})]}),"in_stock"===i?d.jsx("div",{className:"text-sm text-blue-600",children:d.jsxs("p",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Vehicle will be available for sale and display"]})}):d.jsxs("div",{className:"space-y-2",children:[o.clientName&&d.jsxs("div",{className:"text-sm text-blue-600",children:[d.jsxs("p",{children:[d.jsx("span",{className:"font-medium",children:"Client:"})," ",o.clientName]}),o.clientPhone&&d.jsxs("p",{children:[d.jsx("span",{className:"font-medium",children:"Phone:"})," ",(e=>{const s=e.replace(/\D/g,"");return 10===s.length?`(${s.slice(0,3)}) ${s.slice(3,6)}-${s.slice(6)}`:e})(o.clientPhone)]}),o.clientEmail&&d.jsxs("p",{children:[d.jsx("span",{className:"font-medium",children:"Email:"})," ",o.clientEmail]}),"sold"===i&&o.sellingPrice>0&&d.jsxs("p",{children:[d.jsx("span",{className:"font-medium",children:"Sale Price:"})," $",o.sellingPrice.toLocaleString()]})]}),!o.clientName&&d.jsx("div",{className:"text-sm text-orange-600",children:d.jsxs("p",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Please fill in client information above"]})})]})]})]})}),d.jsxs("div",{className:"flex gap-3 justify-end pt-6 border-t border-gray-200 mt-6",children:[d.jsx(g,{type:"button",variant:"outline",onClick:()=>{s()},disabled:C,className:"px-6 py-2 border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-colors",children:"Cancel"}),d.jsx(g,{type:"button",onClick:()=>{return e=void 0,l=null,r=function*(){if((()=>{if("in_stock"===i)return!0;if("reserved"===i||"sold"===i){if(!o.clientName.trim())return N({title:"Validation Error",description:"Client name is required for reserved or sold vehicles.",variant:"destructive"}),!1;if(!o.clientPhone.trim())return N({title:"Validation Error",description:"Client phone is required for reserved or sold vehicles.",variant:"destructive"}),!1;if("sold"===i&&o.sellingPrice<=0)return N({title:"Validation Error",description:"Selling price must be greater than 0 for sold vehicles.",variant:"destructive"}),!1}return!0})()){S(!0);try{const e=c(n(n(n({status:i},"in_stock"!==i?{clientName:o.clientName,clientPhone:o.clientPhone,clientEmail:o.clientEmail,clientLicensePlate:o.clientLicensePlate,notes:o.notes}:{clientName:"",clientPhone:"",clientEmail:"",clientLicensePlate:"",notes:o.notes}),"sold"===i?{sellingPrice:o.sellingPrice,saleDate:o.saleDate?o.saleDate.toISOString():(new Date).toISOString()}:{}),"reserved"===i?{reservationDate:o.reservationDate?o.reservationDate.toISOString():(new Date).toISOString(),deliveryChecklist:{customsCleared:!1,pdiCompleted:a.pdiCompleted||!1,registrationPlate:!1,insurancePrepared:!1,finalInspection:!1,documentationReady:!1,deliveryPreparation:!1,keysPrepared:!1}}:{}),{lastUpdated:(new Date).toISOString()});"in_stock"!==i&&f.linkCarWithClient(a.id,{vinNumber:a.vinNumber,model:a.model,brand:a.brand,year:a.year,color:a.color,status:i,location:"car_inventory"},{clientName:o.clientName,clientPhone:o.clientPhone,clientEmail:o.clientEmail,clientAddress:"",clientLicensePlate:o.clientLicensePlate,sellingPrice:"sold"===i?o.sellingPrice:void 0,saleDate:"sold"===i&&o.saleDate?o.saleDate.toISOString():void 0,reservationDate:"reserved"===i&&o.reservationDate?o.reservationDate.toISOString():void 0,notes:o.notes},"car_status_dialog"),yield t(a.id,i,e),s()}catch(e){N({title:"Error",description:"Failed to update vehicle status. Please try again.",variant:"destructive"})}finally{S(!1)}}},new Promise((s,a)=>{var t=e=>{try{n(r.next(e))}catch(s){a(s)}},i=e=>{try{n(r.throw(e))}catch(s){a(s)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(t,i);n((r=r.apply(e,l)).next())});var e,l,r},disabled:C||!i,className:"px-6 py-2 bg-monza-yellow text-monza-black hover:bg-monza-yellow/90 border-2 border-monza-yellow hover:border-monza-yellow/90 font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:C?d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"w-4 h-4 border-2 border-monza-black border-t-transparent rounded-full animate-spin"}),"Updating..."]}):"Update Status"})]})]})})};export{D as C};
