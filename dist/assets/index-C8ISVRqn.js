import{l as e,j as s,C as a,g as t,h as l,aV as r,a as n,k as o,L as i,I as c,ak as d,w as m,aY as u,m as x,A as h,aZ as p,s as f}from"./index-BmUpYGrm.js";import{r as j}from"./vendor-vN6PtkFd.js";import{R as N}from"./realExcelService-CzdfAlLU.js";import{F as y}from"./file-text-bXPYLusF.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";import"./excel-DF0p_WFv.js";const g=()=>{const[g,b]=j.useState(!1),[v,w]=j.useState(0),[C,S]=j.useState(null),[F,E]=j.useState(null),{toast:U}=e();return s.jsxs("div",{className:"space-y-6",children:[s.jsxs(a,{children:[s.jsx(t,{children:s.jsxs(l,{className:"flex items-center gap-2",children:[s.jsx(r,{className:"h-5 w-5"}),"Upload Data to Supabase"]})}),s.jsxs(n,{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center p-4 bg-blue-50 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:"Need a template?"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Download our CSV template to get started"})]}),s.jsxs(o,{variant:"outline",onClick:()=>{const e=new Blob(["VIN Number,Model,Brand,Year,Color,Status,Client Name,Client Phone,Client Email,Current Floor,Price,Category,Battery %,PDI Completed,Notes\nLDP95H961SE900001,Free,Voyah,2024,White,available,John Doe,+1234567890,john@example.com,Showroom Floor 1,75000,REEV,95,false,Sample car entry\nLDP95C969SY890002,Dream,Voyah,2024,Black,sold,Jane Smith,+1234567891,jane@example.com,Inventory,95000,EV,88,true,Another sample entry"],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download="car_data_template.csv",a.click(),window.URL.revokeObjectURL(s),U({title:"Template Downloaded",description:"CSV template file has been downloaded. Fill it with your data and upload it back."})},children:[s.jsx(y,{className:"h-4 w-4 mr-2"}),"Download Template"]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"file-upload",children:"Select CSV or Excel file"}),s.jsx(c,{id:"file-upload",type:"file",accept:".csv,.xlsx,.xls",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&(E(a),S(null))},disabled:g}),F&&s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Selected: ",F.name," (",(F.size/1024).toFixed(1)," KB)"]})]}),s.jsxs(o,{onClick:()=>{return e=void 0,s=null,a=function*(){if(F){b(!0),w(0);try{U({title:"Processing File",description:"Reading and parsing your data file..."});const s=["VIN Number","Model","Brand","Year","Color","Status","Client Name","Current Floor"],a=yield N.importFromExcel(F,s);if(a.errors.length>0&&0===a.data.length)throw new Error(a.errors.join(", "));w(30);const t=a.data.map(e=>({vin_number:e["VIN Number"]||e.vinNumber||e.vin||"",model:e.Model||e.model||"",brand:e.Brand||e.brand||"Voyah",year:parseInt(e.Year||e.year)||(new Date).getFullYear(),color:e.Color||e.color||"",status:e.Status||e.status||"in_stock",client_name:e["Client Name"]||e.clientName||"",client_phone:e["Client Phone"]||e.clientPhone||"",client_email:e["Client Email"]||e.clientEmail||"",current_location:e["Current Floor"]||e.currentFloor||"Inventory",selling_price:parseFloat(e.Price||e.price)||5e4,category:e.Category||e.category||"EV",battery_percentage:parseInt(e["Battery %"]||e.batteryPercentage)||100,pdi_completed:"true"===e["PDI Completed"]||!0===e.pdi_completed||!1,notes:e.Notes||e.notes||""}));w(50);const l=10;let r=0;const n=[];for(let o=0;o<t.length;o+=l){const s=t.slice(o,o+l);try{const{data:e,error:a}=yield f.from("car_inventory").insert(s);a?n.push(`Batch ${Math.floor(o/l)+1}: ${a.message}`):r+=s.length}catch(e){n.push(`Batch ${Math.floor(o/l)+1}: Upload failed`)}const a=50+(o+l)/t.length*50;w(Math.min(a,100))}S({total:t.length,successful:r,errors:[...a.errors,...n]}),r>0&&U({title:"Upload Successful!",description:`Successfully uploaded ${r} cars to Supabase database.`})}catch(s){U({title:"Upload Failed",description:s.message||"Failed to upload data. Please check your file format.",variant:"destructive"}),S({total:0,successful:0,errors:[s.message||"Upload failed"]})}finally{b(!1),w(0)}}else U({title:"No File Selected",description:"Please select a CSV or Excel file to upload.",variant:"destructive"})},new Promise((t,l)=>{var r=e=>{try{o(a.next(e))}catch(s){l(s)}},n=e=>{try{o(a.throw(e))}catch(s){l(s)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,n);o((a=a.apply(e,s)).next())});var e,s,a},disabled:!F||g,className:"w-full",children:[s.jsx(d,{className:"h-4 w-4 mr-2"}),g?"Uploading...":"Upload to Supabase"]}),g&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{value:v,className:"w-full"}),s.jsxs("p",{className:"text-sm text-center text-muted-foreground",children:[v,"% complete"]})]}),C&&s.jsxs(u,{className:C.successful>0?"border-green-200 bg-green-50":"border-red-200 bg-red-50",children:[C.successful>0?s.jsx(x,{className:"h-4 w-4 text-green-600"}):s.jsx(h,{className:"h-4 w-4 text-red-600"}),s.jsx(p,{children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("p",{className:"font-medium",children:["Upload Complete: ",C.successful,"/",C.total," cars uploaded successfully"]}),C.errors.length>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-red-600",children:"Errors:"}),s.jsxs("ul",{className:"text-sm list-disc list-inside",children:[C.errors.slice(0,5).map((e,a)=>s.jsx("li",{children:e},a)),C.errors.length>5&&s.jsxs("li",{children:["... and ",C.errors.length-5," more errors"]})]})]})]})})]})]})]}),s.jsxs(a,{children:[s.jsx(t,{children:s.jsx(l,{children:"Upload Instructions"})}),s.jsx(n,{className:"space-y-3",children:s.jsxs("div",{className:"grid gap-3",children:[s.jsxs("div",{className:"flex gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium",children:"1"}),s.jsx("p",{className:"text-sm",children:"Download the CSV template or prepare your Excel file with the required columns"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium",children:"2"}),s.jsx("p",{className:"text-sm",children:"Fill in your car data (VIN Number, Model, Brand, Year, Color, etc.)"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium",children:"3"}),s.jsx("p",{className:"text-sm",children:"Upload the file and it will be automatically saved to your Supabase database"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium",children:"4"}),s.jsx("p",{className:"text-sm",children:"Your uploaded cars will appear immediately in all inventory pages"})]})]})})]})]})},b=()=>s.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Data Upload"}),s.jsx("p",{className:"text-muted-foreground mt-2",children:"Upload your car inventory data directly to the Supabase database"})]}),s.jsx(g,{})]});export{b as default};
