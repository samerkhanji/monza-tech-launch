import{j as e,ai as s,C as a,a as t,f as l,e as r,c,aV as n,S as d,I as i,Y as o,Z as m,_ as x,$ as h,a0 as j,K as u,u as g,t as p,N,k as f}from"./index-BmUpYGrm.js";import{r as y}from"./vendor-vN6PtkFd.js";import{T as v,a as b,b as w,c as S,d as C,e as L}from"./table-BEISn_Te.js";import{S as F}from"./star-CR_sFOyJ.js";import{R as M,B as D,b as k,X as A,Y as V,T as K,d as R,P as T,a as $,C as O,L as E}from"./charts-XrXYWaKo.js";import{F as H}from"./file-text-bXPYLusF.js";import"./utils-DhcIvS4g.js";const P=()=>{const[c,n]=y.useState([]);y.useEffect(()=>{const e=localStorage.getItem("clientComments");e&&n(JSON.parse(e))},[]);const d=c.reduce((e,s)=>(e[s.category]=(e[s.category]||0)+1,e),{}),i=Object.entries(d).map(([e,s])=>({category:e.charAt(0).toUpperCase()+e.slice(1),count:s})),o=c.reduce((e,s)=>(e[s.rating]=(e[s.rating]||0)+1,e),{}),m=[1,2,3,4,5].map(e=>({rating:`${e} Star${e>1?"s":""}`,count:o[e]||0})),x=c.length>0?(c.reduce((e,s)=>e+s.rating,0)/c.length).toFixed(1):"0";return 0===c.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(s,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No client comments yet. Start collecting feedback to see analytics!"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(a,{children:e.jsxs(t,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-monza-black",children:c.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Comments"})]})}),e.jsx(a,{children:e.jsxs(t,{className:"p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"text-2xl font-bold text-monza-black",children:x}),e.jsx(F,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Average Rating"})]})}),e.jsx(a,{children:e.jsxs(t,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-monza-black",children:Object.keys(d).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Categories"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(a,{className:"p-4",children:[e.jsxs("h4",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(l,{className:"h-5 w-5"}),"Comments by Category"]}),e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(D,{data:i,children:[e.jsx(k,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"category"}),e.jsx(V,{}),e.jsx(K,{}),e.jsx(R,{dataKey:"count",fill:"#8884d8"})]})})})]}),e.jsxs(a,{className:"p-4",children:[e.jsxs("h4",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Rating Distribution"]}),e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(T,{children:[e.jsx($,{data:m,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,value:s})=>`${e}: ${s}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:m.map((s,a)=>e.jsx(O,{fill:["#FFD700","#FFA500","#FF6347","#32CD32","#4169E1"][a]},`cell-${a}`))}),e.jsx(K,{})]})})})]})]}),e.jsxs(a,{className:"p-4",children:[e.jsx("h4",{className:"text-lg font-medium mb-4",children:"Recent Comments"}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:c.slice(0,5).map(s=>{return e.jsxs("div",{className:"border-l-4 border-l-monza-yellow pl-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.clientName}),e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:s.carModel})]}),e.jsx("div",{className:"flex items-center gap-1",children:(a=s.rating,Array.from({length:5},(s,t)=>e.jsx(F,{className:"h-4 w-4 "+(t<a?"fill-yellow-400 text-yellow-400":"text-gray-300")},t)))})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-1",children:s.comment}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"secondary",className:"text-xs",children:s.category}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleDateString()})]})]},s.id);var a})})]})]})},z=["#8884d8","#83a6ed","#8dd1e1","#82ca9d","#a4de6c","#d0ed57","#ffc658"],Y=({data:t,period:r})=>{const[u,g]=y.useState(t),[p,N]=y.useState(""),[f,F]=y.useState("all");y.useEffect(()=>{const e=JSON.parse(localStorage.getItem("salesLeads")||"[]");if(e.length>0){const s=new Map;e.forEach(e=>{const a=e.leadSource,t=e.carModel;s.has(a)||s.set(a,{count:0,models:new Map});const l=s.get(a);l.count++,l.models.has(t)||l.models.set(t,0),l.models.set(t,l.models.get(t)+1)});const a=e.length,t=Array.from(s.entries()).map(([e,s])=>({source:e,count:s.count,percentage:Math.round(s.count/a*100),trend:Math.floor(20*Math.random())-10,models:Array.from(s.models.entries()).map(([e,s])=>({name:e,count:s}))}));g(t)}},[]);const H=u.filter(e=>{const s=e.source.toLowerCase().includes(p.toLowerCase());let a=!0;return"positive"===f?a=e.trend>0:"negative"===f?a=e.trend<0:"neutral"===f&&(a=0===e.trend),s&&a});u.reduce((e,s)=>e+s.count,0),u.map(e=>({name:e.source,value:e.count}));const Y=u.flatMap(e=>e.models.map(s=>({source:e.source,model:s.name,count:s.count})));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(c,{className:"h-5 w-5"}),"Sales Lead Sources"]}),0===u.length?e.jsxs(a,{className:"p-8 text-center",children:[e.jsx(c,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Sales Data Yet"}),e.jsx("p",{className:"text-gray-600",children:"Start recording lead sources to see analytics here."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs(a,{className:"lg:col-span-2 p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Lead Source Distribution"}),e.jsx("div",{className:"h-80",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(D,{data:u,children:[e.jsx(k,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"source"}),e.jsx(V,{}),e.jsx(K,{}),e.jsx(E,{}),e.jsx(R,{dataKey:"count",name:"Number of Leads",fill:"#8884d8"})]})})})]}),e.jsxs(a,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Lead Sources Percentage"}),e.jsx("div",{className:"h-80",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(T,{children:[e.jsx($,{data:u,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percentage:s})=>`${e} ${s}%`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:u.map((s,a)=>e.jsx(O,{fill:z[a%z.length]},`cell-${a}`))}),e.jsx(K,{})]})})})]})]}),Y.length>0&&e.jsxs(a,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(l,{className:"h-5 w-5"}),"Lead Sources by Model"]}),e.jsx("div",{className:"h-80",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(D,{data:Y,children:[e.jsx(k,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"model"}),e.jsx(V,{}),e.jsx(K,{}),e.jsx(E,{}),e.jsx(R,{dataKey:"count",name:"Number of Leads",fill:"#82ca9d"})]})})})]}),e.jsxs(a,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(n,{className:"h-5 w-5"}),"Detailed Lead Source Data"]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(d,{className:"absolute left-2 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(i,{placeholder:"Search lead sources...",className:"pl-8",value:p,onChange:e=>N(e.target.value)})]}),e.jsxs(o,{value:f,onValueChange:F,children:[e.jsx(m,{className:"w-48",children:e.jsx(x,{placeholder:"Filter by trend"})}),e.jsxs(h,{children:[e.jsx(j,{value:"all",children:"All Trends"}),e.jsx(j,{value:"positive",children:"Positive Trend"}),e.jsx(j,{value:"negative",children:"Negative Trend"}),e.jsx(j,{value:"neutral",children:"Neutral Trend"})]})]})]}),e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(w,{children:[e.jsx(S,{children:"Source"}),e.jsx(S,{children:"Leads"}),e.jsx(S,{children:"Percentage"}),e.jsx(S,{children:"Trend"}),e.jsx(S,{children:"Top Model"})]})}),e.jsxs(C,{children:[H.map(s=>{const a=[...s.models].sort((e,s)=>s.count-e.count)[0];return e.jsxs(w,{children:[e.jsx(L,{className:"font-medium",children:s.source}),e.jsx(L,{children:s.count}),e.jsxs(L,{children:[s.percentage,"%"]}),e.jsxs(L,{className:s.trend>0?"text-green-600":"text-red-600",children:[s.trend>0?"+":"",s.trend,"%"]}),e.jsx(L,{children:(null==a?void 0:a.name)||"N/A"})]},s.source)}),0===H.length&&e.jsx(w,{children:e.jsx(L,{colSpan:5,className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No lead sources match your search criteria."})})})]})]})]})]}),e.jsxs(a,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(s,{className:"h-5 w-5"}),"Client Comments Analytics"]}),e.jsx(P,{})]})]})},I=[{source:"Online Ads",count:78,percentage:27,trend:15,models:[{name:"Voyah Free 2024",count:35},{name:"MHero 917 2024",count:28},{name:"Voyah Dream 2025",count:15}]},{source:"Social Media",count:65,percentage:23,trend:22,models:[{name:"Voyah Free 2024",count:30},{name:"MHero 917 2024",count:25},{name:"Voyah Passion 2024",count:10}]},{source:"Dealer Referral",count:42,percentage:15,trend:-5,models:[{name:"Voyah Free 2024",count:20},{name:"MHero 917 2024",count:15},{name:"Voyah Dream 2025",count:7}]},{source:"Car Shows",count:38,percentage:13,trend:8,models:[{name:"Voyah Free 2025",count:18},{name:"MHero 917 2024",count:12},{name:"Voyah Passion 2024",count:8}]},{source:"Customer Referral",count:35,percentage:12,trend:30,models:[{name:"Voyah Free 2024",count:15},{name:"MHero 917 2024",count:12},{name:"Voyah Free 2025",count:8}]},{source:"Search Engines",count:28,percentage:10,trend:5,models:[{name:"Voyah Free 2024",count:12},{name:"MHero 917 2024",count:10},{name:"Voyah Dream 2025",count:6}]}],J=()=>{var s,a;const[t,l]=y.useState("month"),{user:r}=u(),c=g();return"OWNER"!==(null==(s=null==r?void 0:r.role)?void 0:s.toUpperCase())&&"sales"!==(null==(a=null==r?void 0:r.role)?void 0:a.toLowerCase())?(p({title:"Access Denied",description:"Only owners and sales staff can access the marketing analytics page.",variant:"destructive"}),e.jsx(N,{to:"/dashboard"})):e.jsxs("div",{className:"space-y-8 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Marketing Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Analyze sales performance, lead sources, and marketing effectiveness"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{variant:"outline",onClick:()=>c("/sales"),className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Add Lead Source"]}),e.jsxs("select",{id:"periodFilter",name:"periodFilter",className:"h-10 rounded-md border border-input bg-background px-3 py-2",value:t,onChange:e=>l(e.target.value),children:[e.jsx("option",{value:"week",children:"Last Week"}),e.jsx("option",{value:"month",children:"Last Month"}),e.jsx("option",{value:"quarter",children:"Last Quarter"}),e.jsx("option",{value:"year",children:"Last Year"})]})]})]}),e.jsx("div",{className:"space-y-8",children:e.jsx(Y,{data:I,period:t})})]})};export{J as default};
