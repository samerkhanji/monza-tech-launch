var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,o=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&n(e,s,t[s]);if(a)for(var s of a(t))i.call(t,s)&&n(e,s,t[s]);return e},c=(e,a)=>t(e,s(a)),d=(e,t,s)=>n(e,"symbol"!=typeof t?t+"":t,s),u=(e,t,s)=>new Promise((a,r)=>{var i=e=>{try{o(s.next(e))}catch(t){r(t)}},n=e=>{try{o(s.throw(e))}catch(t){r(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,n);o((s=s.apply(e,t)).next())});import{R as l}from"./vendor-vN6PtkFd.js";const m=new class{constructor(){d(this,"state",{granted:!1,denied:!1,stream:null,lastRequestTime:0}),d(this,"listeners",[]),this.checkInitialPermission()}checkInitialPermission(){return u(this,null,function*(){try{if("permissions"in navigator){const e=yield navigator.permissions.query({name:"camera"});this.updateState({granted:"granted"===e.state,denied:"denied"===e.state,stream:null,lastRequestTime:this.state.lastRequestTime}),e.addEventListener("change",()=>{this.updateState({granted:"granted"===e.state,denied:"denied"===e.state,stream:this.state.stream,lastRequestTime:this.state.lastRequestTime})})}}catch(e){}})}updateState(e){this.state=o({},e),this.listeners.forEach(e=>e(this.state))}subscribe(e){return this.listeners.push(e),e(this.state),()=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}}requestCameraAccess(){return u(this,arguments,function*(e={video:!0}){const t=Date.now();if(this.state.granted&&this.state.stream&&this.state.stream.active)return this.state.stream;if(this.state.denied&&t-this.state.lastRequestTime<5e3)throw new Error("Camera permission recently denied. Please grant permission in browser settings.");try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported on this device or browser");let a=null;const r=[{video:o({facingMode:"environment"},"object"==typeof e.video?e.video:{})},{video:o({facingMode:"user"},"object"==typeof e.video?e.video:{})},{video:!0}];for(const e of r)try{a=yield navigator.mediaDevices.getUserMedia(e);break}catch(s){continue}if(!a)throw new Error("Failed to access camera with any available configuration");return this.updateState({granted:!0,denied:!1,stream:a,lastRequestTime:t}),a}catch(s){const e=s instanceof Error&&"NotAllowedError"===s.name;throw this.updateState({granted:!1,denied:e,stream:null,lastRequestTime:t}),s}})}stopCamera(){this.state.stream&&(this.state.stream.getTracks().forEach(e=>e.stop()),this.updateState(c(o({},this.state),{stream:null})))}isSupported(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}getState(){return o({},this.state)}hasActiveStream(){return!(!this.state.stream||!this.state.stream.active)}};function h(){const[e,t]=l.useState(()=>m.getState());l.useEffect(()=>m.subscribe(t),[]);const s=l.useCallback(e=>u(this,null,function*(){return yield m.requestCameraAccess(e)}),[]),a=l.useCallback(()=>{m.stopCamera()},[]);return c(o({},e),{requestCamera:s,stopCamera:a,isSupported:m.isSupported(),hasActiveStream:m.hasActiveStream()})}export{h as u};
