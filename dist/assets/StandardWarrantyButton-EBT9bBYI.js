var e=(e,t,a)=>new Promise((r,n)=>{var s=e=>{try{l(a.next(e))}catch(t){n(t)}},i=e=>{try{l(a.throw(e))}catch(t){n(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,i);l((a=a.apply(e,t)).next())});import{a8 as t,j as a,y as r,z as n,E as s,F as i,L as l,I as o,H as c,k as d,t as x,aT as m,A as y}from"./index-BmUpYGrm.js";import{r as u}from"./vendor-vN6PtkFd.js";import{F as h}from"./file-text-bXPYLusF.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p=t("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),g=m("https://wunqntfreyezylvbzvxc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1bnFudGZyZXllenlsdmJ6dnhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3NDE4MDIsImV4cCI6MjA2MzMxNzgwMn0.FxcZ536nAZ4oxDD8RWHcGeAqwQtbvECxtYGElqd9tYOL0hW3rH6Wbj3hb7qZNHC5ep1RZ2TTwAjCUY70khk5uA"),v=u.createContext({openWarrantyDialog:()=>{}});function w({children:t,onSaved:m}){const[p,w]=u.useState(!1),[b,j]=u.useState(null),[f,N]=u.useState(""),[S,D]=u.useState(""),[_,C]=u.useState(""),[I,E]=u.useState(!1),[F,M]=u.useState(!1);const k=S?Math.max(0,Math.ceil((new Date(S).getTime()-(new Date).getTime())/864e5)):null;return a.jsxs(v.Provider,{value:{openWarrantyDialog:t=>{j(t),w(!0),function(t){e(this,null,function*(){var e,a,r;try{E(!0);const{data:n,error:s}=yield g.from("car_inventory").select("warranty_start_date,warranty_end_date,warranty_notes").eq("vin",t).single();!s&&n?(N(null!=(e=n.warranty_start_date)?e:""),D(null!=(a=n.warranty_end_date)?a:""),C(null!=(r=n.warranty_notes)?r:"")):(N(""),D(""),C(""))}catch(n){x({title:"Error",description:"Failed to load warranty information",variant:"destructive"})}finally{E(!1)}})}(t)}},children:[t,a.jsx(r,{open:p,onOpenChange:w,children:a.jsxs(n,{className:"sm:max-w-md",children:[a.jsx(s,{children:a.jsxs(i,{className:"flex items-center gap-2",children:["Warranty â€” ",b]})}),I?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(l,{htmlFor:"warranty-start",children:"Start Date"}),a.jsx(o,{id:"warranty-start",type:"date",value:f,onChange:e=>N(e.target.value),placeholder:"Select start date"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(l,{htmlFor:"warranty-end",children:"End Date (Expiry)"}),a.jsx(o,{id:"warranty-end",type:"date",value:S,onChange:e=>D(e.target.value),placeholder:"Select expiry date"}),S&&null!==k&&a.jsxs("div",{className:"flex items-center gap-2 text-sm "+(k?0===k?"text-red-600":k<=30?"text-amber-600":"text-green-600":"text-gray-500"),children:[k?0===k?a.jsx(y,{className:"h-4 w-4 text-red-600"}):k<=30?a.jsx(y,{className:"h-4 w-4 text-amber-600"}):null:null,a.jsx("span",{children:0===k?"Expires today!":1===k?"Expires tomorrow":`${k} days remaining`})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(l,{htmlFor:"warranty-notes",className:"flex items-center gap-2",children:[a.jsx(h,{className:"h-4 w-4"}),"Notes"]}),a.jsx(c,{id:"warranty-notes",rows:3,value:_,onChange:e=>C(e.target.value),placeholder:"Optional warranty notes, coverage details, etc."})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(d,{variant:"outline",onClick:()=>{w(!1),j(null),N(""),D(""),C("")},disabled:F,children:"Cancel"}),a.jsx(d,{onClick:function(){return e(this,null,function*(){if(b)if(f&&S&&new Date(f)>new Date(S))x({title:"Invalid Dates",description:"Start date cannot be after end date",variant:"destructive"});else try{M(!0);const{error:e}=yield g.from("car_inventory").update({warranty_start_date:f||null,warranty_end_date:S||null,warranty_notes:_||null}).eq("vin",b);if(e)throw e;x({title:"Success",description:"Warranty information updated successfully"}),w(!1),null==m||m()}catch(e){x({title:"Error",description:"Failed to save warranty information",variant:"destructive"})}finally{M(!1)}})},disabled:F,children:F?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save"})]})]})]})})]})}const b=({car:e})=>{const{openWarrantyDialog:t}=u.useContext(v);e.warranty_start_date;const r=e.warranty_end_date,n=r?new Date(r):null,s=n&&!isNaN(n.getTime()),i=s?Math.max(0,Math.ceil((n.getTime()-(new Date).getTime())/864e5)):null;return a.jsx("td",{className:"p-4 align-middle text-sm text-gray-900 whitespace-nowrap border-b border-gray-200",children:a.jsx("button",{className:"inline-flex items-center rounded-md border px-2 py-1 text-xs font-medium transition-colors "+(s?0===i?"bg-red-100 text-red-700 border-red-200 hover:bg-red-200":i<=30?"bg-amber-100 text-amber-800 border-amber-200 hover:bg-amber-200":"bg-green-100 text-green-800 border-green-200 hover:bg-green-200":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"),onClick:()=>t(e.vinNumber||""),title:s?0===i?`Expires today (${n.toLocaleDateString()})`:1===i?`Expires tomorrow (${n.toLocaleDateString()})`:`Expires on ${n.toLocaleDateString()} (${i} days remaining)`:"Click to set warranty dates",children:s?0===i?"Expires today":1===i?"Expires tomorrow":`Expires ${n.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"})}`:"Not set"})})};export{p as M,b as S,w as W};
