import{M as e,u as t,j as r,s}from"./index-BmUpYGrm.js";import{R as a}from"./vendor-vN6PtkFd.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";function l(){var l;const[i]=e(),d=t(),n=null!=(l=i.get("vehicleId"))?l:"",[o,m]=a.useState(!1),[c,u]=a.useState(null),[h,x]=a.useState(""),[v,p]=a.useState(""),[b,j]=a.useState(30),[f,N]=a.useState("");return r.jsxs("main",{className:"mx-auto max-w-3xl p-6",children:[r.jsxs("header",{className:"mb-6",children:[r.jsx("h1",{className:"text-2xl font-semibold",children:"Schedule Test Drive"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Create a test drive job for this vehicle."})]}),r.jsxs("form",{onSubmit:e=>{return t=this,r=null,a=function*(){e.preventDefault(),u(null),m(!0);try{if(!n)throw new Error("Missing vehicleId");const e=new Date(h);if(isNaN(e.getTime()))throw new Error("Choose a valid date & time.");const t=new Date(e.getTime()+6e4*b),{error:r}=yield s.rpc("rpc_vehicle_move_to_schedule",{p_vehicle_id:n,p_title:"Test Drive",p_reason:f||`Test drive for ${v||"client"}`,p_priority:2,p_start:e.toISOString(),p_end:t.toISOString(),p_assignee_user_id:null});if(r)throw r;d(`/vehicles/${n}`)}catch(t){u(t.message||"Failed to schedule test drive.")}finally{m(!1)}},new Promise((s,l)=>{var i=t=>{try{n(a.next(t))}catch(e){l(e)}},d=t=>{try{n(a.throw(t))}catch(e){l(e)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,d);n((a=a.apply(t,r)).next())});var t,r,a},className:"space-y-5",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"testDriveDate",className:"block text-sm font-medium",children:"Test Drive Date & Time"}),r.jsx("input",{id:"testDriveDate",type:"datetime-local",value:h,onChange:e=>x(e.target.value),className:"mt-1 w-full h-12 border px-4 rounded-md",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"driverName",className:"block text-sm font-medium",children:"Driver"}),r.jsx("input",{id:"driverName",placeholder:"Driver name",value:v,onChange:e=>p(e.target.value),className:"mt-1 w-full h-12 border px-4 rounded-md"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"duration",className:"block text-sm font-medium",children:"Duration (minutes)"}),r.jsx("input",{id:"duration",type:"number",min:5,value:b,onChange:e=>j(Number(e.target.value)),className:"mt-1 w-full h-12 border px-4 rounded-md",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium",children:"Notes"}),r.jsx("textarea",{id:"notes",placeholder:"Any special requests or route notes…",value:f,onChange:e=>N(e.target.value),className:"mt-1 w-full min-h-[100px] border px-4 py-3 rounded-md"})]}),c&&r.jsx("div",{className:"text-red-600 text-sm border border-red-300 rounded-md p-2 bg-red-50",children:c}),r.jsxs("div",{className:"flex items-center justify-end gap-2",children:[r.jsx("button",{type:"button",onClick:()=>d(-1),className:"h-10 px-4 border rounded-md",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:o,className:"h-10 px-4 rounded-md bg-monza-yellow text-monza-black disabled:opacity-50",children:o?"Scheduling…":"Schedule Test Drive"})]})]})]})}export{l as default};
