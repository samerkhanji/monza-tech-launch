var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,l=(e,t)=>{for(var i in t||(t={}))r.call(t,i)&&n(e,i,t[i]);if(a)for(var i of a(t))s.call(t,i)&&n(e,i,t[i]);return e},o=(e,a)=>t(e,i(a)),c=(e,t,i)=>new Promise((a,r)=>{var s=e=>{try{l(i.next(e))}catch(t){r(t)}},n=e=>{try{l(i.throw(e))}catch(t){r(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,n);l((i=i.apply(e,t)).next())});import{a8 as d,j as m,k as u,ag as p,K as h,t as x,y as g,z as v,E as f,F as y,o as j,b as N,e as b,T as S,L as w,I as D,ao as C,P as T,n as M,ab as I,u as k,aj as O,M as P,Q as A,C as E,a as $,W as R,c as L,m as V,g as U,h as _,X as F}from"./index-BmUpYGrm.js";import{r as J,a as z}from"./vendor-vN6PtkFd.js";import{T as B,a as G,b as W,c as H,d as q,e as K}from"./table-BEISn_Te.js";import{C as Y}from"./CarHistoryDetailsDialog-DrVVgh37.js";import{M as Q,S as Z}from"./StandardWarrantyButton-EBT9bBYI.js";import{V as X}from"./VinScannerDialog-C38X97Jl.js";import{P as ee}from"./PdiViewDialog-C6B7h77-.js";import{B as te}from"./briefcase-BNfZZfKX.js";import{P as ie}from"./play-B-a94Cc8.js";import{C as ae}from"./CarStatusSelectionDialog-BKEPwv76.js";import{E as re,I as se}from"./ITSoftwareUpdateDialog-CuoSWa5I.js";import{C as ne}from"./CustomsManagementDialog-CpmILlI3.js";import{R as le}from"./refresh-cw-C6MAcERo.js";import{B as oe}from"./battery-zPCpHw5W.js";import{F as ce}from"./fuel-DD7FDLWK.js";import"./charts-XrXYWaKo.js";import"./utils-DhcIvS4g.js";import"./testDriveService-Dw5zSlpe.js";import"./enhancedRepairHistoryService-DfLNwEz9.js";import"./enhancedMonzaBotService-CP3UVEVb.js";import"./errorHandling-Dc1u_gNS.js";import"./gauge-Cy8s4FVS.js";import"./smartphone-Cgftoe1I.js";import"./test-tube-BmzcAWFY.js";import"./phone-CUmdYfuI.js";import"./mail-BiNlmlXL.js";import"./file-text-bXPYLusF.js";import"./cameraPermissionManager-D3sOAAEG.js";import"./ocrUtils-boR-SCDU.js";import"./index-dUlNy-FG.js";import"./camera-CKQtJJJ8.js";import"./arrow-left-DqrDEplE.js";import"./PdiChecklistPdf-B4FKiplK.js";import"./datetime-input-Dxp48WV8.js";import"./carClientLinkingService-K_T_il58.js";import"./pen-line--cRXdmmD.js";import"./share-2-zYou0fbF.js";import"./cpu-N9C-mmK2.js";import"./x-circle-HKM8FhbF.js";import"./download-CLPHGjzE.js";import"./truck-KpDOpNzC.js";
/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=d("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),me=({options:e,onAction:t,className:i="",disabled:a=!1,ariaLabel:r="Actions",id:s,variant:n="button",size:l="sm"})=>{var o;const c=J.useRef(null),d=J.useRef(null),[h,x]=J.useState(!1),[g,v]=J.useState({top:0,right:0}),f=e.reduce((e,t)=>{const i=t.group||"main";return e[i]||(e[i]=[]),e[i].push(t),e},{});J.useEffect(()=>{if(h&&c.current){const e=setTimeout(()=>{if(d.current&&c.current){const e=c.current.getBoundingClientRect(),t=d.current.getBoundingClientRect(),i=t.height||200,a=t.width||160,r=window.innerHeight,s=window.innerWidth;let n=e.bottom+5+i>r-20?Math.max(10,e.top-i-5):e.bottom+5;n<10&&(n=10),n+i>r-10&&(n=r-i-10);let l=s-e.right;e.right-a<10&&(l=10),v({top:Math.max(10,n),right:Math.max(10,Math.min(l,s-a-10))})}},10);return()=>clearTimeout(e)}},[h,e.length]),J.useEffect(()=>{const e=e=>{const t=e.target;d.current&&d.current.contains(t)||t.closest(".portal-dropdown-container")||h&&x(!1)},t=()=>{x(!1)},i=()=>{x(!1)},a=e=>{"Escape"===e.key&&x(!1)};if(h)return document.addEventListener("mousedown",e),window.addEventListener("scroll",t,!0),window.addEventListener("resize",i),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",e),window.removeEventListener("scroll",t,!0),window.removeEventListener("resize",i),document.removeEventListener("keydown",a)}},[h]);const y=e=>{a||(t(e),x(!1))},j="sm"===l?"h-8 px-3 text-xs":"h-9 px-4 text-sm",N="sm"===l?"h-3 w-3":"h-4 w-4";return m.jsxs("div",{className:`portal-dropdown-container ${i}`,children:[m.jsx(u,{ref:c,variant:"ghost",size:l,className:"dots"===n?"h-8 w-8 p-0":j,onClick:e=>{e.stopPropagation(),a||x(!h)},disabled:a,id:s,"aria-label":r,children:"dots"===n?m.jsx(Q,{className:N}):m.jsxs(m.Fragment,{children:[m.jsx("span",{children:"Actions"}),m.jsx(p,{className:`${N} ml-1`})]})}),h&&z.createPortal(m.jsx("div",{ref:d,className:"fixed bg-white border border-gray-300 rounded-md shadow-xl z-50 min-w-[160px] max-w-[200px] max-h-[300px] overflow-y-auto",style:{top:`${g.top}px`,right:`${g.right}px`,zIndex:999999},children:m.jsxs("div",{className:"py-1",children:[null==(o=f.main)?void 0:o.map(e=>m.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 flex items-center transition-colors "+(e.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"),onMouseDown:t=>{t.stopPropagation(),e.disabled||y(e.value)},disabled:e.disabled,children:[e.icon&&m.jsx("span",{className:"mr-2",children:e.icon}),e.label]},e.value)),Object.entries(f).map(([e,t])=>"main"===e?null:m.jsxs("div",{children:[m.jsx("div",{className:"border-t border-gray-200 my-1"}),m.jsx("div",{className:"px-3 py-1 text-xs font-medium text-gray-500 uppercase tracking-wider",children:e}),t.map(e=>m.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 flex items-center transition-colors "+(e.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"),onMouseDown:t=>{t.stopPropagation(),e.disabled||y(e.value)},disabled:e.disabled,children:[e.icon&&m.jsx("span",{className:"mr-2",children:e.icon}),e.label]},e.value))]},e))]})}),document.body)]})};const ue=new class{constructor(){var e;n(this,"symbol"!=typeof(e="activeActivities")?e+"":e,new Map)}startActivity(e){return c(this,null,function*(){const t=(new Date).toISOString(),i=crypto.randomUUID(),a=o(l({},e),{id:crypto.randomUUID(),createdAt:t,isActive:!0,sessionId:i,startTime:e.startTime||t});this.activeActivities.set(a.id,a);try{const e=localStorage.getItem("timeTrackingEvents"),t=e?JSON.parse(e):[];return t.push(a),localStorage.setItem("timeTrackingEvents",JSON.stringify(t)),a.id}catch(r){return a.id}})}endActivity(e,t){return c(this,null,function*(){const i=this.activeActivities.get(e);if(!i)return null;const a=(new Date).toISOString(),r=new Date(i.startTime),s=new Date(a),n=Math.round((s.getTime()-r.getTime())/6e4),c=Math.round(n/60*100)/100;let d,m;i.estimatedDurationMinutes&&(d=Math.round((n-i.estimatedDurationMinutes)/i.estimatedDurationMinutes*100),m=d<=-20?5:d<=-10?4:d<=10?3:d<=25?2:1);const u=o(l(l({},i),t),{endTime:a,durationMinutes:n,durationHours:c,actualVsEstimated:d,efficiencyRating:m,updatedAt:a,isActive:!1});this.activeActivities.delete(e);try{const t=localStorage.getItem("timeTrackingEvents"),i=(t?JSON.parse(t):[]).map(t=>t.id===e?u:t);return localStorage.setItem("timeTrackingEvents",JSON.stringify(i)),u}catch(p){return u}})}logCompletedActivity(e){return c(this,null,function*(){const t=new Date(e.startTime),i=new Date(e.endTime),a=Math.round((i.getTime()-t.getTime())/6e4),r=Math.round(a/60*100)/100;let s,n;e.estimatedDurationMinutes&&(s=Math.round((a-e.estimatedDurationMinutes)/e.estimatedDurationMinutes*100),n=s<=-20?5:s<=-10?4:s<=10?3:s<=25?2:1);const c=o(l({},e),{id:crypto.randomUUID(),createdAt:(new Date).toISOString(),durationMinutes:a,durationHours:r,actualVsEstimated:s,efficiencyRating:n,isActive:!1});try{const e=localStorage.getItem("timeTrackingEvents"),t=e?JSON.parse(e):[];return t.push(c),localStorage.setItem("timeTrackingEvents",JSON.stringify(t)),c.id}catch(d){return c.id}})}getActiveActivities(e){const t=Array.from(this.activeActivities.values());return e?t.filter(t=>t.employeeName===e):t}getEmployeePerformance(e,t,i){return c(this,null,function*(){try{const a=localStorage.getItem("timeTrackingEvents");if(!a)return null;const r=JSON.parse(a).filter(a=>a.employeeName===e&&a.startTime>=t&&a.startTime<=i&&!a.isActive);if(0===r.length)return null;const s=r.reduce((e,t)=>e+(t.durationMinutes||0),0),n=Math.round(s/60*100)/100,l=Math.round(s/r.length),o=r.reduce((e,t)=>e+(t.efficiencyRating||3),0)/r.length,c={},d=new Set,m=new Set;let u=0;return r.forEach(e=>{e.carVin&&d.add(e.carVin),e.clientName&&m.add(e.clientName),e.efficiencyRating&&e.efficiencyRating>=3&&u++,c[e.activityType]||(c[e.activityType]={count:0,totalMinutes:0,averageMinutes:0,efficiencyScore:0});const t=c[e.activityType];t.count++,t.totalMinutes+=e.durationMinutes||0,t.efficiencyScore+=e.efficiencyRating||3}),Object.values(c).forEach(e=>{e.averageMinutes=Math.round(e.totalMinutes/e.count),e.efficiencyScore=e.efficiencyScore/e.count}),{employeeName:e,timePeriodd:{start:t,end:i},totalHours:n,totalMinutes:s,activitiesCompleted:r.length,averageActivityDuration:l,efficiencyScore:o,activitiesByType:c,carsWorkedOn:d.size,clientsServed:m.size,onTimePerformance:Math.round(u/r.length*100)}}catch(a){return null}})}getActivityAnalytics(e,t,i){return c(this,null,function*(){try{const a=localStorage.getItem("timeTrackingEvents");if(!a)return null;const r=JSON.parse(a).filter(a=>a.activityType===e&&a.startTime>=t&&a.startTime<=i&&null!==a.endTime);if(0===r.length)return null;const s=r.map(e=>e.durationMinutes||0),n=s.reduce((e,t)=>e+t,0),l=Math.round(n/r.length),o={};r.forEach(e=>{o[e.employeeName]||(o[e.employeeName]={totalDuration:0,count:0,efficiencySum:0}),o[e.employeeName].totalDuration+=e.durationMinutes||0,o[e.employeeName].count++,o[e.employeeName].efficiencySum+=e.efficiencyRating||3});const c=Object.entries(o).map(([e,t])=>({employeeName:e,averageDuration:Math.round(t.totalDuration/t.count),totalActivities:t.count,efficiencyScore:t.efficiencySum/t.count})).sort((e,t)=>e.averageDuration-t.averageDuration);return{activityType:e,totalOccurrences:r.length,averageDurationMinutes:l,fastestDurationMinutes:Math.min(...s),slowestDurationMinutes:Math.max(...s),totalTimeSpentMinutes:n,employeeRankings:c}}catch(a){return null}})}getAllTimeTrackingData(e,t){return c(this,null,function*(){try{const i=localStorage.getItem("timeTrackingEvents");if(!i)return[];const a=JSON.parse(i);return a.filter(i=>(!e||i.startTime>=e)&&(!t||i.startTime<t))}catch(i){return[]}})}formatDuration(e){const t=Math.floor(e/60),i=e%60;return t>0?`${t}h ${i}m`:`${i}m`}calculateEfficiencyPercentage(e,t){return 0===t?100:Math.round((t-e)/t*100)}},pe=(e,t,i,a,r=!1)=>ue.startActivity({employeeName:e,activityType:r?"test_drive_client":"test_drive_employee",activityDescription:`${r?"Client":"Employee"} test drive - ${i}${a?` for ${a}`:""}`,startTime:(new Date).toISOString(),carVin:t,carModel:i,clientName:a,estimatedDurationMinutes:r?30:15,location:"Test Drive Route",department:"Sales"}),he=(e,t,i)=>ue.endActivity(e,{notes:t,issues:i}),xe=(e,t,i,a,r)=>ue.startActivity({employeeName:e,activityType:"repair_start",activityDescription:`Repair: ${a} on ${i}`,startTime:(new Date).toISOString(),carVin:t,carModel:i,estimatedDurationMinutes:60*r,location:"Garage",department:"Service"}),ge=(e,t,i,a)=>ue.endActivity(e,{partsUsed:t,toolsUsed:i,notes:a}),ve=(e,t,i,a,r,s)=>{const n=new Date,l=new Date(n.getTime()-60*r*1e3);return ue.logCompletedActivity({employeeName:e,activityType:"client_interaction",activityDescription:`${a} with ${t}`,startTime:l.toISOString(),endTime:n.toISOString(),clientName:t,clientPhone:i,carVin:s,location:"Showroom",department:"Sales"})},fe=({isOpen:e,onClose:t,car:i,onStartTestDrive:a,onEndTestDrive:r,isClientTestDrive:s=!1})=>{var n,o,d;const{user:p}=h(),[C,T]=J.useState(""),[M,I]=J.useState(""),[k,O]=J.useState(0),P=((e={})=>{const{user:t}=h(),[i,a]=J.useState(!1),[r,s]=J.useState(null),[n,o]=J.useState(0),[d,m]=J.useState(null),{activityType:u,activityDescription:p,carVin:g,carModel:v,clientName:f,clientPhone:y,estimatedDurationMinutes:j,location:N="Workplace",department:b="General",autoTrack:S=!1,showNotifications:w=!0}=e;J.useEffect(()=>{let e;return i&&d&&(e=setInterval(()=>{const e=new Date,t=Math.floor((e.getTime()-d.getTime())/1e3);o(t)},1e3)),()=>{e&&clearInterval(e)}},[i,d]),J.useEffect(()=>{S&&u&&p&&!i&&t&&C()},[S,u,p,i,t]);const D=J.useCallback(e=>{const t=Math.floor(e/3600),i=Math.floor(e%3600/60),a=e%60;return t>0?`${t}:${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${i}:${a.toString().padStart(2,"0")}`},[]),C=J.useCallback((...n)=>c(void 0,[...n],function*(n={}){var c;if(!t)return null;if(i)return r;const d=l(l({},e),n);if(!d.activityType||!d.activityDescription)return null;try{const e=(null==(c=null==t?void 0:t.user_metadata)?void 0:c.full_name)||t.email||"Unknown Employee",i=yield ue.startActivity({employeeName:e,employeeEmail:t.email,activityType:d.activityType,activityDescription:d.activityDescription,startTime:(new Date).toISOString(),carVin:d.carVin,carModel:d.carModel,clientName:d.clientName,estimatedDurationMinutes:d.estimatedDurationMinutes,location:d.location,department:d.department});return s(i),a(!0),m(new Date),o(0),w&&x({title:"Activity Tracking Started",description:`Now tracking: ${d.activityDescription}`,duration:3e3}),i}catch(u){return w&&x({title:"Tracking Error",description:"Failed to start activity tracking",variant:"destructive"}),null}}),[t,e,i,r,w]),T=J.useCallback((e,t)=>c(void 0,null,function*(){if(!r||!i)return null;try{const i=yield ue.endActivity(r,{notes:e,issues:t});return s(null),a(!1),m(null),o(0),w&&i&&x({title:"Activity Completed",description:`Completed in ${ue.formatDuration(i.durationMinutes||0)}`,duration:5e3}),i}catch(n){return w&&x({title:"Tracking Error",description:"Failed to end activity tracking",variant:"destructive"}),null}}),[r,i,w]);return{isTracking:i,activeActivityId:r,elapsedTime:n,startTracking:C,endTracking:T,formatTime:D,trackTestDrive:{start:(e=!1)=>c(void 0,null,function*(){var i;if(!t||!g||!v)return null;const r=(null==(i=null==t?void 0:t.user_metadata)?void 0:i.full_name)||t.email||"Unknown Employee";try{const t=yield pe(r,g,v,f,e);return s(t),a(!0),m(new Date),o(0),w&&x({title:"Test Drive Started",description:(e?"Client":"Employee")+" test drive tracking started",duration:3e3}),t}catch(n){return null}}),end:(e,t)=>c(void 0,null,function*(){if(!r)return null;try{const i=yield he(r,e,t);return s(null),a(!1),m(null),o(0),i}catch(i){return null}})},trackRepair:{start:(e,i)=>c(void 0,null,function*(){var r;if(!t||!g||!v)return null;const n=(null==(r=null==t?void 0:t.user_metadata)?void 0:r.full_name)||t.email||"Unknown Employee";try{const t=yield xe(n,g,v,e,i);return s(t),a(!0),m(new Date),o(0),w&&x({title:"Repair Tracking Started",description:`Repair tracking started: ${e}`,duration:3e3}),t}catch(l){return null}}),end:(e,t,i)=>c(void 0,null,function*(){if(!r)return null;try{const n=yield ge(r,e,t,i);return s(null),a(!1),m(null),o(0),n}catch(n){return null}})},trackClientInteraction:{log:(e,i)=>c(void 0,null,function*(){var a;if(!t||!f||!y)return null;const r=(null==(a=null==t?void 0:t.user_metadata)?void 0:a.full_name)||t.email||"Unknown Employee";try{const t=yield ve(r,f,y,e,i,g);return w&&x({title:"Client Interaction Logged",description:`${e} with ${f} (${i}min)`,duration:3e3}),t}catch(s){return null}})}}})({activityType:s?"test_drive_client":"test_drive_employee",activityDescription:`${s?"Client":"Employee"} test drive - ${(null==i?void 0:i.model)||"Vehicle"}`,carVin:(null==i?void 0:i.vinNumber)||(null==i?void 0:i.vin),carModel:null==i?void 0:i.model,clientName:s?M:void 0,estimatedDurationMinutes:s?30:15,location:"Test Drive Route",department:"Sales",showNotifications:!1});J.useEffect(()=>{var e,t;let a;return(null==(e=null==i?void 0:i.testDriveInfo)?void 0:e.isOnTestDrive)&&(null==(t=null==i?void 0:i.testDriveInfo)?void 0:t.testDriveStartTime)&&(a=setInterval(()=>{const e=new Date(i.testDriveInfo.testDriveStartTime),t=new Date,a=Math.floor((t.getTime()-e.getTime())/1e3);O(a)},1e3)),()=>{a&&clearInterval(a)}},[null==(n=null==i?void 0:i.testDriveInfo)?void 0:n.isOnTestDrive,null==(o=null==i?void 0:i.testDriveInfo)?void 0:o.testDriveStartTime]);const A=e=>{const t=Math.floor(e/3600),i=Math.floor(e%3600/60),a=e%60;return t>0?`${t}:${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${i}:${a.toString().padStart(2,"0")}`},E=()=>c(void 0,null,function*(){if(!i)return;if(!C.trim())return void x({title:"Employee Required",description:"Please enter the employee name.",variant:"destructive"});if(s&&!M.trim())return void x({title:"Client Name Required",description:"Please enter the client name for client test drive.",variant:"destructive"});const e=new Date,t={isOnTestDrive:!0,testDriveStartTime:e.toISOString(),actualStartTime:e.toISOString(),scheduledStartTime:null,employeeName:C.trim(),clientName:s?M.trim():null,isClientTestDrive:s,loggedBy:(null==p?void 0:p.email)||"Unknown",loggedAt:e.toISOString(),vehicleVin:i.vinNumber||i.vin,vehicleModel:i.model,startMethod:"immediate",realTimeCapture:!0};yield P.trackTestDrive.start(s);a(i.id,t),x({title:"🚗 Test Drive Started - Real Time",description:`${s?"Client":"Employee"} test drive started NOW with ${C} at ${e.toLocaleTimeString()}`,duration:5e3}),T(""),I("")});if(!i)return null;const $=null==(d=i.testDriveInfo)?void 0:d.isOnTestDrive;return m.jsx(g,{open:e,onOpenChange:t,children:m.jsxs(v,{className:"max-w-2xl w-[95vw] max-h-[95vh] overflow-y-auto",children:[m.jsx(f,{className:"sticky top-0 bg-white z-10 border-b pb-4",children:m.jsxs(y,{className:"flex items-center gap-2",children:[s?m.jsx(j,{className:"h-5 w-5 text-blue-600"}):m.jsx(te,{className:"h-5 w-5 text-orange-600"}),s?"Client":"Employee"," Test Drive"]})}),m.jsxs("div",{className:"space-y-4 px-1",children:[m.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx(N,{className:"h-4 w-4 text-gray-600"}),m.jsxs("span",{className:"font-medium text-sm",children:[i.model," (",i.year,")"]})]}),m.jsxs("div",{className:"text-xs text-gray-600 font-mono",children:["VIN: ",i.vinNumber||i.vin]})]}),$?m.jsxs("div",{className:"space-y-4",children:[m.jsx("div",{className:"text-center",children:m.jsxs(b,{className:"bg-green-100 text-green-800 border-green-300 px-4 py-2",children:[m.jsx(S,{className:"h-4 w-4 mr-2"}),"Test Drive Active - Real Time"]})}),m.jsxs("div",{className:"text-center p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg border-2 border-green-300",children:[m.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Current Duration"}),m.jsx("div",{className:"text-4xl font-mono font-bold text-green-600",children:A(k)}),m.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Started: ",new Date(i.testDriveInfo.testDriveStartTime).toLocaleString()]})]}),m.jsxs("div",{className:"space-y-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[m.jsxs("div",{className:"flex justify-between text-sm",children:[m.jsx("span",{className:"font-medium",children:"Employee:"}),m.jsx("span",{children:i.testDriveInfo.employeeName})]}),i.testDriveInfo.clientName&&m.jsxs("div",{className:"flex justify-between text-sm",children:[m.jsx("span",{className:"font-medium",children:"Client:"}),m.jsx("span",{children:i.testDriveInfo.clientName})]}),m.jsxs("div",{className:"flex justify-between text-sm",children:[m.jsx("span",{className:"font-medium",children:"Actual Start:"}),m.jsx("span",{className:"font-mono text-green-600 font-semibold",children:new Date(i.testDriveInfo.testDriveStartTime).toLocaleTimeString()})]}),m.jsxs("div",{className:"flex justify-between text-sm",children:[m.jsx("span",{className:"font-medium",children:"Start Method:"}),m.jsx("span",{className:"text-green-600 font-semibold",children:"immediate"===i.testDriveInfo.startMethod?"🕐 Real-Time Capture":"Scheduled"})]})]}),m.jsxs(u,{onClick:()=>c(void 0,null,function*(){if(!i)return;yield P.trackTestDrive.end();r(i.id);const e=A(k);x({title:"Test Drive Completed",description:`Test drive completed. Duration: ${e}`}),t()}),className:"w-full bg-red-600 hover:bg-red-700 text-white py-3",children:[m.jsx(de,{className:"h-4 w-4 mr-2"}),"End Test Drive & Calculate Duration"]})]}):m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg border border-blue-200",children:[m.jsx("div",{className:"text-sm text-gray-600",children:"Current Time"}),m.jsx("div",{className:"text-xl font-mono font-bold text-blue-600",children:(new Date).toLocaleTimeString()}),m.jsx("div",{className:"text-xs text-gray-500",children:(new Date).toLocaleDateString()})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(w,{htmlFor:"employeeName",children:[s?"Accompanying Employee":"Employee Name"," *"]}),m.jsx(D,{id:"employeeName",value:C,onChange:e=>T(e.target.value),placeholder:"Enter employee name",className:"border-gray-300"})]}),s&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(w,{htmlFor:"clientName",children:"Client Name *"}),m.jsx(D,{id:"clientName",value:M,onChange:e=>I(e.target.value),placeholder:"Enter client name",className:"border-gray-300"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border-2 border-green-300",children:[m.jsxs("div",{className:"text-center mb-3",children:[m.jsx("div",{className:"text-lg font-bold text-green-800",children:"Ready to Start Test Drive?"}),m.jsx("div",{className:"text-sm text-gray-600",children:"Click below to capture the real start time"})]}),m.jsxs(u,{onClick:()=>c(void 0,null,function*(){C.trim()?!s||M.trim()?yield E():x({title:"Client Name Required",description:"Please enter the client name first.",variant:"destructive"}):x({title:"Employee Required",description:"Please enter the employee name first.",variant:"destructive"})}),className:"w-full bg-green-600 hover:bg-green-700 text-white py-4 text-lg font-semibold",disabled:!C.trim()||s&&!M.trim(),children:[m.jsx(ie,{className:"h-5 w-5 mr-2"}),"🚗 Take Car Now - Start Real Time"]})]}),m.jsx("div",{className:"text-center",children:m.jsx(u,{onClick:E,variant:"outline",className:"text-sm",disabled:!C.trim()||s&&!M.trim(),children:"Or Schedule Test Drive"})})]}),m.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:m.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-700",children:[m.jsx(S,{className:"h-4 w-4"}),m.jsxs("span",{children:[m.jsx("strong",{children:"Real-Time Tracking:"}),' When you click "Take Car Now", the system will capture the exact timestamp and start duration tracking automatically.']})]})})]})]})]})})},ye=({isOpen:e,onClose:t,car:i,onMoveCar:a})=>{const r=[{id:"floor1",label:"Showroom Floor 1",description:"Move to main showroom floor 1",icon:C},{id:"floor2",label:"Showroom Floor 2",description:"Move to luxury showroom floor 2",icon:C},{id:"inventory",label:"Car Inventory",description:"Move to main car inventory storage",icon:T},{id:"garage-schedule",label:"Garage Schedule",description:"Add to garage schedule for service/repair",icon:M}];return m.jsx(g,{open:e,onOpenChange:t,children:m.jsxs(v,{className:"sm:max-w-[400px]",children:[m.jsx(f,{children:m.jsxs(y,{children:["Move Car - ",null==i?void 0:i.model]})}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[m.jsxs("p",{className:"text-sm",children:[m.jsx("strong",{children:"VIN:"})," ",null==i?void 0:i.vinNumber]}),m.jsxs("p",{className:"text-sm",children:[m.jsx("strong",{children:"Model:"})," ",null==i?void 0:i.model]}),m.jsxs("p",{className:"text-sm",children:[m.jsx("strong",{children:"Color:"})," ",null==i?void 0:i.color]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("p",{className:"text-sm font-medium",children:"Select destination:"}),r.map(e=>m.jsx(u,{variant:"outline",className:"w-full justify-start",onClick:()=>a(e.id),children:e.label},e.id))]})]}),m.jsx(I,{children:m.jsx(u,{variant:"outline",onClick:t,children:"Cancel"})})]})})},je=()=>{try{return[]}catch(e){return[]}},Ne=e=>{try{localStorage.setItem("garageCars",JSON.stringify(e))}catch(t){}},be=()=>{const[e,t]=J.useState([]),[i,a]=J.useState(""),[r,s]=J.useState("All Models"),[n,c]=J.useState("All Status"),[d,p]=J.useState("All Categories"),[h,g]=J.useState(!1),[v,f]=J.useState(!1),[y,j]=J.useState(!1),[S,w]=J.useState(!1),[C,T]=J.useState(!1),[I,z]=J.useState(!1),[Q,te]=J.useState(!1),[ie,de]=J.useState(null),[ue,pe]=J.useState(null),[he,xe]=J.useState(null),[ge,ve]=J.useState(null),[be,Se]=J.useState(null),[we,De]=J.useState(null),[Ce,Te]=J.useState(!1),[Me,Ie]=J.useState(null),[ke,Oe]=J.useState(!1),[Pe,Ae]=J.useState(null),Ee=k();O(),P(),J.useEffect(()=>{localStorage.removeItem("garageCars"),localStorage.removeItem("garageInventory"),localStorage.removeItem("garageSchedule"),localStorage.removeItem("garageSchedules"),localStorage.removeItem("inventoryGarage");const e=je();t(e)},[]);const $e=e=>{switch(e){case"in_stock":case"stored":case"completed":case"ready_for_pickup":return"bg-green-100 text-green-800 border-green-200";case"sold":return"bg-blue-100 text-blue-800 border-blue-200";case"reserved":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"maintenance":case"in_repair":return"bg-orange-100 text-orange-800 border-orange-200";case"pending":case"awaiting_parts":case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},Re=e=>{switch(e){case"in_stock":return"In Stock";case"stored":return"Stored";case"sold":return"Sold";case"reserved":return"Reserved";case"maintenance":return"Maintenance";case"in_repair":return"In Repair";case"completed":return"Completed";case"ready_for_pickup":return"Ready for Pickup";case"pending":return"Pending";case"awaiting_parts":return"Awaiting Parts";case"cancelled":return"Cancelled";default:return e.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())}},Le=e=>{switch(e){case"EV":return"bg-blue-100 text-blue-800";case"REV":return"bg-green-100 text-green-800";case"ICEV":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},Ve=e=>{"sold"===e.status||e.status,De(e),w(!0)},Ue=(t,i)=>{const a=e.find(e=>e.id===t);a&&(xe(a),j(!0))},_e=i=>{const a=e.find(e=>e.id===i);if(!a||!a.testDriveInfo)return;const r=e.map(e=>e.id===i?o(l({},e),{testDriveInfo:null}):e);t(r),Ne(r),x({title:"Test Drive Completed",description:"Test drive has been completed and added to vehicle history."})},Fe={totalCars:e.length,inRepair:e.filter(e=>"in_repair"===e.garageStatus||"maintenance"===e.status).length,completed:e.filter(e=>"completed"===e.repairStatus).length,inProgress:e.filter(e=>"in_progress"===e.repairStatus).length,pending:e.filter(e=>"pending"===e.repairStatus).length},Je=e.filter(e=>{var t,a,s,l;const o=i.toLowerCase(),c=((null==(t=e.vinNumber)?void 0:t.toLowerCase())||"").includes(o)||((null==(a=e.model)?void 0:a.toLowerCase())||"").includes(o)||((null==(s=e.brand)?void 0:s.toLowerCase())||"").includes(o)||((null==(l=e.assignedMechanic)?void 0:l.toLowerCase())||"").includes(o),m="All Models"===r||e.model===r,u="All Status"===n||e.status===n,p="All Categories"===d||e.category===d;return c&&m&&u&&p}),ze=["All Models",...Array.from(new Set(e.map(e=>e.model)))],Be=["All Status",...Array.from(new Set(e.map(e=>e.status)))],Ge=["All Categories",...Array.from(new Set(e.map(e=>e.category)))];return m.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold",children:"Garage Inventory"}),m.jsx("p",{className:"text-muted-foreground",children:"Manage cars currently in garage for repairs and maintenance"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs(u,{variant:"outline",onClick:()=>{const e=je();t(e),x({title:"Inventory Refreshed",description:"Garage inventory has been refreshed"})},children:[m.jsx(le,{className:"h-4 w-4 mr-2"}),"Refresh"]}),m.jsx(u,{variant:"outline",onClick:()=>{x({title:"Export Started",description:"Garage inventory export has been initiated"})},children:"Export"}),m.jsxs(u,{onClick:()=>g(!0),children:[m.jsx(A,{className:"h-4 w-4 mr-2"}),"Scan VIN"]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[m.jsx(E,{children:m.jsxs($,{className:"p-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(N,{className:"h-5 w-5 text-blue-600"}),m.jsx("span",{className:"font-semibold text-gray-900",children:"Total Cars"})]}),m.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Fe.totalCars}),m.jsx("p",{className:"text-sm text-gray-600",children:"In garage"})]})}),m.jsx(E,{children:m.jsxs($,{className:"p-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(R,{className:"h-5 w-5 text-orange-600"}),m.jsx("span",{className:"font-semibold text-gray-900",children:"In Repair"})]}),m.jsx("p",{className:"text-2xl font-bold text-orange-600",children:Fe.inRepair}),m.jsx("p",{className:"text-sm text-gray-600",children:"Active repairs"})]})}),m.jsx(E,{children:m.jsxs($,{className:"p-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(L,{className:"h-5 w-5 text-green-600"}),m.jsx("span",{className:"font-semibold text-gray-900",children:"In Progress"})]}),m.jsx("p",{className:"text-2xl font-bold text-green-600",children:Fe.inProgress}),m.jsx("p",{className:"text-sm text-gray-600",children:"Currently working"})]})}),m.jsx(E,{children:m.jsxs($,{className:"p-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(V,{className:"h-5 w-5 text-green-600"}),m.jsx("span",{className:"font-semibold text-gray-900",children:"Completed"})]}),m.jsx("p",{className:"text-2xl font-bold text-green-600",children:Fe.completed}),m.jsx("p",{className:"text-sm text-gray-600",children:"Finished today"})]})}),m.jsx(E,{children:m.jsxs($,{className:"p-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(M,{className:"h-5 w-5 text-yellow-600"}),m.jsx("span",{className:"font-semibold text-gray-900",children:"Pending"})]}),m.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:Fe.pending}),m.jsx("p",{className:"text-sm text-gray-600",children:"Waiting to start"})]})})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[m.jsx(E,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:-translate-y-1",onClick:()=>{Ee("/garage-schedule")},children:m.jsx($,{className:"p-4",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:m.jsx(L,{className:"h-5 w-5 text-blue-600"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold text-gray-900",children:"Garage Schedule"}),m.jsx("p",{className:"text-sm text-gray-600",children:"View work schedule"})]})]})})}),m.jsx(E,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:-translate-y-1",onClick:()=>Ee("/garage-schedule"),children:m.jsx($,{className:"p-4",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:m.jsx(M,{className:"h-5 w-5 text-purple-600"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold text-gray-900",children:"Daily Plan"}),m.jsx("p",{className:"text-sm text-gray-600",children:"Full day overview"})]})]})})}),m.jsx(E,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:-translate-y-1",onClick:()=>{Ee("/repairs")},children:m.jsx($,{className:"p-4",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:m.jsx(R,{className:"h-5 w-5 text-green-600"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold text-gray-900",children:"Repairs"}),m.jsx("p",{className:"text-sm text-gray-600",children:"Manage repairs"})]})]})})})]}),m.jsxs("div",{className:"form-container grid grid-cols-1 sm:grid-cols-4 gap-4 mb-6",children:[m.jsx("div",{className:"form-col",children:m.jsx(D,{id:"garageSearch",placeholder:"Search by VIN, model, or mechanic...",value:i,onChange:e=>a(e.target.value)})}),m.jsx("div",{className:"form-col",children:m.jsx("select",{id:"modelFilter",className:"form-element",value:r,onChange:e=>s(e.target.value),children:ze.map(e=>m.jsx("option",{value:e,children:e},e))})}),m.jsx("div",{className:"form-col",children:m.jsx("select",{id:"statusFilter",className:"form-element",value:n,onChange:e=>c(e.target.value),children:Be.map(e=>m.jsx("option",{value:e,children:"All Status"===e?"All Status":Re(e)},e))})}),m.jsx("div",{className:"form-col",children:m.jsx("select",{id:"categoryFilter",className:"form-element",value:d,onChange:e=>p(e.target.value),children:Ge.map(e=>m.jsx("option",{value:e,children:e},e))})})]}),m.jsxs(E,{children:[m.jsx(U,{children:m.jsxs(_,{className:"flex items-center gap-2",children:[m.jsx(N,{className:"h-5 w-5"}),"Garage Cars Inventory",m.jsxs(b,{variant:"secondary",className:"ml-auto",children:[Je.length," cars"]})]})}),m.jsx($,{children:m.jsx("div",{className:"rounded-md border",children:m.jsxs(B,{children:[m.jsx(G,{children:m.jsxs(W,{children:[m.jsx(H,{children:"VIN"}),m.jsx(H,{children:"Model"}),m.jsx(H,{children:"Category"}),m.jsx(H,{children:"Year"}),m.jsx(H,{children:"Color"}),m.jsx(H,{children:"Color interior"}),m.jsx(H,{children:"Price"}),m.jsx(H,{children:"Status"}),m.jsx(H,{children:"Warranty Life"}),m.jsx(H,{children:"Battery"}),m.jsx(H,{children:"Range Capacity"}),m.jsx(H,{children:"Km Driven"}),m.jsx(H,{children:"Test Drive"}),m.jsx(H,{children:"PDI"}),m.jsx(H,{children:"Customs"}),m.jsx(H,{children:"Software Model"}),m.jsx(H,{children:"Actions"})]})}),m.jsx(q,{children:Je.map(e=>{var t;return m.jsxs(W,{className:"hover:bg-blue-50 cursor-pointer transition-colors",onClick:()=>{Ae(e),Oe(!0)},title:"Click to view complete car history",children:[m.jsx(K,{className:"font-mono text-sm",children:e.vinNumber}),m.jsx(K,{className:"font-medium",children:e.model}),m.jsx(K,{children:m.jsx(b,{className:Le(e.category),children:e.category})}),m.jsx(K,{children:e.year||"N/A"}),m.jsx(K,{children:e.color}),m.jsx(K,{children:e.interiorColor||e.interior_color||"-"}),m.jsxs(K,{children:["$",e.price?e.price.toLocaleString():"0"]}),m.jsx(K,{children:"sold"===e.status||"reserved"===e.status?m.jsx(b,{className:`${$e(e.status)} cursor-pointer hover:opacity-80 transition-opacity`,onClick:t=>{t.preventDefault(),t.stopPropagation(),Ve(e)},title:"Click to view client information",children:Re(e.status)}):m.jsx(b,{className:`${$e(e.status)} cursor-pointer hover:opacity-80 transition-opacity`,onClick:t=>{t.preventDefault(),t.stopPropagation(),Ve(e)},title:"Click to add client information",children:Re(e.status)})}),m.jsx(Z,{car:e}),m.jsx(K,{children:m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(oe,{className:"h-4 w-4"}),e.batteryPercentage||0,"%"]})}),m.jsx(K,{children:m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(ce,{className:"h-4 w-4"}),e.range||0," km"]})}),m.jsx(K,{children:m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(L,{className:"h-4 w-4"}),e.mileage||e.kmDriven||0," km"]})}),m.jsx(K,{children:(null==(t=e.testDriveInfo)?void 0:t.isOnTestDrive)?m.jsx(b,{variant:"outline",className:"bg-blue-50 text-blue-600 cursor-pointer hover:bg-blue-100 transition-colors",onClick:t=>{t.preventDefault(),t.stopPropagation(),_e(e.id)},title:"Click to end test drive",children:"On Test Drive"}):"sold"===e.status||"reserved"===e.status?m.jsx(b,{variant:"outline",className:"bg-gray-50 text-gray-500",children:"Not Available"}):m.jsx(b,{variant:"outline",className:"bg-gray-50 text-gray-500 cursor-pointer hover:bg-blue-50 hover:text-blue-600 transition-colors",onClick:t=>{t.preventDefault(),t.stopPropagation(),Ue(e.id,(e.model,e.vinNumber))},title:"Click to schedule test drive",children:"Available"})}),m.jsx(K,{children:m.jsx("div",{className:"cursor-pointer",onClick:()=>(e=>{pe(e),f(!0)})(e),children:m.jsx(b,{variant:e.pdiCompleted?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity "+(e.pdiCompleted?"bg-green-100 text-green-800 border-green-200":"bg-yellow-100 text-yellow-800 border-yellow-200"),children:e.pdiCompleted?m.jsxs(m.Fragment,{children:[m.jsx("span",{className:"mr-1 text-lg",children:"☺"})," Complete"]}):m.jsxs(m.Fragment,{children:[m.jsx("span",{className:"mr-1 text-lg",children:"☹"})," Pending"]})})})}),m.jsx(K,{children:m.jsx(b,{variant:"paid"===e.customs?"default":"destructive",className:"cursor-pointer hover:opacity-80 transition-opacity active:scale-95",onClick:()=>(e=>{Se(e),te(!0)})(e),title:"Click to manage customs payment",children:"paid"===e.customs?m.jsxs(m.Fragment,{children:[m.jsx(V,{className:"mr-1 h-4 w-4"})," paid"]}):m.jsxs(m.Fragment,{children:[m.jsx(F,{className:"mr-1 h-4 w-4"})," ",e.customs||"not paid"]})})}),m.jsx(K,{children:m.jsx("div",{className:"flex items-center gap-1 text-xs cursor-pointer",onClick:()=>(e=>{ve(e),z(!0)})(e),title:"Click to manage software updates",children:e.softwareVersion?m.jsxs(m.Fragment,{children:[m.jsxs(b,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:["v",e.softwareVersion]}),e.softwareLastUpdated&&m.jsx("span",{className:"text-gray-500",children:new Date(e.softwareLastUpdated).toLocaleDateString()})]}):m.jsx(b,{variant:"secondary",className:"text-xs text-yellow-700 bg-yellow-100 hover:bg-yellow-200 transition-colors",children:"Update Needed"})})}),m.jsx(K,{children:m.jsx(me,{options:[{value:"view",label:"View Details"},{value:"edit",label:"Edit Car"},{value:"move",label:"Move Car"}],onAction:t=>{"view"===t||"edit"===t?(e=>{de(e),T(!0)})(e):"move"===t&&(e=>{Ie(e),Te(!0)})(e)},id:`actions-${e.id}`,ariaLabel:`Actions for ${e.model} ${e.vinNumber}`})})]},e.id)})})]})})})]}),m.jsx(X,{isOpen:h,onClose:()=>g(!1),onVinScanned:e=>{x({title:"VIN Scanned",description:`VIN ${e} scanned successfully`})}}),ue&&m.jsx(ee,{isOpen:v,onClose:()=>f(!1),car:ue,onPdiComplete:(i,a)=>{t(e=>e.map(e=>e.id===i?o(l({},e),{pdiCompleted:!0,pdiStatus:"completed",pdiTechnician:a.technician,pdiNotes:a.notes,pdiDate:(new Date).toISOString(),lastModified:(new Date).toISOString()}):e));const r=e.map(e=>e.id===i?o(l({},e),{pdiCompleted:!0,pdiStatus:"completed",pdiTechnician:a.technician,pdiNotes:a.notes,pdiDate:(new Date).toISOString(),lastModified:(new Date).toISOString()}):e);localStorage.setItem("garageCars",JSON.stringify(r)),x({title:"PDI Completed",description:"Pre-delivery inspection has been completed successfully"})}}),he&&m.jsx(fe,{isOpen:y,onClose:()=>j(!1),car:he,onStartTestDrive:Ue,onEndTestDrive:_e}),we&&m.jsx(ae,{isOpen:S,onClose:()=>{w(!1),De(null)},car:{id:we.id,model:we.model,vinNumber:we.vinNumber,brand:we.brand,year:we.year,color:we.color,status:we.status,clientName:we.clientName,clientPhone:we.clientPhone,clientLicensePlate:we.clientLicensePlate,sellingPrice:we.price,reservationDate:void 0,saleDate:void 0,notes:we.notes},onStatusUpdate:(i,a,r)=>{t(e=>e.map(e=>e.id===i?o(l({},e),{status:a,clientName:(null==r?void 0:r.name)||e.clientName,clientPhone:(null==r?void 0:r.phone)||e.clientPhone,clientLicensePlate:(null==r?void 0:r.licensePlate)||e.clientLicensePlate,lastModified:(new Date).toISOString()}):e));const s=e.map(e=>e.id===i?o(l({},e),{status:a,clientName:(null==r?void 0:r.name)||e.clientName,clientPhone:(null==r?void 0:r.phone)||e.clientPhone,clientLicensePlate:(null==r?void 0:r.licensePlate)||e.clientLicensePlate,lastModified:(new Date).toISOString()}):e);localStorage.setItem("garageCars",JSON.stringify(s)),x({title:"Status Updated",description:`Car status has been updated to ${Re(a)}`})}}),ie&&m.jsx(re,{isOpen:C,onClose:()=>{T(!1),de(null)},car:{id:ie.id,vinNumber:ie.vinNumber,model:ie.model,brand:ie.brand,year:ie.year,color:ie.color,status:ie.status,sellingPrice:ie.price,arrivalDate:ie.arrivalDate,currentFloor:ie.currentFloor,customs:ie.customs,notes:ie.notes,clientName:ie.clientName,clientPhone:ie.clientPhone,clientLicensePlate:ie.clientLicensePlate,pdiCompleted:ie.pdiCompleted,pdiDate:ie.pdiDate,pdiTechnician:ie.pdiTechnician,pdiNotes:ie.pdiNotes,batteryPercentage:ie.batteryPercentage,range:ie.range,testDriveInfo:ie.testDriveInfo,lastUpdated:ie.lastModified},onCarUpdate:(i,a)=>{t(e=>e.map(e=>e.id===i?o(l(l({},e),a),{lastModified:(new Date).toISOString()}):e));const r=e.map(e=>e.id===i?o(l(l({},e),a),{lastModified:(new Date).toISOString()}):e);localStorage.setItem("garageCars",JSON.stringify(r)),x({title:"Car Updated",description:"Car information has been updated successfully"})}}),ge&&m.jsx(se,{isOpen:I,onClose:()=>{z(!1),ve(null)},car:{vinNumber:ge.vinNumber,model:ge.model,currentVersion:ge.softwareVersion,lastUpdated:ge.softwareLastUpdated,lastUpdatedBy:ge.softwareUpdateBy,notes:ge.softwareUpdateNotes,needsUpdate:!ge.softwareVersion,priority:ge.softwareVersion?"medium":"critical"},onUpdateComplete:(i,a)=>{var r;const s=null==(r=e.find(e=>e.vinNumber===i))?void 0:r.id;s&&((i,a)=>{t(e=>e.map(e=>e.id===i?o(l(l({},e),a),{lastModified:(new Date).toISOString()}):e));const r=e.map(e=>e.id===i?o(l(l({},e),a),{lastModified:(new Date).toISOString()}):e);Ne(r),x({title:"Software Updated",description:"Software information has been updated successfully"})})(s,a)}}),be&&m.jsx(ne,{open:Q,onOpenChange:te,car:be,onCustomsUpdate:(i,a)=>{t(e=>e.map(e=>e.id===i?o(l(l({},e),a),{lastModified:(new Date).toISOString()}):e));const r=e.map(e=>e.id===i?o(l(l({},e),a),{lastModified:(new Date).toISOString()}):e);Ne(r),x({title:"Customs Updated",description:"Customs information has been updated successfully"})}}),Ce&&Me&&m.jsx(ye,{isOpen:Ce,onClose:()=>{Te(!1),Ie(null)},car:{id:Me.id,model:Me.model,vinNumber:Me.vinNumber,color:Me.color},onMoveCar:(i,a)=>{if(!Me)return;t(e=>e.filter(e=>e.id!==Me.id));const r=e.filter(e=>e.id!==Me.id);localStorage.setItem("garageCars",JSON.stringify(r)),x({title:"Car Moved Successfully",description:`${Me.model} has been moved to ${i}.`}),Te(!1),Ie(null)}}),m.jsx(Y,{isOpen:ke,onClose:()=>{Oe(!1),Ae(null)},car:Pe})]})};export{be as default};
