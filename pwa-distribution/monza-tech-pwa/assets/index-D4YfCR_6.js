import{R as oe,r as d,j as e,L as G,b0 as K,I as Z,a as D,b as m,f as h,e as S,B as g,ai as xe,ad as q,p as Y,a4 as ee,aG as R,bS as B,am as H,a1 as T,c as L,d as I,C as se,an as ae,U as M,ar as me,az as he,b3 as je,D as te,q as le,v as re,w as ce,Y as ie,Z as ne,_ as P,aA as W,bT as J}from"./index-BKWZsjPE.js";import{W as k,E}from"./enhancedRepairHistoryManager-D4BsNGqK.js";import{F as X}from"./filter-DmRTMl58.js";import{I as Q}from"./image-YAthtqDG.js";import{S as V}from"./star-BtW1jevB.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=oe("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),pe=({carVin:o,showAll:v=!1})=>{const[i,y]=d.useState([]),[j,c]=d.useState(""),[b,w]=d.useState([]),[p,O]=d.useState(null);d.useEffect(()=>{C()},[o]),d.useEffect(()=>{if(j.trim()){const a=i.filter(n=>n.carModel.toLowerCase().includes(j.toLowerCase())||n.workTypeChange.toLowerCase().includes(j.toLowerCase())||n.changedBy.toLowerCase().includes(j.toLowerCase()));w(a)}else w(i)},[j,i]);const C=()=>{let a;o?a=k.getCarWorkTypeHistory(o):v?a=k.getWorkTypeHistory():a=k.getRecentWorkTypeChanges(10),y(a),w(a);const n=k.getWorkTypeAnalytics();O(n)},$=a=>new Date(a).toLocaleString(),A=a=>{switch(a){case"in_diagnosis":return"bg-blue-100 text-blue-800";case"in_repair":return"bg-orange-100 text-orange-800";case"in_quality_check":return"bg-purple-100 text-purple-800";case"ready":return"bg-green-100 text-green-800";case"delivered":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Work Type History"}),e.jsx("p",{className:"text-gray-600",children:o?`Showing work type changes for car ${o}`:"Recent work type transitions"})]}),p&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p.totalTransitions}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Transitions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.uniqueCars}),e.jsx("div",{className:"text-sm text-gray-600",children:"Unique Cars"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(G,{htmlFor:"search",children:"Search Work Type History"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Z,{id:"search",placeholder:"Search by car model, work type, or employee...",value:j,onChange:a=>c(a.target.value),className:"pl-10"})]})]}),e.jsxs(D,{onClick:C,variant:"outline",className:"self-end",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsx("div",{className:"space-y-4",children:b.length===0?e.jsx(m,{children:e.jsxs(h,{className:"p-6 text-center",children:[e.jsx(S,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No work type history found"})]})}):b.map(a=>{var n,x;return e.jsx(m,{className:"hover:shadow-md transition-shadow",children:e.jsx(h,{className:"p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.carModel}),a.carVin&&e.jsx(g,{variant:"outline",className:"text-xs",children:a.carVin})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(g,{className:A(a.fromWorkType),children:a.fromWorkType.replace("_"," ").toUpperCase()}),e.jsx(xe,{className:"h-4 w-4 text-gray-400"}),e.jsx(g,{className:A(a.toWorkType),children:a.toWorkType.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{children:a.changedBy})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),e.jsx("span",{children:$(a.timestamp)})]}),a.duration&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),e.jsx("span",{children:a.duration})]})]}),a.partsUsed&&a.partsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Parts Used"}),e.jsxs(g,{variant:"outline",className:"text-xs",children:[a.partsUsed.length," parts"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:a.partsUsed.map((_,r)=>e.jsx(g,{variant:"secondary",className:"text-xs",children:_},r))}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(B,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-700",children:["Total Parts Cost: $",((n=a.totalPartsCost)==null?void 0:n.toLocaleString())||"0"]})]})]}),a.toolsUsed&&a.toolsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Tools Used"}),e.jsxs(g,{variant:"outline",className:"text-xs",children:[a.toolsUsed.length," tools"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:a.toolsUsed.map((_,r)=>e.jsx(g,{variant:"secondary",className:"text-xs",children:_},r))}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(B,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-700",children:["Total Tools Cost: $",((x=a.totalToolsCost)==null?void 0:x.toLocaleString())||"0"]})]})]}),a.workNotes&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(T,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Work Notes:"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:a.workNotes})]}),a.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:a.notes})]})})})},a.id)})}),p&&p.transitionCounts&&Object.keys(p.transitionCounts).length>0&&e.jsxs(m,{children:[e.jsx(L,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Work Type Transition Analytics"]})}),e.jsx(h,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(p.transitionCounts).sort(([,a],[,n])=>n-a).slice(0,6).map(([a,n])=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:a}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:n})]},a))})})]}),i.length>0&&e.jsxs(m,{children:[e.jsx(L,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Parts & Tools Usage Analytics"]})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Total Parts"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:i.reduce((a,n)=>{var x;return a+(((x=n.partsUsed)==null?void 0:x.length)||0)},0)}),e.jsx("div",{className:"text-sm text-blue-600",children:"parts used"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Parts Cost"})]}),e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:["$",i.reduce((a,n)=>a+(n.totalPartsCost||0),0).toLocaleString()]}),e.jsx("div",{className:"text-sm text-green-600",children:"total parts cost"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Total Tools"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:i.reduce((a,n)=>{var x;return a+(((x=n.toolsUsed)==null?void 0:x.length)||0)},0)}),e.jsx("div",{className:"text-sm text-orange-600",children:"tools used"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Tools Cost"})]}),e.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:["$",i.reduce((a,n)=>a+(n.totalToolsCost||0),0).toLocaleString()]}),e.jsx("div",{className:"text-sm text-purple-600",children:"total tools cost"})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{className:"h-5 w-5 text-indigo-600"}),e.jsx("span",{className:"font-medium text-indigo-800",children:"Avg Parts"})]}),e.jsx("div",{className:"text-2xl font-bold text-indigo-900",children:i.length>0?Math.round(i.reduce((a,n)=>{var x;return a+(((x=n.partsUsed)==null?void 0:x.length)||0)},0)/i.length):0}),e.jsx("div",{className:"text-sm text-indigo-600",children:"parts per transition"})]}),e.jsxs("div",{className:"bg-teal-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"h-5 w-5 text-teal-600"}),e.jsx("span",{className:"font-medium text-teal-800",children:"Avg Tools"})]}),e.jsx("div",{className:"text-2xl font-bold text-teal-900",children:i.length>0?Math.round(i.reduce((a,n)=>{var x;return a+(((x=n.toolsUsed)==null?void 0:x.length)||0)},0)/i.length):0}),e.jsx("div",{className:"text-sm text-teal-600",children:"tools per transition"})]})]})})]})]})},Ne=({carVin:o,showAll:v=!1})=>{const[i,y]=d.useState([]),[j,c]=d.useState(""),[b,w]=d.useState([]),[p,O]=d.useState(null);d.useEffect(()=>{C()},[o]),d.useEffect(()=>{if(j.trim()){const r=$(i).filter(N=>N.label.toLowerCase().includes(j.toLowerCase())||N.entries.some(t=>t.carModel.toLowerCase().includes(j.toLowerCase())||t.changedBy.toLowerCase().includes(j.toLowerCase())));w(r)}else w($(i))},[j,i]);const C=()=>{let r;o?r=k.getCarWorkTypeHistory(o):v?r=k.getWorkTypeHistory():r=k.getRecentWorkTypeChanges(20),y(r),w($(r));const N=k.getWorkTypeAnalytics();O(N)},$=r=>{const N={};return r.forEach(t=>{var l,f;const u=t.fromWorkType;N[u]||(N[u]={workType:u,label:A(u),color:a(u),icon:n(u),entries:[],totalPartsCost:0,totalToolsCost:0,totalParts:0,totalTools:0,duration:"",notes:[],mechanics:[]});const s=N[u];s.entries.push(t),s.totalPartsCost+=t.totalPartsCost||0,s.totalToolsCost+=t.totalToolsCost||0,s.totalParts+=((l=t.partsUsed)==null?void 0:l.length)||0,s.totalTools+=((f=t.toolsUsed)==null?void 0:f.length)||0,t.notes&&s.notes.push(t.notes),t.mechanics&&s.mechanics.push(...t.mechanics)}),Object.values(N).sort((t,u)=>x(t.workType)-x(u.workType))},A=r=>{switch(r){case"in_diagnosis":return"Diagnosis Stage";case"in_repair":return"Repair Stage";case"in_quality_check":return"Quality Check Stage";case"ready":return"Ready Stage";case"delivered":return"Delivery Stage";default:return r.replace("_"," ").toUpperCase()}},a=r=>{switch(r){case"in_diagnosis":return"bg-blue-100 text-blue-800 border-blue-200";case"in_repair":return"bg-orange-100 text-orange-800 border-orange-200";case"in_quality_check":return"bg-purple-100 text-purple-800 border-purple-200";case"ready":return"bg-green-100 text-green-800 border-green-200";case"delivered":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},n=r=>{switch(r){case"in_diagnosis":return ae;case"in_repair":return T;case"in_quality_check":return se;case"ready":return ge;case"delivered":return se;default:return H}},x=r=>{switch(r){case"in_diagnosis":return 1;case"in_repair":return 2;case"in_quality_check":return 3;case"ready":return 4;case"delivered":return 5;default:return 999}},_=r=>new Date(r).toLocaleString();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Work Type Based Repair History"}),e.jsx("p",{className:"text-gray-600",children:o?`Complete repair history for car ${o} organized by work types`:"Repair history organized by work type stages"})]}),p&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p.totalTransitions}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Transitions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.uniqueCars}),e.jsx("div",{className:"text-sm text-gray-600",children:"Unique Cars"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(G,{htmlFor:"search",children:"Search Work Type History"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Z,{id:"search",placeholder:"Search by work type, car model, or employee...",value:j,onChange:r=>c(r.target.value),className:"pl-10"})]})]}),e.jsxs(D,{onClick:C,variant:"outline",className:"self-end",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsx("div",{className:"space-y-6",children:b.length===0?e.jsx(m,{children:e.jsxs(h,{className:"p-6 text-center",children:[e.jsx(S,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No work type history found"})]})}):b.map(r=>{const N=r.icon;return e.jsxs(m,{className:"border-2",children:[e.jsx(L,{className:`${r.color} border-b`,children:e.jsxs(I,{className:"flex items-center gap-3",children:[e.jsx(N,{className:"h-6 w-6"}),e.jsx("span",{children:r.label}),e.jsxs(g,{variant:"outline",className:"ml-auto",children:[r.entries.length," entries"]})]})}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Parts Used"})]}),e.jsx("div",{className:"text-xl font-bold text-blue-900",children:r.totalParts}),e.jsxs("div",{className:"text-sm text-blue-600",children:["Total Cost: $",r.totalPartsCost.toLocaleString()]})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Tools Used"})]}),e.jsx("div",{className:"text-xl font-bold text-orange-900",children:r.totalTools}),e.jsxs("div",{className:"text-sm text-orange-600",children:["Total Cost: $",r.totalToolsCost.toLocaleString()]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Mechanics"})]}),e.jsx("div",{className:"text-xl font-bold text-green-900",children:new Set(r.mechanics).size}),e.jsx("div",{className:"text-sm text-green-600",children:"Unique mechanics"})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Notes"})]}),e.jsx("div",{className:"text-xl font-bold text-purple-900",children:r.notes.length}),e.jsx("div",{className:"text-sm text-purple-600",children:"Total notes"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Detailed Entries"}),r.entries.map(t=>{var u,s;return e.jsx(m,{className:"border border-gray-200",children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:t.carModel}),t.carVin&&e.jsx(g,{variant:"outline",className:"text-xs",children:t.carVin})]}),e.jsx("div",{className:"text-sm text-gray-500",children:_(t.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{children:t.changedBy})]}),t.duration&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),e.jsx("span",{children:t.duration})]})]}),t.partsUsed&&t.partsUsed.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Parts Used"}),e.jsxs(g,{variant:"outline",className:"text-xs",children:[t.partsUsed.length," parts"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:t.partsUsed.map((l,f)=>e.jsx(g,{variant:"secondary",className:"text-xs",children:l},f))}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(B,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-700",children:["Cost: $",((u=t.totalPartsCost)==null?void 0:u.toLocaleString())||"0"]})]})]}),t.toolsUsed&&t.toolsUsed.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Tools Used"}),e.jsxs(g,{variant:"outline",className:"text-xs",children:[t.toolsUsed.length," tools"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:t.toolsUsed.map((l,f)=>e.jsx(g,{variant:"secondary",className:"text-xs",children:l},f))}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(B,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-700",children:["Cost: $",((s=t.totalToolsCost)==null?void 0:s.toLocaleString())||"0"]})]})]}),t.workNotes&&e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(M,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-800",children:"Work Notes"})]}),e.jsx("p",{className:"text-sm text-gray-700",children:t.workNotes})]}),t.issueDescription&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"font-medium text-red-800",children:"Issue Description"})]}),e.jsx("p",{className:"text-sm text-red-700",children:t.issueDescription})]}),t.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:t.notes})]})},t.id)})]})]})]},r.workType)})})]})},ue=({searchQuery:o="",carVin:v,showAll:i=!0})=>{const[y,j]=d.useState([]),[c,b]=d.useState(null),[w,p]=d.useState(!1),[O,C]=d.useState(!1),[$,A]=d.useState([]),[a,n]=d.useState("");d.useEffect(()=>{x()},[o,v]);const x=()=>{let s=E.getRepairHistory();v&&!i&&(s=s.filter(l=>l.car_vin.toLowerCase().includes(v.toLowerCase()))),o&&(s=E.searchRepairHistory(o)),s.sort((l,f)=>new Date(f.completion_date||f.created_at).getTime()-new Date(l.completion_date||l.created_at).getTime()),j(s)},_=s=>{const l={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-orange-100 text-orange-800",expert:"bg-red-100 text-red-800"};return l[s]||l.medium},r=s=>({mechanical:e.jsx(T,{className:"h-4 w-4"}),electrical:e.jsx(V,{className:"h-4 w-4"}),body_work:e.jsx(S,{className:"h-4 w-4"}),painter:e.jsx(V,{className:"h-4 w-4"}),detailer:e.jsx(V,{className:"h-4 w-4"})})[s]||e.jsx(T,{className:"h-4 w-4"}),N=s=>e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(l=>e.jsx(V,{className:`h-4 w-4 ${l<=s?"text-yellow-400 fill-current":"text-gray-300"}`},l)),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",s,"/5)"]})]}),t=(s,l)=>{A(s),n(l),C(!0)},u=s=>{const l=`
MONZA TECH - REPAIR COMPLETION REPORT
=====================================

Car Information:
- VIN: ${s.car_vin}
- Model: ${s.car_model}
- Customer: ${s.client_name}

Repair Details:
- Issue: ${s.issue_description}
- Solution: ${s.solution_description}
- Work Type: ${s.work_type||"N/A"}
- Mechanic: ${s.technician_name}
- Date: ${s.repair_date}
- Completion: ${s.completion_date||"N/A"}

Repair Steps:
${s.repair_steps.map((U,de)=>`${de+1}. ${U}`).join(`
`)}

Parts Used:
${s.parts_used.map(U=>`- ${U.part_name} (${U.quantity}x) - $${U.cost}`).join(`
`)}

Tools Used:
${s.tools_used.map(U=>`- ${U}`).join(`
`)}

Performance:
- Labor Hours: ${s.labor_hours||0}
- Total Cost: $${s.total_cost||0}
- Difficulty: ${s.difficulty_level}
- Quality Rating: ${s.quality_rating}/5
- Client Satisfaction: ${s.client_satisfaction}/5
- Warranty: ${s.warranty_period} months

Mechanic Notes:
${s.mechanic_notes||"No additional notes"}

Recommendations:
${s.recommendation||"No specific recommendations"}

Generated on: ${new Date().toLocaleString()}
    `,f=new Blob([l],{type:"text/plain"}),F=URL.createObjectURL(f),z=document.createElement("a");z.href=F,z.download=`repair_report_${s.car_vin}_${s.repair_date}.txt`,document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(F)};return y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Enhanced Repair History"}),e.jsx("p",{className:"text-gray-600",children:o||v?"No repair records match your search criteria":"Enhanced repair history will appear here when repairs are completed through the new system"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(m,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Total Repairs"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:E.getRepairStatistics().totalRepairs})]})}),e.jsx(m,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Parts Used"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:E.getRepairStatistics().totalParts})]})}),e.jsx(m,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Mechanics"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:E.getRepairStatistics().totalMechanics})]})}),e.jsx(m,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Cars Serviced"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:E.getRepairStatistics().totalCars})]})})]}),e.jsx("div",{className:"space-y-4",children:y.map(s=>{var l,f,F;return e.jsxs(m,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:r(s.work_type||"mechanical")}),e.jsxs("div",{children:[e.jsxs(I,{className:"text-lg",children:[s.car_model," (",s.car_vin,")"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-4 w-4"}),s.client_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),new Date(s.repair_date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4"}),s.technician_name]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{className:_(s.difficulty_level||"medium"),children:(l=s.difficulty_level)==null?void 0:l.toUpperCase()}),e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>{b(s),p(!0)},children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"View Details"]})]})]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Issue Description"}),e.jsx("p",{className:"text-sm text-gray-600 bg-red-50 p-3 rounded-lg border-l-4 border-red-200",children:s.issue_description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Solution"}),e.jsx("p",{className:"text-sm text-gray-600 bg-green-50 p-3 rounded-lg border-l-4 border-green-200",children:s.solution_description})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Quality Rating"}),N(s.quality_rating||0)]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Client Satisfaction"}),N(s.client_satisfaction||0)]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Performance"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Labor Hours:"}),e.jsxs("span",{className:"font-medium",children:[s.labor_hours||0,"h"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Cost:"}),e.jsxs("span",{className:"font-medium",children:["$",s.total_cost||0]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Warranty:"}),e.jsxs("span",{className:"font-medium",children:[s.warranty_period||0," months"]})]})]})]})]}),(((f=s.before_photos)==null?void 0:f.length)||((F=s.after_photos)==null?void 0:F.length))&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Photo Documentation"}),e.jsxs("div",{className:"flex gap-4",children:[s.before_photos&&s.before_photos.length>0&&e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>t(s.before_photos,"Before Photos"),className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Before Photos (",s.before_photos.length,")"]}),s.after_photos&&s.after_photos.length>0&&e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>t(s.after_photos,"After Photos"),className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"After Photos (",s.after_photos.length,")"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-4 w-4"}),s.parts_used.length," parts used"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4"}),s.tools_used.length," tools used"]}),s.follow_up_required&&e.jsx(g,{variant:"outline",className:"bg-yellow-50 text-yellow-700",children:"Follow-up Required"})]}),e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>u(s),children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"Download Report"]})]})]})]},s.id)})}),c&&e.jsx(te,{open:w,onOpenChange:p,children:e.jsxs(le,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(re,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Repair Details - ",c.car_model," (",c.car_vin,")"]})}),e.jsxs(ie,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(ne,{className:"grid w-full grid-cols-4",children:[e.jsx(P,{value:"overview",children:"Overview"}),e.jsx(P,{value:"parts-tools",children:"Parts & Tools"}),e.jsx(P,{value:"notes",children:"Notes & Steps"}),e.jsx(P,{value:"photos",children:"Photos"})]}),e.jsx(W,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Customer Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsx("span",{children:c.client_name})]}),c.client_phone&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{children:c.client_phone})]}),c.client_email&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{children:c.client_email})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Repair Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Repair Date:"}),e.jsx("span",{children:new Date(c.repair_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Completion:"}),e.jsx("span",{children:c.completion_date?new Date(c.completion_date).toLocaleDateString():"In Progress"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Work Type:"}),e.jsx(g,{variant:"outline",children:c.work_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Difficulty:"}),e.jsx(g,{className:_(c.difficulty_level||"medium"),children:c.difficulty_level})]})]})]})]})}),e.jsx(W,{value:"parts-tools",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Parts Used"}),e.jsx("div",{className:"space-y-2",children:c.parts_used.map((s,l)=>e.jsx("div",{className:"p-3 border rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.part_name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["#",s.part_number]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Supplier: ",s.supplier]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["Qty: ",s.quantity]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["$",s.cost]})]})]})},l))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Tools Used"}),e.jsx("div",{className:"space-y-2",children:c.tools_used.map((s,l)=>e.jsxs("div",{className:"p-2 border rounded-lg flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{children:s})]},l))})]})]})}),e.jsx(W,{value:"notes",className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Repair Steps"}),e.jsx("div",{className:"space-y-2",children:c.repair_steps.map((s,l)=>e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:l+1}),e.jsx("span",{children:s})]},l))})]}),c.mechanic_notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Mechanic Notes"}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border-l-4 border-blue-200",children:c.mechanic_notes})]}),c.recommendation&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Recommendations"}),e.jsx("div",{className:"p-4 bg-green-50 rounded-lg border-l-4 border-green-200",children:c.recommendation})]})]})}),e.jsx(W,{value:"photos",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Before Photos"}),c.before_photos&&c.before_photos.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-2",children:c.before_photos.map((s,l)=>e.jsx("img",{src:s,alt:`Before ${l+1}`,className:"w-full h-32 object-cover rounded-lg border cursor-pointer hover:opacity-75",onClick:()=>t([s],`Before Photo ${l+1}`)},l))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),"No before photos"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"After Photos"}),c.after_photos&&c.after_photos.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-2",children:c.after_photos.map((s,l)=>e.jsx("img",{src:s,alt:`After ${l+1}`,className:"w-full h-32 object-cover rounded-lg border cursor-pointer hover:opacity-75",onClick:()=>t([s],`After Photo ${l+1}`)},l))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),"No after photos"]})]})]})})]})]})}),e.jsx(te,{open:O,onOpenChange:C,children:e.jsxs(le,{className:"max-w-3xl",children:[e.jsx(re,{children:e.jsx(ce,{children:a})}),e.jsx("div",{className:"grid grid-cols-1 gap-4 max-h-96 overflow-y-auto",children:$.map((s,l)=>e.jsx("img",{src:s,alt:`${a} ${l+1}`,className:"w-full max-h-80 object-contain rounded-lg border"},l))})]})})]})},Ce=()=>{const[o,v]=d.useState(""),[i,y]=d.useState(""),[j,c]=d.useState("work-type-based");return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Repair History"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive repair history with work type tracking, parts, and tools"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:e.jsx(J,{className:"h-8 w-8 mx-auto mb-2"})}),e.jsx("div",{className:"text-sm text-gray-600",children:"Complete History"})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(G,{htmlFor:"search",children:"Search Repair History"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Z,{id:"search",placeholder:"Search by car VIN, model, or employee...",value:o,onChange:b=>v(b.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"w-64",children:[e.jsx(G,{htmlFor:"carVin",children:"Filter by Car VIN"}),e.jsx(Z,{id:"carVin",placeholder:"Enter car VIN...",value:i,onChange:b=>y(b.target.value)})]}),e.jsxs(D,{variant:"outline",className:"self-end",onClick:()=>{v(""),y("")},children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Clear Filters"]})]}),e.jsxs(ie,{value:j,onValueChange:c,className:"w-full",children:[e.jsxs(ne,{className:"grid w-full grid-cols-3",children:[e.jsxs(P,{value:"enhanced",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Enhanced History"]}),e.jsxs(P,{value:"work-type-based",className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Work Type Based"]}),e.jsxs(P,{value:"chronological",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Chronological"]})]}),e.jsx(W,{value:"enhanced",className:"mt-6",children:e.jsxs(m,{children:[e.jsx(L,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Enhanced Repair History with Photos & Details"]})}),e.jsx(h,{children:e.jsx(ue,{searchQuery:o,carVin:i||void 0,showAll:!i})})]})}),e.jsx(W,{value:"work-type-based",className:"mt-6",children:e.jsxs(m,{children:[e.jsx(L,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Work Type Based Repair History"]})}),e.jsx(h,{children:e.jsx(Ne,{carVin:i||void 0,showAll:!i})})]})}),e.jsx(W,{value:"chronological",className:"mt-6",children:e.jsxs(m,{children:[e.jsx(L,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Chronological Repair History"]})}),e.jsx(h,{children:e.jsx(pe,{carVin:i||void 0,showAll:!i})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(m,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Total Cars"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:"-"}),e.jsx("div",{className:"text-sm text-blue-600",children:"in repair history"})]})}),e.jsx(m,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Total Parts"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:"-"}),e.jsx("div",{className:"text-sm text-green-600",children:"used across all repairs"})]})}),e.jsx(m,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Total Tools"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:"-"}),e.jsx("div",{className:"text-sm text-orange-600",children:"used across all repairs"})]})}),e.jsx(m,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Total Mechanics"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:"-"}),e.jsx("div",{className:"text-sm text-purple-600",children:"involved in repairs"})]})})]})]})};export{Ce as default};
