const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/enhancedRepairHistoryService-DIHM_Im-.js","assets/index-BUhc98AO.js","assets/index-B1YvrHua.css"])))=>i.map(i=>d[i]);
var Vt=Object.defineProperty;var Ht=(k,r,a)=>r in k?Vt(k,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):k[r]=a;var Ks=(k,r,a)=>Ht(k,typeof r!="symbol"?r+"":r,a);import{R as Ss,r as u,ao as qt,bU as Js,s as B,ay as Lt,bM as xt,t as x,j as e,D as ee,q as se,v as te,w as re,Q as ws,a2 as ne,b as Fe,c as Ue,d as Ae,au as Zs,f as $e,L as S,B as H,M as Xs,a as l,e as ns,Y as Bt,Z as zt,_ as et,ab as de,U as Wt,aA as st,X as Te,az as pt,aK as bs,I as G,ac as ae,bW as Gt,aa as Oe,bX as gt,bN as Cs,bY as Dt,ar as Qt,ad as ft,a0 as Je,C as vt,aH as Yt,$ as Kt,aN as Jt,p as js,g as Zt,h as Xt,i as tt,k as le,l as er,m as ce,aw as sr,ah as rt,aE as os,aq as at,bZ as tr,b_ as ot,z as rr,aF as nt,a1 as it,aj as ar,ak as or,b$ as lt}from"./index-BUhc98AO.js";import{a as nr}from"./addDays-BdqDb4eD.js";import{L as ct}from"./loader-2-B7v8GkH5.js";import{i as ir}from"./inventoryService-DVpHZoL-.js";import{W as lr,E as cr}from"./enhancedRepairHistoryManager-D4BsNGqK.js";import{S as dt}from"./star-Dr40v_NV.js";import{S as dr}from"./send-yPai3UG1.js";import{E as mt}from"./EnhancedSelect-CrO-rBPH.js";import{S as ut}from"./stop-circle-BSXNUSsy.js";import{S as Ns}from"./scan-DwHfEbAm.js";import{S as mr,H as ur}from"./sparkles-CT6Yii68.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=Ss("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=Ss("FileImage",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["circle",{cx:"10",cy:"13",r:"2",key:"6v46hv"}],["path",{d:"m20 17-1.09-1.09a2 2 0 0 0-2.82 0L10 22",key:"17vly1"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=Ss("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),xr=()=>[{id:"1",carCode:"MONZA-001",carModel:"Voyah Free 2024",customerName:"Ahmed Al Mansouri",priority:"high",estimatedDuration:"4",workType:"electrical",assignedMechanic:"Mohammed Hassan",notes:"Battery system check and software update required",status:"in_progress",testDriveStatus:"not_available"},{id:"2",carCode:"MONZA-002",carModel:"Voyah Dreamer 2024",customerName:"Sarah Johnson",priority:"medium",estimatedDuration:"2",workType:"detailer",assignedMechanic:"Ali Ahmed",notes:"Interior cleaning and exterior detailing",status:"scheduled",testDriveStatus:"available"},{id:"3",carCode:"MONZA-003",carModel:"Voyah Free 2023",customerName:"David Chen",priority:"high",estimatedDuration:"6",workType:"mechanic",assignedMechanic:"Omar Khalil",notes:"Engine diagnostic and brake system repair",status:"pending",testDriveStatus:"not_available"},{id:"4",carCode:"MONZA-004",carModel:"Voyah Dreamer 2024",customerName:"Fatima Al Zahra",priority:"low",estimatedDuration:"1.5",workType:"painter",assignedMechanic:"Hassan Ali",notes:"Minor paint touch-up on front bumper",status:"completed",testDriveStatus:"available"},{id:"5",carCode:"MONZA-005",carModel:"Voyah Free 2024",customerName:"Michael Rodriguez",priority:"medium",estimatedDuration:"3",workType:"body_work",assignedMechanic:"Youssef Mahmoud",notes:"Door panel replacement and alignment",status:"scheduled",testDriveStatus:"not_available"},{id:"6",carCode:"MONZA-006",carModel:"Voyah Dreamer 2023",customerName:"Aisha Al Qasimi",priority:"high",estimatedDuration:"5",workType:"electrical",assignedMechanic:"Khalid Omar",notes:"Complete electrical system overhaul",status:"delayed",testDriveStatus:"not_available"},{id:"7",carCode:"MONZA-007",carModel:"Voyah Free 2024",customerName:"Robert Wilson",priority:"low",estimatedDuration:"2",workType:"detailer",assignedMechanic:"Ahmed Hassan",notes:"Full interior and exterior detailing",status:"scheduled",testDriveStatus:"available"}],pr=()=>{const[k,r]=u.useState([]),[a,i]=u.useState(null),[n,d]=u.useState(null);qt();const y=Js(new Date,"yyyy-MM-dd"),v=Js(nr(new Date,1),"yyyy-MM-dd");u.useEffect(()=>{localStorage.removeItem("garageSchedules"),localStorage.removeItem("garageSchedule"),console.log("Garage Schedule: Forcing mock data creation");const T={id:"mock-today",date:y,startTime:"09:00",endTime:"17:00",available:!0,notes:"Regular garage operations",maxCarsCapacity:7,currentCarsScheduled:7,scheduledCars:xr()},j={id:"mock-tomorrow",date:v,startTime:"09:00",endTime:"17:00",available:!0,notes:"Scheduled maintenance day",maxCarsCapacity:5,currentCarsScheduled:0,scheduledCars:[]},U=[T,j];r(U),i(T),d(j),localStorage.setItem("garageSchedule",JSON.stringify(U)),console.log("Garage Schedule: Created mock data with 7 scheduled cars"),console.log("Mock today schedule:",T),console.log("Mock scheduled cars:",T.scheduledCars)},[y,v]);const m=T=>{localStorage.setItem("garageSchedule",JSON.stringify(T)),r(T);const j=T.find(F=>F.date===y),U=T.find(F=>F.date===v);i(j||null),d(U||null)};return{schedules:k,todaySchedule:a,tomorrowSchedule:n,today:y,tomorrow:v,saveSchedules:m,createSchedule:(T,j)=>{if(j){const U=k.map(F=>F.id===j.id?{...j,...T,maxCarsCapacity:T.maxCarsCapacity,scheduledCars:j.scheduledCars||[]}:F);m(U)}else{const U={id:Date.now().toString(),...T,maxCarsCapacity:T.maxCarsCapacity,currentCarsScheduled:0,scheduledCars:[]};m([...k,U])}},deleteSchedule:T=>{const j=k.filter(U=>U.id!==T);m(j)},createDefaultSchedule:T=>{const j={id:Date.now().toString(),date:T,startTime:"09:00",endTime:"17:00",available:!0,notes:"",maxCarsCapacity:7,currentCarsScheduled:0,scheduledCars:[]};m([...k,j])}}};class ke{static async findCarByVIN(r){try{const{data:a,error:i}=await B.from("showroom_floor1_inventory").select("*").eq("vinNumber",r).single();if(a&&!i)return{...a,currentFloor:"floor1"};const{data:n,error:d}=await B.from("showroom_floor2_inventory").select("*").eq("vinNumber",r).single();if(n&&!d)return{...n,currentFloor:"floor2"};const{data:y,error:v}=await B.from("garage_inventory").select("*").eq("vinNumber",r).single();return y&&!v?{...y,currentFloor:"garage"}:null}catch(a){return console.error("Error finding car by VIN:",a),null}}static async updateCarStatus(r,a){try{const i=[],{error:n}=await B.from("showroom_floor1_inventory").update({status:a}).eq("vinNumber",r);n||i.push("Floor 1");const{error:d}=await B.from("showroom_floor2_inventory").update({status:a}).eq("vinNumber",r);d||i.push("Floor 2");const{error:y}=await B.from("garage_inventory").update({status:a}).eq("vinNumber",r);return y||i.push("Garage"),console.log(`Updated car status to "${a}" in: ${i.join(", ")}`),i.length>0}catch(i){return console.error("Error updating car status:",i),!1}}static async addCarToSchedule(r){try{const a={id:`schedule_${Date.now()}`,carCode:r.vinNumber,carModel:r.carModel,customerName:r.customerName||"Customer TBD",priority:r.priority||"medium",estimatedDuration:r.estimatedDuration||"2",workType:r.workType||"mechanic",assignedMechanic:r.assignedMechanic||"Mechanic TBD",notes:r.notes||"Car added via VIN scan",status:"scheduled",testDriveStatus:"not_available",vinNumber:r.vinNumber,brand:r.brand,year:r.year,color:r.color,category:r.category,batteryPercentage:r.batteryPercentage,range:r.range,sellingPrice:r.sellingPrice,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:i}=await B.from("garage_schedule").insert([a]);return i?(console.error("Error adding car to schedule:",i),!1):!0}catch(a){return console.error("Error adding car to schedule:",a),!1}}static async getAllCars(){try{const r=[],{data:a,error:i}=await B.from("showroom_floor1_inventory").select("*");a&&!i&&r.push(...a.map(m=>({...m,currentFloor:"floor1"})));const{data:n,error:d}=await B.from("showroom_floor2_inventory").select("*");n&&!d&&r.push(...n.map(m=>({...m,currentFloor:"floor2"})));const{data:y,error:v}=await B.from("garage_inventory").select("*");return y&&!v&&r.push(...y.map(m=>({...m,currentFloor:"garage"}))),r}catch(r){return console.error("Error getting all cars:",r),[]}}static async moveCarToDestination(r,a){try{const i=await this.findCarByVIN(r);if(!i)return console.error(`Car with VIN ${r} not found in any inventory`),!1;const n=i.currentFloor;if(n==="floor1"){const{error:v}=await B.from("showroom_floor1_inventory").delete().eq("vinNumber",r);if(v)return console.error("Error removing car from Floor 1:",v),!1}else if(n==="floor2"){const{error:v}=await B.from("showroom_floor2_inventory").delete().eq("vinNumber",r);if(v)return console.error("Error removing car from Floor 2:",v),!1}else if(n==="garage"){const{error:v}=await B.from("garage_inventory").delete().eq("vinNumber",r);if(v)return console.error("Error removing car from Garage:",v),!1}const d={...i,currentFloor:a,updated_at:new Date().toISOString()};let y;switch(a){case"floor1":const{error:v}=await B.from("showroom_floor1_inventory").insert([d]);y=v;break;case"floor2":const{error:m}=await B.from("showroom_floor2_inventory").insert([d]);y=m;break;case"garage":const{error:R}=await B.from("garage_inventory").insert([d]);y=R;break;case"car_inventory":const{error:p}=await B.from("showroom_floor1_inventory").insert([d]);y=p;break;default:return console.error(`Unknown destination: ${a}`),!1}return y?(console.error(`Error adding car to ${a}:`,y),!1):(console.log(`Successfully moved car ${r} from ${n} to ${a}`),!0)}catch(i){return console.error("Error moving car to destination:",i),!1}}}const gr=({isOpen:k,onClose:r,onVinScanned:a,onCarAdded:i})=>{var Ee;const n=Lt(),[d,y]=u.useState("camera"),[v,m]=u.useState(!1),[R,p]=u.useState(!1),[M,T]=u.useState(null),[j,U]=u.useState(null),[F,ue]=u.useState(""),[z,f]=u.useState(!1),oe=u.useRef(null),K=u.useRef(null),we=u.useRef(null),{granted:ve,denied:Ve,stream:be,requestCamera:Pe,stopCamera:Ce,isSupported:De,hasActiveStream:J}=xt(),D=He(n.pathname);u.useEffect(()=>{k&&d==="camera"&&ve&&!J?E():k||(Ce(),b())},[k,d,ve,J]),u.useEffect(()=>{oe.current&&be&&(oe.current.srcObject=be,oe.current.play().catch(console.error))},[be]);function He(C){return{"/inventory":{table:"cars",location:"Inventory",currentFloor:"Inventory",inShowroom:!1},"/showroom-floor-1":{table:"cars",location:"Showroom Floor 1",currentFloor:"Showroom Floor 1",inShowroom:!0,showroomEntryDate:new Date().toISOString()},"/showroom-floor-2":{table:"cars",location:"Showroom Floor 2",currentFloor:"Showroom Floor 2",inShowroom:!0,showroomEntryDate:new Date().toISOString()},"/garage-inventory":{table:"cars",location:"Garage",currentFloor:"Garage",inShowroom:!1}}[C]||{table:"cars",location:"Inventory",currentFloor:"Inventory",inShowroom:!1}}function c(C){const P=[/\b[A-HJ-NPR-Z0-9]{17}\b/gi,/(?:VIN|V\.I\.N|VEHICLE\s+ID|CHASSIS)[:#\s]*([A-HJ-NPR-Z0-9]{17})/gi];for(const O of P){const A=C.match(O);if(A)for(const V of A){const Y=V.replace(/[^A-HJ-NPR-Z0-9]/gi,"").toUpperCase();if(Y.length===17&&/^[A-HJ-NPR-Z0-9]{17}$/i.test(Y))return Y}}return null}function w(C){const P={JN:{brand:"Nissan",category:"EV"},LFV:{brand:"BMW",category:"EV"},WBA:{brand:"BMW",category:"EV"},"5YJ":{brand:"Tesla",category:"EV"},LGX:{brand:"Voyah",category:"EV"},WP0:{brand:"Porsche",category:"EV"}},O=C.substring(0,3);let A="Unknown",V="Other";for(const[Ye,L]of Object.entries(P))if(O.startsWith(Ye)){A=L.brand,V=L.category;break}const Y=C.charAt(9);let q=new Date().getFullYear();const Se={L:2020,M:2021,N:2022,P:2023,R:2024,S:2025};Se[Y]&&(q=Se[Y]);let Ie=5e4;return A==="Tesla"?Ie=85e3:A==="BMW"?Ie=75e3:A==="Voyah"?Ie=65e3:A==="Porsche"&&(Ie=12e4),{brand:A,model:`${A} Model`,year:q,category:V,estimatedPrice:Ie}}const b=()=>{T(null),U(null),ue(""),f(!1),m(!1),p(!1)},E=async()=>{try{await Pe()}catch(C){console.error("Camera error:",C),x({title:"Camera Error",description:"Failed to access camera. Please check permissions.",variant:"destructive"})}},I=()=>{if(!oe.current||!K.current){x({title:"Camera not ready",description:"Please ensure the camera is active before capturing.",variant:"destructive"});return}const C=oe.current,P=K.current,O=P.getContext("2d");if(!O){x({title:"Canvas error",description:"Unable to capture photo. Please try again.",variant:"destructive"});return}P.width=C.videoWidth,P.height=C.videoHeight,O.drawImage(C,0,0,P.width,P.height);const A=P.toDataURL("image/jpeg",.9);T(A),f(!0),x({title:"Photo captured",description:"Photo captured! Click 'Extract VIN' to read the VIN using OCR."})},Z=async C=>{try{m(!0),x({title:"Processing Image",description:"Extracting VIN number using OCR..."});const P=await Gt(C);if(!P||P.length<10)throw new Error("No readable text found in image");const O=c(P);if(!O)throw new Error("No valid VIN found in image");const A=w(O),V={vin:O,confidence:.9,extractedText:P,carData:A};U(V),f(!1),x({title:"VIN Detected!",description:`Successfully extracted VIN: ${V.vin}`})}catch(P){console.error("VIN OCR error:",P),x({title:"VIN Extraction Failed",description:P.message||"Failed to extract VIN from image",variant:"destructive"})}finally{m(!1)}},Qe=async C=>{var O;const P=(O=C.target.files)==null?void 0:O[0];if(P){if(!P.type.startsWith("image/")){x({title:"Invalid file",description:"Please select an image file.",variant:"destructive"});return}const A=new FileReader;A.onload=async V=>{var q;const Y=(q=V.target)==null?void 0:q.result;await Z(Y)},A.readAsDataURL(P)}},X=()=>{const C=F.trim().toUpperCase();if(C.length!==17||!/^[A-HJ-NPR-Z0-9]{17}$/i.test(C)){x({title:"Invalid VIN",description:"VIN must be exactly 17 characters and contain only valid characters (no I, O, Q).",variant:"destructive"});return}const P=w(C);U({vin:C,confidence:1,extractedText:C,carData:P}),x({title:"VIN Processed",description:`VIN ${C} has been analyzed and is ready to add.`})},he=async()=>{var C,P;if(j)try{if(p(!0),!j.carData)throw new Error("No car data available from VIN analysis");const O=j.carData.category==="Other"?"EV":j.carData.category,A={vin_number:j.vin,brand:j.carData.brand,model:j.carData.model,year:j.carData.year,color:"To be determined",category:O,battery_percentage:O==="EV"?100:null,status:"in_stock",arrival_date:new Date().toISOString(),current_location:D.currentFloor,showroom_entry_date:D.showroomEntryDate,notes:`Added via VIN scan: ${j.vin}`,selling_price:j.carData.estimatedPrice||0,customs:"not_paid",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:V}=await B.from("cars").select("id, vin_number, current_location").eq("vin_number",j.vin);if(V&&V.length>0){const Y=V[0],{error:q}=await B.from("cars").update({current_location:D.currentFloor,showroom_entry_date:D.showroomEntryDate,updated_at:new Date().toISOString()}).eq("id",Y.id);if(q)throw q;x({title:"Car Moved",description:`Car moved from ${Y.current_location} to ${D.location}.`}),a(j,D),i==null||i(Y.id),me()}else{const{data:Y,error:q}=await B.from("cars").insert(A).select().single();if(q)throw q;x({title:"Car Added Successfully",description:`${(C=j.carData)==null?void 0:C.brand} ${(P=j.carData)==null?void 0:P.model} has been added to ${D.location}.`}),a(j,D),i==null||i(Y.id),me()}}catch(O){console.error("Error adding car:",O),x({title:"Error",description:O.message||"Failed to add car to inventory",variant:"destructive"})}finally{p(!1)}},me=()=>{Ce(),b(),r()},je=()=>{f(!1),T(null)},qe=()=>v?"Processing image...":Ve?"Camera permission denied":De?J?"Camera active":ve?"Camera ready":"Camera access required":"Camera not supported";return e.jsx(ee,{open:k,onOpenChange:me,children:e.jsxs(se,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(te,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-5 w-5"}),"Universal VIN Scanner"]}),e.jsxs(ne,{children:["Scan or enter a VIN to automatically add the vehicle to ",D.location]})]}),j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Fe,{children:[e.jsx(Ue,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-5 w-5 text-green-600"}),"VIN Successfully Detected"]})}),e.jsxs($e,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium",children:"VIN Number"}),e.jsx(H,{variant:"outline",className:"w-full justify-center text-lg font-mono",children:j.vin})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium",children:"Confidence"}),e.jsxs(H,{variant:"secondary",className:"w-full justify-center",children:[(j.confidence*100).toFixed(0),"%"]})]})]}),j.carData&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium",children:"Brand"}),e.jsx("p",{className:"font-semibold",children:j.carData.brand})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium",children:"Model"}),e.jsx("p",{className:"font-semibold",children:j.carData.model})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium",children:"Year"}),e.jsx("p",{className:"font-semibold",children:j.carData.year})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium",children:"Category"}),e.jsx(H,{variant:"outline",children:j.carData.category})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium",children:"Estimated Price"}),e.jsxs("p",{className:"font-semibold",children:["$",(Ee=j.carData.estimatedPrice)==null?void 0:Ee.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-sm font-medium",children:"Target Location"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xs,{className:"h-4 w-4"}),e.jsx("p",{className:"font-semibold",children:D.location})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>U(null),children:"Scan Another"}),e.jsx(l,{onClick:he,disabled:R,className:"bg-green-600 hover:bg-green-700",children:R?e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding Car..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Add to ",D.location]})})]})]}):e.jsxs(Bt,{value:d,onValueChange:C=>y(C),children:[e.jsxs(zt,{className:"grid w-full grid-cols-2",children:[e.jsxs(et,{value:"camera",className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Camera Scanner"]}),e.jsxs(et,{value:"manual",className:"flex items-center gap-2",children:[e.jsx(Wt,{className:"h-4 w-4"}),"Manual Entry"]})]}),e.jsx(st,{value:"camera",className:"space-y-4",children:z&&M?e.jsxs(Fe,{children:[e.jsx(Ue,{children:e.jsx(Ae,{children:"Captured Photo"})}),e.jsxs($e,{className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:M,alt:"Captured VIN",className:"w-full h-64 object-contain border rounded-md"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",onClick:je,className:"flex-1",children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Retake"]}),e.jsx(l,{onClick:()=>Z(M),disabled:v,className:"flex-1",children:v?e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"mr-2 h-4 w-4"}),"Extract VIN"]})})]})]})]}):e.jsxs(Fe,{children:[e.jsx(Ue,{children:e.jsx(Ae,{children:"Camera View"})}),e.jsxs($e,{className:"space-y-4",children:[e.jsxs("div",{className:"relative w-full aspect-video bg-slate-100 rounded-md overflow-hidden",children:[e.jsx("video",{ref:oe,className:"w-full h-full object-cover",playsInline:!0,muted:!0,autoPlay:!0,style:{display:"block"}}),!J&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center flex-col gap-2",children:[e.jsx(de,{className:"h-12 w-12 text-muted-foreground opacity-30"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center px-4",children:qe()})]}),e.jsx("canvas",{ref:K,className:"hidden"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsx(l,{onClick:C=>{C.preventDefault(),C.stopPropagation(),console.log("Camera button clicked:",J),J?Ce():E()},variant:J?"destructive":"default",disabled:v,children:J?"Stop Camera":"Start Camera"}),e.jsxs(l,{onClick:C=>{C.preventDefault(),C.stopPropagation(),console.log("Capture button clicked"),I()},disabled:!J||v,variant:"secondary",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Capture"]}),e.jsxs(l,{onClick:C=>{var P;C.preventDefault(),C.stopPropagation(),console.log("Upload button clicked"),(P=we.current)==null||P.click()},variant:"outline",disabled:v,children:[e.jsx(bs,{className:"mr-2 h-4 w-4"}),"Upload"]})]}),e.jsx("input",{ref:we,type:"file",accept:"image/*",onChange:Qe,className:"hidden"}),J&&e.jsx("div",{className:"text-xs text-muted-foreground text-center p-2 bg-blue-50 rounded",children:"📸 Position the VIN number clearly in the camera view and capture when ready"})]})]})}),e.jsx(st,{value:"manual",className:"space-y-4",children:e.jsxs(Fe,{children:[e.jsx(Ue,{children:e.jsx(Ae,{children:"Manual VIN Entry"})}),e.jsxs($e,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"manual-vin",children:"VIN Number (17 characters)"}),e.jsx(G,{id:"manual-vin",value:F,onChange:C=>ue(C.target.value.toUpperCase()),placeholder:"Enter 17-character VIN",maxLength:17,className:"font-mono"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"VIN must be exactly 17 characters (excludes I, O, Q)"})]}),e.jsxs(l,{onClick:X,disabled:F.length!==17,className:"w-full",children:[e.jsx(Zs,{className:"mr-2 h-4 w-4"}),"Process VIN"]})]})]})})]}),e.jsx(ae,{children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Xs,{className:"h-4 w-4"}),"Target: ",D.location]}),e.jsx(l,{variant:"outline",onClick:me,children:"Close"})]})})]})})};class ks{static recordScheduleChange(r,a,i,n,d,y,v,m,R,p){try{const M={id:`schedule-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,carId:r,carCode:a,carModel:i,customerName:n,fromStatus:d,toStatus:y,fromWorkType:p==null?void 0:p.fromWorkType,toWorkType:p==null?void 0:p.toWorkType,timestamp:new Date().toISOString(),changedBy:v,notes:R||`${m.replace("_"," ")}: ${d} → ${y}`,partsUsed:(p==null?void 0:p.partsUsed)||[],toolsUsed:(p==null?void 0:p.toolsUsed)||[],totalPartsCost:this.calculatePartsCost((p==null?void 0:p.partsUsed)||[]),totalToolsCost:this.calculateToolsCost((p==null?void 0:p.toolsUsed)||[]),workNotes:p==null?void 0:p.workNotes,issueDescription:p==null?void 0:p.issueDescription,estimatedDuration:p==null?void 0:p.estimatedDuration,actualDuration:p==null?void 0:p.actualDuration,priority:(p==null?void 0:p.priority)||"medium",assignedMechanic:p==null?void 0:p.assignedMechanic,location:(p==null?void 0:p.location)||"garage_repair",type:m};this.saveScheduleChange(M),d!==y&&this.recordAsWorkTypeChange(M),this.recordInRepairHistory(M),console.log(`Garage schedule change recorded: ${i} (${a}) - ${m} - ${d} → ${y}`)}catch(M){console.error("Error recording garage schedule change:",M)}}static recordStatusChange(r,a,i,n,d,y,v,m,R){this.recordScheduleChange(r,a,i,n,d,y,v,"status_change",m,R)}static recordWorkTypeChange(r,a,i,n,d,y,v,m,R){this.recordScheduleChange(r,a,i,n,d,y,v,"work_type_change",m,{...R,fromWorkType:d,toWorkType:y})}static recordCompletion(r,a,i,n,d,y,v,m){this.recordScheduleChange(r,a,i,n,d,"completed",y,"completion",v,m)}static recordAssignmentChange(r,a,i,n,d,y,v,m,R){this.recordScheduleChange(r,a,i,n,d,y,v,"assignment",m,{...R,assignedMechanic:y})}static recordPriorityChange(r,a,i,n,d,y,v,m,R){this.recordScheduleChange(r,a,i,n,d,y,v,"priority_change",m,{...R,priority:y})}static saveScheduleChange(r){const a=localStorage.getItem(this.GARAGE_SCHEDULE_HISTORY_KEY),i=a?JSON.parse(a):[];i.unshift(r),localStorage.setItem(this.GARAGE_SCHEDULE_HISTORY_KEY,JSON.stringify(i))}static recordAsWorkTypeChange(r){r.fromStatus!==r.toStatus&&lr.recordWorkTypeChange({id:r.id,carVin:r.carCode,carModel:r.carModel,customerName:r.customerName,fromWorkType:r.fromStatus,toWorkType:r.toStatus,workTypeChange:`${r.fromStatus.replace("_"," ").toUpperCase()} → ${r.toStatus.replace("_"," ").toUpperCase()}`,timestamp:r.timestamp,changedBy:r.changedBy,notes:r.notes,type:"work_type_change",partsUsed:r.partsUsed,partsUsedInStage:r.partsUsed,totalPartsCost:r.totalPartsCost,toolsUsed:r.toolsUsed,toolsUsedInStage:r.toolsUsed,totalToolsCost:r.totalToolsCost,workNotes:r.workNotes,issueDescription:r.issueDescription})}static recordInRepairHistory(r){const a=localStorage.getItem("repairHistory"),i=a?JSON.parse(a):[],n={id:r.id,car_vin:r.carCode,car_model:r.carModel,client_name:r.customerName,issue_description:r.issueDescription||`Status changed from ${r.fromStatus} to ${r.toStatus}`,solution_description:r.notes||`${r.type.replace("_"," ")}: ${r.fromStatus} → ${r.toStatus}`,repair_steps:[`${r.type.replace("_"," ")}: ${r.fromStatus} → ${r.toStatus}`],parts_used:r.partsUsed.map(d=>({part_number:d,part_name:d,quantity:1,cost:0,supplier:"Monza Parts"})),technician_name:r.assignedMechanic||r.changedBy,repair_date:r.timestamp,completion_date:r.timestamp,difficulty_level:"medium",labor_hours:r.actualDuration?parseFloat(r.actualDuration.replace("h","")):0,total_cost:r.totalPartsCost+r.totalToolsCost,quality_rating:5,client_satisfaction:5,photos:[],before_photos:[],after_photos:[],repair_category:r.type,warranty_period:12,follow_up_required:!1,follow_up_notes:"",workTypeTransition:`${r.fromStatus} → ${r.toStatus}`,fromStage:r.fromStatus,toStage:r.toStatus,transitionTimestamp:r.timestamp,partsUsed:r.partsUsed,partsUsedInStage:r.partsUsed,totalPartsCost:r.totalPartsCost,toolsUsed:r.toolsUsed,toolsUsedInStage:r.toolsUsed,totalToolsCost:r.totalToolsCost};i.unshift(n),localStorage.setItem("repairHistory",JSON.stringify(i))}static getScheduleChanges(){try{const r=localStorage.getItem(this.GARAGE_SCHEDULE_HISTORY_KEY);return r?JSON.parse(r):[]}catch(r){return console.error("Error loading garage schedule changes:",r),[]}}static getCarScheduleChanges(r){return this.getScheduleChanges().filter(i=>i.carId===r)}static getChangesByType(r){return this.getScheduleChanges().filter(i=>i.type===r)}static getRecentChanges(r=20){return this.getScheduleChanges().slice(0,r)}static calculatePartsCost(r){let a=0;return r.forEach(i=>{i.toLowerCase().includes("engine")?a+=500:i.toLowerCase().includes("transmission")?a+=300:i.toLowerCase().includes("brake")?a+=150:i.toLowerCase().includes("tire")?a+=200:i.toLowerCase().includes("battery")?a+=120:i.toLowerCase().includes("filter")?a+=25:i.toLowerCase().includes("oil")?a+=50:a+=75}),a}static calculateToolsCost(r){let a=0;return r.forEach(i=>{i.toLowerCase().includes("diagnostic")?a+=200:i.toLowerCase().includes("lift")?a+=150:i.toLowerCase().includes("wrench")?a+=50:i.toLowerCase().includes("screwdriver")?a+=20:i.toLowerCase().includes("multimeter")?a+=100:a+=30}),a}static clearScheduleChanges(){localStorage.removeItem(this.GARAGE_SCHEDULE_HISTORY_KEY)}}Ks(ks,"GARAGE_SCHEDULE_HISTORY_KEY","garageScheduleHistory");const fr=Object.freeze(Object.defineProperty({__proto__:null,GarageScheduleHistoryService:ks},Symbol.toStringTag,{value:"Module"})),vr=({softwareVersion:k,softwareLastUpdated:r,softwareUpdateBy:a,softwareUpdateNotes:i,compact:n=!1,editable:d=!0,onSave:y,carId:v})=>{const[m,R]=u.useState(!1),[p,M]=u.useState(k||""),[T,j]=u.useState(a||""),[U,F]=u.useState(i||""),ue=()=>{y&&p.trim()&&(y({softwareVersion:p.trim(),softwareLastUpdated:new Date().toISOString(),softwareUpdateBy:T.trim()||"System",softwareUpdateNotes:U.trim()}),x({title:"✅ Software Version Updated",description:`Updated to v${p.trim()}`})),R(!1)},z=()=>{M(k||""),j(a||""),F(i||""),R(!1)},f=()=>{d&&R(!0)},oe=K=>new Date(K).toLocaleDateString();return!k&&!m?e.jsx("div",{className:`text-sm ${d?"cursor-pointer hover:text-blue-600 hover:underline":""}`,onClick:d?f:void 0,title:d?"Click to add software version":void 0,children:e.jsx(H,{variant:"secondary",className:`text-xs text-yellow-700 bg-yellow-100 border border-yellow-300 ${d?"hover:bg-yellow-200 hover:border-yellow-400 cursor-pointer":""}`,children:d?"Click to add version":"Update Needed"})}):m?e.jsxs("div",{className:"space-y-3 p-3 border rounded-lg bg-blue-50 min-w-64",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"software-version",className:"text-xs",children:"Software Version"}),e.jsx(G,{id:"software-version",placeholder:"e.g., 2.1.0",value:p,onChange:K=>M(K.target.value),className:"h-7 text-xs",required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"update-by",className:"text-xs",children:"Updated By"}),e.jsx(G,{id:"update-by",placeholder:"e.g., IT Technician",value:T,onChange:K=>j(K.target.value),className:"h-7 text-xs"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"update-notes",className:"text-xs",children:"Update Notes"}),e.jsx(Oe,{id:"update-notes",placeholder:"Notes about this update...",value:U,onChange:K=>F(K.target.value),className:"text-xs",rows:2})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{size:"sm",onClick:ue,className:"h-6 px-2 text-xs",disabled:!p.trim(),children:e.jsx(gt,{className:"w-3 h-3"})}),e.jsx(l,{size:"sm",variant:"outline",onClick:z,className:"h-6 px-2 text-xs",children:e.jsx(Te,{className:"w-3 h-3"})})]})]}):n?e.jsxs("div",{className:`flex items-center gap-1 ${d?"cursor-pointer hover:opacity-80":""}`,onClick:d?f:void 0,title:d?"Click to edit software version":void 0,children:[e.jsxs(H,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:["v",k]}),d&&e.jsx(Cs,{className:"w-3 h-3 text-gray-400"})]}):e.jsxs("div",{className:`space-y-2 ${d?"cursor-pointer hover:bg-blue-50 hover:border-blue-200 p-2 rounded border border-transparent transition-colors":""}`,onClick:d?f:void 0,title:d?"Click to edit software version":void 0,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(H,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:[e.jsx(Dt,{className:"w-3 h-3 mr-1"}),"v",k]}),d&&e.jsx(Cs,{className:"w-3 h-3 text-gray-400"})]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[r&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qt,{className:"w-3 h-3"}),e.jsxs("span",{children:["Updated: ",oe(r)]})]}),a&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:"w-3 h-3"}),e.jsxs("span",{children:["By: ",a]})]}),i&&e.jsxs("div",{className:"text-xs text-gray-500 italic",children:['"',i,'"']})]})]})},jr=({isOpen:k,onClose:r,carDetails:a,onSubmit:i})=>{var J,D,He;const[n,d]=u.useState({solutionDescription:"",repairSteps:[""],partsUsed:[],toolsUsed:[],totalLaborHours:0,totalCost:0,difficultyLevel:"medium",qualityRating:5,clientSatisfaction:5,warrantPeriod:12,followUpRequired:!1,followUpNotes:"",beforePhotos:[],afterPhotos:[],mechanicNotes:"",recommendation:""}),[y,v]=u.useState([]),[m,R]=u.useState([]),[p,M]=u.useState(!1),[T,j]=u.useState("before"),U=u.useRef(null),F=u.useRef(null),ue=u.useRef(null);Je.useEffect(()=>{a&&d(c=>{var w;return{...c,carId:a.id,carCode:a.carCode,carModel:a.carModel,customerName:a.customerName,assignedMechanic:a.assignedMechanic,workType:a.workType,issueDescription:a.issueDescription,toolsUsed:a.toolsUsed||[],totalLaborHours:a.actualDuration?parseFloat(a.actualDuration.replace("h","")):parseFloat(a.estimatedDuration||"0"),partsUsed:((w=a.partsUsed)==null?void 0:w.map(b=>({partNumber:b,partName:b,quantity:1,cost:0,supplier:"Monza Parts"})))||[]}})},[a]);const z=(c,w)=>{d(b=>({...b,[c]:w}))},f=()=>{d(c=>({...c,repairSteps:[...c.repairSteps||[],""]}))},oe=(c,w)=>{d(b=>{var E;return{...b,repairSteps:((E=b.repairSteps)==null?void 0:E.map((I,Z)=>Z===c?w:I))||[]}})},K=c=>{d(w=>{var b;return{...w,repairSteps:((b=w.repairSteps)==null?void 0:b.filter((E,I)=>I!==c))||[]}})},we=(c,w)=>{if(!c)return;const b=Array.from(c),E=b.filter(I=>I.type.startsWith("image/"));if(E.length!==b.length){x({title:"Invalid Files",description:"Only image files are allowed",variant:"destructive"});return}v(I=>[...I,...E]),E.forEach(I=>{const Z=new FileReader;Z.onload=Qe=>{var he;const X=(he=Qe.target)==null?void 0:he.result;d(me=>({...me,beforePhotos:[...me.beforePhotos||[],X]}))},Z.readAsDataURL(I)})},ve=(c,w)=>{w==="before"?(v(b=>b.filter((E,I)=>I!==c)),d(b=>{var E;return{...b,beforePhotos:((E=b.beforePhotos)==null?void 0:E.filter((I,Z)=>Z!==c))||[]}})):(R(b=>b.filter((E,I)=>I!==c)),d(b=>{var E;return{...b,afterPhotos:((E=b.afterPhotos)==null?void 0:E.filter((I,Z)=>Z!==c))||[]}}))},Ve=async c=>{j(c),M(!0);try{const w=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});F.current&&(F.current.srcObject=w)}catch{x({title:"Camera Error",description:"Unable to access camera",variant:"destructive"}),M(!1)}},be=()=>{if(F.current&&ue.current){const c=F.current,w=ue.current,b=w.getContext("2d");if(w.width=c.videoWidth,w.height=c.videoHeight,b){b.drawImage(c,0,0);const E=w.toDataURL("image/jpeg",.8);d(T==="before"?I=>({...I,beforePhotos:[...I.beforePhotos||[],E]}):I=>({...I,afterPhotos:[...I.afterPhotos||[],E]})),x({title:"Photo Captured",description:`${T==="before"?"Before":"After"} photo added successfully`})}}Pe()},Pe=()=>{var c;(c=F.current)!=null&&c.srcObject&&F.current.srcObject.getTracks().forEach(b=>b.stop()),M(!1)},Ce=()=>{var c,w,b;return(c=n.solutionDescription)!=null&&c.trim()?(w=n.repairSteps)!=null&&w.some(E=>E.trim())?(b=n.mechanicNotes)!=null&&b.trim()?!0:(x({title:"Missing Information",description:"Please add mechanic notes",variant:"destructive"}),!1):(x({title:"Missing Information",description:"Please add at least one repair step",variant:"destructive"}),!1):(x({title:"Missing Information",description:"Please provide a solution description",variant:"destructive"}),!1)},De=()=>{var w;if(!Ce()||!a)return;const c={...n,completionDate:new Date().toISOString(),repairSteps:((w=n.repairSteps)==null?void 0:w.filter(b=>b.trim()))||[]};i(c),r(),d({solutionDescription:"",repairSteps:[""],partsUsed:[],toolsUsed:[],totalLaborHours:0,totalCost:0,difficultyLevel:"medium",qualityRating:5,clientSatisfaction:5,warrantPeriod:12,followUpRequired:!1,followUpNotes:"",beforePhotos:[],afterPhotos:[],mechanicNotes:"",recommendation:""}),v([]),R([])};return a?e.jsxs(e.Fragment,{children:[e.jsx(ee,{open:k,onOpenChange:r,children:e.jsxs(se,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(te,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"h-5 w-5 text-green-600"}),"Complete Repair - Submit to History"]}),e.jsxs(ne,{children:["Provide detailed information about the completed repair for ",a.carModel," (",a.carCode,")"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Fe,{children:[e.jsx(Ue,{children:e.jsx(Ae,{className:"text-sm",children:"Repair Summary"})}),e.jsx($e,{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Car:"}),e.jsxs("span",{children:[a.carModel," (",a.carCode,")"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Customer:"}),e.jsx("span",{children:a.customerName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Mechanic:"}),e.jsx("span",{children:a.assignedMechanic})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Work Type:"}),e.jsx(H,{variant:"outline",children:a.workType.replace("_"," ")})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Original Issue Description"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-md border text-sm",children:a.issueDescription||"No issue description provided"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"solution",children:"Solution Description *"}),e.jsx(Oe,{id:"solution",placeholder:"Describe how the issue was resolved...",value:n.solutionDescription,onChange:c=>z("solutionDescription",c.target.value),rows:4,className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(S,{children:"Repair Steps Performed *"}),e.jsx(l,{size:"sm",variant:"outline",onClick:f,children:"Add Step"})]}),e.jsx("div",{className:"space-y-2",children:((J=n.repairSteps)==null?void 0:J.map((c,w)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{placeholder:`Step ${w+1}...`,value:c,onChange:b=>oe(w,b.target.value),className:"flex-1"}),n.repairSteps&&n.repairSteps.length>1&&e.jsx(l,{size:"sm",variant:"outline",onClick:()=>K(w),children:e.jsx(Te,{className:"h-4 w-4"})})]},w)))||[]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"difficulty",children:"Difficulty Level"}),e.jsxs("select",{id:"difficulty",value:n.difficultyLevel,onChange:c=>z("difficultyLevel",c.target.value),className:"w-full h-10 px-3 border border-gray-300 rounded-md bg-white mt-1",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"}),e.jsx("option",{value:"expert",children:"Expert"})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"quality",children:"Quality Rating"}),e.jsx("div",{className:"flex items-center gap-1 mt-1",children:[1,2,3,4,5].map(c=>e.jsx(dt,{className:`h-5 w-5 cursor-pointer ${c<=(n.qualityRating||0)?"text-yellow-400 fill-current":"text-gray-300"}`,onClick:()=>z("qualityRating",c)},c))})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"satisfaction",children:"Client Satisfaction"}),e.jsx("div",{className:"flex items-center gap-1 mt-1",children:[1,2,3,4,5].map(c=>e.jsx(dt,{className:`h-5 w-5 cursor-pointer ${c<=(n.clientSatisfaction||0)?"text-green-400 fill-current":"text-gray-300"}`,onClick:()=>z("clientSatisfaction",c)},c))})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"warranty",children:"Warranty (months)"}),e.jsx(G,{id:"warranty",type:"number",min:"1",max:"60",value:n.warrantPeriod,onChange:c=>z("warrantPeriod",parseInt(c.target.value)),className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"laborHours",children:"Total Labor Hours"}),e.jsx(G,{id:"laborHours",type:"number",step:"0.5",min:"0",value:n.totalLaborHours,onChange:c=>z("totalLaborHours",parseFloat(c.target.value)),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"totalCost",children:"Total Cost (AED)"}),e.jsx(G,{id:"totalCost",type:"number",step:"0.01",min:"0",value:n.totalCost,onChange:c=>z("totalCost",parseFloat(c.target.value)),className:"mt-1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{className:"text-base font-semibold",children:"Photo Documentation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(S,{className:"text-sm",children:"Before Photos (Optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>Ve("before"),children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Camera"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>{var c;return(c=U.current)==null?void 0:c.click()},children:[e.jsx(bs,{className:"h-4 w-4 mr-1"}),"Upload"]})]})]}),e.jsx("input",{ref:U,type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:c=>we(c.target.files)}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 min-h-[120px] border-2 border-dashed border-gray-300 rounded-lg p-2",children:[(D=n.beforePhotos)==null?void 0:D.map((c,w)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:c,alt:`Before ${w+1}`,className:"w-full h-20 object-cover rounded border"}),e.jsx(l,{size:"sm",variant:"destructive",className:"absolute top-1 right-1 h-6 w-6 p-0 opacity-0 group-hover:opacity-100",onClick:()=>ve(w,"before"),children:e.jsx(Te,{className:"h-3 w-3"})})]},w)),(!n.beforePhotos||n.beforePhotos.length===0)&&e.jsxs("div",{className:"col-span-2 flex items-center justify-center text-gray-500 text-sm",children:[e.jsx(ht,{className:"h-8 w-8 mr-2"}),"No before photos added"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(S,{className:"text-sm",children:"After Photos (Optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>Ve("after"),children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Camera"]}),e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>{var c;return(c=U.current)==null?void 0:c.click()},children:[e.jsx(bs,{className:"h-4 w-4 mr-1"}),"Upload"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 min-h-[120px] border-2 border-dashed border-gray-300 rounded-lg p-2",children:[(He=n.afterPhotos)==null?void 0:He.map((c,w)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:c,alt:`After ${w+1}`,className:"w-full h-20 object-cover rounded border"}),e.jsx(l,{size:"sm",variant:"destructive",className:"absolute top-1 right-1 h-6 w-6 p-0 opacity-0 group-hover:opacity-100",onClick:()=>ve(w,"after"),children:e.jsx(Te,{className:"h-3 w-3"})})]},w)),(!n.afterPhotos||n.afterPhotos.length===0)&&e.jsxs("div",{className:"col-span-2 flex items-center justify-center text-gray-500 text-sm",children:[e.jsx(ht,{className:"h-8 w-8 mr-2"}),"No after photos added"]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"followUp",checked:n.followUpRequired,onChange:c=>z("followUpRequired",c.target.checked)}),e.jsx(S,{htmlFor:"followUp",children:"Follow-up Required"})]}),n.followUpRequired&&e.jsx(Oe,{placeholder:"Follow-up notes and instructions...",value:n.followUpNotes,onChange:c=>z("followUpNotes",c.target.value),rows:2})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"mechanicNotes",children:"Mechanic Notes & Details *"}),e.jsx(Oe,{id:"mechanicNotes",placeholder:"Additional notes, observations, or recommendations...",value:n.mechanicNotes,onChange:c=>z("mechanicNotes",c.target.value),rows:3,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"recommendations",children:"Recommendations for Customer"}),e.jsx(Oe,{id:"recommendations",placeholder:"Future maintenance recommendations, warnings, or advice...",value:n.recommendation,onChange:c=>z("recommendation",c.target.value),rows:2,className:"mt-1"})]})]}),e.jsxs(ae,{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(l,{onClick:De,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(dr,{className:"h-4 w-4 mr-2"}),"Submit to Repair History"]})]})]})}),p&&e.jsx(ee,{open:p,onOpenChange:Pe,children:e.jsxs(se,{className:"max-w-md",children:[e.jsx(te,{children:e.jsxs(re,{children:["Capture ",T==="before"?"Before":"After"," Photo"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("video",{ref:F,autoPlay:!0,playsInline:!0,className:"w-full rounded-lg border",style:{transform:"scaleX(-1)"}}),e.jsx("canvas",{ref:ue,className:"hidden"})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:Pe,children:"Cancel"}),e.jsxs(l,{onClick:be,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Capture Photo"]})]})]})})]}):null},Nr=({scheduledCars:k,onStatusUpdate:r,onViewDetails:a})=>{var Gs,Ds,Qs,Ys;Yt();const{user:i}=Kt(),[n,d]=u.useState([]),[y,v]=u.useState(!0),[m,R]=u.useState(null),[p,M]=u.useState(!1),[T,j]=u.useState(!1),[U,F]=u.useState(!1),[ue,z]=u.useState(!1),[f,oe]=u.useState(null),[K,we]=u.useState(!1),[ve,Ve]=u.useState(""),[be,Pe]=u.useState(""),[Ce,De]=u.useState(30),[J,D]=u.useState(""),[He,c]=u.useState(!1),[w,b]=u.useState(!1),[E,I]=u.useState(null),[Z,Qe]=u.useState(new Date),[X,he]=u.useState(null),[me,je]=u.useState(""),[qe,Ee]=u.useState(!1),[C,P]=u.useState(!1),[O,A]=u.useState(!1),[V,Y]=u.useState(null),[q,Se]=u.useState(""),[Ie,Ye]=u.useState(!1),[L,is]=u.useState(null),[jt,ls]=u.useState(!1),[Nt,cs]=u.useState(!1),[W,ie]=u.useState(""),[ds,Le]=u.useState(""),[ms,Ts]=u.useState("tool"),[Q,us]=u.useState(null),[Ze,Ps]=u.useState("tool"),[yt,Be]=u.useState(!1),[wt,ze]=u.useState(!1),[xe,hs]=u.useState(""),[yr,We]=u.useState(!1),[pe,xs]=u.useState(!1),[Xe,ps]=u.useState(!1),_e=Je.useRef(null),es=Je.useRef(null),Ge=Je.useRef(null),gs=Je.useRef(null),{stream:Ne,requestCamera:Es,stopCamera:Is}=xt();u.useEffect(()=>{rs()},[k]);const _s=async()=>{try{xs(!0),We(!0),await Es({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),x({title:"📷 Scanner Ready",description:"Point camera at QR code or barcode to scan part information"})}catch(s){console.error("Camera access error:",s),x({title:"Camera Error",description:"Could not access camera. Please check permissions.",variant:"destructive"}),xs(!1),We(!1)}},Ke=()=>{Is(),xs(!1),We(!1)},Rs=async()=>{if(!_e.current||!es.current){x({title:"Scanner Error",description:"Camera not ready for scanning",variant:"destructive"});return}try{const s=es.current,t=_e.current,o=s.getContext("2d");if(!o)return;s.width=t.videoWidth,s.height=t.videoHeight,o.drawImage(t,0,0,s.width,s.height);const h=s.toDataURL("image/png"),g=await bt(h);g?(ie(g),Ke(),x({title:"✅ Part Scanned Successfully",description:`Detected: ${g}`})):x({title:"No QR Code Detected",description:"Make sure the QR code is clearly visible and try again",variant:"destructive"})}catch(s){console.error("Scanning error:",s),x({title:"Scanning Error",description:"Failed to process the image. Please try again.",variant:"destructive"})}},bt=async s=>{const t=["Brake Pads Front Set","Oil Filter","Air Filter","Spark Plugs Set","Battery 12V","Windshield Wipers","Headlight Bulb H7","Engine Mount","Transmission Filter","Radiator Coolant"];return await new Promise(o=>setTimeout(o,1e3)),t[Math.floor(Math.random()*t.length)]};u.useEffect(()=>{_e.current&&Ne&&pe&&(_e.current.srcObject=Ne,_e.current.play().catch(console.error)),Ge.current&&Ne&&Xe&&(Ge.current.srcObject=Ne,Ge.current.play().catch(console.error))},[Ne,pe,Xe]);const Ct=async()=>{try{ps(!0),We(!0),await Es({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),x({title:"📷 OCR Scanner Ready",description:"Point camera at part label or barcode to scan part information"})}catch(s){console.error("Camera access error:",s),x({title:"Camera Error",description:"Could not access camera. Please check permissions.",variant:"destructive"}),ps(!1),We(!1)}},fs=()=>{Is(),ps(!1),We(!1)},St=async()=>{if(!Ge.current||!gs.current){x({title:"Scanner Error",description:"Camera not ready for scanning",variant:"destructive"});return}try{const s=gs.current,t=Ge.current,o=s.getContext("2d");if(!o)return;s.width=t.videoWidth,s.height=t.videoHeight,o.drawImage(t,0,0,s.width,s.height);const h=s.toDataURL("image/png"),g=await kt(h);g?(ie(g),fs(),x({title:"✅ Part Scanned Successfully",description:`OCR Detected: ${g}`})):x({title:"No Text Detected",description:"Make sure the part label is clearly visible and try again",variant:"destructive"})}catch(s){console.error("OCR scanning error:",s),x({title:"Scanning Error",description:"Failed to process the image. Please try again.",variant:"destructive"})}},kt=async s=>{const t=["Brake Pad Set Front","Oil Filter Element","Air Filter Housing","Spark Plug NGK","Battery Terminal +/-","Wiper Blade 24inch","Headlight Assembly LED","Engine Mount Rubber","Transmission Oil ATF","Radiator Cap 1.3 Bar","Fuel Pump Assembly","Alternator Brush Set","Starter Motor Bendix","Clutch Disc 240mm","Timing Belt Kit"];return await new Promise(o=>setTimeout(o,1500)),t[Math.floor(Math.random()*t.length)]};u.useEffect(()=>{if(qe||C){const s=document.getElementById(qe?"tool-name-input":"part-name-input");s&&setTimeout(()=>{s.focus()},100)}},[qe,C]),u.useEffect(()=>{const s=setInterval(()=>{Qe(new Date)},6e4);return()=>clearInterval(s)},[]),u.useEffect(()=>{if(n.length>0){const s=n.map(t=>({...t,timeProgress:vs(t.car)}));d(s)}},[Z,n.length]);const Tt=(s,t,o)=>{try{console.log("handleCellClick called:",{carId:s,field:t,currentValue:o}),he({carId:s,field:t,value:o}),je(o)}catch(h){console.error("Error in handleCellClick:",h),he(null),je("")}},Ms=()=>{if(!X)return;const s=n.map(t=>{if(t.car.id===X.carId){const o={...t.car,[X.field]:me};return{...t,car:o}}return t});d(s),he(null),je(""),x({title:"Updated",description:`${X.field} updated successfully`})},Pt=(s,t)=>{const o=n.map(h=>{if(h.car.id===s){const g={...h.car,softwareVersion:t.softwareVersion,softwareLastUpdated:t.softwareLastUpdated,softwareUpdateBy:t.softwareUpdateBy,softwareUpdateNotes:t.softwareUpdateNotes};return{...h,car:g}}return h});d(o)},Fs=()=>{he(null),je("")},Us=s=>{Le(s),Ts("tool"),ie(""),Ee(!0)},As=s=>{Le(s),Ts("part"),ie(""),P(!0)},ss=()=>{if(!W.trim())return;const s=n.map(t=>{if(t.car.id===ds)if(ms==="tool"){const o={toolName:W.trim(),toolType:"equipment",isRequired:!0};return{...t,toolsRequired:[...t.toolsRequired,o]}}else{const o={partName:W.trim(),partNumber:`PN-${W.trim().toUpperCase().replace(/\s+/g,"")}`,quantity:1};return{...t,partsNeeded:[...t.partsNeeded,o]}}return t});d(s),x({title:`${ms==="tool"?"Tool":"Part"} Added`,description:`${W.trim()} added to the ${ms} list`}),Ee(!1),P(!1),ie(""),Le("")},ge=()=>{pe&&Ke(),Xe&&fs(),Ee(!1),P(!1),ls(!1),cs(!1),Be(!1),ze(!1),ie(""),Le(""),hs(""),us(null)},Et=s=>{hs(s),Be(!0)},It=s=>{hs(s),ze(!0)},$s=(s,t)=>{Le(s),us(t),Ps("part"),ie(t.partName),ls(!0)},Os=(s,t)=>{Le(s),us(t),Ps("tool"),ie(t.toolName),cs(!0)},ts=()=>{if(!W.trim()||!Q)return;const s=n.map(t=>{if(t.car.id===ds)if(Ze==="tool"){const o=t.toolsRequired.map(h=>h===Q?{...h,toolName:W.trim()}:h);return{...t,toolsRequired:o}}else{const o=t.partsNeeded.map(h=>h===Q?{...h,partName:W.trim()}:h);return{...t,partsNeeded:o}}return t});d(s),x({title:`${Ze==="tool"?"Tool":"Part"} Updated`,description:`${Q.name} updated to ${W.trim()}`}),ge()},Vs=()=>{if(!Q)return;const s=n.map(t=>{if(t.car.id===ds)if(Ze==="tool"){const o=t.toolsRequired.filter(h=>h!==Q);return{...t,toolsRequired:o}}else{const o=t.partsNeeded.filter(h=>h!==Q);return{...t,partsNeeded:o}}return t});d(s),x({title:`${Ze==="tool"?"Tool":"Part"} Deleted`,description:`${Q.name} removed from the list`}),ge()},ye=(s,t,o,h="text",g)=>{try{if(!s||!s.car||!s.car.id)return console.warn("Invalid carDetail in renderEditableCell:",s),e.jsx("div",{className:"text-gray-400 text-sm",children:"Invalid data"});if(h==="select"&&(!g||g.length===0))return console.warn("No options provided for select field:",t),e.jsx("div",{className:"text-gray-400 text-sm",children:"No options"});if((X==null?void 0:X.carId)===s.car.id&&(X==null?void 0:X.field)===t)return e.jsxs("div",{className:"flex items-center gap-2",style:{position:"relative",zIndex:1e3},children:[h==="select"&&g?e.jsx("div",{className:"w-32",children:e.jsx(mt,{value:me,onValueChange:je,options:g.map($=>({value:$,label:$.replace("_"," ").toLowerCase()})),placeholder:"Select...",searchable:!0})}):e.jsx(G,{id:`edit-${t}-${s.car.id}`,value:me,onChange:$=>je($.target.value),className:"w-32 h-8",autoFocus:!0,onKeyDown:$=>{$.key==="Enter"?Ms():$.key==="Escape"&&Fs()}}),e.jsx(l,{size:"sm",onClick:Ms,className:"h-6 w-6 p-0",children:e.jsx(gt,{className:"h-3 w-3"})}),e.jsx(l,{size:"sm",onClick:Fs,variant:"outline",className:"h-6 w-6 p-0",children:e.jsx(Te,{className:"h-3 w-3"})})]});let N=o||"";return t==="priority"?N=(o||"").toUpperCase():t==="status"?N=(o||"").replace("_"," ").toUpperCase():t==="workType"&&(N=(o||"").replace("_"," ").toLowerCase()),e.jsxs("div",{className:"cursor-pointer hover:bg-gray-100 p-1 rounded flex items-center gap-1",style:{position:"relative",zIndex:1},onClick:$=>{$.preventDefault(),$.stopPropagation();try{Tt(s.car.id,t,o||"")}catch(Me){console.error("Error in cell click handler:",Me),he(null),je("")}},children:[e.jsx("span",{className:t==="priority"?"font-medium":"",children:t==="priority"?e.jsx(H,{className:Bs(o||""),variant:"outline",children:N}):t==="status"?e.jsx(H,{className:Ls(o||""),children:N}):N}),e.jsx(Cs,{className:"h-3 w-3 text-gray-400 opacity-0 group-hover:opacity-100"})]})}catch(_){return console.error("Error in renderEditableCell:",_),e.jsx("div",{className:"text-red-500 text-sm",children:"Error loading cell"})}},rs=async()=>{v(!0);const s=[];for(const t of k)try{const o=Hs(t),h=vs(t),g={...t,startTime:t.startTime||void 0,actualStartTime:t.actualStartTime||void 0,actualEndTime:t.actualEndTime||void 0,partsHistory:t.partsHistory||[]};s.push({car:g,repairHistory:[],partsNeeded:o.parts.map(_=>({partName:_,partNumber:`PN-${_.toUpperCase().replace(/\s+/g,"")}`,quantity:1})),toolsRequired:o.tools.map(_=>({toolName:_,toolType:"equipment",isRequired:!0})),aiRecommendations:o,timeProgress:h,isTimerRunning:!1})}catch(o){console.error(`Error loading details for car ${t.carCode}:`,o);const h=Hs(t),g={...t,startTime:t.startTime||void 0,actualStartTime:t.actualStartTime||void 0,actualEndTime:t.actualEndTime||void 0,partsHistory:t.partsHistory||[]};s.push({car:g,repairHistory:[],partsNeeded:[],toolsRequired:[],aiRecommendations:h,timeProgress:vs(t),isTimerRunning:!1})}d(s),v(!1)},Hs=s=>{const t={electrical:{parts:["Battery","Alternator","Starter Motor","Fuses","Wiring Harness"],tools:["Multimeter","Battery Tester","Wire Crimper","Soldering Iron"],expectedTime:"2-4 hours",notes:"Electrical diagnostics and repair work"},mechanic:{parts:["Oil Filter","Air Filter","Brake Pads","Spark Plugs","Timing Belt"],tools:["Socket Set","Wrench Set","Jack Stands","Torque Wrench"],expectedTime:"3-6 hours",notes:"Mechanical maintenance and repair"},body_work:{parts:["Body Panels","Bumper","Paint","Filler","Primer"],tools:["Welder","Grinder","Paint Gun","Sanding Tools"],expectedTime:"4-8 hours",notes:"Body repair and paint work"},painter:{parts:["Paint","Clear Coat","Primer","Filler","Sandpaper"],tools:["Paint Gun","Compressor","Sanding Tools","Masking Tape"],expectedTime:"2-5 hours",notes:"Paint and finish work"},detailer:{parts:["Wax","Polish","Interior Cleaner","Glass Cleaner"],tools:["Buffer","Vacuum","Steam Cleaner","Microfiber Cloths"],expectedTime:"1-3 hours",notes:"Interior and exterior detailing"}},o=s.workType,h=t.mechanic,g=t[o]||h;return{expectedTime:g.expectedTime,parts:g.parts,tools:g.tools,notes:g.notes}},vs=s=>{const t=s.actualStartTime,o=Jt(s.estimatedDuration,0)*60;if(!t)return{elapsed:0,remaining:o,percentage:0,isOverrunning:!1,isDelayed:!1};const h=new Date(t),_=Math.floor(((Z||new Date).getTime()-h.getTime())/(1e3*60)),N=Math.max(0,o-_),$=Math.min(100,_/o*100),Me=_>o;return{elapsed:_,remaining:N,percentage:$,isOverrunning:Me,startTime:h}},qs=s=>{switch(s){case"electrical":return e.jsx(or,{className:"h-4 w-4 text-blue-600"});case"mechanic":return e.jsx(it,{className:"h-4 w-4 text-green-600"});case"body_work":return e.jsx(ur,{className:"h-4 w-4 text-purple-600"});case"painter":return e.jsx(ar,{className:"h-4 w-4 text-orange-600"});case"detailer":return e.jsx(mr,{className:"h-4 w-4 text-pink-600"});default:return e.jsx(ns,{className:"h-4 w-4"})}},Ls=s=>{switch(s){case"in_progress":return"bg-green-100 text-green-700 border-green-200";case"completed":return"bg-emerald-100 text-emerald-700 border-emerald-200";case"waiting_parts":return"bg-orange-100 text-orange-700 border-orange-200";case"paused":return"bg-red-100 text-red-700 border-red-200";case"scheduled":return"bg-blue-100 text-blue-700 border-blue-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},Bs=s=>{switch(s){case"high":return"bg-red-100 text-red-700 border-red-200";case"medium":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"low":return"bg-green-100 text-green-700 border-green-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},Re=s=>{const t=Math.floor(s/60),o=s%60;return t>0?`${t}h ${o}m`:`${o}m`},as=async(s,t)=>{var o,h,g,_;try{const N=n.find(fe=>fe.car.id===s);if(!N){console.error("Car detail not found for ID:",s);return}const{GarageScheduleHistoryService:$}=await lt(async()=>{const{GarageScheduleHistoryService:fe}=await Promise.resolve().then(()=>fr);return{GarageScheduleHistoryService:fe}},void 0);if($.recordStatusChange(N.car.id,N.car.carCode,N.car.carModel,N.car.customerName,N.car.status,t,"Garage Mechanic",`Status changed from ${N.car.status} to ${t}`,{partsUsed:((o=N.car.partsHistory)==null?void 0:o.map(fe=>fe.partName))||[],toolsUsed:N.toolsRequired||[],workNotes:N.car.notes,issueDescription:`Work type: ${N.car.workType}`,estimatedDuration:N.car.estimatedDuration,actualDuration:(h=N.timeProgress)!=null&&h.elapsed?`${Math.round(N.timeProgress.elapsed/60)}h`:void 0,priority:N.car.priority,assignedMechanic:N.car.assignedMechanic,location:"garage_repair"}),t==="completed"&&$.recordCompletion(N.car.id,N.car.carCode,N.car.carModel,N.car.customerName,N.car.status,"Garage Mechanic","Repair completed successfully",{partsUsed:((g=N.car.partsHistory)==null?void 0:g.map(fe=>fe.partName))||[],toolsUsed:N.toolsRequired||[],workNotes:N.car.notes,issueDescription:`Completed ${N.car.workType} work`,estimatedDuration:N.car.estimatedDuration,actualDuration:(_=N.timeProgress)!=null&&_.elapsed?`${Math.round(N.timeProgress.elapsed/60)}h`:void 0,priority:N.car.priority,assignedMechanic:N.car.assignedMechanic,location:"garage_repair"}),!await ke.updateCarStatus(N.car.carCode,t)){x({title:"Status Update Failed",description:"Failed to update car status in inventory tables",variant:"destructive"});return}r(s,t),x({title:"Status Updated",description:`Car status changed to ${t.replace("_"," ")} and recorded in repair history`}),t==="completed"&&await rs()}catch(N){console.error("Error updating car status:",N),x({title:"Error",description:"An error occurred while updating car status",variant:"destructive"})}},_t=async s=>{try{console.log("Sending completed car to repair history:",s.car.carModel);const{enhancedRepairHistoryService:t}=await lt(async()=>{const{enhancedRepairHistoryService:$}=await import("./enhancedRepairHistoryService-DIHM_Im-.js");return{enhancedRepairHistoryService:$}},__vite__mapDeps([0,1,2])),o=s.car.actualStartTime?new Date(s.car.actualStartTime):null,h=s.car.actualEndTime?new Date(s.car.actualEndTime):new Date,g=o?Math.floor((h.getTime()-o.getTime())/(1e3*60)):0,_={car_vin:s.car.vin||s.car.carCode,car_model:s.car.carModel,client_name:s.car.customerName,issue_description:s.car.notes||"Repair work completed",solution_description:`Completed ${s.car.workType} work on ${s.car.carModel}`,repair_steps:[`Started ${s.car.workType} work`,"Parts installed","Quality check completed","Work finished"],parts_used:s.car.partsHistory.map($=>({part_number:$.partNumber,part_name:$.partName,quantity:1,cost:0,supplier:"Monza Parts"})),technician_name:s.car.assignedMechanic||"Unassigned",repair_date:o?o.toISOString():new Date().toISOString(),completion_date:h.toISOString(),difficulty_level:"medium",labor_hours:g/60,total_cost:0,quality_rating:5,client_satisfaction:5,photos:[],before_photos:[],after_photos:[],repair_category:s.car.workType,warranty_period:12,follow_up_required:!1,follow_up_notes:""},N=!0;N&&(x({title:"Repair History Updated",description:`${s.car.carModel} repair data has been saved to repair history with ${s.car.partsHistory.length} parts and ${s.toolsRequired.length} tools used`}),console.log("Repair history saved successfully:",N))}catch(t){console.error("Error sending to repair history:",t),x({title:"Error",description:"Failed to save repair history data",variant:"destructive"})}},zs=s=>{const t=new Date,o=n.map(h=>h.car.id===s.car.id?{...h,isTimerRunning:!0,timerStartTime:t,car:{...h.car,actualStartTime:t.toISOString()}}:h);d(o),x({title:"Real-Time Timer Started",description:`Started minute-by-minute tracking for ${s.car.carModel}`})},Ws=s=>{const t=new Date,o=n.map(g=>g.car.id===s.car.id?{...g,isTimerRunning:!1,car:{...g.car,actualEndTime:t.toISOString()}}:g);d(o);const h=s.timerStartTime?Math.floor((t.getTime()-s.timerStartTime.getTime())/(1e3*60)):0;x({title:"Timer Stopped",description:`Completed work on ${s.car.carModel} in ${Re(h)}`})},Rt=()=>{c(!0)},Mt=(s,t)=>{if(E){if(!ir.usePart(s,1,{carVIN:E.car.carCode||E.car.vin||"UNKNOWN-CAR",employee:(i==null?void 0:i.name)||"Unknown",type:"scan",context:"schedule_repair"})){x({title:"Part Scan Failed",description:"Failed to process part scan. Check if part exists and has sufficient quantity.",variant:"destructive"}),b(!1),I(null);return}const h=n.map(g=>g.car.id===E.car.id?{...g,car:{...g.car,partsHistory:[...g.car.partsHistory,{partNumber:s,partName:t,scannedAt:new Date().toISOString(),scannedBy:(i==null?void 0:i.name)||"Unknown"}]}}:g);d(h),x({title:"Part Scanned",description:`${t} (${s}) added to ${E.car.carModel}. Inventory updated.`})}b(!1),I(null)},Ft=async s=>{try{console.log("VIN Scanned:",s);const t=await ke.findCarByVIN(s);if(!t){x({title:"Car Not Found",description:`No car found with VIN ${s} in any inventory`,variant:"destructive"}),c(!1);return}if(console.log("Found car data:",t),!await ke.updateCarStatus(s,"in_repair")){x({title:"Status Update Failed",description:"Failed to update car status in inventory tables",variant:"destructive"}),c(!1);return}if(!await ke.addCarToSchedule(t)){x({title:"Schedule Addition Failed",description:"Failed to add car to garage schedule",variant:"destructive"}),c(!1);return}ke.removeCarFromInventory(s,"Added to garage schedule via VIN scanner"),x({title:"Car Added to Schedule",description:`${t.carModel} (${s}) has been added to repair schedule and removed from all inventory locations`}),await rs(),c(!1)}catch(t){console.error("Error processing VIN scan:",t),x({title:"Error",description:"An error occurred while processing the VIN scan",variant:"destructive"}),c(!1)}},Ut=s=>{is(s),Ye(!0)},At=async s=>{try{if(!cr.saveRepairFromCompletion(s)){x({title:"Error",description:"Failed to save repair to history",variant:"destructive"});return}if(L){const o=L.car,h=o.vin||o.carCode;await ke.updateCarStatus(h,"completed");const g=n.filter(_=>_.car.id!==o.id);d(g),ks.recordScheduleChange(o.id,o.carCode,o.carModel,o.customerName,o.status,"completed",s.assignedMechanic,"completion",`Repair completed and documented. ${s.solutionDescription}`,{partsUsed:s.partsUsed.map(_=>_.partName),toolsUsed:s.toolsUsed,workNotes:s.mechanicNotes,actualDuration:`${s.totalLaborHours}h`,assignedMechanic:s.assignedMechanic}),x({title:"✅ Repair Completed",description:`Repair for ${o.carModel} (${o.carCode}) has been completed and documented in repair history.`})}Ye(!1),is(null)}catch(t){console.error("Error completing repair:",t),x({title:"Error",description:"An error occurred while completing the repair",variant:"destructive"})}},$t=async()=>{if(!V||!q){x({title:"Missing Information",description:"Please select a destination for the completed car",variant:"destructive"});return}try{const s=V.car,t=s.vin||s.carCode;let o;switch(q){case"floor1":o="in_stock";break;case"floor2":o="in_stock";break;case"garage":o="in_repair";break;case"car_inventory":o="in_stock";break;default:o="in_stock"}if(!await ke.updateCarStatus(t,o)){x({title:"Status Update Failed",description:"Failed to update car status in inventory",variant:"destructive"});return}if(!await ke.moveCarToDestination(t,q)){x({title:"Move Failed",description:"Failed to move car to selected destination",variant:"destructive"});return}await _t(V),await r(s.id,"completed"),x({title:"Repair Completed",description:`${s.carModel} has been completed and moved to ${Ot(q)}`}),await rs(),A(!1),Y(null),Se("")}catch(s){console.error("Error completing repair:",s),x({title:"Error",description:"An error occurred while completing the repair",variant:"destructive"})}},Ot=s=>{switch(s){case"floor1":return"Floor 1 Inventory";case"floor2":return"Floor 2 Inventory";case"garage":return"Garage Inventory";case"car_inventory":return"Car Inventory";default:return"Unknown Destination"}};return y?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-monza-yellow"}),e.jsx("span",{className:"ml-2",children:"Loading schedule data..."})]}):!n||n.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Garage Schedule - Repair Station"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive view of all scheduled cars with parts, tools, and work progress"})]})}),e.jsxs(Fe,{children:[e.jsx(Ue,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5"}),"Scheduled Cars (0)"]})}),e.jsx($e,{children:e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No cars scheduled for today. The schedule will appear here when cars are added."})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Garage Schedule - Repair Station"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive view of all scheduled cars with parts, tools, and work progress"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:Rt,className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[e.jsx(ws,{className:"h-4 w-4 mr-2"}),"Scan VIN"]}),e.jsxs(H,{className:"bg-green-100 text-green-700",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse mr-1"}),"Monza AI Enhanced"]})]})]}),e.jsxs(Fe,{children:[e.jsx(Ue,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5"}),"Scheduled Cars (",k.length,")"]})}),e.jsx($e,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Zt,{children:[e.jsx(Xt,{children:e.jsxs(tt,{children:[e.jsx(le,{children:"Car Info"}),e.jsx(le,{children:"Customer"}),e.jsx(le,{children:"Work Type"}),e.jsx(le,{children:"Assigned Worker"}),e.jsx(le,{children:"Expected Time"}),e.jsx(le,{children:"Progress"}),e.jsx(le,{children:"Parts Needed"}),e.jsx(le,{children:"Tools Required"}),e.jsx(le,{children:"Status"}),e.jsx(le,{children:"Notes"}),e.jsx(le,{children:"Software Model"}),e.jsx(le,{children:"Actions"})]})}),e.jsx(er,{children:n.map(s=>{try{return!s||!s.car||!s.car.id?(console.warn("Invalid carDetail in table row:",s),null):e.jsxs(tt,{className:"hover:bg-gray-50",children:[e.jsx(ce,{children:e.jsxs("div",{className:"space-y-1",children:[ye(s,"carModel",s.car.carModel),ye(s,"carCode",s.car.carCode),ye(s,"priority",s.car.priority,"select",["high","medium","low"])]})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-1",children:[ye(s,"customerName",s.car.customerName),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx(sr,{className:"h-3 w-3 inline mr-1"}),"Contact Info"]})]})}),e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[qs(s.car.workType),ye(s,"workType",s.car.workType,"select",["electrical","painter","detailer","mechanic","body_work"])]})}),e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4 text-blue-500"}),ye(s,"assignedMechanic",s.car.assignedMechanic||"Unassigned")]})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-1",children:[ye(s,"estimatedDuration",s.car.estimatedDuration),e.jsx("div",{className:"text-sm text-gray-500",children:"AI Estimated"})]})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(rt,{value:s.timeProgress.percentage,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"font-medium",children:[Re(s.timeProgress.elapsed)," / ",s.car.estimatedDuration,"h"]}),s.isTimerRunning&&e.jsx("div",{className:"text-green-600 font-semibold animate-pulse",children:"⏱️ Live tracking..."}),s.timeProgress.remaining>0&&!s.isTimerRunning&&e.jsxs("div",{className:"text-blue-600",children:[Re(s.timeProgress.remaining)," remaining"]})]}),s.timeProgress.isOverrunning&&e.jsxs(H,{className:"bg-red-100 text-red-700 text-xs",children:["⚠️ Overrunning by ",Re(s.timeProgress.elapsed-parseInt(s.car.estimatedDuration)*60)]}),s.isTimerRunning?e.jsx(l,{size:"sm",variant:"outline",onClick:()=>Ws(s),className:"h-7 w-7 p-0 bg-red-50 hover:bg-red-100",title:"Stop Timer",children:e.jsx(ut,{className:"h-3 w-3 text-red-600"})}):e.jsx(l,{size:"sm",variant:"outline",onClick:()=>zs(s),className:"h-7 w-7 p-0 bg-green-50 hover:bg-green-100",title:"Start Timer",children:e.jsx(os,{className:"h-3 w-3 text-green-600"})})]})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"AI Recommended:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.partsNeeded.slice(0,2).map((t,o)=>e.jsx(H,{variant:"outline",className:"text-xs cursor-pointer hover:bg-blue-50 hover:text-blue-700 transition-colors",onClick:()=>$s(s.car.id,t),children:t.partName},o)),s.partsNeeded.length>2&&e.jsxs(H,{variant:"outline",className:"text-xs cursor-pointer hover:bg-blue-50 hover:text-blue-700",onClick:()=>Et(s.car.id),children:["+",s.partsNeeded.length-2," more"]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(l,{size:"sm",variant:"outline",className:"h-6 px-2 text-xs",onClick:()=>As(s.car.id),children:[e.jsx(at,{className:"h-3 w-3 mr-1"}),"Add Part"]})}),s.car.partsHistory.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-500 mt-2 mb-1",children:"Scanned Parts:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.car.partsHistory.slice(0,2).map((t,o)=>e.jsx(H,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:t.partName},o)),s.car.partsHistory.length>2&&e.jsxs(H,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:["+",s.car.partsHistory.length-2," more"]})]})]})]})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"AI Recommended:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.toolsRequired.slice(0,2).map((t,o)=>e.jsx(H,{variant:"outline",className:"text-xs cursor-pointer hover:bg-blue-50 hover:text-blue-700 transition-colors",onClick:()=>Os(s.car.id,t),children:t.toolName},o)),s.toolsRequired.length>2&&e.jsxs(H,{variant:"outline",className:"text-xs cursor-pointer hover:bg-blue-50 hover:text-blue-700",onClick:()=>It(s.car.id),children:["+",s.toolsRequired.length-2," more"]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(l,{size:"sm",variant:"outline",className:"h-6 px-2 text-xs",onClick:()=>Us(s.car.id),children:[e.jsx(at,{className:"h-3 w-3 mr-1"}),"Add Tool"]})})]})}),e.jsx(ce,{children:ye(s,"status",s.car.status,"select",["pending","scheduled","in_progress","completed","delayed"])}),e.jsx(ce,{children:ye(s,"notes",s.car.notes||"Add notes...")}),e.jsx(ce,{children:e.jsx(vr,{softwareVersion:s.car.softwareVersion,softwareLastUpdated:s.car.softwareLastUpdated,softwareUpdateBy:s.car.softwareUpdateBy,softwareUpdateNotes:s.car.softwareUpdateNotes,compact:!0,editable:!0,carId:s.car.id,onSave:t=>{Pt(s.car.id,t)}})}),e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{R(s),M(!0)},className:"h-7 w-7 p-0",title:"View Details",children:e.jsx(pt,{className:"h-3 w-3"})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{var o,h,g,_,N,$,Me,fe;const t={id:((o=s==null?void 0:s.car)==null?void 0:o.id)||(s==null?void 0:s.carId)||(s==null?void 0:s.id),vinNumber:((h=s==null?void 0:s.car)==null?void 0:h.vinNumber)||((g=s==null?void 0:s.car)==null?void 0:g.vin)||(s==null?void 0:s.vinNumber)||(s==null?void 0:s.vin),model:((_=s==null?void 0:s.car)==null?void 0:_.carModel)||((N=s==null?void 0:s.car)==null?void 0:N.model)||(s==null?void 0:s.carModel)||(s==null?void 0:s.model),arrivalDate:(($=s==null?void 0:s.car)==null?void 0:$.arrivalDate)||new Date().toISOString(),category:((Me=s==null?void 0:s.car)==null?void 0:Me.category)||"EV",status:((fe=s==null?void 0:s.car)==null?void 0:fe.status)||"in_stock"};oe(t),Promise.resolve().then(()=>j(!0))},type:"button",className:"h-7 w-7 p-0",title:"Test Drive",children:e.jsx(hr,{className:"h-3 w-3"})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{oe(s.car),F(!0)},className:"h-7 w-7 p-0",title:"PDI Check",children:e.jsx(tr,{className:"h-3 w-3"})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{I(s),b(!0)},className:"h-7 w-7 p-0",title:"Scan Part",children:e.jsx(Ns,{className:"h-3 w-3"})}),s.car.status==="scheduled"&&e.jsx(l,{size:"sm",variant:"outline",onClick:()=>as(s.car.id,"in_progress"),className:"h-7 w-7 p-0 bg-green-50 hover:bg-green-100",title:"Start Work",children:e.jsx(os,{className:"h-3 w-3 text-green-600"})}),s.car.status==="in_progress"&&e.jsx(l,{size:"sm",variant:"outline",onClick:()=>as(s.car.id,"completed"),className:"h-7 w-7 p-0 bg-blue-50 hover:bg-blue-100",title:"Complete Work",children:e.jsx(vt,{className:"h-3 w-3 text-blue-600"})}),s.car.status==="completed"&&e.jsx(l,{size:"sm",variant:"outline",onClick:()=>Ut(s),className:"h-7 w-7 p-0 bg-green-50 hover:bg-green-100",title:"Complete Repair & Move Car",children:e.jsx(ys,{className:"h-3 w-3 text-green-600"})}),s.car.status==="pending"&&e.jsx(l,{size:"sm",variant:"outline",onClick:()=>as(s.car.id,"scheduled"),className:"h-7 w-7 p-0 bg-orange-50 hover:bg-orange-100",title:"Mark Scheduled",children:e.jsx(js,{className:"h-3 w-3 text-orange-600"})}),s.car.status==="delayed"&&e.jsx(l,{size:"sm",variant:"outline",onClick:()=>as(s.car.id,"in_progress"),className:"h-7 w-7 p-0 bg-yellow-50 hover:bg-yellow-100",title:"Resume Work",children:e.jsx(os,{className:"h-3 w-3 text-yellow-600"})})]})})]},s.car.id)}catch(t){return console.error("Error rendering table row:",t),null}})})]})})})]}),e.jsx(ee,{open:T,onOpenChange:j,children:e.jsx(ot,{container:typeof document<"u"?document.getElementById("modals-root"):void 0,children:e.jsxs(se,{className:"calendar-dialog-fix z-extreme max-w-xl w-[min(700px,95vw)]",overlayClassName:"bg-black/50",onOpenAutoFocus:s=>{s.preventDefault(),setTimeout(()=>{const t=document.getElementById("testDriveDate");if(t&&t.focus)try{t.focus({preventScroll:!0})}catch{t.focus()}},0)},children:[e.jsxs(te,{children:[e.jsxs(re,{children:["Test Drive - ",(f==null?void 0:f.model)||(f==null?void 0:f.carModel)]}),e.jsx(ne,{children:"Schedule and manage test drive for this vehicle"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"calendar-input-container",children:[e.jsx(S,{htmlFor:"testDriveDate",children:"Test Drive Date"}),e.jsx("div",{className:"relative",children:e.jsx(G,{id:"testDriveDate",type:"datetime-local",className:"calendar-fix"})})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"driverName",children:"Driver"}),e.jsx(G,{id:"driverName",placeholder:"Driver name"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"testDriveDuration",children:"Duration (minutes)"}),e.jsx(G,{id:"testDriveDuration",type:"number",placeholder:"30"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"testDriveNotes",children:"Notes"}),e.jsx(Oe,{id:"testDriveNotes",placeholder:"Test drive notes..."})]})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(l,{onClick:()=>{x({title:"Test Drive Scheduled",description:`Test drive scheduled for ${(f==null?void 0:f.model)||(f==null?void 0:f.carModel)}`}),j(!1)},children:"Schedule Test Drive"})]})]})})}),K&&e.jsxs("div",{className:"fixed top-16 right-0 h-[calc(100vh-4rem)] w-full max-w-md bg-white border-l border-gray-200 shadow-xl z-[2147483001] flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Test Drive"}),e.jsx("div",{className:"text-lg font-semibold",children:(f==null?void 0:f.carModel)||"Vehicle"})]}),e.jsx("button",{type:"button",className:"h-9 px-3 border rounded-md",onClick:()=>we(!1),children:"Close"})]}),e.jsxs("div",{className:"p-4 space-y-4 overflow-auto",children:[(f==null?void 0:f.testDriveStartTime)&&e.jsxs("div",{className:"rounded-md border border-gray-200 p-3 bg-gray-50",children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Previous Test Drive"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("div",{children:["Start: ",new Date(f.testDriveStartTime).toLocaleString()]}),typeof f.testDriveDuration=="number"?e.jsxs("div",{children:["Duration: ",f.testDriveDuration," min"]}):e.jsxs("div",{children:["Duration: ",Math.max(1,Math.floor((Date.now()-new Date(f.testDriveStartTime).getTime())/6e4))," min (running)"]}),f.testDriveDriver&&e.jsxs("div",{children:["Driver: ",f.testDriveDriver]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"td-date",className:"block text-sm font-medium",children:"Date & Time"}),e.jsx("input",{id:"td-date",type:"datetime-local",value:ve,onChange:s=>Ve(s.target.value),className:"mt-1 w-full h-12 border px-4 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"td-driver",className:"block text-sm font-medium",children:"Driver"}),e.jsx("input",{id:"td-driver",value:be,onChange:s=>Pe(s.target.value),placeholder:"Driver name",className:"mt-1 w-full h-12 border px-4 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"td-duration",className:"block text-sm font-medium",children:"Duration (minutes)"}),e.jsx("input",{id:"td-duration",type:"number",min:5,value:Ce,onChange:s=>De(Number(s.target.value)),className:"mt-1 w-full h-12 border px-4 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"td-notes",className:"block text-sm font-medium",children:"Notes"}),e.jsx("textarea",{id:"td-notes",value:J,onChange:s=>D(s.target.value),placeholder:"Notes…",className:"mt-1 w-full min-h-[100px] border px-4 py-3 rounded-md"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",className:"h-10 px-4 border rounded-md",onClick:()=>we(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"h-10 px-4 rounded-md bg-monza-yellow text-monza-black",onClick:()=>{f&&(d(s=>s.map(t=>{var g;if((((g=t==null?void 0:t.car)==null?void 0:g.id)||(t==null?void 0:t.carId)||(t==null?void 0:t.id))!==f.id)return t;const h={...t};return h.car={...t.car,testDriveStatus:"on_test_drive",testDriveDriver:be,testDriveStartTime:ve||new Date().toISOString(),testDriveDuration:Ce},h})),x({title:"Test Drive Scheduled",description:"Vehicle remains in Schedule. Test drive info saved."}),we(!1))},children:"Save"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Status: ",e.jsx("span",{className:"font-medium",children:(f==null?void 0:f.testDriveStatus)||"available"})]})]})]}),f&&e.jsx(rr,{car:{id:f.id,model:f.carModel,year:new Date().getFullYear(),color:"",arrivalDate:new Date().toISOString(),status:"in_stock",vinNumber:f.vin||f.vinNumber||""},isOpen:U,onClose:()=>F(!1),onSave:()=>F(!1)}),e.jsx(ee,{open:ue,onOpenChange:z,children:e.jsx(ot,{container:typeof document<"u"?document.getElementById("modals-root"):void 0,children:e.jsxs(se,{className:"z-extreme",overlayClassName:"bg-black/50",children:[e.jsxs(te,{children:[e.jsxs(re,{children:["Customs - ",f==null?void 0:f.carModel]}),e.jsx(ne,{children:"Manage customs documentation and status"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"customsStatus",children:"Customs Status"}),e.jsx(mt,{value:"",onValueChange:()=>{},options:[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"paid",label:"Paid"}],placeholder:"Select status...",searchable:!1})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"customsDocumentation",children:"Documentation"}),e.jsx(G,{id:"customsDocumentation",placeholder:"Document reference"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"customsNotes",children:"Notes"}),e.jsx(Oe,{id:"customsNotes",placeholder:"Customs notes..."})]})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:()=>z(!1),children:"Cancel"}),e.jsx(l,{onClick:()=>{x({title:"Customs Updated",description:`Customs status updated for ${f==null?void 0:f.carModel}`}),z(!1)},children:"Update Customs"})]})]})})}),e.jsx(gr,{isOpen:He,onClose:()=>c(!1),onVinScanned:(s,t)=>{Ft(s.vin)}}),e.jsx(ee,{open:w,onOpenChange:b,children:e.jsxs(se,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsx(re,{children:"Scan Part Number"}),e.jsxs(ne,{children:["Scan part number for ",E==null?void 0:E.car.carModel]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:[e.jsx(de,{className:"h-12 w-12 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"OCR Camera Scanner"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Point camera at part number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"partNumber",children:"Part Number"}),e.jsx(G,{id:"partNumber",placeholder:"Enter part number manually or scan..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"partName",children:"Part Name"}),e.jsx(G,{id:"partName",placeholder:"Part name..."})]})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(l,{onClick:()=>Mt("PN123456","Brake Pad"),children:"Add Part to Car"})]})]})}),e.jsx(ee,{open:qe,onOpenChange:Ee,children:e.jsxs(se,{className:"max-w-xl",children:[e.jsxs(te,{children:[e.jsx(re,{children:"Add New Tool"}),e.jsx(ne,{children:"Add a new tool to the tools list"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(l,{variant:pe?"outline":"default",onClick:()=>{pe&&Ke()},className:"w-full rounded-none",children:"Manual Entry"}),e.jsx(l,{variant:pe?"default":"outline",onClick:async()=>{pe||await _s()},className:"w-full rounded-none",children:"Scan Tool Number"})]}),!pe&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"tool-name-input",children:"Tool Number or Name"}),e.jsx(G,{id:"tool-name-input",placeholder:"Enter tool number or name...",value:W,onChange:s=>{ie(s.target.value)},onKeyDown:s=>{s.key==="Enter"?ss():s.key==="Escape"&&ge()},autoFocus:!0,className:"w-full h-12 px-5 py-3 text-base text-center rounded-none"})]}),pe&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"aspect-video bg-slate-100 border",children:[e.jsx("video",{ref:_e,className:"w-full h-full object-cover",playsInline:!0,muted:!0}),e.jsx("canvas",{ref:es,className:"hidden"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",onClick:Ke,className:"flex-1",children:"Cancel"}),e.jsx(l,{onClick:Rs,className:"flex-1",children:"Capture & Scan"})]}),W&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Detected: ",e.jsx("span",{className:"font-mono",children:W})]})]})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:ge,children:"Cancel"}),e.jsx(l,{onClick:ss,disabled:!W.trim(),children:"Add Tool"})]})]})}),e.jsx(ee,{open:C,onOpenChange:P,children:e.jsxs(se,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsx(re,{children:"Add New Part"}),e.jsx(ne,{children:"Add a new part to the parts list"})]}),e.jsxs("div",{className:"space-y-4",children:[pe?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Part Scanner"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Point camera at QR code or barcode"})]}),e.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden aspect-video",children:Ne?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:_e,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"border-2 border-blue-500 bg-transparent w-48 h-32 rounded-lg opacity-80",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-l-2 border-t-2 border-blue-500"}),e.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-r-2 border-t-2 border-blue-500"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-l-2 border-b-2 border-blue-500"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-r-2 border-b-2 border-blue-500"})]})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(de,{className:"mx-auto h-8 w-8 mb-2 opacity-60"}),e.jsx("p",{className:"text-sm opacity-80",children:"Starting camera..."})]})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{onClick:Rs,disabled:!Ne,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Scan Now"]}),e.jsx(l,{variant:"outline",onClick:Ke,className:"px-4",children:e.jsx(Te,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"text-xs text-center text-gray-500",children:'Position the QR code or barcode within the blue frame and click "Scan Now"'})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"part-name-input",children:"Part Name"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{id:"part-name-input",placeholder:"Enter part name...",value:W,onChange:s=>{console.log("Input changed:",s.target.value),ie(s.target.value)},onKeyDown:s=>{s.key==="Enter"?ss():s.key==="Escape"&&ge()},autoFocus:!0,className:"flex-1"}),e.jsx(l,{type:"button",variant:"outline",onClick:_s,className:"px-3",title:"Scan QR Code",children:e.jsx(ws,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Ns,{className:"h-3 w-3"}),"Click the QR icon to scan part barcodes or QR codes"]})]}),e.jsx("canvas",{ref:es,style:{display:"none"}})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:ge,children:"Cancel"}),e.jsx(l,{onClick:ss,disabled:!W.trim(),children:"Add Part"})]})]})}),e.jsx(ee,{open:jt,onOpenChange:ls,children:e.jsxs(se,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsx(re,{children:"Edit Part"}),e.jsx(ne,{children:"Edit or delete this part from the parts list"})]}),e.jsxs("div",{className:"space-y-4",children:[Xe?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium mb-2",children:"OCR Part Scanner"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Point camera at part label or barcode for OCR scanning"})]}),e.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden aspect-video",children:Ne?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:Ge,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"border-2 border-green-500 bg-transparent w-64 h-40 rounded-lg opacity-90",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:"absolute top-0 left-0 w-5 h-5 border-l-2 border-t-2 border-green-500"}),e.jsx("div",{className:"absolute top-0 right-0 w-5 h-5 border-r-2 border-t-2 border-green-500"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-5 h-5 border-l-2 border-b-2 border-green-500"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-5 h-5 border-r-2 border-b-2 border-green-500"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"bg-green-500 bg-opacity-20 px-2 py-1 rounded text-white text-xs font-medium",children:"OCR SCAN AREA"})})]})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(de,{className:"mx-auto h-10 w-10 mb-2 opacity-60"}),e.jsx("p",{className:"text-sm opacity-80",children:"Starting OCR camera..."})]})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{onClick:St,disabled:!Ne,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Scan with OCR"]}),e.jsx(l,{variant:"outline",onClick:fs,className:"px-4",children:e.jsx(Te,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"text-xs text-center text-gray-500",children:'Position part label or barcode within the green frame and click "Scan with OCR"'}),Q&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Original Part:"})," ",Q.partNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Quantity:"})," ",Q.quantity]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"edit-part-name-input",children:"Part Name"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{id:"edit-part-name-input",placeholder:"Enter part name...",value:W,onChange:s=>{console.log("Edit input changed:",s.target.value),ie(s.target.value)},onKeyDown:s=>{s.key==="Enter"?ts():s.key==="Escape"&&ge()},autoFocus:!0,className:"flex-1"}),e.jsx(l,{type:"button",variant:"outline",onClick:Ct,className:"px-3",title:"Scan with OCR Camera",children:e.jsx(de,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),"Click the camera icon to scan part labels with OCR"]}),Q&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Part Number:"})," ",Q.partNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Quantity:"})," ",Q.quantity]})]})]}),e.jsx("canvas",{ref:gs,style:{display:"none"}})]}),e.jsxs(ae,{className:"flex justify-between",children:[e.jsx(l,{variant:"destructive",onClick:Vs,className:"mr-auto",children:"Delete Part"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",onClick:ge,children:"Cancel"}),e.jsx(l,{onClick:ts,disabled:!W.trim(),children:"Save Changes"})]})]})]})}),e.jsx(ee,{open:Nt,onOpenChange:cs,children:e.jsxs(se,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsx(re,{children:"Edit Tool"}),e.jsx(ne,{children:"Edit or delete this tool from the tools list"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"edit-tool-name-input",children:"Tool Name"}),e.jsx(G,{id:"edit-tool-name-input",placeholder:"Enter tool name...",value:W,onChange:s=>{console.log("Edit input changed:",s.target.value),ie(s.target.value)},onKeyDown:s=>{s.key==="Enter"?ts():s.key==="Escape"&&ge()},autoFocus:!0,className:"w-full"})]}),Q&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tool Type:"})," ",Q.toolType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Required:"})," ",Q.isRequired?"Yes":"No"]})]})]}),e.jsxs(ae,{className:"flex justify-between",children:[e.jsx(l,{variant:"destructive",onClick:Vs,className:"mr-auto",children:"Delete Tool"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",onClick:ge,children:"Cancel"}),e.jsx(l,{onClick:ts,disabled:!W.trim(),children:"Save Changes"})]})]})]})}),e.jsx(ee,{open:yt,onOpenChange:Be,children:e.jsxs(se,{className:"max-w-2xl",children:[e.jsxs(te,{children:[e.jsx(re,{children:"All Parts"}),e.jsx(ne,{children:"All parts for this car. Click any part to edit or delete it."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(Gs=n.find(s=>s.car.id===xe))==null?void 0:Gs.partsNeeded.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.partName}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Part #: ",s.partNumber]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Qty: ",s.quantity]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{Be(!1),$s(xe,s)},children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>{const o=n.map(h=>{if(h.car.id===xe){const g=h.partsNeeded.filter(_=>_!==s);return{...h,partsNeeded:g}}return h});d(o),x({title:"Part Deleted",description:`${s.partName} removed from the parts list`})},children:"Delete"})]})]},t))}),((Ds=n.find(s=>s.car.id===xe))==null?void 0:Ds.partsNeeded.length)===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No parts available. Click "Add Part" to add new parts.'})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:()=>Be(!1),children:"Close"}),e.jsx(l,{onClick:()=>{Be(!1),As(xe)},children:"Add New Part"})]})]})}),e.jsx(ee,{open:wt,onOpenChange:ze,children:e.jsxs(se,{className:"max-w-2xl",children:[e.jsxs(te,{children:[e.jsx(re,{children:"All Tools"}),e.jsx(ne,{children:"All tools for this car. Click any tool to edit or delete it."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(Qs=n.find(s=>s.car.id===xe))==null?void 0:Qs.toolsRequired.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.toolName}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Type: ",s.toolType]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Required: ",s.isRequired?"Yes":"No"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{ze(!1),Os(xe,s)},children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>{const o=n.map(h=>{if(h.car.id===xe){const g=h.toolsRequired.filter(_=>_!==s);return{...h,toolsRequired:g}}return h});d(o),x({title:"Tool Deleted",description:`${s.toolName} removed from the tools list`})},children:"Delete"})]})]},t))}),((Ys=n.find(s=>s.car.id===xe))==null?void 0:Ys.toolsRequired.length)===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No tools available. Click "Add Tool" to add new tools.'})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:()=>ze(!1),children:"Close"}),e.jsx(l,{onClick:()=>{ze(!1),Us(xe)},children:"Add New Tool"})]})]})}),e.jsx(ee,{open:p,onOpenChange:M,children:e.jsxs(se,{className:"max-w-4xl h-[90vh] flex flex-col",children:[e.jsxs(te,{className:"flex-shrink-0 pb-4 border-b",children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5"}),"Car Details - ",m==null?void 0:m.car.carModel]}),e.jsx(ne,{children:"Comprehensive view of all car information, work progress, and details"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2",style:{scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"},children:m&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Car Model:"}),e.jsx("span",{children:m.car.carModel})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Car Code:"}),e.jsx("span",{children:m.car.carCode})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"VIN:"}),e.jsx("span",{children:m.car.vin||"Not available"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Customer:"}),e.jsx("span",{children:m.car.customerName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Priority:"}),e.jsx(H,{className:Bs(m.car.priority),variant:"outline",children:m.car.priority.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx(H,{className:Ls(m.car.status),children:m.car.status.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Work Type:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[qs(m.car.workType),e.jsx("span",{children:m.car.workType.replace("_"," ").toUpperCase()})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Assigned Mechanic:"}),e.jsx("span",{children:m.car.assignedMechanic||"Unassigned"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Estimated Duration:"}),e.jsxs("span",{children:[m.car.estimatedDuration," hours"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold border-b pb-2",children:"Work Progress"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Progress:"}),e.jsxs("span",{children:[m.timeProgress.percentage,"%"]})]}),e.jsx(rt,{value:m.timeProgress.percentage,className:"h-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Elapsed Time:"}),e.jsx("span",{children:Re(m.timeProgress.elapsed)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Remaining Time:"}),e.jsx("span",{children:Re(m.timeProgress.remaining)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Timer Status:"}),e.jsx("span",{className:m.isTimerRunning?"text-green-600 font-semibold":"text-gray-600",children:m.isTimerRunning?"⏱️ Running":"⏸️ Stopped"})]}),m.timeProgress.isOverrunning&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Overrun:"}),e.jsxs(H,{className:"bg-red-100 text-red-700",children:["⚠️ ",Re(m.timeProgress.elapsed-parseInt(m.car.estimatedDuration)*60)]})]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Timer Controls"}),e.jsx("div",{className:"flex gap-2",children:m.isTimerRunning?e.jsxs(l,{onClick:()=>Ws(m),className:"bg-red-50 hover:bg-red-100 text-red-700",children:[e.jsx(ut,{className:"h-4 w-4 mr-2"}),"Stop Timer"]}):e.jsxs(l,{onClick:()=>zs(m),className:"bg-green-50 hover:bg-green-100 text-green-700",children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"Start Timer"]})})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Parts Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"AI Recommended Parts:"}),e.jsx("div",{className:"space-y-2",children:m.partsNeeded.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{children:s.partName}),e.jsx(H,{variant:"outline",className:"text-xs",children:s.partNumber})]},t))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Scanned Parts:"}),e.jsx("div",{className:"space-y-2",children:m.car.partsHistory.length>0?m.car.partsHistory.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded",children:[e.jsx("span",{children:s.partName}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.scannedAt).toLocaleDateString()})]},t)):e.jsx("div",{className:"text-gray-500 text-sm",children:"No parts scanned yet"})})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Tools Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Required Tools:"}),e.jsx("div",{className:"space-y-2",children:m.toolsRequired.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded",children:[e.jsx("span",{children:s.toolName}),e.jsx(H,{variant:"outline",className:"text-xs",children:s.toolType})]},t))})]})})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"AI Recommendations"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Expected Time:"}),e.jsx("span",{children:m.aiRecommendations.expectedTime})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:m.aiRecommendations.notes})]})]})]}),m.car.notes&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Work Notes"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded",children:e.jsx("p",{className:"text-sm",children:m.car.notes})})]})]})}),e.jsxs(ae,{className:"flex-shrink-0 pt-4 border-t",children:[e.jsx(l,{variant:"outline",onClick:()=>M(!1),children:"Close"}),e.jsx(l,{onClick:()=>{M(!1)},children:"Export Details"})]})]})}),e.jsx(ee,{open:O,onOpenChange:A,children:e.jsxs(se,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5 text-green-600"}),"Complete Repair & Move Car"]}),e.jsx(ne,{children:"Choose where to send the completed car after repair"})]}),e.jsxs("div",{className:"space-y-4",children:[V&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:V.car.carModel}),e.jsxs("p",{className:"text-sm text-blue-700",children:["VIN: ",V.car.vin||V.car.carCode]}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Status: ",V.car.status]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(S,{className:"text-sm font-medium",children:"Select Destination:"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(l,{variant:q==="floor1"?"default":"outline",onClick:()=>Se("floor1"),className:"justify-start h-auto p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(nt,{className:"h-5 w-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Floor 1 Inventory"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Showroom Floor 1"})]})]})}),e.jsx(l,{variant:q==="floor2"?"default":"outline",onClick:()=>Se("floor2"),className:"justify-start h-auto p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(nt,{className:"h-5 w-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Floor 2 Inventory"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Showroom Floor 2"})]})]})}),e.jsx(l,{variant:q==="garage"?"default":"outline",onClick:()=>Se("garage"),className:"justify-start h-auto p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(it,{className:"h-5 w-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Garage Inventory"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Keep in garage for further work"})]})]})}),e.jsx(l,{variant:q==="car_inventory"?"default":"outline",onClick:()=>Se("car_inventory"),className:"justify-start h-auto p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ns,{className:"h-5 w-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Car Inventory"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Main car inventory system"})]})]})})]})]})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsxs(l,{onClick:$t,disabled:!q,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ys,{className:"h-4 w-4 mr-2"}),"Complete & Move"]})]})]})}),e.jsx(jr,{isOpen:Ie,onClose:()=>{Ye(!1),is(null)},carDetails:L?{id:L.car.id,carCode:L.car.carCode,carModel:L.car.carModel,customerName:L.car.customerName,assignedMechanic:L.car.assignedMechanic,workType:L.car.workType,status:L.car.status,issueDescription:L.car.issueDescription||L.car.notes||"",partsUsed:L.car.partsUsed||[],toolsUsed:L.car.toolsUsed||[],estimatedDuration:L.car.estimatedDuration,actualDuration:L.car.actualDuration,startTime:L.car.startTime,endTime:L.car.actualEndTime}:null,onSubmit:At})]})},Fr=()=>{var d;const{todaySchedule:k,today:r,saveSchedules:a,schedules:i}=pr(),n=(y,v)=>{var M;const m=k;if(!m)return;const R={...m,scheduledCars:((M=m.scheduledCars)==null?void 0:M.map(T=>T.id===y?{...T,status:v}:T))||[]},p=i.map(T=>T.id===m.id?R:T);a(p)};return e.jsx("div",{className:"p-6 garage-schedule-container",children:e.jsxs("div",{className:"garage-schedule-content",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Garage Schedule"}),e.jsxs("p",{className:"text-gray-600",children:["Today: ",r]}),e.jsxs("p",{className:"text-gray-600",children:["Cars scheduled: ",((d=k==null?void 0:k.scheduledCars)==null?void 0:d.length)||0]})]}),e.jsx("div",{className:"garage-schedule-table-container",children:e.jsx(Nr,{scheduledCars:(k==null?void 0:k.scheduledCars)||[],onStatusUpdate:n,onViewDetails:()=>{}})})]})})};export{Fr as default};
