import{r as i,s as B,t as c,u as qe,j as t,B as b,C as ce,A as He,a as q,Q as ze,b as Je,c as Qe,d as Ge,e as me,X as ue,T as Ke,f as We,g as Ye,h as Xe,i as ge,k as y,l as Ze,m as x,W as et,n as tt,F as rt,o as st,M as at,p as ot,P as nt,V as it,D as lt,q as dt,v as ct,w as mt,L as _,I as O,E as ut,x as gt,y as ht,z as pt,G as vt,H as ft,J as yt,K as xt,N as wt,O as X}from"./index-BjC2zLSq.js";import{C as Dt}from"./CarHistoryDetailsDialog-Dx7iiGdW.js";import"./scroll-area-JbdFLxxb.js";import"./enhancedRepairHistoryService-EjGHomAS.js";import"./test-tube-Copberli.js";const St=()=>({connectedUsers:[],currentPageUsers:[],isConnected:!1,broadcastUpdate:async()=>{},updateUserStatus:async()=>{},subscribe:()=>()=>{}});function Ct(){const[s,S]=i.useState([]),[k,w]=i.useState(!0),[I,h]=i.useState(null),[E,F]=i.useState("cars"),{subscribe:D}=St(),V=async()=>{try{w(!0),h(null);let{data:u,error:m}=await B.from("cars").select("*").order("created_at",{ascending:!1});if(m){const g=await B.from("car_inventory").select("*").order("created_at",{ascending:!1});if(g.error)throw m;F("car_inventory"),u=g.data}else F("cars");S(u||[])}catch(u){h(u instanceof Error?u.message:"Failed to fetch cars"),console.error("Error fetching cars:",u)}finally{w(!1)}},U=async u=>{try{const{data:m,error:g}=await B.from(E).insert([u]).select().single();if(g)throw g;return S(o=>[m,...o]),m}catch(m){return h(m instanceof Error?m.message:"Failed to add car"),console.error("Error adding car:",m),null}},H=async(u,m)=>{try{const{data:g,error:o}=await B.from(E).update({...m,updated_at:new Date().toISOString()}).eq("id",u).select().single();if(o)throw o;return S(n=>n.map(l=>l.id===u?g:l)),g}catch(g){return h(g instanceof Error?g.message:"Failed to update car"),console.error("Error updating car:",g),null}},L=async u=>{try{const{error:m}=await B.from(E).delete().eq("id",u);if(m)throw m;return S(g=>g.filter(o=>o.id!==u)),!0}catch(m){return h(m instanceof Error?m.message:"Failed to delete car"),console.error("Error deleting car:",m),!1}},z=async()=>{await V()};return i.useEffect(()=>{V()},[]),i.useEffect(()=>D(),[D]),{cars:s,loading:k,error:I,refetch:z,addCar:U,updateCar:H,deleteCar:L}}const Z=s=>({id:s.id,vinNumber:s.vin_number||s.vinNumber,model:s.model,brand:s.brand,year:s.year,color:s.color,interiorColor:s.interior_color||s.interiorColor,category:s.category,status:s.status,currentFloor:s.current_location||s.currentLocation||s.currentFloor,arrivalDate:s.arrival_date||s.arrivalDate||new Date().toISOString(),soldDate:s.sold_date||s.soldDate,reservedDate:s.reserved_date||s.reservedDate,sellingPrice:s.selling_price||s.sellingPrice,batteryPercentage:s.battery_percentage||s.batteryPercentage,pdiCompleted:s.pdi_completed||s.pdiCompleted,inShowroom:s.in_showroom||s.inShowroom,showroomNote:s.showroom_note||s.showroomNote,showroomEntryDate:s.showroom_entry_date||s.showroomEntryDate,showroomExitDate:s.showroom_exit_date||s.showroomExitDate,clientName:s.client_name||s.clientName,clientPhone:s.client_phone||s.clientPhone,clientLicensePlate:s.client_license_plate||s.clientLicensePlate,clientEmail:s.client_email||s.clientEmail,clientAddress:s.client_address||s.clientAddress,pdiTechnician:s.pdi_technician||s.pdiTechnician,pdiNotes:s.pdi_notes||s.pdiNotes,pdiPhotos:s.pdi_photos||s.pdiPhotos,pdiDate:s.pdi_date||s.pdiDate,notes:s.notes,lastUpdated:s.last_updated||s.lastUpdated||new Date().toISOString()}),jt=()=>{const{cars:s,loading:S,error:k,addCar:w,updateCar:I,refetch:h}=Ct(),[E,F]=i.useState([]),[D,V]=i.useState(!1);return i.useEffect(()=>{if(!S&&!D){let o=[];if(s&&s.length>0)o=s.map(Z),console.log(`Car Inventory: Loaded ${o.length} cars from Supabase`);else try{const n=localStorage.getItem("carInventory"),l=localStorage.getItem("showroomFloor1Cars"),j=localStorage.getItem("showroomFloor2Cars"),J=localStorage.getItem("garageCars"),M=localStorage.getItem("inventoryFloor2Cars"),Q=[...n?JSON.parse(n):[],...l?JSON.parse(l):[],...j?JSON.parse(j):[],...J?JSON.parse(J):[],...M?JSON.parse(M):[]];Q.length>0?(o=Q.map(Z),console.log(`Car Inventory: Loaded ${o.length} cars from localStorage fallback`)):console.log("Car Inventory: No data found in Supabase or localStorage")}catch(n){console.error("Error loading from localStorage:",n)}F(o),V(!0)}},[s,S,D]),i.useEffect(()=>{if(D&&s&&s.length>0){const o=s.map(Z);F(o)}},[s,D]),{cars:E,loading:S,error:k,handleStatusUpdate:async(o,n)=>{try{const l={status:n,soldDate:n==="sold"?new Date().toISOString():void 0,reservedDate:n==="reserved"?new Date().toISOString():void 0,lastUpdated:new Date().toISOString()};await I(o,l),c({title:"Status Updated",description:`Car status updated to ${n.replace("_"," ")}.`})}catch(l){console.error("Error updating car status:",l),c({title:"Update Failed",description:"Failed to update car status. Please try again.",variant:"destructive"})}},handleShowroomToggle:async(o,n,l)=>{try{const j={inShowroom:n,showroomNote:l,showroomEntryDate:n?new Date().toISOString():void 0,showroomExitDate:n?void 0:new Date().toISOString(),lastUpdated:new Date().toISOString()};await I(o,j),c({title:"Showroom Status Updated",description:`Car ${n?"added to":"removed from"} showroom.`})}catch(j){console.error("Error updating showroom status:",j),c({title:"Update Failed",description:"Failed to update showroom status. Please try again.",variant:"destructive"})}},handleClientInfoSave:async(o,n)=>{try{const l={...n,lastUpdated:new Date().toISOString()};await I(o,l),c({title:"Client Information Saved",description:"Client information has been updated successfully."})}catch(l){console.error("Error saving client info:",l),c({title:"Save Failed",description:"Failed to save client information. Please try again.",variant:"destructive"})}},handlePdiComplete:async(o,n)=>{try{const l={pdiCompleted:!0,pdiTechnician:n.technician,pdiNotes:n.notes,pdiPhotos:n.photos,pdiDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};await I(o,l),c({title:"PDI Completed",description:`PDI completed successfully by ${n.technician}.`})}catch(l){console.error("Error completing PDI:",l),c({title:"PDI Update Failed",description:"Failed to complete PDI. Please try again.",variant:"destructive"})}},handleCarUpdate:async(o,n)=>{try{const l={...n,lastUpdated:new Date().toISOString()};await I(o,l),c({title:"Car Updated",description:"Car information has been updated successfully."})}catch(l){console.error("Error updating car:",l),c({title:"Update Failed",description:"Failed to update car information. Please try again.",variant:"destructive"})}},addCarQuick:async o=>{const n={vin_number:o.vinNumber,model:o.model,brand:o.brand,year:o.year,color:o.color,interior_color:o.interiorColor,category:o.category,status:o.status||"in_stock",arrival_date:o.arrivalDate||new Date().toISOString(),selling_price:o.sellingPrice??o.price,battery_percentage:o.batteryPercentage,pdi_completed:o.pdiCompleted,notes:o.notes};return Object.keys(n).forEach(l=>{n[l]===void 0&&delete n[l]}),await w(n)},loadCars:async()=>{try{await h()}catch(o){console.error("Error loading cars:",o),c({title:"Load Failed",description:"Failed to load car inventory. Please refresh the page.",variant:"destructive"})}}}},Tt=()=>{const{cars:s,handleCarUpdate:S,addCarQuick:k}=jt(),w=s.map(e=>{let r="in_stock";e.status==="sold"?r="sold":e.status==="reserved"?r="reserved":r="in_stock";const p=["EV","REV","ICEV"].includes(e.category)?e.category:"EV";return{id:e.id,vinNumber:e.vinNumber,model:e.model,year:e.year,color:e.color,interiorColor:e.interior_color||e.interiorColor||"",price:e.sellingPrice||0,status:r,category:p,batteryPercentage:e.batteryPercentage||100,range:e.range||520,features:e.features||[],arrivalDate:e.arrivalDate||new Date().toISOString(),pdiCompleted:e.pdiCompleted,pdiStatus:e.pdiCompleted?"completed":"pending",pdiTechnician:e.pdiTechnician,pdiDate:e.pdiDate,pdiNotes:e.pdiNotes,testDriveInfo:e.testDriveInfo,customs:e.customs==="paid"?"paid":"not paid",brand:e.brand,currentFloor:e.current_location||e.category,purchasePrice:e.purchase_price,clientName:e.client_name,clientPhone:e.client_phone,clientLicensePlate:e.client_license_plate,expectedDeliveryDate:e.expected_delivery_date,notes:e.notes,lastModified:e.updated_at,softwareVersion:Math.random()>.5?e.softwareVersion||"2.1.0":void 0,softwareLastUpdated:Math.random()>.5?e.softwareLastUpdated||"2024-01-15":void 0,softwareUpdateBy:Math.random()>.5?e.softwareUpdateBy||"IT Team":void 0,softwareUpdateNotes:Math.random()>.5?e.softwareUpdateNotes||"Routine update":void 0}}),[I]=qe(),h=I.get("filter"),E=()=>{switch(h){case"ready":return w.filter(e=>e.status==="sold"||e.pdiStatus==="completed"||e.currentFloor==="showroom"||e.pdiCompleted===!0);case"attention":return w.filter(e=>{var r,a,p;return e.status==="reserved"||e.pdiStatus==="failed"||e.customs==="not paid"||e.softwareVersion===void 0||((r=e.notes)==null?void 0:r.toLowerCase().includes("issue"))||((a=e.notes)==null?void 0:a.toLowerCase().includes("problem"))||((p=e.notes)==null?void 0:p.toLowerCase().includes("repair"))});default:return w}},[F,D]=i.useState(!1),[V,U]=i.useState(!1),[H,L]=i.useState(!1),[z,u]=i.useState(!1),[m,g]=i.useState(!1),[o,n]=i.useState(!1),[l,j]=i.useState(!1),[J,M]=i.useState(!1),[Q,ee]=i.useState(!1),[he,W]=i.useState(!1),[te,re]=i.useState(null),[se,Y]=i.useState(null),[d,v]=i.useState(null),[pe,ae]=i.useState(!1),[P,oe]=i.useState(null),[ve,ne]=i.useState(!1),[fe,ie]=i.useState(!1),[ye,le]=i.useState(null),[G,xe]=i.useState(""),K=(()=>{const e=E();if(!G.trim())return e;const r=G.toLowerCase();return e.filter(a=>{var p,C,T,$,R;return a.vinNumber.toLowerCase().includes(r)||a.model.toLowerCase().includes(r)||a.color.toLowerCase().includes(r)||(((p=a.interiorColor)==null?void 0:p.toLowerCase().includes(r))??!1)||a.category.toLowerCase().includes(r)||a.status.toLowerCase().includes(r)||((C=a.brand)==null?void 0:C.toLowerCase().includes(r))||((T=a.clientName)==null?void 0:T.toLowerCase().includes(r))||(($=a.clientPhone)==null?void 0:$.toLowerCase().includes(r))||((R=a.notes)==null?void 0:R.toLowerCase().includes(r))||a.year.toString().includes(r)||a.price.toString().includes(r)})})(),[f,N]=i.useState({vinNumber:"",model:"Voyah Dream",year:2024,color:"",price:0,status:"available",category:"EV",batteryPercentage:100,range:520,pdiStatus:"pending",customs:"not paid",horsePower:350,torque:500,acceleration:"4.5",topSpeed:250,chargingTime:"30 minutes",warranty:"4 years / 80,000 km"}),we=async e=>{const r=w.some(a=>a.vinNumber===e);if(!r){const a={vinNumber:e,model:`Vehicle ${e.slice(-4)}`,year:new Date().getFullYear(),color:"Unknown",category:"EV",status:"in_stock",arrivalDate:new Date().toISOString(),batteryPercentage:100,range:0};await k(a)}D(!1),c({title:"VIN Scanned",description:`VIN ${e} ${r?"found":"added to inventory"}`})},De=(e,r,a)=>{c({title:"Car Moved",description:`Car moved from ${r} to ${a}`})},Se=e=>{c({title:"Car Added",description:"Car has been added to inventory"})},Ce=async()=>{await k({vinNumber:f.vinNumber,model:f.model,year:f.year,color:f.color,category:f.category,status:"in_stock",arrivalDate:new Date().toISOString(),batteryPercentage:f.batteryPercentage,range:f.range,sellingPrice:f.price}),U(!1),N({vinNumber:"",model:"Voyah Dream",year:2024,color:"",price:0,status:"available",category:"EV",batteryPercentage:100,range:520,pdiStatus:"pending",customs:"not paid",horsePower:350,torque:500,acceleration:"4.5",topSpeed:250,chargingTime:"30 minutes",warranty:"4 years / 80,000 km"}),c({title:"Car Added",description:"Car has been added to inventory"})},A=(e,r)=>{const a={...r,sellingPrice:r.price,status:r.status==="available"?"in_stock":r.status,customs:r.customs==="paid"?"paid":"not_paid",softwareVersion:r.softwareVersion,softwareLastUpdated:r.softwareLastUpdated,softwareUpdateBy:r.softwareUpdateBy,softwareUpdateNotes:r.softwareUpdateNotes};S(e,a),L(!1),v(null),c({title:"Car Updated",description:"Car details have been updated"})},je=(e,r)=>{if(d){if(console.log(`Moving car ${d.id} to ${e} with notes: ${r}`),e==="garage-schedule"){const a={vinNumber:d.vinNumber,model:d.model,brand:d.brand,year:d.year,color:d.color,status:"waiting",priority:"normal",estimatedDuration:120,notes:r||"Moved from Car Inventory",clientName:d.clientName||"",clientPhone:d.clientPhone||"",arrivalTime:new Date().toISOString(),scheduledTime:new Date().toISOString()},p=localStorage.getItem("garageSchedule"),C=p?JSON.parse(p):{scheduledCars:[]},T={...a,id:Date.now().toString()};C.scheduledCars.push(T),localStorage.setItem("garageSchedule",JSON.stringify(C));const $={...d,id:`garage-${Date.now()}`,status:"in_stock",garageStatus:"stored",currentFloor:"Garage",repairStatus:"pending",assignedMechanic:"",estimatedCompletion:"",repairNotes:r||"Moved from Car Inventory",lastModified:new Date().toISOString()},R=localStorage.getItem("garageCars"),de=R?JSON.parse(R):[];de.push($),localStorage.setItem("garageCars",JSON.stringify(de)),c({title:"Car Added to Garage Schedule",description:`${d.model} has been added to the garage schedule and inventory for service/repair.`})}else c({title:"Car Moved",description:`${d.model} has been moved`});u(!1),v(null)}},Ne=e=>{Y(e),W(!0)},be=e=>{le(e),ie(!0)},Ie=e=>{v(e),j(!0)},Pe=e=>{const r=e.status==="reserved"||e.status==="sold",a=e.expectedDeliveryDate;r&&a&&!e.pdiCompleted||!e.pdiCompleted?(v(e),setTimeout(()=>M(!0),0)):Ie(e)},_e=e=>{g(!1),v(e),n(!0)},Te=e=>{ae(e),n(!1),requestAnimationFrame(()=>{g(!0)})},Ee=(e,r)=>{A(e,{testDriveInfo:{...r,isOnTestDrive:!0}}),c({title:"Test Drive Scheduled",description:`${r.isClientTestDrive?"Client":"Employee"} test drive scheduled`}),g(!1),v(null)},Fe=e=>{const r=w.find($=>$.id===e);if(!r||!r.testDriveInfo)return;const a={isOnTestDrive:r.testDriveInfo.isOnTestDrive,testDriveStartTime:r.testDriveInfo.testDriveStartTime,testDriverName:r.testDriveInfo.testDriverName,testDriverPhone:r.testDriveInfo.testDriverPhone,testDriverLicense:r.testDriveInfo.testDriverLicense,notes:r.testDriveInfo.notes,purpose:r.testDriveInfo.purpose||"Test drive",isClientTestDrive:r.testDriveInfo.isClientTestDrive||!1,loggedBy:r.testDriveInfo.loggedBy||"System",loggedByName:r.testDriveInfo.loggedByName||"System User",loggedAt:r.testDriveInfo.loggedAt||new Date().toISOString(),emergencyContact:r.testDriveInfo.emergencyContact,emergencyContactPhone:r.testDriveInfo.emergencyContactPhone,vehicleVin:r.vinNumber,vehicleModel:r.model},p=X.endTestDrive(a),C=X.addToHistory(r,p);A(e,{testDriveInfo:void 0,testDriveHistory:C.testDriveHistory});const T=X.formatDuration(p.actualDuration||0);c({title:"Test Drive Completed",description:`Test drive completed in ${T}. Added to vehicle history.`})},Ue=(e,r)=>{A(e,{pdiCompleted:!0,pdiTechnician:r.technician,pdiNotes:r.notes,pdiPhotos:r.photos,pdiDate:new Date().toISOString()}),c({title:"PDI Completed",description:"Pre-Delivery Inspection has been completed successfully."})},Oe=e=>{re(e),ee(!0)},ke=(e,r,a)=>{var C;A(e,{status:r,...a,lastUpdated:new Date().toISOString()});const p=(C=w.find(T=>T.id===e))==null?void 0:C.model;c({title:"Car Status Updated",description:`${p} status updated to ${r.replace("_"," ")}`})},Ve=e=>{Y(e),W(!0)},Le=(e,r)=>{S(e,r)},Me=e=>{oe(e),ne(!0)},Ae=(e,r)=>{S(e,{...r,lastUpdated:new Date().toISOString()}),c({title:"Software Updated",description:"Car software information has been updated"})},$e=e=>{switch(e){case"available":case"in_stock":return"bg-green-100 text-green-800 border-green-200";case"sold":return"bg-blue-100 text-blue-800 border-blue-200";case"reserved":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},Re=e=>{switch(e){case"available":case"in_stock":return"Available";case"reserved":return"Reserved";case"sold":return"Sold";default:return e}},Be=e=>{switch(e){case"EV":return"category-ev";case"REV":return"category-rev";case"ICEV":return"category-icev";default:return"bg-gray-400 text-white"}};return t.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Car Inventory"}),h&&t.jsxs(b,{variant:"outline",className:"text-sm font-medium",children:[h==="ready"&&t.jsxs(t.Fragment,{children:[t.jsx(ce,{className:"w-4 h-4 mr-1"}),"Ready Cars"]}),h==="attention"&&t.jsxs(t.Fragment,{children:[t.jsx(He,{className:"w-4 h-4 mr-1"}),"Need Attention"]})]})]}),t.jsxs("p",{className:"text-gray-600 mt-1",children:[h==="ready"&&"Cars ready for delivery and completed processing",h==="attention"&&"Cars requiring immediate attention or action",!h&&"Manage your car inventory and track vehicle details"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(q,{onClick:()=>D(!0),variant:"outline",className:"flex items-center gap-2 border-green-200 text-green-700 hover:bg-green-50",children:[t.jsx(ze,{className:"h-4 w-4"}),"VIN Scanner"]}),t.jsx(q,{onClick:()=>U(!0),className:"flex items-center gap-2 bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:"Add Car Manually"})]})]}),t.jsxs(Je,{children:[t.jsx(Qe,{children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs(Ge,{className:"flex items-center gap-2",children:[t.jsx(me,{className:"h-5 w-5"}),h==="ready"&&`Ready Cars (${K.length})`,h==="attention"&&`Cars Needing Attention (${K.length})`,!h&&`Car Inventory (${K.length} ${G?`of ${w.length}`:""})`]}),t.jsxs("div",{className:"flex items-center gap-2",children:[h&&t.jsxs(q,{variant:"outline",size:"sm",onClick:()=>window.location.href="/car-inventory",className:"text-xs",children:[t.jsx(ue,{className:"h-3 w-3 mr-1"}),"Clear Filter"]}),t.jsx(Ke,{id:"car-inventory-search",value:G,onChange:xe,placeholder:"Search VINs, models, clients, colors...",className:"w-full sm:w-auto"})]})]})}),t.jsx(We,{children:t.jsx("div",{className:"rounded-md border",children:t.jsxs(Ye,{children:[t.jsx(Xe,{children:t.jsxs(ge,{className:"bg-gray-50",children:[t.jsx(y,{className:"font-semibold",children:"VIN"}),t.jsx(y,{className:"font-semibold",children:"Model"}),t.jsx(y,{className:"font-semibold",children:"Category"}),t.jsx(y,{className:"font-semibold",children:"Year"}),t.jsx(y,{className:"font-semibold",children:"Color"}),t.jsx(y,{className:"font-semibold",children:"Color interior"}),t.jsx(y,{className:"font-semibold",children:"Price"}),t.jsx(y,{className:"font-semibold",children:"Status"}),t.jsx(y,{className:"font-semibold",children:"Warranty Life"}),t.jsx(y,{className:"font-semibold",children:"Battery"}),t.jsx(y,{className:"font-semibold",children:"Range Capacity"}),t.jsx(y,{className:"font-semibold",children:"Km Driven"}),t.jsx(y,{className:"font-semibold",children:"Test Drive"}),t.jsx(y,{className:"font-semibold",children:"PDI"}),t.jsx(y,{className:"font-semibold",children:"Customs"}),t.jsx(y,{className:"font-semibold",children:"Software Model"}),t.jsx(y,{className:"font-semibold",children:"Actions"})]})}),t.jsx(Ze,{children:K.map(e=>{var r;return t.jsxs(ge,{className:"hover:bg-gray-50 cursor-pointer transition-all hover:bg-blue-50",onClick:()=>be(e),title:"Click to view complete car history",children:[t.jsx(x,{className:"font-mono text-sm",children:e.vinNumber}),t.jsx(x,{className:"font-medium",children:e.model}),t.jsx(x,{children:t.jsx(b,{className:Be(e.category),children:e.category})}),t.jsx(x,{children:e.year}),t.jsx(x,{children:e.color}),t.jsx(x,{children:e.interiorColor||e.color||"-"}),t.jsxs(x,{className:"font-medium",children:["$",e.price.toLocaleString()]}),t.jsx(x,{children:t.jsx(b,{className:`${$e(e.status)} cursor-pointer hover:opacity-80 transition-all hover:scale-105 active:scale-95`,onClick:a=>{a.preventDefault(),a.stopPropagation(),Oe(e)},title:"Click to change status",children:Re(e.status)})}),t.jsx(x,{children:t.jsx(et,{warrantyStartDate:e.warrantyStartDate,warrantyEndDate:e.warrantyEndDate,warrantyMonthsRemaining:e.warrantyMonthsRemaining,warrantyDaysRemaining:e.warrantyDaysRemaining,warrantyStatus:e.warrantyStatus,compact:!0})}),t.jsx(x,{children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(tt,{className:"h-4 w-4"}),e.batteryPercentage,"%"]})}),t.jsx(x,{children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(rt,{className:"h-4 w-4"}),e.range," km"]})}),t.jsx(x,{children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(at,{className:"h-4 w-4"}),st.getKilometersDriven(e.id)," km"]})}),t.jsx(x,{children:(r=e.testDriveInfo)!=null&&r.isOnTestDrive?t.jsxs(b,{className:"bg-blue-100 text-blue-800 border-blue-200 cursor-pointer hover:opacity-80 transition-opacity",onClick:a=>{a.preventDefault(),a.stopPropagation(),Fe(e.id)},title:"Click to end test drive",children:[t.jsx(ot,{className:"mr-1 h-3 w-3"}),e.testDriveInfo.isClientTestDrive?"Client":"Employee"," Test Drive"]}):e.status==="sold"||e.status==="reserved"?t.jsx(b,{variant:"outline",className:"bg-gray-50 text-gray-500",children:"Not Available"}):t.jsx(b,{variant:"outline",className:"bg-gray-50 text-gray-500 cursor-pointer hover:bg-blue-50 hover:text-blue-600 transition-colors",onClick:a=>{a.preventDefault(),a.stopPropagation(),_e(e)},title:"Click to schedule test drive",children:"Available"})}),t.jsx(x,{children:t.jsx("div",{className:"cursor-pointer",onClick:a=>{a.preventDefault(),a.stopPropagation(),Pe(e)},children:t.jsx(b,{variant:e.pdiCompleted?"default":"outline",className:`cursor-pointer hover:opacity-80 transition-opacity ${e.pdiCompleted?"bg-green-100 text-green-800 border-green-200":"bg-yellow-100 text-yellow-800 border-yellow-200"}`,children:e.pdiCompleted?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-1 text-lg",children:"☺"})," Complete"]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-1 text-lg",children:"☹"})," Pending"]})})})}),t.jsx(x,{children:t.jsx(b,{variant:e.customs==="paid"?"default":"destructive",className:"cursor-pointer hover:opacity-80 transition-opacity active:scale-95",onClick:a=>{a.preventDefault(),a.stopPropagation(),Ve(e)},title:"Click to manage customs payment",children:e.customs==="paid"?t.jsxs(t.Fragment,{children:[t.jsx(ce,{className:"mr-1 h-4 w-4"})," paid"]}):t.jsxs(t.Fragment,{children:[t.jsx(ue,{className:"mr-1 h-4 w-4"})," ",e.customs||"not paid"]})})}),t.jsx(x,{children:t.jsx("div",{className:"flex items-center gap-1 text-xs cursor-pointer",onClick:()=>Me(e),title:"Click to manage software updates",children:e.softwareVersion?t.jsxs(t.Fragment,{children:[t.jsxs(b,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:["v",e.softwareVersion]}),e.softwareLastUpdated&&t.jsx("span",{className:"text-gray-500",children:new Date(e.softwareLastUpdated).toLocaleDateString()})]}):t.jsx(b,{variant:"secondary",className:"text-xs text-yellow-700 bg-yellow-100 hover:bg-yellow-200 transition-colors",children:"Update Needed"})})}),t.jsx(x,{children:t.jsx(nt,{options:[{value:"details",label:"View Details"},{value:"edit",label:"Edit Car"},{value:"move",label:"Move Car"}],onAction:a=>{a==="details"?Ne(e):a==="edit"?(v(e),L(!0)):a==="move"&&(v(e),u(!0))},id:`actions-${e.id}`,ariaLabel:`Actions for ${e.model} ${e.vinNumber}`})})]},e.id)})})]})})})]}),t.jsx(it,{isOpen:F,onClose:()=>D(!1),onVinScanned:we,targetLocation:"Inventory",onCarMoved:De,onCarAdded:Se,onTestDrive:(e,r)=>{const a={id:e.id,vinNumber:e.vin_number,model:e.model,year:e.year,color:e.color,price:e.selling_price,status:e.status,category:e.category,batteryPercentage:e.battery_percentage||100,range:e.range_km||0,features:[],arrivalDate:e.arrival_date,pdiCompleted:e.pdi_completed,pdiTechnician:e.pdi_technician,pdiDate:e.pdi_date,pdiNotes:e.notes,testDriveInfo:{isOnTestDrive:e.test_drive_status},customs:e.customs==="not_paid"?"not paid":e.customs==="paid"?"paid":void 0};v(a),ae(r),n(!0),D(!1)},onPdiAction:e=>{const r={id:e.id,vinNumber:e.vin_number,model:e.model,year:e.year,color:e.color,price:e.selling_price,status:e.status,category:e.category,batteryPercentage:e.battery_percentage||100,range:e.range_km||0,features:[],arrivalDate:e.arrival_date,pdiCompleted:e.pdi_completed,pdiTechnician:e.pdi_technician,pdiDate:e.pdi_date,pdiNotes:e.notes,testDriveInfo:{isOnTestDrive:e.test_drive_status},customs:e.customs==="not_paid"?"not paid":e.customs==="paid"?"paid":"not paid"};v(r),j(!0),D(!1)}}),t.jsx(lt,{open:V,onOpenChange:U,children:t.jsxs(dt,{className:"sm:max-w-[600px]",children:[t.jsx(ct,{children:t.jsxs(mt,{className:"flex items-center gap-2",children:[t.jsx(me,{className:"h-5 w-5"}),"Add Car to Inventory"]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(_,{htmlFor:"vinNumber",children:"VIN Number *"}),t.jsx(O,{id:"vinNumber",value:f.vinNumber,onChange:e=>N(r=>({...r,vinNumber:e.target.value})),placeholder:"Enter VIN number",required:!0})]}),t.jsxs("div",{children:[t.jsx(_,{htmlFor:"model",children:"Model *"}),t.jsx(O,{id:"model",value:f.model,onChange:e=>N(r=>({...r,model:e.target.value})),placeholder:"Enter model name",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(_,{htmlFor:"year",children:"Year *"}),t.jsx(O,{id:"year",type:"number",min:"2020",max:"2030",value:f.year,onChange:e=>N(r=>({...r,year:parseInt(e.target.value)})),required:!0})]}),t.jsxs("div",{children:[t.jsx(_,{htmlFor:"color",children:"Color *"}),t.jsx(O,{id:"color",value:f.color,onChange:e=>N(r=>({...r,color:e.target.value})),placeholder:"e.g., Midnight Silver",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(_,{htmlFor:"category",children:"Category *"}),t.jsxs("select",{id:"category",value:f.category,onChange:e=>N(r=>({...r,category:e.target.value})),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",required:!0,children:[t.jsx("option",{value:"EV",children:"EV (Electric Vehicle)"}),t.jsx("option",{value:"REV",children:"REV (Range Extended Vehicle)"}),t.jsx("option",{value:"ICEV",children:"ICEV (Internal Combustion Engine)"})]})]}),t.jsxs("div",{children:[t.jsx(_,{htmlFor:"price",children:"Price (USD) *"}),t.jsx(O,{id:"price",type:"number",min:"0",value:f.price,onChange:e=>N(r=>({...r,price:parseInt(e.target.value)})),placeholder:"e.g., 85000",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(_,{htmlFor:"status",children:"Status"}),t.jsxs("select",{id:"status",value:f.status,onChange:e=>N(r=>({...r,status:e.target.value})),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",children:[t.jsx("option",{value:"available",children:"Available"}),t.jsx("option",{value:"sold",children:"Sold"}),t.jsx("option",{value:"reserved",children:"Reserved"}),t.jsx("option",{value:"pending",children:"Pending"})]})]}),t.jsxs("div",{children:[t.jsx(_,{htmlFor:"batteryPercentage",children:"Battery %"}),t.jsx(O,{id:"batteryPercentage",type:"number",min:"0",max:"100",value:f.batteryPercentage,onChange:e=>N(r=>({...r,batteryPercentage:parseInt(e.target.value)}))})]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.jsxs("div",{children:[t.jsx(_,{htmlFor:"range",children:"Range (km)"}),t.jsx(O,{id:"range",type:"number",min:"0",value:f.range,onChange:e=>N(r=>({...r,range:parseInt(e.target.value)})),placeholder:"e.g., 520"})]})})]}),t.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[t.jsx(q,{variant:"outline",onClick:()=>U(!1),children:"Cancel"}),t.jsx(q,{onClick:Ce,className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:"Add Car"})]})]})}),d&&t.jsx(ut,{isOpen:H,onClose:()=>{L(!1),v(null)},car:d,onSave:A}),d&&t.jsx(gt,{isOpen:z,onClose:()=>{u(!1),v(null)},car:d,onMoveCar:je}),d&&t.jsx(ht,{isOpen:l,onClose:()=>{j(!1),v(null)},car:d,onPdiComplete:Ue}),d&&t.jsx(pt,{isOpen:J,onClose:()=>{M(!1),v(null)},car:d,onSave:(e,r)=>{A(e,{pdiCompleted:r,pdiDate:new Date().toISOString()}),M(!1),v(null)}}),d&&t.jsx(vt,{isOpen:o,onClose:()=>{n(!1),v(null)},onSelectTestDriveType:Te,carModel:d.model,carVin:d.vinNumber}),d&&t.jsx(ft,{isOpen:m,onClose:()=>{g(!1),v(null)},car:{...d,currentFloor:d.currentFloor||"Inventory"},onScheduleTestDrive:Ee,isClientTestDrive:pe}),te&&t.jsx(yt,{isOpen:Q,onClose:()=>{ee(!1),re(null)},car:te,onStatusUpdate:ke}),se&&t.jsx(xt,{isOpen:he,onClose:()=>{W(!1),Y(null)},car:se,onCarUpdate:Le}),t.jsx(wt,{isOpen:ve,onClose:()=>{ne(!1),oe(null)},car:P?{vinNumber:P.vinNumber,model:P.model,currentVersion:P.softwareVersion,lastUpdated:P.softwareLastUpdated,lastUpdatedBy:P.softwareUpdateBy,notes:P.softwareUpdateNotes,needsUpdate:!P.softwareVersion,priority:P.softwareVersion?"medium":"critical"}:null,onUpdateComplete:(e,r)=>{var p;const a=(p=w.find(C=>C.vinNumber===e))==null?void 0:p.id;a&&Ae(a,r)}}),t.jsx(Dt,{isOpen:fe,onClose:()=>{ie(!1),le(null)},car:ye})]})};export{Tt as default};
