import{r as u,$ as z}from"./index-D4jk50_k.js";const H=()=>{const[o,h]=u.useState([]),[O,V]=u.useState(!1),{user:w}=z();u.useEffect(()=>{const e=localStorage.getItem("auditLogs");e&&h(JSON.parse(e))},[]);const y=u.useCallback(e=>{localStorage.setItem("auditLogs",JSON.stringify(e)),h(e)},[]),E=u.useCallback((e,a,r,i,t)=>{if(!w)return;const c=navigator.userAgent,m=/Mobile|Android|iPhone|iPad/.test(c)?/iPad/.test(c)?"tablet":"mobile":"desktop",d=c.includes("Chrome")?"Chrome":c.includes("Firefox")?"Firefox":c.includes("Safari")?"Safari":"Other",s={id:`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),userId:w.id,userName:w.name,userRole:w.role,action:e,section:a,entityType:r,entityId:t==null?void 0:t.entityId,entityName:t==null?void 0:t.entityName,details:i,vinNumber:t==null?void 0:t.vinNumber,partNumber:t==null?void 0:t.partNumber,carModel:t==null?void 0:t.carModel,carBrand:t==null?void 0:t.carBrand,category:t==null?void 0:t.category,location:t==null?void 0:t.location,changes:t==null?void 0:t.changes,metadata:{userAgent:navigator.userAgent,sessionId:sessionStorage.getItem("sessionId")||"unknown",pageUrl:window.location.href,deviceType:m,browserName:d,...t==null?void 0:t.metadata}},n=JSON.parse(localStorage.getItem("auditLogs")||"[]"),C=[s,...n].slice(0,1e4);y(C)},[w,y]),x=u.useCallback(e=>o.filter(a=>{var l,b,v,A,N,S,D,g,T,I,k,B,M;const r=!e.section||a.section===e.section,i=!e.action||a.action===e.action,t=!e.userId||a.userId===e.userId,c=!e.entityType||a.entityType===e.entityType,m=!e.dateFrom||new Date(a.timestamp)>=new Date(e.dateFrom),d=!e.dateTo||new Date(a.timestamp)<=new Date(e.dateTo),s=!e.searchTerm||a.details.toLowerCase().includes(e.searchTerm.toLowerCase())||a.userName.toLowerCase().includes(e.searchTerm.toLowerCase())||((l=a.entityName)==null?void 0:l.toLowerCase().includes(e.searchTerm.toLowerCase()))||((b=a.vinNumber)==null?void 0:b.toLowerCase().includes(e.searchTerm.toLowerCase()))||((v=a.partNumber)==null?void 0:v.toLowerCase().includes(e.searchTerm.toLowerCase()))||((A=a.carModel)==null?void 0:A.toLowerCase().includes(e.searchTerm.toLowerCase()))||((N=a.carBrand)==null?void 0:N.toLowerCase().includes(e.searchTerm.toLowerCase()))||((S=a.category)==null?void 0:S.toLowerCase().includes(e.searchTerm.toLowerCase()))||((D=a.location)==null?void 0:D.toLowerCase().includes(e.searchTerm.toLowerCase())),n=!e.vinNumber||((g=a.vinNumber)==null?void 0:g.toLowerCase().includes(e.vinNumber.toLowerCase())),C=!e.partNumber||((T=a.partNumber)==null?void 0:T.toLowerCase().includes(e.partNumber.toLowerCase())),R=!e.carModel||((I=a.carModel)==null?void 0:I.toLowerCase().includes(e.carModel.toLowerCase())),U=!e.carBrand||((k=a.carBrand)==null?void 0:k.toLowerCase().includes(e.carBrand.toLowerCase())),_=!e.category||((B=a.category)==null?void 0:B.toLowerCase().includes(e.category.toLowerCase())),$=!e.location||((M=a.location)==null?void 0:M.toLowerCase().includes(e.location.toLowerCase()));return r&&i&&t&&c&&m&&d&&s&&n&&C&&R&&U&&_&&$}),[o]),F=u.useCallback(()=>{const e=new Date().toDateString(),a=o.filter(t=>new Date(t.timestamp).toDateString()===e),r=new Set(a.map(t=>t.userId)).size,i=Object.entries(o.reduce((t,c)=>(t[c.section]||(t[c.section]={count:0,lastActivity:c.timestamp}),t[c.section].count++,new Date(c.timestamp)>new Date(t[c.section].lastActivity)&&(t[c.section].lastActivity=c.timestamp),t),{})).map(([t,c])=>({section:t,count:c.count,lastActivity:c.lastActivity})).sort((t,c)=>new Date(c.lastActivity).getTime()-new Date(t.lastActivity).getTime());return{totalActivities:o.length,todayActivities:a.length,activeUsers:r,sectionsActivity:i}},[o]),L=u.useCallback(e=>{var d;const a=o.filter(s=>s.userId===e);if(a.length===0)return null;const r=new Date().toDateString(),i=a.filter(s=>new Date(s.timestamp).toDateString()===r),t=Object.entries(a.reduce((s,n)=>(s[n.action]=(s[n.action]||0)+1,s),{})).map(([s,n])=>({action:s,count:n})).sort((s,n)=>n.count-s.count),c=Object.entries(a.reduce((s,n)=>(s[n.section]=(s[n.section]||0)+1,s),{})).map(([s,n])=>({section:s,count:n})).sort((s,n)=>n.count-s.count),m=a[0];return{userId:e,userName:m.userName,userRole:m.userRole,totalActivities:a.length,todayActivities:i.length,lastActivity:a[0].timestamp,mostActiveSection:((d=c[0])==null?void 0:d.section)||"None",activityBreakdown:t,sectionBreakdown:c,recentActivities:a.slice(0,20)}},[o]),j=u.useCallback(()=>[...new Set(o.map(a=>a.userId))].map(a=>L(a)).filter(a=>a!==null),[o,L]),P=u.useCallback(e=>{if(!e.trim())return o;const a=e.toLowerCase().split(" ").filter(r=>r.length>0);return o.filter(r=>{const i=[r.details,r.userName,r.entityName,r.vinNumber,r.partNumber,r.carModel,r.carBrand,r.category,r.location,r.section.replace("_"," "),r.action,r.entityType].filter(Boolean).join(" ").toLowerCase();return a.every(t=>i.includes(t))})},[o]),J=u.useCallback(()=>{const e=new Date;e.setDate(e.getDate()-30);const a=o.filter(r=>new Date(r.timestamp)>e);y(a)},[o,y]);return{auditLogs:o,loading:O,logActivity:E,filterLogs:x,getAuditStats:F,getEmployeeAuditSummary:L,getAllEmployeesAuditSummary:j,advancedSearch:P,clearOldLogs:J}};export{H as u};
