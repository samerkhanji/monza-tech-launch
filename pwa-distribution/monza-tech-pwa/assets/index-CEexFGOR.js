import{r as l,t as d,j as e,b0 as H,I,d as S,e as B,f as M,g as A,ax as C,i as R,a1 as T,B as n,Y as V,Z as W,_ as m,aA as h,w as D,bT as L,ad as U,aw as G,av as Z,h as $,aG as O,bR as P,ab as J,U as K,aP as Q}from"./index-CrIDvSVN.js";import{enhancedRepairHistoryService as Y}from"./enhancedRepairHistoryService-BdR5OMjW.js";import{S as E}from"./star-Bd80_wkG.js";const le=()=>{const[x,u]=l.useState([]),[i,k]=l.useState(""),[X,ee]=l.useState(null),[q,c]=l.useState(!0),[p,f]=l.useState(""),[g,j]=l.useState(!1);l.useEffect(()=>{N()},[]);const N=async()=>{c(!0);try{u([{id:"1",car_vin:"WVWAA7AJ2DW123456",car_model:"Voyah Free 2024",car_year:2024,car_color:"Pearl White",client_name:"Ahmed Al-Mahmoud",client_phone:"+973 3333 4444",client_email:"ahmed.mahmoud@email.com",client_license_plate:"ABC-123",issue_description:"Battery charging system not working properly, showing error codes related to HV battery management",solution_description:"Replaced faulty BMS (Battery Management System) module and updated software to latest version",repair_steps:["Diagnosed charging system using diagnostic tools","Identified faulty BMS module through error code analysis","Ordered replacement BMS module (Part: DF-BMS-2024-01)","Removed old BMS module following safety protocols","Installed new BMS module and calibrated system","Updated software to version 2.4.1","Performed full system test and quality check"],parts_used:[{part_number:"DF-BMS-2024-01",part_name:"Battery Management System Module",quantity:1,cost:850,supplier:"Dong Feng Parts"},{part_number:"DF-SEAL-88",part_name:"BMS Gasket Seal",quantity:2,cost:25,supplier:"Dong Feng Parts"}],labor_hours:4.5,total_cost:1200,technician_name:"Mohammad Ali",repair_date:"2024-01-15",completion_date:"2024-01-15",photos:["repair_1_before.jpg","repair_1_after.jpg"],before_photos:["bms_before_1.jpg","bms_before_2.jpg"],after_photos:["bms_after_1.jpg","bms_after_2.jpg"],repair_category:"Electrical",difficulty_level:"hard",quality_rating:5,client_satisfaction:5,warranty_period:12,follow_up_required:!1,created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T15:30:00Z"}])}catch(s){console.error("Error loading repair history:",s),d({title:"Error",description:"Failed to load repair history",variant:"destructive"})}finally{c(!1)}},y=async()=>{if(!i.trim()){N();return}c(!0);try{const s=await Y.searchRepairHistory(i);u(s)}catch(s){console.error("Error searching repair history:",s),d({title:"Error",description:"Failed to search repair history",variant:"destructive"})}finally{c(!1)}},z=async s=>{try{j(!0),f("");const r=`Tell me about this repair case: ${s.issue_description} on ${s.car_model}`,o=await Q.processEnhancedMessage(r,{source:"repair_inquiry",formType:"repair",extractedData:s});f(o.textResponse),d({title:"MonzaBot Analysis Complete",description:"MonzaBot has analyzed the repair case"})}catch(r){console.error("Error asking MonzaBot:",r),d({title:"Error",description:"Failed to get MonzaBot analysis",variant:"destructive"})}finally{j(!1)}},F=s=>{switch(s){case"easy":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"hard":return"bg-orange-100 text-orange-800";case"expert":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return q?e.jsx("div",{className:"container mx-auto py-6",children:e.jsx("div",{className:"text-center",children:"Loading enhanced repair history..."})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Enhanced Repair History"}),e.jsx("p",{className:"text-muted-foreground",children:"Detailed repair records with client information, parts used, and solutions"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(H,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search by VIN, client name, issue, or solution...",className:"pl-9",value:i,onChange:s=>k(s.target.value),onKeyPress:s=>s.key==="Enter"&&y()})]}),e.jsx(S,{onClick:y,children:"Search"})]}),p&&e.jsxs(B,{className:"bg-blue-50 border-blue-200",children:[e.jsx(M,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-blue-600"}),"MonzaBot Analysis"]})}),e.jsx(R,{children:e.jsx("div",{className:"whitespace-pre-wrap text-sm",children:p})})]}),e.jsx("div",{className:"grid gap-6",children:x.map(s=>{var r,o,_,v,b,w;return e.jsxs(B,{className:"w-full",children:[e.jsx(M,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),s.car_model," (",s.car_year,")"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["VIN: ",s.car_vin]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{className:F(s.difficulty_level),children:s.difficulty_level}),s.quality_rating&&e.jsxs(n,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(E,{className:"h-3 w-3"}),s.quality_rating,"/5"]})]})]})}),e.jsx(R,{children:e.jsxs(V,{defaultValue:"overview",className:"w-full",children:[e.jsxs(W,{className:"grid w-full grid-cols-4",children:[e.jsx(m,{value:"overview",children:"Overview"}),e.jsx(m,{value:"client",children:"Client"}),e.jsx(m,{value:"parts",children:"Parts"}),e.jsx(m,{value:"solution",children:"Solution"})]}),e.jsxs(h,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:L(new Date(s.repair_date),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.technician_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[s.labor_hours,"h"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Issue Description"}),e.jsx("p",{className:"text-sm bg-red-50 p-3 rounded border border-red-100",children:s.issue_description})]})]}),e.jsxs(h,{value:"client",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:s.client_name})]}),s.client_phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.client_phone})]}),s.client_email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.client_email})]}),s.client_license_plate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.client_license_plate})]})]}),s.client_satisfaction&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Client Satisfaction"}),e.jsxs("div",{className:"flex items-center gap-2",children:[[...Array(5)].map((a,t)=>e.jsx(E,{className:`h-4 w-4 ${t<s.client_satisfaction?"text-yellow-400 fill-current":"text-gray-300"}`},t)),e.jsxs("span",{className:"text-sm",children:["(",s.client_satisfaction,"/5)"]})]})]})]}),e.jsxs(h,{value:"parts",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Parts Used"]}),e.jsx("div",{className:"space-y-2",children:s.parts_used.map((a,t)=>e.jsx("div",{className:"bg-amber-50 p-3 rounded border border-amber-100",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.part_name}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono",children:a.part_number}),a.supplier&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Supplier: ",a.supplier]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm",children:["Qty: ",a.quantity]}),a.cost&&e.jsxs("p",{className:"text-sm flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),a.cost]})]})]})},t))})]}),s.total_cost&&e.jsx("div",{className:"bg-green-50 p-3 rounded border border-green-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total Cost"}),e.jsxs("span",{className:"font-bold flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4"}),s.total_cost]})]})})]}),e.jsxs(h,{value:"solution",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Solution Description"}),e.jsx("p",{className:"text-sm bg-green-50 p-3 rounded border border-green-100",children:s.solution_description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Repair Steps"}),e.jsx("ol",{className:"space-y-2",children:s.repair_steps.map((a,t)=>e.jsxs("li",{className:"text-sm flex gap-2",children:[e.jsx("span",{className:"bg-blue-100 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-medium",children:t+1}),e.jsx("span",{children:a})]},t))})]}),(((r=s.photos)==null?void 0:r.length)||((o=s.before_photos)==null?void 0:o.length)||((_=s.after_photos)==null?void 0:_.length))&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Photos Available"]}),e.jsxs("div",{className:"flex gap-2",children:[((v=s.before_photos)==null?void 0:v.length)&&e.jsxs(n,{variant:"outline",children:[s.before_photos.length," Before Photos"]}),((b=s.after_photos)==null?void 0:b.length)&&e.jsxs(n,{variant:"outline",children:[s.after_photos.length," After Photos"]}),((w=s.photos)==null?void 0:w.length)&&e.jsxs(n,{variant:"outline",children:[s.photos.length," General Photos"]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(S,{variant:"outline",onClick:()=>z(s),disabled:g,className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),g?"Analyzing...":"Ask MonzaBot About This Repair"]})})]})]})})]},s.id)})}),x.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No repair history found"}),e.jsx("p",{className:"text-muted-foreground",children:i?"Try a different search term":"No enhanced repair records available yet"})]})]})};export{le as default};
