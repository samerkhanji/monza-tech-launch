import{R as me,r as m,j as e,L as J,b0 as ie,I as K,d as W,e as o,i as x,h as U,B as h,ai as de,ad as k,w as O,a4 as Y,aG as b,bR as C,am as S,a1 as _,az as re,f as M,g as B,D as X,a as ee,b as se,c as ae,U as D,Y as le,Z as te,_ as u,aA as f,C as oe,an as xe,ar as he,b3 as je,bS as ce}from"./index-CrIDvSVN.js";import{W as A,E as q}from"./enhancedRepairHistoryManager-D4BsNGqK.js";import{F as ne}from"./filter-BJ97fFRF.js";import{I as G}from"./image-BjeGoMPD.js";import{S as Z}from"./star-Bd80_wkG.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=me("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),ge=({carVin:j,showAll:y=!1})=>{var V,E;const[n,P]=m.useState([]),[g,i]=m.useState(""),[w,$]=m.useState([]),[v,z]=m.useState(null),[l,F]=m.useState(null),[Q,L]=m.useState(!1);m.useEffect(()=>{I()},[j]),m.useEffect(()=>{if(g.trim()){const a=n.filter(r=>r.carModel.toLowerCase().includes(g.toLowerCase())||r.workTypeChange.toLowerCase().includes(g.toLowerCase())||r.changedBy.toLowerCase().includes(g.toLowerCase()));$(a)}else $(n)},[g,n]);const I=()=>{let a;j?a=A.getCarWorkTypeHistory(j):y?a=A.getWorkTypeHistory():a=A.getRecentWorkTypeChanges(10),P(a),$(a);const r=A.getWorkTypeAnalytics();z(r)},R=a=>new Date(a).toLocaleString(),T=a=>{switch(a){case"in_diagnosis":return"bg-blue-100 text-blue-800";case"in_repair":return"bg-orange-100 text-orange-800";case"in_quality_check":return"bg-purple-100 text-purple-800";case"ready":return"bg-green-100 text-green-800";case"delivered":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Work Type History"}),e.jsx("p",{className:"text-gray-600",children:j?`Showing work type changes for car ${j}`:"Recent work type transitions"})]}),v&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:v.totalTransitions}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Transitions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:v.uniqueCars}),e.jsx("div",{className:"text-sm text-gray-600",children:"Unique Cars"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(J,{htmlFor:"search",children:"Search Work Type History"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(K,{id:"search",placeholder:"Search by car model, work type, or employee...",value:g,onChange:a=>i(a.target.value),className:"pl-10"})]})]}),e.jsxs(W,{onClick:I,variant:"outline",className:"self-end",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsx("div",{className:"space-y-4",children:w.length===0?e.jsx(o,{children:e.jsxs(x,{className:"p-6 text-center",children:[e.jsx(U,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No work type history found"})]})}):w.map(a=>{var r,s;return e.jsx(o,{className:"hover:shadow-md transition-shadow",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.carModel}),a.carVin&&e.jsx(h,{variant:"outline",className:"text-xs",children:a.carVin})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(h,{className:T(a.fromWorkType),children:a.fromWorkType.replace("_"," ").toUpperCase()}),e.jsx(de,{className:"h-4 w-4 text-gray-400"}),e.jsx(h,{className:T(a.toWorkType),children:a.toWorkType.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),e.jsx("span",{children:a.changedBy})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsx("span",{children:R(a.timestamp)})]}),a.duration&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),e.jsx("span",{children:a.duration})]})]}),a.partsUsed&&a.partsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Parts Used"}),e.jsxs(h,{variant:"outline",className:"text-xs",children:[a.partsUsed.length," parts"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:a.partsUsed.map((t,c)=>e.jsx(h,{variant:"secondary",className:"text-xs",children:t},c))}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(C,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-700",children:["Total Parts Cost: $",((r=a.totalPartsCost)==null?void 0:r.toLocaleString())||"0"]})]})]}),a.toolsUsed&&a.toolsUsed.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Tools Used"}),e.jsxs(h,{variant:"outline",className:"text-xs",children:[a.toolsUsed.length," tools"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:a.toolsUsed.map((t,c)=>e.jsx(h,{variant:"secondary",className:"text-xs",children:t},c))}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(C,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-700",children:["Total Tools Cost: $",((s=a.totalToolsCost)==null?void 0:s.toLocaleString())||"0"]})]})]}),a.workNotes&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(_,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Work Notes:"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:a.workNotes})]}),a.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:a.notes})]}),e.jsx("div",{className:"ml-4 flex-shrink-0",children:e.jsxs(W,{size:"sm",variant:"outline",onClick:()=>{F(a),L(!0)},className:"flex items-center gap-1",children:[e.jsx(re,{className:"h-4 w-4"}),"View Details"]})})]})})},a.id)})}),v&&v.transitionCounts&&Object.keys(v.transitionCounts).length>0&&e.jsxs(o,{children:[e.jsx(M,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Work Type Transition Analytics"]})}),e.jsx(x,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(v.transitionCounts).sort(([,a],[,r])=>r-a).slice(0,6).map(([a,r])=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:a}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:r})]},a))})})]}),n.length>0&&e.jsxs(o,{children:[e.jsx(M,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"Parts & Tools Usage Analytics"]})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Total Parts"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:n.reduce((a,r)=>{var s;return a+(((s=r.partsUsed)==null?void 0:s.length)||0)},0)}),e.jsx("div",{className:"text-sm text-blue-600",children:"parts used"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Parts Cost"})]}),e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:["$",n.reduce((a,r)=>a+(r.totalPartsCost||0),0).toLocaleString()]}),e.jsx("div",{className:"text-sm text-green-600",children:"total parts cost"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Total Tools"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:n.reduce((a,r)=>{var s;return a+(((s=r.toolsUsed)==null?void 0:s.length)||0)},0)}),e.jsx("div",{className:"text-sm text-orange-600",children:"tools used"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Tools Cost"})]}),e.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:["$",n.reduce((a,r)=>a+(r.totalToolsCost||0),0).toLocaleString()]}),e.jsx("div",{className:"text-sm text-purple-600",children:"total tools cost"})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_,{className:"h-5 w-5 text-indigo-600"}),e.jsx("span",{className:"font-medium text-indigo-800",children:"Avg Parts"})]}),e.jsx("div",{className:"text-2xl font-bold text-indigo-900",children:n.length>0?Math.round(n.reduce((a,r)=>{var s;return a+(((s=r.partsUsed)==null?void 0:s.length)||0)},0)/n.length):0}),e.jsx("div",{className:"text-sm text-indigo-600",children:"parts per transition"})]}),e.jsxs("div",{className:"bg-teal-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"h-5 w-5 text-teal-600"}),e.jsx("span",{className:"font-medium text-teal-800",children:"Avg Tools"})]}),e.jsx("div",{className:"text-2xl font-bold text-teal-900",children:n.length>0?Math.round(n.reduce((a,r)=>{var s;return a+(((s=r.toolsUsed)==null?void 0:s.length)||0)},0)/n.length):0}),e.jsx("div",{className:"text-sm text-teal-600",children:"tools per transition"})]})]})})]}),l&&e.jsx(X,{open:Q,onOpenChange:L,children:e.jsxs(ee,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Work Type History Details - ",l.carModel," (",l.carVin,")"]})}),e.jsxs(le,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(te,{className:"grid w-full grid-cols-4",children:[e.jsx(u,{value:"overview",children:"Overview"}),e.jsx(u,{value:"transition",children:"Transition Details"}),e.jsx(u,{value:"resources",children:"Parts & Tools"}),e.jsx(u,{value:"notes",children:"Notes & Timeline"})]}),e.jsx(f,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Vehicle Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Model:"}),e.jsx("span",{children:l.carModel})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"VIN:"}),e.jsx("span",{className:"font-mono",children:l.carVin})]}),l.customerName&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Customer:"}),e.jsx("span",{children:l.customerName})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Work Type Transition"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{children:R(l.timestamp)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"From:"}),e.jsx(h,{className:T(l.fromWorkType),children:l.fromWorkType.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"To:"}),e.jsx(h,{className:T(l.toWorkType),children:l.toWorkType.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Changed By:"}),e.jsx("span",{children:l.changedBy})]}),l.duration&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Duration:"}),e.jsx("span",{children:l.duration})]})]})]})]})}),e.jsx(f,{value:"transition",className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx(h,{className:`${T(l.fromWorkType)} text-lg px-3 py-1`,children:l.fromWorkType.replace("_"," ").toUpperCase()}),e.jsx(de,{className:"h-6 w-6 text-gray-400"}),e.jsx(h,{className:`${T(l.toWorkType)} text-lg px-3 py-1`,children:l.toWorkType.replace("_"," ").toUpperCase()})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Changed By"})]}),e.jsx("p",{className:"text-lg",children:l.changedBy})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(O,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Date & Time"})]}),e.jsx("p",{className:"text-lg",children:R(l.timestamp)})]})}),l.duration&&e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Y,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-medium",children:"Duration"})]}),e.jsx("p",{className:"text-lg",children:l.duration})]})})]})]})}),e.jsx(f,{value:"resources",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-blue-600"}),"Parts Used"]}),l.partsUsed&&l.partsUsed.length>0?e.jsxs("div",{className:"space-y-2",children:[l.partsUsed.map((a,r)=>e.jsx("div",{className:"p-3 border rounded-lg bg-blue-50",children:e.jsx("div",{className:"font-medium",children:a})},r)),e.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-800",children:["Total Parts Cost: $",((V=l.totalPartsCost)==null?void 0:V.toLocaleString())||"0"]})]})})]}):e.jsx("p",{className:"text-gray-500",children:"No parts used in this transition"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-orange-600"}),"Tools Used"]}),l.toolsUsed&&l.toolsUsed.length>0?e.jsxs("div",{className:"space-y-2",children:[l.toolsUsed.map((a,r)=>e.jsxs("div",{className:"p-3 border rounded-lg bg-orange-50 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{children:a})]},r)),e.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-800",children:["Total Tools Cost: $",((E=l.totalToolsCost)==null?void 0:E.toLocaleString())||"0"]})]})})]}):e.jsx("p",{className:"text-gray-500",children:"No tools used in this transition"})]})]})}),e.jsx(f,{value:"notes",className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[l.workNotes&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-gray-600"}),"Work Notes"]}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border",children:e.jsx("p",{className:"text-gray-700",children:l.workNotes})})]}),l.notes&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-blue-600"}),"Additional Notes"]}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border",children:e.jsx("p",{className:"text-gray-700",children:l.notes})})]}),!l.workNotes&&!l.notes&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No notes available for this work type transition"})]})]})})]})]})})]})},Ne=({carVin:j,showAll:y=!1})=>{const[n,P]=m.useState([]),[g,i]=m.useState(""),[w,$]=m.useState([]),[v,z]=m.useState(null),[l,F]=m.useState(null),[Q,L]=m.useState(!1);m.useEffect(()=>{I()},[j]),m.useEffect(()=>{if(g.trim()){const s=R(n).filter(t=>t.label.toLowerCase().includes(g.toLowerCase())||t.entries.some(c=>c.carModel.toLowerCase().includes(g.toLowerCase())||c.changedBy.toLowerCase().includes(g.toLowerCase())));$(s)}else $(R(n))},[g,n]);const I=()=>{let s;j?s=A.getCarWorkTypeHistory(j):y?s=A.getWorkTypeHistory():s=A.getRecentWorkTypeChanges(20),P(s),$(R(s));const t=A.getWorkTypeAnalytics();z(t)},R=s=>{const t={};return s.forEach(c=>{var N,H;const d=c.fromWorkType;t[d]||(t[d]={workType:d,label:T(d),color:V(d),icon:E(d),entries:[],totalPartsCost:0,totalToolsCost:0,totalParts:0,totalTools:0,duration:"",notes:[],mechanics:[]});const p=t[d];p.entries.push(c),p.totalPartsCost+=c.totalPartsCost||0,p.totalToolsCost+=c.totalToolsCost||0,p.totalParts+=((N=c.partsUsed)==null?void 0:N.length)||0,p.totalTools+=((H=c.toolsUsed)==null?void 0:H.length)||0,c.notes&&p.notes.push(c.notes),c.mechanics&&p.mechanics.push(...c.mechanics)}),Object.values(t).sort((c,d)=>a(c.workType)-a(d.workType))},T=s=>{switch(s){case"in_diagnosis":return"Diagnosis Stage";case"in_repair":return"Repair Stage";case"in_quality_check":return"Quality Check Stage";case"ready":return"Ready Stage";case"delivered":return"Delivery Stage";default:return s.replace("_"," ").toUpperCase()}},V=s=>{switch(s){case"in_diagnosis":return"bg-blue-100 text-blue-800 border-blue-200";case"in_repair":return"bg-orange-100 text-orange-800 border-orange-200";case"in_quality_check":return"bg-purple-100 text-purple-800 border-purple-200";case"ready":return"bg-green-100 text-green-800 border-green-200";case"delivered":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},E=s=>{switch(s){case"in_diagnosis":return xe;case"in_repair":return _;case"in_quality_check":return oe;case"ready":return pe;case"delivered":return oe;default:return S}},a=s=>{switch(s){case"in_diagnosis":return 1;case"in_repair":return 2;case"in_quality_check":return 3;case"ready":return 4;case"delivered":return 5;default:return 999}},r=s=>new Date(s).toLocaleString();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Work Type Based Repair History"}),e.jsx("p",{className:"text-gray-600",children:j?`Complete repair history for car ${j} organized by work types`:"Repair history organized by work type stages"})]}),v&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:v.totalTransitions}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Transitions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:v.uniqueCars}),e.jsx("div",{className:"text-sm text-gray-600",children:"Unique Cars"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(J,{htmlFor:"search",children:"Search Work Type History"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(K,{id:"search",placeholder:"Search by work type, car model, or employee...",value:g,onChange:s=>i(s.target.value),className:"pl-10"})]})]}),e.jsxs(W,{onClick:I,variant:"outline",className:"self-end",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsx("div",{className:"space-y-6",children:w.length===0?e.jsx(o,{children:e.jsxs(x,{className:"p-6 text-center",children:[e.jsx(U,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No work type history found"})]})}):w.map(s=>{const t=s.icon;return e.jsxs(o,{className:"border-2",children:[e.jsx(M,{className:`${s.color} border-b`,children:e.jsxs(B,{className:"flex items-center gap-3",children:[e.jsx(t,{className:"h-6 w-6"}),e.jsx("span",{children:s.label}),e.jsxs(h,{variant:"outline",className:"ml-auto",children:[s.entries.length," entries"]})]})}),e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Parts Used"})]}),e.jsx("div",{className:"text-xl font-bold text-blue-900",children:s.totalParts}),e.jsxs("div",{className:"text-sm text-blue-600",children:["Total Cost: $",s.totalPartsCost.toLocaleString()]})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Tools Used"})]}),e.jsx("div",{className:"text-xl font-bold text-orange-900",children:s.totalTools}),e.jsxs("div",{className:"text-sm text-orange-600",children:["Total Cost: $",s.totalToolsCost.toLocaleString()]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Mechanics"})]}),e.jsx("div",{className:"text-xl font-bold text-green-900",children:new Set(s.mechanics).size}),e.jsx("div",{className:"text-sm text-green-600",children:"Unique mechanics"})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Notes"})]}),e.jsx("div",{className:"text-xl font-bold text-purple-900",children:s.notes.length}),e.jsx("div",{className:"text-sm text-purple-600",children:"Total notes"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Detailed Entries"}),s.entries.map(c=>{var d,p;return e.jsx(o,{className:"border border-gray-200",children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:c.carModel}),c.carVin&&e.jsx(h,{variant:"outline",className:"text-xs",children:c.carVin})]}),e.jsx("div",{className:"text-sm text-gray-500",children:r(c.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),e.jsx("span",{children:c.changedBy})]}),c.duration&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsx("span",{children:c.duration})]})]}),c.partsUsed&&c.partsUsed.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Parts Used"}),e.jsxs(h,{variant:"outline",className:"text-xs",children:[c.partsUsed.length," parts"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:c.partsUsed.map((N,H)=>e.jsx(h,{variant:"secondary",className:"text-xs",children:N},H))}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(C,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-700",children:["Cost: $",((d=c.totalPartsCost)==null?void 0:d.toLocaleString())||"0"]})]})]}),c.toolsUsed&&c.toolsUsed.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Tools Used"}),e.jsxs(h,{variant:"outline",className:"text-xs",children:[c.toolsUsed.length," tools"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:c.toolsUsed.map((N,H)=>e.jsx(h,{variant:"secondary",className:"text-xs",children:N},H))}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(C,{className:"h-3 w-3 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-700",children:["Cost: $",((p=c.totalToolsCost)==null?void 0:p.toLocaleString())||"0"]})]})]}),c.workNotes&&e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-800",children:"Work Notes"})]}),e.jsx("p",{className:"text-sm text-gray-700",children:c.workNotes})]}),c.issueDescription&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xe,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"font-medium text-red-800",children:"Issue Description"})]}),e.jsx("p",{className:"text-sm text-red-700",children:c.issueDescription})]}),c.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:c.notes}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs(W,{size:"sm",variant:"outline",onClick:()=>{F(s),L(!0)},className:"flex items-center gap-1",children:[e.jsx(re,{className:"h-4 w-4"}),"View Stage Details"]})})]})},c.id)})]})]})]},s.workType)})}),l&&e.jsx(X,{open:Q,onOpenChange:L,children:e.jsxs(ee,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),l.label," Stage Details - ",l.entries.length," Entries"]})}),e.jsxs(le,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(te,{className:"grid w-full grid-cols-4",children:[e.jsx(u,{value:"overview",children:"Overview"}),e.jsx(u,{value:"entries",children:"All Entries"}),e.jsx(u,{value:"resources",children:"Resources Used"}),e.jsx(u,{value:"analytics",children:"Analytics"})]}),e.jsxs(f,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Stage Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Work Type:"}),e.jsx(h,{className:"text-white bg-blue-600",children:l.workType.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total Entries:"}),e.jsx("span",{children:l.entries.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Unique Mechanics:"}),e.jsx("span",{children:new Set(l.mechanics).size})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total Duration:"}),e.jsx("span",{children:l.duration||"Not specified"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Resource Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Parts Used:"}),e.jsxs("span",{children:[l.totalParts," parts"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Parts Cost:"}),e.jsxs("span",{className:"font-mono",children:["$",l.totalPartsCost.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Tools Used:"}),e.jsxs("span",{children:[l.totalTools," tools"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Tools Cost:"}),e.jsxs("span",{className:"font-mono",children:["$",l.totalToolsCost.toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Mechanics Involved"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Set(l.mechanics)).map((s,t)=>e.jsxs(h,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),s]},t))})]})]}),e.jsx(f,{value:"entries",className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["All Stage Entries (",l.entries.length,")"]}),e.jsx("div",{className:"space-y-3",children:l.entries.map((s,t)=>{var c,d,p,N;return e.jsx(o,{className:"border",children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Vehicle Information"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-3 w-3"}),e.jsx("span",{children:s.carModel})]}),s.carVin&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"VIN:"}),e.jsx("span",{className:"font-mono text-xs",children:s.carVin})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Work Details"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-3 w-3"}),e.jsx("span",{children:s.changedBy})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(s.timestamp).toLocaleDateString()})]}),s.duration&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-3 w-3"}),e.jsx("span",{children:s.duration})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Resources"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-3 w-3 text-blue-600"}),e.jsxs("span",{children:[((c=s.partsUsed)==null?void 0:c.length)||0," parts"]}),e.jsxs("span",{className:"text-green-600 font-mono",children:["$",((d=s.totalPartsCost)==null?void 0:d.toLocaleString())||"0"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-3 w-3 text-orange-600"}),e.jsxs("span",{children:[((p=s.toolsUsed)==null?void 0:p.length)||0," tools"]}),e.jsxs("span",{className:"text-green-600 font-mono",children:["$",((N=s.totalToolsCost)==null?void 0:N.toLocaleString())||"0"]})]})]})]})]}),(s.workNotes||s.notes)&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),s.workNotes&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.workNotes}),s.notes&&e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})]})]})},s.id)})})]})}),e.jsx(f,{value:"resources",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-blue-600"}),"Parts Used Across Stage"]}),e.jsxs("div",{className:"space-y-2",children:[Array.from(new Set(l.entries.flatMap(s=>s.partsUsed||[]))).map((s,t)=>e.jsxs("div",{className:"p-3 border rounded-lg bg-blue-50",children:[e.jsx("div",{className:"font-medium",children:s}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Used in ",l.entries.filter(c=>{var d;return(d=c.partsUsed)==null?void 0:d.includes(s)}).length," entries"]})]},t)),e.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-800",children:["Total Parts Cost: $",l.totalPartsCost.toLocaleString()]})]})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-orange-600"}),"Tools Used Across Stage"]}),e.jsxs("div",{className:"space-y-2",children:[Array.from(new Set(l.entries.flatMap(s=>s.toolsUsed||[]))).map((s,t)=>e.jsxs("div",{className:"p-3 border rounded-lg bg-orange-50 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-orange-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Used in ",l.entries.filter(c=>{var d;return(d=c.toolsUsed)==null?void 0:d.includes(s)}).length," entries"]})]})]},t)),e.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border-l-4 border-green-400",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-800",children:["Total Tools Cost: $",l.totalToolsCost.toLocaleString()]})]})})]})]})]})}),e.jsxs(f,{value:"analytics",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Cars Processed"})]}),e.jsx("div",{className:"text-2xl font-bold",children:new Set(l.entries.map(s=>s.carVin)).size}),e.jsx("div",{className:"text-sm text-gray-600",children:"unique vehicles"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Mechanics"})]}),e.jsx("div",{className:"text-2xl font-bold",children:new Set(l.mechanics).size}),e.jsx("div",{className:"text-sm text-gray-600",children:"involved"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Avg Parts"})]}),e.jsx("div",{className:"text-2xl font-bold",children:l.entries.length>0?Math.round(l.totalParts/l.entries.length):0}),e.jsx("div",{className:"text-sm text-gray-600",children:"per entry"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Total Cost"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:["$",(l.totalPartsCost+l.totalToolsCost).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:"parts + tools"})]})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Timeline"}),e.jsx("div",{className:"space-y-2",children:l.entries.sort((s,t)=>new Date(s.timestamp).getTime()-new Date(t.timestamp).getTime()).map((s,t)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold",children:t+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.carModel}),e.jsx("div",{className:"text-sm text-gray-600",children:s.changedBy})]}),e.jsx("div",{className:"text-sm text-gray-600",children:new Date(s.timestamp).toLocaleDateString()})]},s.id))})]})]})]})]})})]})},ue=({searchQuery:j="",carVin:y,showAll:n=!0})=>{const[P,g]=m.useState([]),[i,w]=m.useState(null),[$,v]=m.useState(!1),[z,l]=m.useState(!1),[F,Q]=m.useState([]),[L,I]=m.useState("");m.useEffect(()=>{R()},[j,y]);const R=()=>{let s=q.getRepairHistory();y&&!n&&(s=s.filter(t=>t.car_vin.toLowerCase().includes(y.toLowerCase()))),j&&(s=q.searchRepairHistory(j)),s.sort((t,c)=>new Date(c.completion_date||c.created_at).getTime()-new Date(t.completion_date||t.created_at).getTime()),g(s)},T=s=>{const t={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-orange-100 text-orange-800",expert:"bg-red-100 text-red-800"};return t[s]||t.medium},V=s=>({mechanical:e.jsx(_,{className:"h-4 w-4"}),electrical:e.jsx(Z,{className:"h-4 w-4"}),body_work:e.jsx(U,{className:"h-4 w-4"}),painter:e.jsx(Z,{className:"h-4 w-4"}),detailer:e.jsx(Z,{className:"h-4 w-4"})})[s]||e.jsx(_,{className:"h-4 w-4"}),E=s=>e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(t=>e.jsx(Z,{className:`h-4 w-4 ${t<=s?"text-yellow-400 fill-current":"text-gray-300"}`},t)),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",s,"/5)"]})]}),a=(s,t)=>{Q(s),I(t),l(!0)},r=s=>{const t=`
MONZA TECH - REPAIR COMPLETION REPORT
=====================================

Car Information:
- VIN: ${s.car_vin}
- Model: ${s.car_model}
- Customer: ${s.client_name}

Repair Details:
- Issue: ${s.issue_description}
- Solution: ${s.solution_description}
- Work Type: ${s.work_type||"N/A"}
- Mechanic: ${s.technician_name}
- Date: ${s.repair_date}
- Completion: ${s.completion_date||"N/A"}

Repair Steps:
${s.repair_steps.map((N,H)=>`${H+1}. ${N}`).join(`
`)}

Parts Used:
${s.parts_used.map(N=>`- ${N.part_name} (${N.quantity}x) - $${N.cost}`).join(`
`)}

Tools Used:
${s.tools_used.map(N=>`- ${N}`).join(`
`)}

Performance:
- Labor Hours: ${s.labor_hours||0}
- Total Cost: $${s.total_cost||0}
- Difficulty: ${s.difficulty_level}
- Quality Rating: ${s.quality_rating}/5
- Client Satisfaction: ${s.client_satisfaction}/5
- Warranty: ${s.warranty_period} months

Mechanic Notes:
${s.mechanic_notes||"No additional notes"}

Recommendations:
${s.recommendation||"No specific recommendations"}

Generated on: ${new Date().toLocaleString()}
    `,c=new Blob([t],{type:"text/plain"}),d=URL.createObjectURL(c),p=document.createElement("a");p.href=d,p.download=`repair_report_${s.car_vin}_${s.repair_date}.txt`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(d)};return P.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Enhanced Repair History"}),e.jsx("p",{className:"text-gray-600",children:j||y?"No repair records match your search criteria":"Enhanced repair history will appear here when repairs are completed through the new system"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Total Repairs"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:q.getRepairStatistics().totalRepairs})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Parts Used"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:q.getRepairStatistics().totalParts})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Mechanics"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:q.getRepairStatistics().totalMechanics})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Cars Serviced"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:q.getRepairStatistics().totalCars})]})})]}),e.jsx("div",{className:"space-y-4",children:P.map(s=>{var t,c,d;return e.jsxs(o,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:V(s.work_type||"mechanical")}),e.jsxs("div",{children:[e.jsxs(B,{className:"text-lg",children:[s.car_model," (",s.car_vin,")"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-4 w-4"}),s.client_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-4 w-4"}),new Date(s.repair_date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-4 w-4"}),s.technician_name]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{className:T(s.difficulty_level||"medium"),children:(t=s.difficulty_level)==null?void 0:t.toUpperCase()}),e.jsxs(W,{size:"sm",variant:"outline",onClick:()=>{w(s),v(!0)},children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"View Details"]})]})]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Issue Description"}),e.jsx("p",{className:"text-sm text-gray-600 bg-red-50 p-3 rounded-lg border-l-4 border-red-200",children:s.issue_description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Solution"}),e.jsx("p",{className:"text-sm text-gray-600 bg-green-50 p-3 rounded-lg border-l-4 border-green-200",children:s.solution_description})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Quality Rating"}),E(s.quality_rating||0)]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Client Satisfaction"}),E(s.client_satisfaction||0)]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Performance"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Labor Hours:"}),e.jsxs("span",{className:"font-medium",children:[s.labor_hours||0,"h"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Cost:"}),e.jsxs("span",{className:"font-medium",children:["$",s.total_cost||0]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Warranty:"}),e.jsxs("span",{className:"font-medium",children:[s.warranty_period||0," months"]})]})]})]})]}),(((c=s.before_photos)==null?void 0:c.length)||((d=s.after_photos)==null?void 0:d.length))&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Photo Documentation"}),e.jsxs("div",{className:"flex gap-4",children:[s.before_photos&&s.before_photos.length>0&&e.jsxs(W,{size:"sm",variant:"outline",onClick:()=>a(s.before_photos,"Before Photos"),className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Before Photos (",s.before_photos.length,")"]}),s.after_photos&&s.after_photos.length>0&&e.jsxs(W,{size:"sm",variant:"outline",onClick:()=>a(s.after_photos,"After Photos"),className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"After Photos (",s.after_photos.length,")"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),s.parts_used.length," parts used"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-4 w-4"}),s.tools_used.length," tools used"]}),s.follow_up_required&&e.jsx(h,{variant:"outline",className:"bg-yellow-50 text-yellow-700",children:"Follow-up Required"})]}),e.jsxs(W,{size:"sm",variant:"outline",onClick:()=>r(s),children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"Download Report"]})]})]})]},s.id)})}),i&&e.jsx(X,{open:$,onOpenChange:v,children:e.jsxs(ee,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Repair Details - ",i.car_model," (",i.car_vin,")"]})}),e.jsxs(le,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(te,{className:"grid w-full grid-cols-4",children:[e.jsx(u,{value:"overview",children:"Overview"}),e.jsx(u,{value:"parts-tools",children:"Parts & Tools"}),e.jsx(u,{value:"notes",children:"Notes & Steps"}),e.jsx(u,{value:"photos",children:"Photos"})]}),e.jsx(f,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Customer Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsx("span",{children:i.client_name})]}),i.client_phone&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{children:i.client_phone})]}),i.client_email&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{children:i.client_email})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Repair Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Repair Date:"}),e.jsx("span",{children:new Date(i.repair_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Completion:"}),e.jsx("span",{children:i.completion_date?new Date(i.completion_date).toLocaleDateString():"In Progress"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Work Type:"}),e.jsx(h,{variant:"outline",children:i.work_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Difficulty:"}),e.jsx(h,{className:T(i.difficulty_level||"medium"),children:i.difficulty_level})]})]})]})]})}),e.jsx(f,{value:"parts-tools",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Parts Used"}),e.jsx("div",{className:"space-y-2",children:i.parts_used.map((s,t)=>e.jsx("div",{className:"p-3 border rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.part_name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["#",s.part_number]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Supplier: ",s.supplier]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["Qty: ",s.quantity]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["$",s.cost]})]})]})},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Tools Used"}),e.jsx("div",{className:"space-y-2",children:i.tools_used.map((s,t)=>e.jsxs("div",{className:"p-2 border rounded-lg flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{children:s})]},t))})]})]})}),e.jsx(f,{value:"notes",className:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Repair Steps"}),e.jsx("div",{className:"space-y-2",children:i.repair_steps.map((s,t)=>e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:t+1}),e.jsx("span",{children:s})]},t))})]}),i.mechanic_notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Mechanic Notes"}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border-l-4 border-blue-200",children:i.mechanic_notes})]}),i.recommendation&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Recommendations"}),e.jsx("div",{className:"p-4 bg-green-50 rounded-lg border-l-4 border-green-200",children:i.recommendation})]})]})}),e.jsx(f,{value:"photos",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Before Photos"}),i.before_photos&&i.before_photos.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.before_photos.map((s,t)=>e.jsx("img",{src:s,alt:`Before ${t+1}`,className:"w-full h-32 object-cover rounded-lg border cursor-pointer hover:opacity-75",onClick:()=>a([s],`Before Photo ${t+1}`)},t))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),"No before photos"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"After Photos"}),i.after_photos&&i.after_photos.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.after_photos.map((s,t)=>e.jsx("img",{src:s,alt:`After ${t+1}`,className:"w-full h-32 object-cover rounded-lg border cursor-pointer hover:opacity-75",onClick:()=>a([s],`After Photo ${t+1}`)},t))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),"No after photos"]})]})]})})]})]})}),e.jsx(X,{open:z,onOpenChange:l,children:e.jsxs(ee,{className:"max-w-3xl",children:[e.jsx(se,{children:e.jsx(ae,{children:L})}),e.jsx("div",{className:"grid grid-cols-1 gap-4 max-h-96 overflow-y-auto",children:F.map((s,t)=>e.jsx("img",{src:s,alt:`${L} ${t+1}`,className:"w-full max-h-80 object-contain rounded-lg border"},t))})]})})]})},Te=()=>{const[j,y]=m.useState(""),[n,P]=m.useState(""),[g,i]=m.useState("work-type-based");return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Repair History"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive repair history with work type tracking, parts, and tools"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:e.jsx(ce,{className:"h-8 w-8 mx-auto mb-2"})}),e.jsx("div",{className:"text-sm text-gray-600",children:"Complete History"})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(J,{htmlFor:"search",children:"Search Repair History"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(K,{id:"search",placeholder:"Search by car VIN, model, or employee...",value:j,onChange:w=>y(w.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"w-64",children:[e.jsx(J,{htmlFor:"carVin",children:"Filter by Car VIN"}),e.jsx(K,{id:"carVin",placeholder:"Enter car VIN...",value:n,onChange:w=>P(w.target.value)})]}),e.jsxs(W,{variant:"outline",className:"self-end",onClick:()=>{y(""),P("")},children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Clear Filters"]})]}),e.jsxs(le,{value:g,onValueChange:i,className:"w-full",children:[e.jsxs(te,{className:"grid w-full grid-cols-3",children:[e.jsxs(u,{value:"enhanced",className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Enhanced History"]}),e.jsxs(u,{value:"work-type-based",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Work Type Based"]}),e.jsxs(u,{value:"chronological",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Chronological"]})]}),e.jsx(f,{value:"enhanced",className:"mt-6",children:e.jsxs(o,{children:[e.jsx(M,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Enhanced Repair History with Photos & Details"]})}),e.jsx(x,{children:e.jsx(ue,{searchQuery:j,carVin:n||void 0,showAll:!n})})]})}),e.jsx(f,{value:"work-type-based",className:"mt-6",children:e.jsxs(o,{children:[e.jsx(M,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Work Type Based Repair History"]})}),e.jsx(x,{children:e.jsx(Ne,{carVin:n||void 0,showAll:!n})})]})}),e.jsx(f,{value:"chronological",className:"mt-6",children:e.jsxs(o,{children:[e.jsx(M,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Chronological Repair History"]})}),e.jsx(x,{children:e.jsx(ge,{carVin:n||void 0,showAll:!n})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Total Cars"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:"-"}),e.jsx("div",{className:"text-sm text-blue-600",children:"in repair history"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Total Parts"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:"-"}),e.jsx("div",{className:"text-sm text-green-600",children:"used across all repairs"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Total Tools"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:"-"}),e.jsx("div",{className:"text-sm text-orange-600",children:"used across all repairs"})]})}),e.jsx(o,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Total Mechanics"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:"-"}),e.jsx("div",{className:"text-sm text-purple-600",children:"involved in repairs"})]})})]})]})};export{Te as default};
