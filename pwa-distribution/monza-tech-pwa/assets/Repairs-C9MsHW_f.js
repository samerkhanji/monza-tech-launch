import{R as is,r as f,t as X,j as e,I as F,d as U,S as We,U as Qe,Y as De,Z as Te,_ as ie,e as R,s as re,$ as Ke,a0 as ns,D as fe,a as Ne,b as ve,c as we,a1 as Q,a2 as ls,a3 as xe,a4 as $e,L as W,a5 as os,a6 as cs,a7 as ds,a8 as ms,a9 as me,aa as be,B as M,X as ue,ab as us,w as Z,ac as _e,f as se,g as te,T as hs,i as q,k as Ye,l as Ze,m as he,n as J,o as Xe,p as z,ad as ge,ae as Ve,af as He,ag as xs,ah as gs,ai as ps,h as Ie,aj as Me,ak as Pe,al as Re,am as Ee,an as es,C as ss,ao as ts,ap as Ge,aq as js,ar as ys,as as qe,at as ze,au as fs,av as Ns,aw as vs,ax as ws,ay as bs,az as Ss,A as Ce,aA as ce,aB as ks}from"./index-CrIDvSVN.js";import{S as Cs}from"./scroll-area-CTkIDaID.js";import{P as Ds,w as Fe}from"./PartNumberScannerDialog-CtbQQyHr.js";import{I as Ts}from"./info-CMQr5IZ4.js";import{S as _s}from"./square-pen-Cu5lUal4.js";import{C as Is}from"./crown-IQ0HPxYR.js";import{S as Es}from"./star-Bd80_wkG.js";import{H as Ms,S as Ps}from"./sparkles-BHtJ_4Ts.js";import{E as Je}from"./EnhancedSelect-DTYmsXxj.js";import"./loader-2-BI9Qerkv.js";import"./rotate-ccw-CHwXVFf3.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=is("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),Os=(m,n)=>{const[t,g]=f.useState(null),[v,p]=f.useState(!1);return{selectedCar:t,detailsModalOpen:v,setDetailsModalOpen:p,openCarDetails:h=>{g(h),p(!0)},handleUpdateStatus:(h,N)=>{if(typeof n!="function")return;const T=new Date().toISOString(),A=m.map(C=>C.id===h?{...C,status:N,lastUpdated:T,endTimestamp:N==="ready"?T:C.endTimestamp}:C);n(A),localStorage.setItem("garageCars",JSON.stringify(A)),X({title:"Status Updated",description:`Car status has been updated to ${N.replace("_"," ")}`})},handleUpdateCarDetails:(h,N)=>{if(typeof n!="function")return;const T=new Date().toISOString(),A=m.map(C=>C.id===h?{...C,...N,lastUpdated:T}:C);n(A),localStorage.setItem("garageCars",JSON.stringify(A)),p(!1),g(null),X({title:"Car Details Updated",description:"Car details have been updated successfully."})}}},Us=(m,n)=>{const[t,g]=f.useState(""),v=m.filter(p=>(p.carModel.toLowerCase().includes(t.toLowerCase())||p.carCode.toLowerCase().includes(t.toLowerCase())||p.customerName.toLowerCase().includes(t.toLowerCase())||p.issueDescription&&p.issueDescription.toLowerCase().includes(t.toLowerCase())||p.mechanics&&p.mechanics.some(S=>S.toLowerCase().includes(t.toLowerCase())))&&n==="all");return{searchTerm:t,setSearchTerm:g,filteredCars:v}},Ls=()=>{const[m,n]=f.useState([]),[t,g]=f.useState([]);f.useEffect(()=>{const o=()=>{let N=localStorage.getItem("garageSchedules");if(N||(N=localStorage.getItem("garageSchedule")),N)try{const T=JSON.parse(N),A=Array.isArray(T)?T:[T],C=new Date().toISOString().split("T")[0],r=A.find(c=>c.date===C);r&&r.scheduledCars?(n(r.scheduledCars),console.log(`Garage Schedule Integration: Loaded ${r.scheduledCars.length} scheduled cars for today`)):(console.log("Garage Schedule Integration: No scheduled cars found for today"),n([]))}catch(T){console.error("Error loading scheduled cars:",T)}else console.log("Garage Schedule Integration: No schedules found in localStorage")},S=()=>{const N=localStorage.getItem("carInventory");if(N)try{const A=JSON.parse(N).filter(C=>C.damages&&C.damages.length>0||C.notes&&C.notes.toLowerCase().includes("issue")||C.notes&&C.notes.toLowerCase().includes("problem")||C.notes&&C.notes.toLowerCase().includes("repair"));g(A)}catch(T){console.error("Error loading inventory cars:",T)}};o(),S();const h=N=>{N.key==="garageSchedules"||N.key==="garageSchedule"?o():N.key==="carInventory"&&S()};return window.addEventListener("storage",h),()=>window.removeEventListener("storage",h)},[]);const v=f.useCallback(()=>{let o=localStorage.getItem("garageSchedules");o||(o=localStorage.getItem("garageSchedule"));const S=localStorage.getItem("garageCars");if(!o)return[];try{const h=JSON.parse(o),N=Array.isArray(h)?h:[h],T=S?JSON.parse(S):[],A=N.flatMap(r=>(r.scheduledCars||[]).map(c=>({...c,scheduleDate:r.date}))),C=T.filter(r=>A.some(c=>c.carCode===r.carCode)||r.status==="delivered"||r.endTimestamp);return localStorage.setItem("garageCars",JSON.stringify(C)),C}catch(h){return console.error("Error syncing schedule with garage:",h),[]}},[]);return{scheduledCars:m,inventoryCarsWithIssues:t,convertScheduledCarToGarageCar:o=>({id:`garage-${o.id}`,carModel:o.carModel,carCode:o.carCode,customerName:o.customerName,entryDate:new Date().toISOString(),status:"in_diagnosis",assignedEmployee:o.assignedMechanic||"Unassigned",mechanics:o.assignedMechanic?[o.assignedMechanic]:[],notes:o.notes,workNotes:`Scheduled work: ${o.workType} (${o.estimatedDuration}h)`,issueDescription:`Category: ${o.workType}, Priority: ${o.priority}`,repairDuration:o.estimatedDuration+"h",lastUpdated:new Date().toISOString()}),convertInventoryCarToGarageCar:o=>{const S=o.damages&&o.damages.length>0?o.damages.map(h=>`${h.severity} ${h.description} at ${h.location}`).join("; "):o.notes||"General maintenance required";return{id:`garage-inv-${o.id}`,carModel:o.model,carCode:o.vinNumber,customerName:o.clientName||"Inventory Vehicle",entryDate:new Date().toISOString(),status:"in_diagnosis",assignedEmployee:"Unassigned",mechanics:[],notes:o.notes,issueDescription:S,workNotes:"Transferred from inventory due to reported issues",lastUpdated:new Date().toISOString()}},syncScheduleWithGarage:v}},as=()=>{const[m,n]=f.useState([]),[t,g]=f.useState([]);return f.useEffect(()=>{const v=()=>{let E=localStorage.getItem("garageSchedules");if(E||(E=localStorage.getItem("garageSchedule")),E)try{const o=JSON.parse(E),S=Array.isArray(o)?o:[o];n(S);const h=S.flatMap(N=>(N.scheduledCars||[]).map(T=>({...T,scheduleDate:N.date,scheduleTime:`${N.startTime} - ${N.endTime}`,available:N.available,scheduleNotes:N.notes})));g(h),console.log(`Garage Schedule Data: Loaded ${h.length} scheduled cars`)}catch(o){console.error("Error loading garage schedules:",o)}else console.log("Garage Schedule Data: No schedules found in localStorage")};v();const p=E=>{(E.key==="garageSchedules"||E.key==="garageSchedule")&&v()};return window.addEventListener("storage",p),()=>window.removeEventListener("storage",p)},[]),{schedules:m,allScheduledCars:t}},Ws=({searchTerm:m,setSearchTerm:n,isGarageManager:t,onSyncScheduledCars:g})=>{const v=()=>{X({title:"Data Refreshed",description:"Garage overview has been updated with latest information"})},p=()=>{g==null||g(),X({title:"Scheduled Cars Synced",description:"Cars from garage schedule have been synced to garage overview"})},E=()=>{X({title:"Export Started",description:"Garage report is being generated..."})};return e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Garage Overview"}),e.jsx("p",{className:"text-muted-foreground",children:t?"Manage and track all garage operations":"View current garage status"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{placeholder:"Search cars...",value:m,onChange:o=>n(o.target.value),className:"w-64"}),e.jsxs(U,{variant:"outline",size:"sm",onClick:v,children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(U,{variant:"outline",size:"sm",onClick:p,className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Sync Schedule"]}),t&&e.jsxs(U,{variant:"outline",size:"sm",onClick:E,children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]})},$s=({activeTab:m,setActiveTab:n})=>e.jsx(De,{value:m,onValueChange:n,className:"w-full sm:w-auto",children:e.jsxs(Te,{children:[e.jsx(ie,{value:"all",children:"All"}),e.jsx(ie,{value:"in_garage",children:"In Garage"}),e.jsx(ie,{value:"delivered",children:"Delivered"})]})}),Vs=({cars:m,searchTerm:n,setSearchTerm:t,activeTab:g,setActiveTab:v})=>e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Garage Status Summary"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded-md p-3",children:[e.jsx("div",{className:"text-muted-foreground text-sm",children:"In Diagnosis"}),e.jsx("div",{className:"text-2xl font-bold",children:m.filter(p=>p.status==="in_diagnosis").length})]}),e.jsxs("div",{className:"border rounded-md p-3",children:[e.jsx("div",{className:"text-muted-foreground text-sm",children:"In Repair"}),e.jsx("div",{className:"text-2xl font-bold",children:m.filter(p=>p.status==="in_repair").length})]}),e.jsxs("div",{className:"border rounded-md p-3",children:[e.jsx("div",{className:"text-muted-foreground text-sm",children:"In Quality Check"}),e.jsx("div",{className:"text-2xl font-bold",children:m.filter(p=>p.status==="in_quality_check").length})]}),e.jsxs("div",{className:"border rounded-md p-3",children:[e.jsx("div",{className:"text-muted-foreground text-sm",children:"Ready for Pickup"}),e.jsx("div",{className:"text-2xl font-bold",children:m.filter(p=>p.status==="ready").length})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsx($s,{activeTab:g,setActiveTab:v}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsx(F,{placeholder:"Search cars...",value:n,onChange:p=>t(p.target.value),className:"w-full"})})]})]})}),Hs={in_diagnosis:"In Diagnosis",in_repair:"In Repair",in_quality_check:"Quality Check",ready:"Ready for Pickup",delivered:"Delivered"},Rs={async trackProductivity(m){try{const n=new Date(m.estimatedStart),t=new Date(n);t.setDate(n.getDate()-n.getDay());const g=Math.ceil((n.getTime()-new Date(n.getFullYear(),0,1).getTime())/(7*24*60*60*1e3)),v=n.getFullYear(),{error:p}=await re.from("productivity_tracking").insert({car_id:m.carId,car_code:m.carCode,customer_name:m.customerName,assigned_mechanics:m.assignedMechanics,work_type:m.workType,estimated_hours:m.estimatedHours,actual_hours:m.actualHours,estimated_start:m.estimatedStart,actual_start:m.actualStart,estimated_completion:m.estimatedCompletion,actual_completion:m.actualCompletion,status:m.status||"in_progress",delay_reason:m.delayReason,productivity_notes:m.productivityNotes,quality_issues:m.qualityIssues||[],week_start:t.toISOString().split("T")[0],week_number:g,year:v});if(p)throw p;await this.generateWeeklySummary(new Date(m.estimatedStart)),await this.generateAIInsights(),console.log("Productivity tracking recorded successfully")}catch(n){throw console.error("Error tracking productivity:",n),n}},async updateProductivityCompletion(m,n,t,g){try{const{error:v}=await re.from("productivity_tracking").update({actual_completion:n,actual_hours:t,status:"completed",quality_issues:g||[],updated_at:new Date().toISOString()}).eq("car_code",m).eq("status","in_progress");if(v)throw v;await this.generateWeeklySummary(new Date(n)),await this.generateAIInsights(),console.log("Productivity completion updated successfully")}catch(v){throw console.error("Error updating productivity completion:",v),v}},async generateWeeklySummary(m){try{const{error:n}=await re.rpc("generate_weekly_summary",{week_date:m.toISOString().split("T")[0]});if(n)throw n;console.log("Weekly summary generated successfully")}catch(n){throw console.error("Error generating weekly summary:",n),n}},async getWeeklyProductivity(m){try{const{data:n,error:t}=await re.from("weekly_productivity_summary").select("*").eq("week_start",m).single();if(t&&t.code!=="PGRST116")throw t;return n?{weekStart:n.week_start,weekEnd:n.week_end,totalCarsWorked:n.total_cars_worked,totalEstimatedHours:n.total_estimated_hours,totalActualHours:n.total_actual_hours,overallEfficiencyPercentage:n.overall_efficiency_percentage,carsCompletedOnTime:n.cars_completed_on_time,carsDelayed:n.cars_delayed,averageDelayHours:n.average_delay_hours,electricalHours:n.electrical_hours,painterHours:n.painter_hours,detailerHours:n.detailer_hours,mechanicHours:n.mechanic_hours,bodyWorkHours:n.body_work_hours}:null}catch(n){throw console.error("Error fetching weekly productivity:",n),n}},async getMechanicPerformance(m){try{const{data:n,error:t}=await re.from("mechanic_performance").select("*").eq("week_start",m).order("efficiency_percentage",{ascending:!1});if(t)throw t;return n||[]}catch(n){throw console.error("Error fetching mechanic performance:",n),n}},async generateAIInsights(){try{const m=new Date;m.setDate(m.getDate()-28);const{data:n,error:t}=await re.from("weekly_productivity_summary").select("*").gte("week_start",m.toISOString().split("T")[0]).order("week_start",{ascending:!1}).limit(4);if(t||!n||n.length<2)return;const g=n[0],v=n[1],p=[];if(g.overall_efficiency_percentage&&v.overall_efficiency_percentage){const o=v.overall_efficiency_percentage-g.overall_efficiency_percentage;o>10&&p.push({insight_type:"efficiency",priority:o>20?"high":"medium",title:"Significant Efficiency Drop Detected",description:`Overall garage efficiency dropped by ${o.toFixed(1)}% this week compared to last week.`,affected_area:"overall",efficiency_drop:o,recommended_actions:["Review work allocation and scheduling","Check if mechanics need additional training","Analyze bottlenecks in the workflow","Consider equipment maintenance or upgrades"],expected_improvement:"Could improve efficiency by 15-25% within 2 weeks",week_start:g.week_start,week_end:g.week_end})}if(g.average_delay_hours&&v.average_delay_hours){const o=g.average_delay_hours-v.average_delay_hours;o>2&&p.push({insight_type:"bottleneck",priority:o>5?"high":"medium",title:"Increasing Repair Delays",description:`Average repair delays increased by ${o.toFixed(1)} hours this week.`,affected_area:"overall",delay_increase:o,recommended_actions:["Review parts inventory to prevent delays","Optimize scheduling to reduce wait times","Consider hiring additional mechanics for peak periods","Implement better project management tools"],expected_improvement:"Could reduce delays by 30-40% within 3 weeks",week_start:g.week_start,week_end:g.week_end})}const E=g.electrical_hours+g.painter_hours+g.detailer_hours+g.mechanic_hours+g.body_work_hours;if(E>0){const S=[{type:"electrical",hours:g.electrical_hours,name:"Electrical Work"},{type:"painter",hours:g.painter_hours,name:"Painting"},{type:"detailer",hours:g.detailer_hours,name:"Detailing"},{type:"mechanic",hours:g.mechanic_hours,name:"Mechanical Work"},{type:"body_work",hours:g.body_work_hours,name:"Body Work"}].reduce((h,N)=>N.hours>h.hours?N:h);S.hours/E>.6&&p.push({insight_type:"recommendation",priority:"medium",title:`${S.name} Capacity Imbalance`,description:`${S.name} accounts for ${(S.hours/E*100).toFixed(1)}% of total work hours, indicating potential capacity imbalance.`,affected_area:"work_type_specific",affected_entity:S.type,recommended_actions:[`Consider cross-training mechanics in ${S.name.toLowerCase()}`,"Hire specialized technicians for high-demand work types","Implement better work distribution strategies","Review pricing strategy for overloaded work types"],expected_improvement:"Better work distribution and reduced bottlenecks",week_start:g.week_start,week_end:g.week_end})}for(const o of p)await re.from("ai_insights").insert(o);console.log(`Generated ${p.length} AI insights`)}catch(m){console.error("Error generating AI insights:",m)}},async getAIInsights(m=10){try{const{data:n,error:t}=await re.from("ai_insights").select("*").order("created_at",{ascending:!1}).limit(m);if(t)throw t;return n||[]}catch(n){return console.error("Error fetching AI insights:",n),[]}},async acknowledgeInsight(m,n){try{const{error:t}=await re.from("ai_insights").update({status:"acknowledged",acknowledged_by:n,acknowledged_at:new Date().toISOString()}).eq("id",m);if(t)throw t;console.log("AI insight acknowledged")}catch(t){throw console.error("Error acknowledging insight:",t),t}}},Gs=({isOpen:m,setIsOpen:n,selectedCar:t,onSave:g})=>{const{user:v}=Ke(),[p,E]=f.useState((t==null?void 0:t.issueDescription)||""),[o,S]=f.useState((t==null?void 0:t.workNotes)||""),[h,N]=f.useState((t==null?void 0:t.partsUsed)||[]),[T,A]=f.useState(""),[C,r]=f.useState((t==null?void 0:t.mechanics)||[]),[c,i]=f.useState(""),[a,k]=f.useState(t!=null&&t.startTimestamp?new Date(t.startTimestamp).toISOString().slice(0,16):""),[w,l]=f.useState(t!=null&&t.endTimestamp?new Date(t.endTimestamp).toISOString().slice(0,16):""),[j,d]=f.useState("mechanic"),[_,P]=f.useState(8),[V,x]=f.useState(0),[D,I]=f.useState(""),[G,ae]=f.useState([]),[B,ee]=f.useState(""),[K,L]=f.useState("");ns.useEffect(()=>{if(t){if(E(t.issueDescription||""),S(t.workNotes||""),N(t.partsUsed||[]),r(t.mechanics||[]),k(t.startTimestamp?new Date(t.startTimestamp).toISOString().slice(0,16):""),l(t.endTimestamp?new Date(t.endTimestamp).toISOString().slice(0,16):""),t.startTimestamp&&!D){const y=new Date(t.startTimestamp);y.setHours(y.getHours()+_),I(y.toISOString().slice(0,16))}if(t.startTimestamp&&t.endTimestamp){const y=new Date(t.startTimestamp),de=(new Date(t.endTimestamp).getTime()-y.getTime())/(1e3*60*60);x(Math.round(de*100)/100)}}},[t]);const oe=y=>{A(y),X({title:"Part number scanned",description:`Part number ${y} ready to add`})},ne=()=>{T.trim()&&!h.includes(T.trim())&&(N([...h,T.trim()]),A(""))},le=y=>{N(h.filter(H=>H!==y))},pe=()=>{c.trim()&&!C.includes(c.trim())&&(r([...C,c.trim()]),i(""))},Se=y=>{r(C.filter(H=>H!==y))},je=()=>{B.trim()&&!G.includes(B.trim())&&(ae([...G,B.trim()]),ee(""))},ke=y=>{ae(G.filter(H=>H!==y))},ye=async()=>{if(!t)return;const y={issueDescription:p,workNotes:o,partsUsed:h,mechanics:C,startTimestamp:a?new Date(a).toISOString():t.startTimestamp,endTimestamp:w?new Date(w).toISOString():t.endTimestamp,lastUpdated:new Date().toISOString()};if(a&&C.length>0)try{const H=w?"completed":"in_progress",de={carId:t.id,carCode:t.carCode,customerName:t.customerName,assignedMechanics:C,workType:j,estimatedHours:_,actualHours:w?V:void 0,estimatedStart:a,actualStart:a,estimatedCompletion:D||new Date(Date.now()+_*60*60*1e3).toISOString(),actualCompletion:w||void 0,status:H,productivityNotes:K,qualityIssues:G};await Rs.trackProductivity(de),X({title:"Productivity Tracked",description:"Car details and productivity metrics have been recorded for AI analysis."})}catch(H){console.error("Error tracking productivity:",H),X({title:"Productivity Tracking Failed",description:"Car details saved but productivity tracking failed.",variant:"destructive"})}g(t.id,y),await Fe.trackClientInteraction({clientName:t.customerName,clientPhone:"",clientLicensePlate:"",carVin:t.carCode,interactionType:"repair_update",notes:`Updated repair details: ${o||"No specific notes"}`,employee:(v==null?void 0:v.name)||"Unknown Employee"}),await Fe.trackWorkflowEvent({eventType:"repair_details_updated",entityType:"repair",entityId:t.id,userName:(v==null?void 0:v.name)||"Unknown User",metadata:{carCode:t.carCode,customerName:t.customerName,partsCount:h.length,mechanicsCount:C.length,workType:j,estimatedHours:_}}),X({title:"Details Updated",description:`Details for ${t.carCode} have been saved successfully.`})};return t?e.jsx(fe,{open:m,onOpenChange:n,children:e.jsxs(Ne,{className:"sm:max-w-[900px] h-[90vh] bg-white opacity-100 flex flex-col",children:[e.jsxs(ve,{className:"flex-shrink-0",children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Edit Car Details - ",t.carModel," (",t.carCode,")"]}),e.jsx(ls,{children:"Update repair details, track productivity metrics, and manage team assignments."})]}),e.jsx(Cs,{className:"flex-1 pr-4",children:e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xe,{className:"h-4 w-4 text-blue-600"}),e.jsx("h3",{className:"text-sm font-medium text-blue-700",children:"Customer Information"})]}),e.jsxs("p",{className:"text-sm",children:["Customer: ",t.customerName]}),e.jsxs("p",{className:"text-sm",children:["Assigned Employee: ",t.assignedEmployee]}),e.jsxs("p",{className:"text-sm",children:["Entry Date: ",new Date(t.entryDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx($e,{className:"h-4 w-4 text-green-600"}),e.jsx("h3",{className:"text-sm font-medium text-green-700",children:"Productivity Tracking"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"workType",children:"Work Type"}),e.jsxs(os,{value:j,onValueChange:y=>d(y),children:[e.jsx(cs,{children:e.jsx(ds,{placeholder:"Select work type"})}),e.jsxs(ms,{children:[e.jsx(me,{value:"electrical",children:"Electrical"}),e.jsx(me,{value:"painter",children:"Painting"}),e.jsx(me,{value:"detailer",children:"Detailing"}),e.jsx(me,{value:"mechanic",children:"Mechanical"}),e.jsx(me,{value:"body_work",children:"Body Work"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"estimatedHours",children:"Estimated Hours"}),e.jsx(F,{id:"estimatedHours",type:"number",step:"0.5",min:"0",value:_,onChange:y=>P(Number(y.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"estimatedCompletion",children:"Estimated Completion"}),e.jsx(F,{id:"estimatedCompletion",type:"datetime-local",value:D,onChange:y=>I(y.target.value),className:"repair-dialog"})]}),w&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"actualHours",children:"Actual Hours"}),e.jsx(F,{id:"actualHours",type:"number",step:"0.1",min:"0",value:V,onChange:y=>x(Number(y.target.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{htmlFor:"issueDescription",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Issue Description"]}),e.jsx(be,{id:"issueDescription",value:p,onChange:y=>E(y.target.value),placeholder:"Describe the issue with the vehicle...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{htmlFor:"workNotes",className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"Work Notes"]}),e.jsx(be,{id:"workNotes",value:o,onChange:y=>S(y.target.value),placeholder:"Detailed work notes and observations...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{htmlFor:"productivityNotes",className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"Productivity Notes"]}),e.jsx(be,{id:"productivityNotes",value:K,onChange:y=>L(y.target.value),placeholder:"Notes about efficiency, delays, or productivity insights...",className:"min-h-[80px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Quality Issues"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{value:B,onChange:y=>ee(y.target.value),placeholder:"Add quality issue...",onKeyPress:y=>y.key==="Enter"&&je()}),e.jsx(U,{type:"button",onClick:je,children:"Add Issue"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map((y,H)=>e.jsxs(M,{variant:"destructive",className:"flex items-center gap-1",children:[y,e.jsx(ue,{className:"h-3 w-3 cursor-pointer",onClick:()=>ke(y)})]},H))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Part Numbers Used"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{value:T,onChange:y=>A(y.target.value),placeholder:"Add part number...",onKeyPress:y=>y.key==="Enter"&&ne(),className:"flex-1"}),e.jsx(Ds,{onPartNumberScanned:oe,children:e.jsx(U,{variant:"outline",size:"sm",type:"button",title:"Scan Part Number",children:e.jsx(us,{className:"h-4 w-4"})})}),e.jsx(U,{type:"button",onClick:ne,children:"Add Part"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map((y,H)=>e.jsxs(M,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-mono font-semibold",children:y}),e.jsx(ue,{className:"h-3 w-3 cursor-pointer",onClick:()=>le(y)})]},H))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Assigned Mechanics"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{value:c,onChange:y=>i(y.target.value),placeholder:"Add mechanic name...",onKeyPress:y=>y.key==="Enter"&&pe()}),e.jsx(U,{type:"button",onClick:pe,children:"Add Mechanic"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map((y,H)=>e.jsxs(M,{variant:"outline",className:"flex items-center gap-1",children:[y,e.jsx(ue,{className:"h-3 w-3 cursor-pointer",onClick:()=>Se(y)})]},H))})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Z,{className:"h-4 w-4 text-green-600"}),e.jsx("h3",{className:"text-sm font-medium text-green-700",children:"Time Tracking"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"startTime",children:"Start Time"}),e.jsx(F,{id:"startTime",type:"datetime-local",value:a,onChange:y=>k(y.target.value),className:"repair-dialog"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{htmlFor:"endTime",children:"End Time"}),e.jsx(F,{id:"endTime",type:"datetime-local",value:w,onChange:y=>l(y.target.value),className:"repair-dialog"})]})]})]})]})}),e.jsxs(_e,{className:"flex-shrink-0 mt-4",children:[e.jsx(U,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(U,{onClick:ye,className:"bg-green-600 hover:bg-green-700",children:"Save & Track Productivity"})]})]})}):null},qs=(m,n)=>{const t=r=>{let c,i;switch(r.status){case"in_diagnosis":c="in_repair",i="Diagnosis → Repair";break;case"in_repair":c="in_quality_check",i="Repair → Quality Check";break;case"in_quality_check":c="ready",i="Quality Check → Ready";break;case"ready":c="delivered",i="Ready → Delivered";break;default:return}const k=new Date().toISOString(),w=m.map(l=>l.id===r.id?{...l,status:c,endTimestamp:c==="delivered"?k:l.endTimestamp,lastUpdated:k}:l);n(w),localStorage.setItem("garageCars",JSON.stringify(w)),S(r,r.status,c,i,k),c==="delivered"&&v(r,k),X({title:"Status Updated",description:`${r.carCode} moved to ${c.replace("_"," ").toUpperCase()}`})},g=(r,c)=>{const a=new Date().toISOString(),k=`${r.status.replace("_"," ").toUpperCase()} → ${c.replace("_"," ").toUpperCase()}`,w=m.map(l=>l.id===r.id?{...l,status:c,endTimestamp:c==="delivered"?a:l.endTimestamp,lastUpdated:a}:l);n(w),localStorage.setItem("garageCars",JSON.stringify(w)),S(r,r.status,c,k,a),c==="delivered"&&v(r,a),X({title:"Status Updated",description:`${r.carCode} moved to ${c.replace("_"," ").toUpperCase()}`})},v=(r,c)=>{p(r,c),E(r,c),o(r,c)},p=(r,c)=>{const i=localStorage.getItem("carInventory");if(i)try{const k=JSON.parse(i).map(w=>{var l;return w.model===r.carModel||(l=w.vinNumber)!=null&&l.includes(r.carCode)?{...w,status:"sold",soldDate:c,currentFloor:void 0,inShowroom:!1,showroomExitDate:c,showroomNote:`Delivered to client - ${r.customerName}`,clientName:r.customerName,notes:`Delivered after repair completion. Work performed: ${r.workNotes||r.issueDescription||"Repair completed"}`}:w});localStorage.setItem("carInventory",JSON.stringify(k))}catch(a){console.error("Error updating car inventory on delivery:",a)}},E=(r,c)=>{const i=r.startTimestamp?new Date(r.startTimestamp):new Date(r.entryDate),a=new Date(c),k=Math.round((a.getTime()-i.getTime())/(1e3*60*60)),w={id:Date.now().toString(),carCode:r.carCode,carModel:r.carModel,customerName:r.customerName,assignedEmployee:r.assignedEmployee,mechanics:r.mechanics||[],entryDate:r.entryDate,startTimestamp:r.startTimestamp,endTimestamp:c,deliveryTimestamp:c,issueDescription:r.issueDescription,workNotes:r.workNotes,partsUsed:r.partsUsed||[],repairDurationHours:k,repairDuration:`${k}h`,statusComments:r.statusComments,completedAt:c,status:"delivered"},l=localStorage.getItem("repairHistory"),j=l?JSON.parse(l):[];j.unshift(w),localStorage.setItem("repairHistory",JSON.stringify(j))},o=(r,c)=>{if(r.partsUsed&&r.partsUsed.length>0){const i=localStorage.getItem("inventoryHistory"),a=i?JSON.parse(i):[];r.partsUsed.forEach(k=>{const w={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,partId:`part-${k.replace(/\s+/g,"-").toLowerCase()}`,partName:k,partNumber:`PN-${k.replace(/\s+/g,"").toUpperCase()}`,quantity:1,carVIN:r.carCode,employee:r.assignedEmployee,timestamp:c,partType:k.includes("DF")?"DF":k.includes("BM")?"BM":void 0};a.unshift(w)}),localStorage.setItem("inventoryHistory",JSON.stringify(a))}},S=(r,c,i,a,k)=>{const w={id:`worktype-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,carCode:r.carCode,carModel:r.carModel,customerName:r.customerName,fromWorkType:c,toWorkType:i,workTypeChange:a,timestamp:k,assignedEmployee:r.assignedEmployee,mechanics:r.mechanics||[],notes:`Work type changed from ${c.replace("_"," ")} to ${i.replace("_"," ")}`,duration:C(r,c,k),partsUsed:r.partsUsed||[],partsUsedInStage:h(r),totalPartsCost:T(r.partsUsed||[]),toolsUsed:r.toolsUsed||[],toolsUsedInStage:N(r),totalToolsCost:A(r.toolsUsed||[]),workNotes:r.workNotes,issueDescription:r.issueDescription},l=localStorage.getItem("repairHistory"),j=l?JSON.parse(l):[];j.unshift({...w,type:"work_type_change",date:new Date(k).toLocaleDateString(),description:a,technician:r.assignedEmployee,notes:w.notes,workTypeTransition:a,fromStage:c,toStage:i,transitionTimestamp:k,partsUsed:w.partsUsed,partsUsedInStage:w.partsUsedInStage,totalPartsCost:w.totalPartsCost,toolsUsed:w.toolsUsed,toolsUsedInStage:w.toolsUsedInStage,totalToolsCost:w.totalToolsCost}),localStorage.setItem("repairHistory",JSON.stringify(j));const d=localStorage.getItem("workTypeHistory"),_=d?JSON.parse(d):[];_.unshift(w),localStorage.setItem("workTypeHistory",JSON.stringify(_))},h=(r,c)=>r.partsUsed||[],N=(r,c)=>r.toolsUsed||[],T=r=>{let c=0;return r.forEach(i=>{i.toLowerCase().includes("battery")?c+=1500:i.toLowerCase().includes("brake")?c+=200:i.toLowerCase().includes("filter")?c+=50:i.toLowerCase().includes("sensor")?c+=300:i.toLowerCase().includes("motor")?c+=800:c+=100}),c},A=r=>{let c=0;return r.forEach(i=>{i.toLowerCase().includes("diagnostic")?c+=500:i.toLowerCase().includes("lift")?c+=200:i.toLowerCase().includes("scanner")?c+=300:i.toLowerCase().includes("welder")?c+=150:i.toLowerCase().includes("tester")?c+=250:i.toLowerCase().includes("meter")?c+=100:i.toLowerCase().includes("torque")?c+=80:i.toLowerCase().includes("socket")?c+=50:c+=75}),c},C=(r,c,i)=>{let a;switch(c){case"in_diagnosis":a=r.startTimestamp?new Date(r.startTimestamp):new Date(r.entryDate);break;case"in_repair":a=r.startTimestamp?new Date(r.startTimestamp):new Date(r.entryDate);break;case"in_quality_check":a=r.startTimestamp?new Date(r.startTimestamp):new Date(r.entryDate);break;default:a=new Date(r.entryDate)}const k=new Date(i),w=Math.round((k.getTime()-a.getTime())/(1e3*60*60)),l=Math.round((k.getTime()-a.getTime())/(1e3*60));return w>0?`${w}h ${l%60}m`:`${l}m`};return{moveToNextStage:t,changeCarStatus:g}},zs=({cars:m,onUpdateStatus:n,isGarageManager:t,searchTerm:g,setSearchTerm:v})=>{const[p,E]=f.useState(null),[o,S]=f.useState(!1),[h,N]=f.useState(m),{changeCarStatus:T}=qs(h,N),A=(a,k)=>{if(!a||!k)return"Ongoing";try{return`${Math.round((new Date(k).getTime()-new Date(a).getTime())/36e5)}h`}catch{return"N/A"}},C=a=>{E(a),S(!0)},r=a=>{switch(a){case"ready":return"bg-green-100 text-green-800";case"in_repair":return"bg-orange-100 text-orange-800";case"in_diagnosis":return"bg-blue-100 text-blue-800";case"in_quality_check":return"bg-purple-100 text-purple-800";case"delivered":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},c=(a,k)=>{const w=m.find(l=>l.id===a);w&&(T(w,k),n(a,k))},i=m.filter(a=>a.status!=="delivered");return e.jsxs(e.Fragment,{children:[e.jsxs(R,{children:[e.jsx(se,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Garage Workflow & Employee Tracking Dashboard (",i.length," active cars)"]}),g!==void 0&&v&&e.jsx(hs,{value:g,onChange:v,placeholder:"Search cars, customers, employees, issues...",className:"w-full sm:w-auto"})]})}),e.jsx(q,{children:e.jsxs(Ye,{children:[e.jsx(Ze,{children:e.jsxs(he,{children:[e.jsx(J,{children:"Car Details"}),e.jsx(J,{children:"Customer"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Assigned Team"}),e.jsx(J,{children:"Issue & Work Notes"}),e.jsx(J,{children:"Time Tracking"}),e.jsx(J,{children:"Productivity"}),e.jsx(J,{children:"Actions"})]})}),e.jsx(Xe,{children:i.length>0?i.map(a=>e.jsxs(he,{className:"hover:bg-amber-50/30",children:[e.jsx(z,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.carModel}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Code: ",a.carCode]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Entry: ",new Date(a.entryDate).toLocaleDateString(),a.expectedExitDate&&e.jsxs("div",{children:["Expected Exit: ",a.expectedExitDate]})]})]})}),e.jsx(z,{children:a.customerName}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:`text-xs ${r(a.status)}`,children:Hs[a.status]}),a.statusComments&&e.jsx("div",{className:"text-xs bg-gray-50 p-1.5 rounded border max-w-[200px]",children:a.statusComments.length>50?a.statusComments.substring(0,50)+"...":a.statusComments}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{className:"h-7 w-full rounded-md border border-input bg-background px-2 text-xs",value:a.status,onChange:k=>c(a.id,k.target.value),children:[e.jsx("option",{disabled:!0,children:"Change Status"}),e.jsx("option",{value:"in_diagnosis",children:"In Diagnosis"}),e.jsx("option",{value:"in_repair",children:"In Repair"}),e.jsx("option",{value:"in_quality_check",children:"Quality Check"}),e.jsx("option",{value:"ready",children:"Ready for Pickup"}),e.jsx("option",{value:"delivered",children:"Delivered"})]})})]})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:a.assignedEmployee}),a.mechanics&&a.mechanics.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:"Mechanics:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.mechanics.map((k,w)=>e.jsx(M,{variant:"outline",className:"text-xs",children:k},w))})]}),a.partsUsed&&a.partsUsed.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:"Parts Used:"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.partsUsed.join(", ")})]})]})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-2 max-w-xs",children:[a.issueDescription&&e.jsxs("div",{className:"text-sm bg-red-50 p-2 rounded border border-red-100",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1 text-xs font-semibold",children:[e.jsx(Q,{className:"h-3 w-3"}),"Issue:"]}),a.issueDescription.length>100?a.issueDescription.substring(0,100)+"...":a.issueDescription]}),a.workNotes&&e.jsxs("div",{className:"text-sm bg-amber-50 p-2 rounded border border-amber-100",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1 text-xs font-semibold",children:[e.jsx(ge,{className:"h-3 w-3"}),"Work Notes:"]}),a.workNotes.length>100?a.workNotes.substring(0,100)+"...":a.workNotes]}),!a.issueDescription&&!a.workNotes&&e.jsx("span",{className:"text-muted-foreground text-sm",children:"No notes available"})]})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsxs("span",{children:["Arrived: ",new Date(a.entryDate).toLocaleDateString()]})]}),a.startTimestamp&&e.jsxs("div",{className:"text-green-600 bg-green-50 px-2 py-1 rounded border border-green-100",children:["Started: ",Ve.formatDateTime(a.startTimestamp)]}),a.endTimestamp&&e.jsxs("div",{className:"text-amber-600 bg-amber-50 px-2 py-1 rounded border border-amber-100",children:["Finished: ",Ve.formatDateTime(a.endTimestamp)]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Updated: ",new Date(a.lastUpdated).toLocaleDateString()]})]})}),e.jsx(z,{children:e.jsxs("div",{className:"text-sm",children:[a.startTimestamp&&a.endTimestamp?e.jsx(M,{variant:"default",children:A(a.startTimestamp,a.endTimestamp)}):a.startTimestamp?e.jsx(M,{variant:"secondary",children:"In Progress"}):e.jsx(M,{variant:"outline",children:"Not Started"}),a.repairDuration&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Duration: ",a.repairDuration]})]})}),e.jsx(z,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(U,{variant:"outline",size:"sm",onClick:()=>C(a),children:[e.jsx(Ts,{className:"h-4 w-4 mr-1"}),"View Details"]}),t&&e.jsxs(U,{variant:"outline",size:"sm",onClick:()=>C(a),children:[e.jsx(_s,{className:"h-4 w-4 mr-1"}),"Edit"]})]})})]},a.id)):e.jsx(he,{children:e.jsx(z,{colSpan:8,className:"text-center py-6 text-muted-foreground",children:"No cars found in the garage."})})})]})})]}),p&&e.jsx(Gs,{isOpen:o,setIsOpen:S,selectedCar:p,onSave:(a,k)=>{console.log("Saving car details:",a,k),S(!1)}})]})},Fs=({cars:m,onUpdateStatus:n,isGarageManager:t})=>{const{schedules:g,allScheduledCars:v}=as(),[p,E]=f.useState(new Date),[o,S]=f.useState(""),[h,N]=f.useState("all"),T=m.filter(x=>{var I,G,ae,B,ee,K,L,oe,ne;if(!o.trim())return!0;const D=o.toLowerCase();return((I=x.carCode)==null?void 0:I.toLowerCase().includes(D))||((G=x.carModel)==null?void 0:G.toLowerCase().includes(D))||((ae=x.customerName)==null?void 0:ae.toLowerCase().includes(D))||((B=x.assignedEmployee)==null?void 0:B.toLowerCase().includes(D))||((ee=x.issueDescription)==null?void 0:ee.toLowerCase().includes(D))||((K=x.workNotes)==null?void 0:K.toLowerCase().includes(D))||((L=x.mechanics)==null?void 0:L.some(le=>le.toLowerCase().includes(D)))||((oe=x.partsUsed)==null?void 0:oe.some(le=>le.toLowerCase().includes(D)))||((ne=x.status)==null?void 0:ne.toLowerCase().includes(D))});f.useEffect(()=>{E(new Date)},[g,v]),(()=>{const x=v.map(I=>I.carCode),D=m.filter(I=>!x.includes(I.carCode)&&I.status!=="delivered"&&!I.endTimestamp);return{isValid:D.length===0,invalidCars:D}})();const C=new Date().toISOString().split("T")[0],r=g.find(x=>x.date===C),c=(r==null?void 0:r.scheduledCars)||[],i=()=>["electrical","mechanic","body_work","painter","detailer"].map(D=>{const I=c.filter(L=>L.workType===D),G=I.filter(L=>L.status==="pending").length,ae=I.filter(L=>L.status==="scheduled").length,B=I.filter(L=>L.status==="in_progress").length,ee=I.filter(L=>L.status==="completed").length,K=I.filter(L=>L.priority==="high").length;return{section:D,total:I.length,pending:G,scheduled:ae,inProgress:B,completed:ee,highPriority:K,utilization:I.length>0?Math.round((B+ee)/I.length*100):0}}),a=x=>{switch(x){case"electrical":return e.jsx(Pe,{className:"h-5 w-5 text-blue-600"});case"mechanic":return e.jsx(Q,{className:"h-5 w-5 text-green-600"});case"body_work":return e.jsx(Ie,{className:"h-5 w-5 text-purple-600"});case"painter":return e.jsx(Me,{className:"h-5 w-5 text-orange-600"});case"detailer":return e.jsx(Es,{className:"h-5 w-5 text-pink-600"});default:return e.jsx(Ie,{className:"h-5 w-5"})}},k=x=>{switch(x){case"electrical":return"Electrical";case"mechanic":return"Mechanical";case"body_work":return"Body Work";case"painter":return"Painting";case"detailer":return"Detailing";default:return x}},w=i(),l=c.length,j=c.filter(x=>x.status==="in_progress").length,d=c.filter(x=>x.status==="completed").length,_=c.filter(x=>x.priority==="high").length,P=c.filter(x=>{var D;return(D=x.notes)==null?void 0:D.includes("")}).length,V=c.filter(x=>{var D;return(D=x.notes)==null?void 0:D.includes("")}).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{className:"border-blue-200 bg-blue-50",children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Garage Schedule Integration"}),e.jsxs("p",{className:"text-xs text-blue-600",children:["Last synced: ",p.toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{variant:"outline",className:"text-blue-700 border-blue-300",children:[l," scheduled today"]}),e.jsxs(M,{variant:"outline",className:"text-green-700 border-green-300",children:[m.length," in garage"]})]})]})})}),e.jsxs(R,{className:"border-l-4 border-l-blue-500",children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-5 w-5 text-blue-600"}),"Live Garage Operations Summary",e.jsxs(M,{className:"bg-green-100 text-green-700",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse mr-1"}),"LIVE"]})]}),e.jsxs(xs,{children:["Real-time summary from today's garage schedule (",C,")"]})]}),e.jsxs(q,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cars Assigned Today"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:j}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Currently Working"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Completed Today"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:_}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"High Priority"})]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[P>0&&e.jsxs(M,{className:"bg-yellow-100 text-yellow-800",children:[P," Special Event",P>1?"s":""]}),V>0&&e.jsxs(M,{className:"bg-purple-100 text-purple-800",children:[V," Owner Request",V>1?"s":""]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:"SECTION STATUS OVERVIEW"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:w.map(x=>e.jsxs(R,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a(x.section),e.jsx("span",{className:"font-medium text-sm",children:k(x.section)}),x.highPriority>0&&e.jsxs(M,{variant:"destructive",className:"text-xs",children:[x.highPriority," HIGH"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[x.utilization,"%"]})]}),e.jsx(gs,{value:x.utilization,className:"h-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs text-muted-foreground",children:[e.jsxs("div",{children:["Active: ",x.inProgress]}),e.jsxs("div",{children:["Done: ",x.completed]}),e.jsxs("div",{children:["Scheduled: ",x.scheduled]}),e.jsxs("div",{children:["Pending: ",x.pending]})]})]})]},x.section))})]}),c.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-3",children:"TODAY'S SCHEDULE HIGHLIGHTS"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:c.slice(0,5).map(x=>{var D,I,G;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a(x.workType),e.jsx("span",{className:"font-medium",children:x.carCode}),e.jsx("span",{className:"text-muted-foreground",children:x.carModel}),x.priority==="high"&&e.jsx(As,{className:"h-3 w-3 text-red-500"}),((D=x.notes)==null?void 0:D.includes(""))&&e.jsx(Is,{className:"h-3 w-3 text-purple-500"}),((I=x.notes)==null?void 0:I.includes(""))&&e.jsx("span",{className:"text-xs"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{variant:x.status==="in_progress"?"default":"secondary",className:"text-xs",children:(G=x.status)==null?void 0:G.replace("_"," ").toUpperCase()}),e.jsx("span",{className:"text-muted-foreground",children:x.estimatedDuration})]})]},x.id)})}),c.length>5&&e.jsx("div",{className:"text-center mt-2",children:e.jsxs(U,{variant:"ghost",size:"sm",className:"text-xs",children:["View All ",c.length," Assignments",e.jsx(ps,{className:"h-3 w-3 ml-1"})]})})]}),!r&&e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx("p",{className:"text-sm",children:"No garage schedule found for today"}),e.jsx("p",{className:"text-xs",children:"Visit the Garage Schedule page to create today's assignments"})]})]})]}),e.jsx(Vs,{cars:T,searchTerm:o,setSearchTerm:S,activeTab:h,setActiveTab:N}),e.jsx(zs,{cars:T,onUpdateStatus:n,isGarageManager:t,searchTerm:o,setSearchTerm:S}),e.jsxs("div",{className:"flex items-center justify-center gap-2 py-3 border-t bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Live sync with garage schedule • Last updated: ",p.toLocaleTimeString()]}),e.jsxs(M,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:[e.jsx(He,{className:"h-3 w-3 mr-1"}),"Connected"]})]})]})},Be=({scheduledCars:m})=>{const n=o=>{switch(o){case"electrical":return e.jsx(Pe,{className:"h-4 w-4"});case"painter":return e.jsx(Me,{className:"h-4 w-4"});case"detailer":return e.jsx(Ps,{className:"h-4 w-4"});case"mechanic":return e.jsx(Ee,{className:"h-4 w-4"});case"body_work":return e.jsx(Ms,{className:"h-4 w-4"});default:return e.jsx(Q,{className:"h-4 w-4"})}},t=o=>{switch(o){case"electrical":return"bg-yellow-100 text-yellow-800";case"painter":return"bg-purple-100 text-purple-800";case"detailer":return"bg-blue-100 text-blue-800";case"mechanic":return"bg-green-100 text-green-800";case"body_work":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},g=o=>{switch(o){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},v=o=>{switch(o){case"scheduled":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-orange-100 text-orange-800";case"completed":return"bg-green-100 text-green-800";case"delayed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},p=o=>{switch(o){case"completed":return e.jsx(ss,{className:"h-4 w-4"});case"delayed":return e.jsx(es,{className:"h-4 w-4"});default:return e.jsx(Z,{className:"h-4 w-4"})}},E=m.reduce((o,S)=>(o[S.scheduleDate]||(o[S.scheduleDate]=[]),o[S.scheduleDate].push(S),o),{});return e.jsx("div",{className:"space-y-6",children:e.jsxs(R,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5"}),"Worker Schedule Overview"]})}),e.jsxs(q,{children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Complete view of all scheduled work assignments and employee activities"}),Object.keys(E).length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No scheduled work found. Cars will appear here when scheduled in the garage schedule."}):e.jsx("div",{className:"space-y-6",children:Object.entries(E).map(([o,S])=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b pb-2",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("h3",{className:"font-medium",children:new Date(o).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsxs(M,{variant:"outline",children:[S.length," scheduled"]})]}),e.jsxs(Ye,{children:[e.jsx(Ze,{children:e.jsxs(he,{children:[e.jsx(J,{children:"Car & Customer"}),e.jsx(J,{children:"Work Details"}),e.jsx(J,{children:"Assigned Worker"}),e.jsx(J,{children:"Schedule Time"}),e.jsx(J,{children:"Priority & Status"}),e.jsx(J,{children:"Notes"})]})}),e.jsx(Xe,{children:S.map(h=>e.jsxs(he,{children:[e.jsx(z,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:h.carCode}),e.jsx("div",{className:"text-sm text-muted-foreground",children:h.carModel}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ge,{className:"h-3 w-3"}),e.jsx("span",{className:"text-sm",children:h.customerName})]})]})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{className:`${t(h.workType)} flex items-center gap-1 w-fit`,children:[n(h.workType),h.workType.replace("_"," ")]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsxs("span",{children:[h.estimatedDuration,"h estimated"]})]})]})}),e.jsx(z,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:h.assignedMechanic||"Unassigned"})]})}),e.jsx(z,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsx("span",{children:h.scheduleTime})]}),!h.available&&e.jsx(M,{variant:"destructive",className:"mt-1 text-xs",children:"Unavailable"})]})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs(M,{className:g(h.priority),children:[h.priority," priority"]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs(M,{className:`${v(h.status)} flex items-center gap-1`,children:[p(h.status),h.status.replace("_"," ")]})})]})}),e.jsx(z,{children:e.jsxs("div",{className:"max-w-xs",children:[h.notes&&e.jsx("div",{className:"text-sm bg-gray-50 p-2 rounded border",children:h.notes.length>100?h.notes.substring(0,100)+"...":h.notes}),h.scheduleNotes&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Schedule: ",h.scheduleNotes]})]})})]},h.id))})]})]},o))})]})]})})},Js=({cars:m,scheduledCars:n,onScheduleUpdate:t})=>{var Ae,Oe,Ue,Le;const{toast:g}=ts(),[v,p]=f.useState(!1),[E,o]=f.useState(!1),[S,h]=f.useState(!1),[N,T]=f.useState(null),[A,C]=f.useState(!1),[r,c]=f.useState({employees:!1,skills:!1}),[i,a]=f.useState({priority:"medium",workType:"mechanic",status:"scheduled"}),[k,w]=f.useState(null),[l,j]=f.useState([{id:"pdi-setup",name:"PDI Setup",workType:"mechanic",estimatedDuration:120,requiredSkills:["mechanical","electrical","inspection"],description:"Pre-Delivery Inspection and setup",priority:"high"},{id:"battery-check",name:"Battery Check",workType:"electrical",estimatedDuration:45,requiredSkills:["electrical","battery"],description:"Battery health and charging system check",priority:"medium"},{id:"tire-rotation",name:"Tire Rotation",workType:"mechanic",estimatedDuration:60,requiredSkills:["mechanical","tires"],description:"Tire rotation and balance",priority:"low"}]),[d,_]=f.useState({workTitle:{isValid:!0,message:""},carCode:{isValid:!0,message:""},scheduledDate:{isValid:!0,message:""},startTime:{isValid:!0,message:""},estimatedDuration:{isValid:!0,message:""},assignedMechanic:{isValid:!0,message:""}}),P=f.useRef(null),V=f.useRef(null),x=f.useRef(null),D=f.useRef(null),I=f.useRef(null),G=f.useRef(null);f.useEffect(()=>{const s=()=>{C(window.innerWidth<768)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const ae=m.filter(s=>!n.some(u=>u.carCode===s.carCode)),B=[{value:"mechanic",label:"Mechanical",icon:Q,color:"bg-blue-100 text-blue-800"},{value:"electrical",label:"Electrical",icon:Pe,color:"bg-yellow-100 text-yellow-800"},{value:"body_work",label:"Bodywork",icon:Me,color:"bg-purple-100 text-purple-800"},{value:"painter",label:"Painting",icon:Ee,color:"bg-green-100 text-green-800"},{value:"detailer",label:"Detailing",icon:Ee,color:"bg-gray-100 text-gray-800"}],ee=[{value:"high",label:"High Priority"},{value:"medium",label:"Medium Priority"},{value:"low",label:"Low Priority"}],K=[{id:"1",name:"Ahmed Hassan",skills:["mechanical","electrical","inspection"],availability:{}},{id:"2",name:"Mohammed Ali",skills:["mechanical","bodywork"],availability:{}},{id:"3",name:"Fatima Zahra",skills:["electrical","battery"],availability:{}},{id:"4",name:"Omar Khalil",skills:["inspection","cleaning"],availability:{}},{id:"5",name:"Layla Ahmed",skills:["mechanical","electrical","bodywork"],availability:{}}],L=(s,u)=>{let b=!0,O="";switch(s){case"workTitle":!u||u.trim().length===0?(b=!1,O="Work title is required"):u.trim().length<3&&(b=!1,O="Work title must be at least 3 characters");break;case"carCode":u||(b=!1,O="Please select a car");break;case"scheduledDate":if(!u)b=!1,O="Please select a date";else{const $=new Date(u),Y=new Date;Y.setHours(0,0,0,0),$<Y&&(b=!1,O="Date cannot be in the past")}break;case"startTime":u||(b=!1,O="Please select a start time");break;case"estimatedDuration":!u||u<15?(b=!1,O="Duration must be at least 15 minutes"):u>480&&(b=!1,O="Duration cannot exceed 8 hours");break;case"assignedMechanic":u||(b=!1,O="Please assign an employee");break}return _($=>({...$,[s]:{isValid:b,message:O}})),b},oe=()=>{const s=["workTitle","carCode","scheduledDate","startTime","estimatedDuration","assignedMechanic"];let u=!0;return s.forEach(b=>{const O=i[b];L(b,O)||(u=!1)}),u},ne=()=>{var u,b;const s=Object.entries(d).filter(([O,$])=>!$.isValid);if(s.length>0){const O=s[0][0],Y={workTitle:P,carCode:V,scheduledDate:x,startTime:D,estimatedDuration:I,assignedMechanic:G}[O];Y!=null&&Y.current&&(Y.current.scrollIntoView({behavior:"smooth",block:"center"}),(b=(u=Y.current).focus)==null||b.call(u))}},le=(s,u)=>n.some(b=>b.workTitle===s&&b.scheduledDate===u),pe=(s,u,b,O)=>n.some($=>{var Y;return $.assignedMechanic===((Y=K.find(rs=>rs.id===s))==null?void 0:Y.name)&&$.scheduledDate===u&&$.startTime===b}),Se=s=>({mechanic:["mechanical","diagnostic"],electrical:["electrical","battery"],body_work:["bodywork","mechanical"],painter:["painting","bodywork"],detailer:["cleaning","detailing"]})[s]||[],je=s=>{a(u=>({...u,workType:s.workType,estimatedDuration:s.estimatedDuration,requiredSkills:s.requiredSkills,priority:s.priority})),w(s),o(!1),g({title:"Template Applied",description:`${s.name} template has been applied to the form.`})},ke=async(s,u)=>{const b=[{type:"email",icon:Ns,label:"Email"},{type:"sms",icon:vs,label:"SMS"},{type:"whatsapp",icon:ws,label:"WhatsApp"}];for(const O of b)await new Promise($=>setTimeout($,500)),g({title:`${O.label} Notification Sent`,description:`${s} has been notified about the scheduled work.`})},ye=()=>{if(!oe()){ne(),g({title:"Validation Error",description:"Please fix the errors in the form before submitting.",variant:"destructive"});return}if(!i.workTitle||!i.carCode||!i.scheduledDate||!i.startTime||!i.estimatedDuration||!i.assignedMechanic){g({title:"Missing Information",description:"Please fill in all required fields.",variant:"destructive"});return}if(le(i.workTitle,i.scheduledDate)){g({title:"Duplicate Work Title",description:"A work with this title already exists on the selected date.",variant:"destructive"});return}const s=K.find(O=>O.name===i.assignedMechanic);if(s&&pe(s.id,i.scheduledDate,i.startTime,i.estimatedDuration)){T({employee:i.assignedMechanic,date:i.scheduledDate,time:i.startTime}),h(!0);return}const u=m.find(O=>O.carCode===i.carCode),b={id:Date.now().toString(),carCode:i.carCode,carModel:(u==null?void 0:u.carModel)||"Unknown Model",customerName:(u==null?void 0:u.customerName)||"Unknown Customer",workTitle:i.workTitle,scheduledDate:i.scheduledDate,startTime:i.startTime,estimatedDuration:i.estimatedDuration,assignedMechanic:i.assignedMechanic,priority:i.priority,workType:i.workType,status:"scheduled",notes:i.notes||"",requiredSkills:i.requiredSkills||[]};t(b),b.assignedMechanic&&ke(b.assignedMechanic),a({priority:"medium",workType:"mechanic",status:"scheduled"}),_({workTitle:{isValid:!0,message:""},carCode:{isValid:!0,message:""},scheduledDate:{isValid:!0,message:""},startTime:{isValid:!0,message:""},estimatedDuration:{isValid:!0,message:""},assignedMechanic:{isValid:!0,message:""}}),c({employees:!1,skills:!1}),p(!1),g({title:"Work Scheduled",description:"The work has been successfully scheduled."})},y=s=>{a(u=>({...u,workType:s,requiredSkills:Se(s)}))},H=s=>{switch(s){case"high":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},de=n.reduce((s,u)=>{const b=u.workType||"other";return s[b]||(s[b]=[]),s[b].push(u),s},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Work Scheduler"}),e.jsx("p",{className:"text-gray-600",children:"Schedule and manage garage work"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(U,{onClick:()=>o(!0),variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Templates"]}),e.jsxs(U,{onClick:()=>p(!0),className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),"Schedule New Work"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(de).map(([s,u])=>{const b=B.find($=>$.value===s),O=(b==null?void 0:b.icon)||Q;return e.jsxs(R,{className:"hover:shadow-md transition-shadow",children:[e.jsx(se,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),e.jsx(te,{className:"text-lg",children:(b==null?void 0:b.label)||s})]}),e.jsx(M,{className:(b==null?void 0:b.color)||"bg-gray-100 text-gray-800",children:u.length})]})}),e.jsx(q,{children:e.jsxs("div",{className:"space-y-2",children:[u.slice(0,3).map($=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:$.workTitle||$.carCode}),e.jsx("p",{className:"text-xs text-gray-600",children:$.assignedMechanic||"Unassigned"})]}),e.jsx(M,{className:H($.priority),children:$.priority})]},$.id)),u.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["+",u.length-3," more jobs"]})]})})]},s)})}),e.jsx(fe,{open:v,onOpenChange:p,children:e.jsxs(Ne,{className:"work-scheduler-dialog max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5"}),"Schedule New Work"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"text-sm font-medium",children:"Work Type *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:B.map(s=>e.jsxs(U,{variant:i.workType===s.value?"default":"outline",className:`justify-start h-auto p-3 ${i.workType===s.value?s.color:""}`,onClick:()=>y(s.value),children:[e.jsx(s.icon,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"text-sm font-medium",children:"Select Car *"}),e.jsx("div",{ref:V,children:e.jsx(Je,{value:i.carCode,onValueChange:s=>{a(u=>({...u,carCode:s})),L("carCode",s)},options:ae.map(s=>({value:s.carCode,label:`${s.carCode} - ${s.carModel}`})),placeholder:"Choose a car",searchable:!0})}),d.carCode.isValid&&i.carCode&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:((Ae=m.find(s=>s.carCode===i.carCode))==null?void 0:Ae.customerName)||"Unknown Customer"}),!d.carCode.isValid&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:d.carCode.message})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"text-sm font-medium",children:"Work Title *"}),e.jsx(F,{value:i.workTitle||"",onChange:s=>{a(u=>({...u,workTitle:s.target.value})),L("workTitle",s.target.value)},placeholder:"Enter work title",className:`border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow ${d.workTitle.isValid?"":"border-red-500 focus:border-red-500 focus:ring-red-500"}`,ref:P}),d.workTitle.isValid&&i.workTitle&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.workTitle}),!d.workTitle.isValid&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:d.workTitle.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"text-sm font-medium",children:"Date *"}),e.jsx("div",{className:"relative date-input-wrapper",children:e.jsx(F,{type:"date",value:i.scheduledDate||"",onChange:s=>{a(u=>({...u,scheduledDate:s.target.value})),L("scheduledDate",s.target.value)},className:`border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow ${d.scheduledDate.isValid?"":"border-red-500 focus:border-red-500 focus:ring-red-500"}`,style:{zIndex:1e4},ref:x})}),d.scheduledDate.isValid&&i.scheduledDate&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(i.scheduledDate).toLocaleDateString()}),!d.scheduledDate.isValid&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:d.scheduledDate.message})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"text-sm font-medium",children:"Start Time *"}),e.jsx("div",{className:"relative date-input-wrapper",children:e.jsx(F,{type:"time",value:i.startTime||"",onChange:s=>{a(u=>({...u,startTime:s.target.value})),L("startTime",s.target.value)},className:`border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow ${d.startTime.isValid?"":"border-red-500 focus:border-red-500 focus:ring-red-500"}`,style:{zIndex:1e4},ref:D})}),d.startTime.isValid&&i.startTime&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.startTime}),!d.startTime.isValid&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:d.startTime.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"text-sm font-medium",children:"Estimated Duration (minutes) *"}),e.jsx(F,{type:"number",min:"15",step:"15",value:i.estimatedDuration||"",onChange:s=>{a(u=>({...u,estimatedDuration:parseInt(s.target.value)})),L("estimatedDuration",parseInt(s.target.value))},placeholder:"60",className:`border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow ${d.estimatedDuration.isValid?"":"border-red-500 focus:border-red-500 focus:ring-red-500"}`,ref:I}),d.estimatedDuration.isValid&&i.estimatedDuration&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.estimatedDuration," minutes"]}),!d.estimatedDuration.isValid&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:d.estimatedDuration.message})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"text-sm font-medium",children:"Priority *"}),e.jsx(Je,{value:i.priority,onValueChange:s=>a(u=>({...u,priority:s})),options:ee.map(s=>({value:s.value,label:s.label})),placeholder:"Select priority"})]})]}),e.jsxs("div",{className:"space-y-3 employee-assignment-section",ref:G,children:[e.jsx(W,{className:"text-sm font-medium",children:"Assign Employees *"}),A?e.jsxs("div",{className:"border rounded-md",children:[e.jsxs(U,{variant:"ghost",className:"w-full justify-between p-3",onClick:()=>c(s=>({...s,employees:!s.employees})),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),i.assignedMechanic?`Assigned: ${i.assignedMechanic}`:"Select Employee"]}),r.employees?e.jsx(qe,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4"})]}),r.employees&&e.jsx("div",{className:"border-t p-3 max-h-40 overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:K.map(s=>e.jsx(U,{variant:i.assignedMechanic===s.name?"default":"outline",className:"w-full justify-start h-auto p-2",onClick:()=>{a(u=>({...u,assignedMechanic:s.name})),L("assignedMechanic",s.name)},children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.skills.slice(0,2).join(", "),s.skills.length>2&&"..."]})]}),i.assignedMechanic===s.name&&e.jsx(fs,{className:"h-4 w-4 text-green-600"})]})},s.id))})})]}):e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-md p-3 employee-assignment-grid",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:K.map(s=>e.jsx(U,{variant:i.assignedMechanic===s.name?"default":"outline",className:"justify-start h-auto p-2",onClick:()=>{a(u=>({...u,assignedMechanic:s.name})),L("assignedMechanic",s.name)},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.skills.slice(0,2).join(", "),s.skills.length>2&&"..."]})]})]})},s.id))})}),d.assignedMechanic.isValid&&i.assignedMechanic&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Assigned to: ",i.assignedMechanic]}),!d.assignedMechanic.isValid&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:d.assignedMechanic.message})]}),i.requiredSkills&&i.requiredSkills.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"text-sm font-medium",children:"Required Skills"}),A?e.jsxs("div",{className:"border rounded-md",children:[e.jsxs(U,{variant:"ghost",className:"w-full justify-between p-3",onClick:()=>c(s=>({...s,skills:!s.skills})),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Skills (",((Oe=i.requiredSkills)==null?void 0:Oe.length)||0,")"]}),r.skills?e.jsx(qe,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4"})]}),r.skills&&e.jsx("div",{className:"border-t p-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:(Ue=i.requiredSkills)==null?void 0:Ue.map(s=>e.jsxs(M,{variant:"secondary",className:"flex items-center gap-1",children:[s,e.jsx(ue,{className:"h-3 w-3 cursor-pointer",onClick:()=>a(u=>{var b;return{...u,requiredSkills:((b=u.requiredSkills)==null?void 0:b.filter(O=>O!==s))||[]}})})]},s))})})]}):e.jsx("div",{className:"flex flex-wrap gap-2",children:(Le=i.requiredSkills)==null?void 0:Le.map(s=>e.jsxs(M,{variant:"secondary",className:"flex items-center gap-1",children:[s,e.jsx(ue,{className:"h-3 w-3 cursor-pointer",onClick:()=>a(u=>{var b;return{...u,requiredSkills:((b=u.requiredSkills)==null?void 0:b.filter(O=>O!==s))||[]}})})]},s))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{className:"text-sm font-medium",children:"Notes"}),e.jsx(be,{value:i.notes||"",onChange:s=>a(u=>({...u,notes:s.target.value})),placeholder:"Enter any additional notes...",rows:3,className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]})]}),e.jsxs(_e,{children:[e.jsx(U,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(U,{onClick:ye,className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:"Schedule Work"})]})]})}),e.jsx(fe,{open:E,onOpenChange:o,children:e.jsxs(Ne,{className:"max-w-2xl",children:[e.jsx(ve,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"Work Templates"]})}),e.jsx("div",{className:"space-y-4",children:l.map(s=>e.jsx(R,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>je(s),children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(M,{className:H(s.priority),children:s.priority}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.estimatedDuration," min"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.requiredSkills.slice(0,3).map(u=>e.jsx(M,{variant:"outline",className:"text-xs",children:u},u)),s.requiredSkills.length>3&&e.jsxs(M,{variant:"outline",className:"text-xs",children:["+",s.requiredSkills.length-3]})]})]})})},s.id))})]})}),e.jsx(fe,{open:S,onOpenChange:h,children:e.jsxs(Ne,{children:[e.jsx(ve,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-5 w-5 text-red-500"}),"Scheduling Conflict"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:N==null?void 0:N.employee})," is already assigned to work during this time period."]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Conflict Details:"}),e.jsx("br",{}),"Employee: ",N==null?void 0:N.employee,e.jsx("br",{}),"Date: ",N==null?void 0:N.date,e.jsx("br",{}),"Time: ",N==null?void 0:N.time]})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Would you like to proceed anyway or choose a different time/employee?"})]}),e.jsxs(_e,{children:[e.jsx(U,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(U,{onClick:()=>{ye(),h(!1)},className:"bg-red-500 hover:bg-red-600",children:"Schedule Anyway"})]})]})})]})},Bs=()=>{const m=bs(),[n,t]=f.useState(()=>{const l=localStorage.getItem("garageCars");if(l)try{const j=JSON.parse(l);let d=localStorage.getItem("garageSchedules");if(d||(d=localStorage.getItem("garageSchedule")),d){const _=JSON.parse(d),V=(Array.isArray(_)?_:[_]).flatMap(D=>(D.scheduledCars||[]).map(I=>I.carCode));return j.filter(D=>V.includes(D.carCode)||D.status==="delivered"||D.endTimestamp)}return j.length>0?j:[]}catch(j){return console.error("Error loading garage cars:",j),[]}return[]}),{user:g}=Ke(),{toast:v}=ts(),p=(g==null?void 0:g.name)==="Mark",E=()=>{try{let l=localStorage.getItem("garageSchedules");if(l||(l=localStorage.getItem("garageSchedule")),l){const j=JSON.parse(l),d=Array.isArray(j)?j:[j],_=new Date().toISOString().split("T")[0],P=d.find(V=>V.date===_);if(P&&P.scheduledCars){const V=P.scheduledCars,x=n.map(I=>I.carCode),D=V.filter(I=>!x.includes(I.carCode)).map(I=>C(I));D.length>0&&(t(I=>[...I,...D]),console.log(`Auto-synced ${D.length} scheduled cars to garage overview`))}}}catch(l){console.error("Error syncing scheduled cars to garage:",l)}};f.useEffect(()=>{const j=new URLSearchParams(m.search).get("vin");j&&(S(j),setTimeout(()=>{const d=n.find(_=>{var P,V,x;return((P=_.carCode)==null?void 0:P.toLowerCase().includes(j.toLowerCase()))||((V=_.vinNumber)==null?void 0:V.toLowerCase().includes(j.toLowerCase()))||((x=_.model)==null?void 0:x.toLowerCase().includes(j.toLowerCase()))});v(d?{title:"Car Found in Garage Repairs",description:`Showing ${d.model||"Vehicle"} (${d.carCode}) - Status: ${d.status}`,duration:5e3}:{title:"Car Not Found",description:`No car found with VIN/Code: ${j} in Garage Repairs`,variant:"destructive",duration:5e3})},500))},[m.search,n]),f.useEffect(()=>{localStorage.setItem("garageCars",JSON.stringify(n))},[n]),f.useEffect(()=>{const l=j=>{if(j.key==="garageCars"&&j.newValue)try{const d=JSON.parse(j.newValue);t(d)}catch(d){console.error("Error parsing updated garage cars:",d)}else(j.key==="garageSchedules"||j.key==="garageSchedule")&&setTimeout(()=>E(),100)};return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)},[]);const{searchTerm:o,setSearchTerm:S,filteredCars:h}=Us(n,"all"),{handleUpdateStatus:N}=Os(n,t),{scheduledCars:T,inventoryCarsWithIssues:A,convertScheduledCarToGarageCar:C,convertInventoryCarToGarageCar:r,syncScheduleWithGarage:c}=Ls(),{allScheduledCars:i}=as();f.useEffect(()=>{const l=c();t(l)},[i,c]),f.useEffect(()=>{E()},[i]);const a=l=>{const j=C(l);n.some(_=>_.carCode===j.carCode)?v({title:"Car Already in Garage",description:`${j.carCode} is already being worked on.`,variant:"destructive"}):(t(_=>[..._,j]),v({title:"Car Added to Garage",description:`${j.carCode} has been moved from schedule to garage.`}))},k=l=>{const j=r(l);n.some(_=>_.carCode===j.carCode)?v({title:"Car Already in Garage",description:`${j.carCode} is already being worked on.`,variant:"destructive"}):(t(_=>[..._,j]),v({title:"Car Added to Garage",description:`${j.carCode} has been moved from inventory to garage for repairs.`}))},w=l=>{switch(l){case"scheduled":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-orange-100 text-orange-800";case"completed":return"bg-green-100 text-green-800";case"delayed":return"bg-red-100 text-red-800";case"in_diagnosis":return"bg-purple-100 text-purple-800";case"in_repair":return"bg-amber-100 text-amber-800";case"in_quality_check":return"bg-cyan-100 text-cyan-800";case"ready":return"bg-emerald-100 text-emerald-800";case"delivered":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return p?e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx(Ws,{searchTerm:o,setSearchTerm:S,isGarageManager:p,onSyncScheduledCars:E}),e.jsxs(De,{defaultValue:"garage",className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-3",children:[e.jsx(ie,{value:"garage",children:"Garage Operations"}),e.jsx(ie,{value:"schedule",children:"Worker Schedule"}),e.jsx(ie,{value:"scheduled-work",children:"Scheduled Work"})]}),e.jsxs(ce,{value:"garage",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(R,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Today's Scheduled Cars (",T.length,")"]})}),e.jsx(q,{children:T.length>0?e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:T.map(l=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:l.carCode}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[l.workType," - ",l.estimatedDuration,"h"]})]}),e.jsx(U,{size:"sm",onClick:()=>a(l),disabled:n.some(j=>j.carCode===l.carCode),children:"Add to Garage"})]},l.id))}):e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(Z,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No cars scheduled for today"})]})})]}),e.jsxs(R,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Inventory Cars with Issues (",A.length,")"]})}),e.jsx(q,{children:A.length>0?e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:A.map(l=>{var j;return e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:l.vinNumber}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[l.model," - ",((j=l.damages)==null?void 0:j.length)||0," damage(s)"]})]}),e.jsx(U,{size:"sm",onClick:()=>k(l),disabled:n.some(d=>d.carCode===l.vinNumber),children:"Add to Garage"})]},l.id)})}):e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(Ce,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No inventory cars with reported issues"})]})})]})]}),e.jsx(Fs,{cars:h,onUpdateStatus:N,isGarageManager:p})]}),e.jsxs(ce,{value:"schedule",className:"space-y-4",children:[e.jsxs(R,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Complete Worker Schedule Overview"]})}),e.jsx(q,{children:e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"View all scheduled work assignments, employee activities, and garage operations from the garage schedule system."})})]}),e.jsx(Be,{scheduledCars:i})]}),e.jsx(ce,{value:"scheduled-work",className:"space-y-4",children:e.jsxs(R,{children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Schedule Work Appointments"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create and manage work appointments based on cars, workers, time, and priority"})]}),e.jsx(q,{children:e.jsx(Js,{cars:n,scheduledCars:i,onScheduleUpdate:l=>{const j=ks("garageSchedules",[]),d=new Date().toISOString().split("T")[0],_=j.findIndex(P=>P.date===d);if(_===-1){const P={id:Date.now().toString(),date:d,startTime:"08:00",endTime:"17:00",available:!0,maxCarsCapacity:10,currentCarsScheduled:1,scheduledCars:[l]};j.push(P)}else{const P=j[_];P.scheduledCars=P.scheduledCars||[],P.scheduledCars.push(l),P.currentCarsScheduled=(P.currentCarsScheduled||0)+1}localStorage.setItem("garageSchedules",JSON.stringify(j)),v({title:"Appointment Scheduled",description:`${l.carCode} has been scheduled for ${l.workType} work.`,duration:5e3})}})})]})})]})]}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-monza-red",children:"Garage Overview"}),e.jsx("p",{className:"text-sm text-monza-grey",children:"Live overview of garage operations and scheduled work"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(U,{variant:"outline",size:"sm",onClick:()=>window.location.href="/garage-schedule",className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"View Full Schedule"]}),e.jsxs(M,{className:"bg-green-100 text-green-800",children:[e.jsx(Ss,{className:"h-3 w-3 mr-1"}),"Read-Only View"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(R,{children:e.jsxs(q,{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Cars Scheduled Today"}),e.jsx("p",{className:"text-2xl font-bold",children:T.length})]}),e.jsx("div",{children:e.jsx(Ie,{className:"h-8 w-8 text-blue-500"})})]})}),e.jsx(R,{children:e.jsxs(q,{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Cars In Progress"}),e.jsx("p",{className:"text-2xl font-bold",children:n.filter(l=>l.status==="in_repair"||l.status==="in_diagnosis").length})]}),e.jsx("div",{children:e.jsx(Q,{className:"h-8 w-8 text-orange-500"})})]})}),e.jsx(R,{children:e.jsxs(q,{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Ready for Pickup"}),e.jsx("p",{className:"text-2xl font-bold",children:n.filter(l=>l.status==="ready").length})]}),e.jsx("div",{children:e.jsx(ss,{className:"h-8 w-8 text-green-500"})})]})}),e.jsx(R,{children:e.jsxs(q,{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Issues Reported"}),e.jsx("p",{className:"text-2xl font-bold",children:A.length})]}),e.jsx("div",{children:e.jsx(Ce,{className:"h-8 w-8 text-red-500"})})]})})]}),e.jsxs(De,{defaultValue:"schedule",className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-3",children:[e.jsx(ie,{value:"schedule",children:"Today's Schedule"}),e.jsx(ie,{value:"active",children:"Active Work"}),e.jsx(ie,{value:"overview",children:"Complete Overview"})]}),e.jsx(ce,{value:"schedule",className:"space-y-4",children:e.jsxs(R,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Scheduled Work for Today (",T.length," cars)"]})}),e.jsx(q,{children:T.length>0?e.jsx("div",{className:"space-y-3",children:T.map(l=>e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-lg",children:l.carCode}),e.jsx(M,{className:w(l.status),children:l.status.replace("_"," ")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Vehicle & Customer"}),e.jsx("p",{className:"font-medium",children:l.carModel}),e.jsx("p",{className:"text-muted-foreground",children:l.customerName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Work Details"}),e.jsx("p",{className:"font-medium",children:l.workType}),e.jsxs("p",{className:"text-muted-foreground",children:[l.estimatedDuration,"h estimated"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Assignment"}),e.jsx("p",{className:"font-medium",children:l.assignedMechanic||"Unassigned"}),e.jsxs(M,{variant:l.priority==="high"?"destructive":l.priority==="medium"?"default":"secondary",className:"text-xs",children:[l.priority," priority"]})]})]}),l.notes&&e.jsxs("div",{className:"mt-3 p-2 bg-white rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Notes:"}),e.jsx("p",{className:"text-sm",children:l.notes})]})]})})},l.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No cars scheduled for today"})]})})]})}),e.jsx(ce,{value:"active",className:"space-y-4",children:e.jsxs(R,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Cars Currently Being Worked On Today"]})}),e.jsx(q,{children:(()=>{const l=new Date().toDateString(),j=n.filter(d=>{const _=["in_repair","in_diagnosis","in_progress","scheduled"].includes(d.status),P=d.entryDate&&new Date(d.entryDate).toDateString()===l,V=T.some(x=>x.carCode===d.carCode);return _&&(P||V)});return j.length>0?e.jsx("div",{className:"space-y-3",children:j.map(d=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-medium text-lg",children:d.carCode}),e.jsx(M,{className:w(d.status),children:d.status.replace("_"," ")}),e.jsx(M,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700",children:"Working Today"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Started: ",new Date(d.entryDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Vehicle & Customer"}),e.jsx("p",{className:"font-medium",children:d.carModel}),e.jsx("p",{className:"text-muted-foreground",children:d.customerName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Assigned Team"}),e.jsx("p",{className:"font-medium",children:d.assignedEmployee}),d.mechanics&&d.mechanics.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:d.mechanics.map((_,P)=>e.jsx(M,{variant:"outline",className:"text-xs",children:_},P))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Today's Progress"}),e.jsx("p",{className:"font-medium",children:d.repairDuration||"In progress"}),d.expectedExitDate&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Target completion: ",d.expectedExitDate]})]})]}),d.issueDescription&&e.jsxs("div",{className:"mt-3 p-2 bg-red-50 rounded border border-red-100",children:[e.jsx("p",{className:"text-xs text-red-600 font-medium mb-1",children:"Today's Work:"}),e.jsx("p",{className:"text-sm",children:d.issueDescription})]}),d.workNotes&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded border border-blue-100",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Progress Notes:"}),e.jsx("p",{className:"text-sm",children:d.workNotes})]})]},d.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No cars being worked on today"}),e.jsx("p",{className:"text-xs mt-2",children:"Cars scheduled for today will appear here when work begins"})]})})()})]})}),e.jsx(ce,{value:"overview",className:"space-y-4",children:e.jsx(Be,{scheduledCars:i})})]})]})},nt=()=>e.jsx(Bs,{});export{nt as default};
