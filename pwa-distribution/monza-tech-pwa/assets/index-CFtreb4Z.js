var Ue=Object.defineProperty;var qe=(D,c,i)=>c in D?Ue(D,c,{enumerable:!0,configurable:!0,writable:!0,value:i}):D[c]=i;var ye=(D,c,i)=>qe(D,typeof c!="symbol"?c+"":c,i);import{r as F,j as e,b as C,f as b,bS as X,a4 as H,c as R,d as k,ag as E,B as L,I as g,a as O,bX as Te,X as Be,t as $,c2 as Re,C as Ce,p as be,A as he,L as h,a5 as J,a6 as Y,a7 as z,a8 as Q,a9 as M,aK as ke,U as je,bE as Ge,D as ee,aQ as me,am as We,q as se,v as te,w as ae,a2 as xe,ac as re,e as ie,Y as we,Z as Pe,_,aA as V,aG as Se,aq as ue,aa as pe,a1 as Ie,bH as Ae,b3 as Ke,ak as Je,a3 as Ye,an as Me}from"./index-CnqA2hW7.js";import{u as ze}from"./useAuditLog-bHzgDI78.js";import{S as Qe}from"./square-pen-BxxLPU8h.js";import{T as le}from"./trending-down-RvbmpwNb.js";import{P as Xe}from"./percent-BQtY7lAZ.js";import{C as Oe}from"./calculator-XKCpVnZf.js";import{I as Ze}from"./info-dZXmp6jm.js";import es from"./MarketingBudgetCalendar-BQ7FKkD5.js";import"./calendar-X9bAF6hR.js";import"./endOfMonth-soqRkUlB.js";import"./subDays-DB3nDO12.js";import"./addDays-BU2HkLjr.js";import"./chevron-left-C6r0Lf13.js";const ss=({cars:D,onUpdatePricing:c})=>{const[i,r]=F.useState(null),[v,P]=F.useState(0),[s,n]=F.useState(0),o=l=>{r(l.id),P(l.purchasePrice||0),n(l.sellingPrice||0)},u=()=>{r(null),P(0),n(0)},j=l=>{if(v<=0||s<=0){$({title:"Invalid Prices",description:"Purchase and selling prices must be greater than 0",variant:"destructive"});return}c(l,v,s),r(null)},T=l=>l>20?{color:"bg-green-100 text-green-800",icon:H}:l>10?{color:"bg-yellow-100 text-yellow-800",icon:H}:l>0?{color:"bg-orange-100 text-orange-800",icon:H}:{color:"bg-red-100 text-red-800",icon:le},p=D.reduce((l,N)=>l+(N.purchasePrice||N.marketPrice||0),0),m=D.filter(l=>l.status==="in_stock").reduce((l,N)=>l+(N.sellingPrice||N.marketPrice||0),0),x=D.filter(l=>l.profitMargin),a=x.length>0?x.reduce((l,N)=>l+(N.profitMargin||0),0)/x.length:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Investment"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p.toLocaleString()]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Projected Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",m.toLocaleString()]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[a.toFixed(1),"%"]})]})]})})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Car Pricing Management"}),e.jsx(E,{children:"Manage purchase and selling prices for all vehicles in inventory"})]}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"Vehicle"}),e.jsx("th",{className:"text-left p-3",children:"VIN"}),e.jsx("th",{className:"text-left p-3",children:"Status"}),e.jsx("th",{className:"text-left p-3",children:"Purchase Price"}),e.jsx("th",{className:"text-left p-3",children:"Selling Price"}),e.jsx("th",{className:"text-left p-3",children:"Market Value"}),e.jsx("th",{className:"text-left p-3",children:"Profit Margin"}),e.jsx("th",{className:"text-left p-3",children:"Days in Stock"}),e.jsx("th",{className:"text-left p-3",children:"Actions"})]})}),e.jsx("tbody",{children:D.map(l=>{const N=i===l.id,S=T(l.profitMargin||0),t=S.icon;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[l.brand," ",l.model]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.year," • ",l.color]})]})}),e.jsx("td",{className:"p-3",children:e.jsx("p",{className:"text-sm font-mono",children:l.vinNumber})}),e.jsx("td",{className:"p-3",children:e.jsx(L,{variant:l.status==="sold"?"default":l.status==="reserved"?"secondary":"outline",children:(l.status||"in_stock").replace("_"," ")})}),e.jsx("td",{className:"p-3",children:N?e.jsx(g,{type:"number",value:v,onChange:f=>P(parseFloat(f.target.value)||0),className:"w-24"}):e.jsx("span",{className:"font-medium",children:l.purchasePrice?`$${l.purchasePrice.toLocaleString()}`:"Not set"})}),e.jsx("td",{className:"p-3",children:N?e.jsx(g,{type:"number",value:s,onChange:f=>n(parseFloat(f.target.value)||0),className:"w-24"}):e.jsx("span",{className:"font-medium",children:l.sellingPrice?`$${l.sellingPrice.toLocaleString()}`:"Not set"})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"text-gray-600",children:["$",(l.marketPrice||0).toLocaleString()]})}),e.jsx("td",{className:"p-3",children:l.profitMargin?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(t,{className:"h-4 w-4"}),e.jsxs(L,{className:S.color,children:[l.profitMargin.toFixed(1),"%"]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"text-sm",children:[l.daysInInventory||0," days"]})}),e.jsx("td",{className:"p-3",children:N?e.jsxs("div",{className:"flex gap-1",children:[e.jsx(O,{size:"sm",onClick:()=>j(l.id),className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(O,{size:"sm",variant:"outline",onClick:u,className:"h-8 w-8 p-0",children:e.jsx(Be,{className:"h-4 w-4"})})]}):e.jsx(O,{size:"sm",variant:"outline",onClick:()=>o(l),className:"h-8 w-8 p-0",children:e.jsx(Qe,{className:"h-4 w-4"})})})]},l.id)})})]})})})]})]})},ts=({cars:D})=>{const c=F.useMemo(()=>{const n=new Map;return D.forEach(o=>{const u=`${o.brand} ${o.model}`;n.has(u)||n.set(u,{model:o.model,brand:o.brand,inStock:0,sold:0,reserved:0,avgDaysToSell:0,demandRatio:0,recommendation:"maintain",avgPrice:0,profitability:0});const j=n.get(u);o.status==="in_stock"&&j.inStock++,o.status==="sold"&&j.sold++,o.status==="reserved"&&j.reserved++}),n.forEach((o,u)=>{const j=D.filter(a=>`${a.brand} ${a.model}`===u),T=j.filter(a=>a.status==="sold");if(T.length>0){const a=T.reduce((l,N)=>{const S=new Date(N.arrivalDate),t=N.soldDate?new Date(N.soldDate):new Date;return l+Math.floor((t.getTime()-S.getTime())/864e5)},0);o.avgDaysToSell=a/T.length}const p=o.inStock+o.sold+o.reserved;o.demandRatio=p>0?(o.sold+o.reserved)/p:0;const m=j.filter(a=>a.sellingPrice||a.marketPrice);m.length>0&&(o.avgPrice=m.reduce((a,l)=>a+(l.sellingPrice||l.marketPrice||0),0)/m.length);const x=j.filter(a=>a.profitMargin);x.length>0&&(o.profitability=x.reduce((a,l)=>a+(l.profitMargin||0),0)/x.length),o.demandRatio>.8&&o.avgDaysToSell<30?o.recommendation="increase":o.demandRatio<.3||o.avgDaysToSell>90?o.recommendation="decrease":o.recommendation="maintain"}),Array.from(n.values()).sort((o,u)=>u.demandRatio-o.demandRatio)},[D]),i=n=>{switch(n){case"increase":return e.jsxs(L,{className:"bg-green-100 text-green-800",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Increase Supply"]});case"decrease":return e.jsxs(L,{className:"bg-red-100 text-red-800",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),"Decrease Supply"]});default:return e.jsxs(L,{className:"bg-blue-100 text-blue-800",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"Maintain"]})}},r=n=>n>.7?{color:"bg-green-500",label:"High Demand"}:n>.4?{color:"bg-yellow-500",label:"Medium Demand"}:{color:"bg-red-500",label:"Low Demand"},v=D.length,P=D.filter(n=>n.status==="sold").length;D.filter(n=>n.status==="in_stock").length;const s=v>0?P/v:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Overall Demand"}),e.jsxs("p",{className:"text-2xl font-bold",children:[(s*100).toFixed(1),"%"]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Models to Increase"}),e.jsx("p",{className:"text-2xl font-bold",children:c.filter(n=>n.recommendation==="increase").length})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Models to Maintain"}),e.jsx("p",{className:"text-2xl font-bold",children:c.filter(n=>n.recommendation==="maintain").length})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Models to Decrease"}),e.jsx("p",{className:"text-2xl font-bold",children:c.filter(n=>n.recommendation==="decrease").length})]})]})})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Supply & Demand Analysis by Model"}),e.jsx(E,{children:"Analyze supply and demand patterns to optimize inventory levels"})]}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"Model"}),e.jsx("th",{className:"text-left p-3",children:"Stock Levels"}),e.jsx("th",{className:"text-left p-3",children:"Demand Ratio"}),e.jsx("th",{className:"text-left p-3",children:"Avg Days to Sell"}),e.jsx("th",{className:"text-left p-3",children:"Avg Price"}),e.jsx("th",{className:"text-left p-3",children:"Profitability"}),e.jsx("th",{className:"text-left p-3",children:"Recommendation"})]})}),e.jsx("tbody",{children:c.map((n,o)=>{const u=r(n.demandRatio);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsx("div",{children:e.jsxs("p",{className:"font-medium",children:[n.brand," ",n.model]})})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-green-600",children:n.sold})," sold"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-blue-600",children:n.inStock})," in stock"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-orange-600",children:n.reserved})," reserved"]})]})}),e.jsxs("td",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${u.color}`}),e.jsxs("span",{className:"font-medium",children:[(n.demandRatio*100).toFixed(1),"%"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:u.label})]}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium",children:n.avgDaysToSell>0?`${Math.round(n.avgDaysToSell)} days`:"-"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium",children:n.avgPrice>0?`$${Math.round(n.avgPrice).toLocaleString()}`:"-"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`font-medium ${n.profitability>15?"text-green-600":n.profitability>5?"text-yellow-600":"text-red-600"}`,children:n.profitability>0?`${n.profitability.toFixed(1)}%`:"-"})}),e.jsx("td",{className:"p-3",children:i(n.recommendation)})]},o)})})]})})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"3-4 Month Ordering Recommendations"}),e.jsx(E,{children:"Based on current demand patterns and inventory turnover"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[c.filter(n=>n.recommendation==="increase").map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[n.brand," ",n.model]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["High demand (",(n.demandRatio*100).toFixed(1),"%) • Fast turnover (",Math.round(n.avgDaysToSell)," days)"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-green-700",children:["Order ",Math.max(3,Math.round(n.sold*1.5))," units"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Next quarter"})]})]},o)),c.filter(n=>n.recommendation==="decrease").map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[n.brand," ",n.model]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Low demand (",(n.demandRatio*100).toFixed(1),"%) • Slow turnover (",Math.round(n.avgDaysToSell)," days)"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-red-700",children:["Reduce by ",Math.max(1,Math.round(n.inStock*.5))," units"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Clear excess inventory"})]})]},o))]})})]})]})},as=({cars:D})=>{const{forecastData:c,modelForecasts:i}=F.useMemo(()=>{const s=new Map;D.filter(m=>m.status==="sold"&&m.soldDate).forEach(m=>{const x=new Date(m.soldDate),a=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}`;s.set(a,(s.get(a)||0)+1)});const o=Array.from(s.values()).reduce((m,x)=>m+x,0)/Math.max(1,s.size),u=[],j=new Date;for(let m=0;m<12;m++){const x=new Date(j);x.setMonth(j.getMonth()+m);let a=1;const l=x.getMonth();(l===11||l===0)&&(a=1.3),l>=3&&l<=5&&(a=1.1),l>=6&&l<=8&&(a=.9);const N=Math.round(o*a),S=Math.max(N,Math.round(N*1.2));u.push({month:x.toLocaleDateString("en-US",{year:"numeric",month:"short"}),projected_sales:N,recommended_orders:S,projected_revenue:N*45e3,inventory_turnover:N/Math.max(1,D.filter(t=>t.status==="in_stock").length)})}const T=new Map,p=new Map;return D.forEach(m=>{const x=`${m.brand} ${m.model}`;p.has(x)||p.set(x,[]),p.get(x).push(m)}),p.forEach((m,x)=>{const a=m.filter(w=>w.status==="sold"&&w.soldDate),l=m.filter(w=>w.status==="in_stock").length,N=new Map;a.forEach(w=>{const y=new Date(w.soldDate),I=`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}`;N.set(I,(N.get(I)||0)+1)});const S=Array.from(N.values()).reduce((w,y)=>w+y,0)/Math.max(1,N.size),[t,f]=x.split(" ",2);T.set(x,{model:f,brand:t,current_stock:l,monthly_sales_rate:S,predicted_demand:S*3,reorder_point:Math.max(2,Math.round(S*1.5)),optimal_stock_level:Math.max(3,Math.round(S*2.5)),forecast_accuracy:Math.min(95,60+a.length*2)})}),{forecastData:u,modelForecasts:Array.from(T.values()).sort((m,x)=>x.monthly_sales_rate-m.monthly_sales_rate)}},[D]),r=(s,n,o)=>s<=o?{status:"critical",color:"bg-red-100 text-red-800",icon:he,label:"Reorder Now"}:s<n*.8?{status:"low",color:"bg-yellow-100 text-yellow-800",icon:be,label:"Low Stock"}:s>n*1.5?{status:"excess",color:"bg-blue-100 text-blue-800",icon:H,label:"Excess Stock"}:{status:"optimal",color:"bg-green-100 text-green-800",icon:H,label:"Optimal"},v=c.reduce((s,n)=>s+n.projected_revenue,0),P=c.reduce((s,n)=>s+n.inventory_turnover,0)/c.length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"12-Month Revenue Projection"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",(v/1e6).toFixed(1),"M"]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Inventory Turnover"}),e.jsxs("p",{className:"text-2xl font-bold",children:[P.toFixed(1),"x/month"]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Models Need Reorder"}),e.jsx("p",{className:"text-2xl font-bold",children:i.filter(s=>s.current_stock<=s.reorder_point).length})]})]})})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"12-Month Sales & Order Forecast"}),e.jsx(E,{children:"Projected sales and recommended ordering schedule"})]}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"Month"}),e.jsx("th",{className:"text-left p-3",children:"Projected Sales"}),e.jsx("th",{className:"text-left p-3",children:"Recommended Orders"}),e.jsx("th",{className:"text-left p-3",children:"Projected Revenue"}),e.jsx("th",{className:"text-left p-3",children:"Inventory Turnover"})]})}),e.jsx("tbody",{children:c.map((s,n)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium",children:s.month}),e.jsxs("td",{className:"p-3",children:[s.projected_sales," units"]}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"font-medium text-blue-600",children:[s.recommended_orders," units"]})}),e.jsxs("td",{className:"p-3",children:["$",(s.projected_revenue/1e3).toFixed(0),"K"]}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:`font-medium ${s.inventory_turnover>1?"text-green-600":s.inventory_turnover>.5?"text-yellow-600":"text-red-600"}`,children:[s.inventory_turnover.toFixed(2),"x"]})})]},n))})]})})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Model-Specific Inventory Forecasts"}),e.jsx(E,{children:"Detailed forecasting and reorder recommendations by model"})]}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"Model"}),e.jsx("th",{className:"text-left p-3",children:"Current Stock"}),e.jsx("th",{className:"text-left p-3",children:"Monthly Sales Rate"}),e.jsx("th",{className:"text-left p-3",children:"3-Month Demand"}),e.jsx("th",{className:"text-left p-3",children:"Reorder Point"}),e.jsx("th",{className:"text-left p-3",children:"Optimal Stock"}),e.jsx("th",{className:"text-left p-3",children:"Status"}),e.jsx("th",{className:"text-left p-3",children:"Forecast Accuracy"})]})}),e.jsx("tbody",{children:i.map((s,n)=>{const o=r(s.current_stock,s.optimal_stock_level,s.reorder_point),u=o.icon;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsx("div",{children:e.jsxs("p",{className:"font-medium",children:[s.brand," ",s.model]})})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium",children:s.current_stock})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"text-gray-700",children:[s.monthly_sales_rate.toFixed(1),"/month"]})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"font-medium text-blue-600",children:[Math.round(s.predicted_demand)," units"]})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"font-medium text-orange-600",children:[s.reorder_point," units"]})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"font-medium text-green-600",children:[s.optimal_stock_level," units"]})}),e.jsx("td",{className:"p-3",children:e.jsxs(L,{className:o.color,children:[e.jsx(u,{className:"h-3 w-3 mr-1"}),o.label]})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:`font-medium ${s.forecast_accuracy>80?"text-green-600":s.forecast_accuracy>60?"text-yellow-600":"text-red-600"}`,children:[s.forecast_accuracy.toFixed(0),"%"]})})]},n)})})]})})})]}),i.filter(s=>s.current_stock<=s.reorder_point).length>0&&e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-red-600"}),"Urgent Reorder Required"]}),e.jsx(E,{children:"These models have reached their reorder point and need immediate attention"})]}),e.jsx(b,{children:e.jsx("div",{className:"space-y-3",children:i.filter(s=>s.current_stock<=s.reorder_point).map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-red-900",children:[s.brand," ",s.model]}),e.jsxs("p",{className:"text-sm text-red-700",children:["Current: ",s.current_stock," units • Reorder at: ",s.reorder_point," units"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-red-900",children:["Order ",Math.max(s.optimal_stock_level-s.current_stock,s.reorder_point)," units"]}),e.jsx("p",{className:"text-sm text-red-700",children:"ASAP"})]})]},n))})})]})]})},rs=({cars:D})=>{const c=F.useMemo(()=>{const r=D.filter(u=>u.status==="sold"&&u.purchasePrice&&u.sellingPrice),v=r.reduce((u,j)=>u+(j.sellingPrice||0),0),P=r.reduce((u,j)=>u+(j.purchasePrice||0),0),s=v-P,n=r.length>0?r.reduce((u,j)=>u+(j.profitMargin||0),0)/r.length:0,o=new Map;return r.forEach(u=>{const j=`${u.brand} ${u.model}`,T=(u.sellingPrice||0)-(u.purchasePrice||0);o.has(j)||o.set(j,{profit:0,margin:0,count:0,revenue:0});const p=o.get(j);p.profit+=T,p.revenue+=u.sellingPrice||0,p.count+=1,p.margin=p.count>0?(p.revenue-(p.revenue-p.profit))/(p.revenue-p.profit)*100:0}),{totalRevenue:v,totalCost:P,totalProfit:s,avgProfitMargin:n,soldCount:r.length,modelProfitability:Array.from(o.entries()).map(([u,j])=>({model:u,...j,avgProfit:j.profit/j.count})).sort((u,j)=>j.margin-u.margin)}},[D]),i=r=>r>25?e.jsx(L,{className:"bg-green-100 text-green-800",children:"Excellent"}):r>15?e.jsx(L,{className:"bg-blue-100 text-blue-800",children:"Good"}):r>5?e.jsx(L,{className:"bg-yellow-100 text-yellow-800",children:"Fair"}):e.jsx(L,{className:"bg-red-100 text-red-800",children:"Poor"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",c.totalRevenue.toLocaleString()]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Profit"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",c.totalProfit.toLocaleString()]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[c.avgProfitMargin.toFixed(1),"%"]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cars Sold"}),e.jsx("p",{className:"text-2xl font-bold",children:c.soldCount})]})]})})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Profitability by Model"}),e.jsx(E,{children:"Analyze profit margins and performance by car model"})]}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"Model"}),e.jsx("th",{className:"text-left p-3",children:"Units Sold"}),e.jsx("th",{className:"text-left p-3",children:"Total Revenue"}),e.jsx("th",{className:"text-left p-3",children:"Total Profit"}),e.jsx("th",{className:"text-left p-3",children:"Avg Profit/Unit"}),e.jsx("th",{className:"text-left p-3",children:"Profit Margin"}),e.jsx("th",{className:"text-left p-3",children:"Performance"})]})}),e.jsx("tbody",{children:c.modelProfitability.map((r,v)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsx("p",{className:"font-medium",children:r.model})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium",children:r.count})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"font-medium",children:["$",r.revenue.toLocaleString()]})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:`font-medium ${r.profit>0?"text-green-600":"text-red-600"}`,children:["$",r.profit.toLocaleString()]})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"font-medium",children:["$",Math.round(r.avgProfit).toLocaleString()]})}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:`font-medium ${r.margin>15?"text-green-600":r.margin>5?"text-yellow-600":"text-red-600"}`,children:[r.margin.toFixed(1),"%"]})}),e.jsx("td",{className:"p-3",children:i(r.margin)})]},v))})]})})})]})]})},ls=({cars:D,onAddReceipt:c})=>{const[i,r]=F.useState(""),[v,P]=F.useState(""),[s,n]=F.useState(""),[o,u]=F.useState(""),[j,T]=F.useState(new Date().toISOString().split("T")[0]),p=a=>{var t;const l=(t=a.target.files)==null?void 0:t[0];if(!l)return;if(!i||!v||!s){$({title:"Missing Information",description:"Please fill in all required fields before uploading",variant:"destructive"});return}const N=URL.createObjectURL(l),S={type:v,amount:parseFloat(s),date:j,description:o||`${v} receipt`,fileName:l.name,fileUrl:N};c(i,S),P(""),n(""),u(""),T(new Date().toISOString().split("T")[0])},m=a=>{const l={purchase:"bg-blue-100 text-blue-800",customs:"bg-purple-100 text-purple-800",shipping:"bg-green-100 text-green-800",maintenance:"bg-orange-100 text-orange-800",other:"bg-gray-100 text-gray-800"};return e.jsx(L,{className:l[a]||l.other,children:a})},x=D.find(a=>a.id===i);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Upload Receipt"}),e.jsx(E,{children:"Upload receipts for purchase, customs, shipping, and maintenance costs"})]}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"car-select",children:"Select Car"}),e.jsxs(J,{value:i,onValueChange:r,children:[e.jsx(Y,{children:e.jsx(z,{placeholder:"Choose a car..."})}),e.jsx(Q,{children:D.map(a=>e.jsxs(M,{value:a.id,children:[a.brand," ",a.model," - ",a.vinNumber]},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"receipt-type",children:"Receipt Type"}),e.jsxs(J,{value:v,onValueChange:P,children:[e.jsx(Y,{children:e.jsx(z,{placeholder:"Choose type..."})}),e.jsxs(Q,{children:[e.jsx(M,{value:"purchase",children:"Purchase"}),e.jsx(M,{value:"customs",children:"Customs"}),e.jsx(M,{value:"shipping",children:"Shipping"}),e.jsx(M,{value:"maintenance",children:"Maintenance"}),e.jsx(M,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"amount",children:"Amount ($)"}),e.jsx(g,{id:"amount",type:"number",value:s,onChange:a=>n(a.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"date",children:"Date"}),e.jsx(g,{id:"date",type:"date",value:j,onChange:a=>T(a.target.value)})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(h,{htmlFor:"description",children:"Description (Optional)"}),e.jsx(g,{id:"description",value:o,onChange:a=>u(a.target.value),placeholder:"Brief description of the expense..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(h,{htmlFor:"receipt-file",children:"Upload Receipt File"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{id:"receipt-file",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:p,className:"hidden"}),e.jsxs(O,{type:"button",variant:"outline",onClick:()=>{var a;return(a=document.getElementById("receipt-file"))==null?void 0:a.click()},disabled:!i||!v||!s,className:"w-full",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Upload Receipt File"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Supported formats: PDF, JPG, PNG (Max 5MB)"})]})]})]})})]}),x&&e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsxs(k,{children:["Receipts for ",x.brand," ",x.model]}),e.jsxs(E,{children:["VIN: ",x.vinNumber]})]}),e.jsx(b,{children:x.receipts.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No receipts uploaded yet"}):e.jsxs("div",{className:"space-y-3",children:[x.receipts.map((a,l)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(je,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m(a.type),e.jsxs("span",{className:"font-medium",children:["$",a.amount.toLocaleString()]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1",children:[e.jsx(Clock,{className:"h-3 w-3"}),new Date(a.date).toLocaleDateString(),a.fileName&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:a.fileName})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.fileUrl&&e.jsx(O,{size:"sm",variant:"outline",onClick:()=>window.open(a.fileUrl,"_blank"),children:"View"}),e.jsx(O,{size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700",children:e.jsx(Ge,{className:"h-4 w-4"})})]})]},l)),e.jsx("div",{className:"border-t pt-3 mt-4",children:e.jsxs("div",{className:"flex justify-between items-center font-medium",children:[e.jsx("span",{children:"Total Receipts:"}),e.jsxs("span",{children:["$",x.receipts.reduce((a,l)=>a+l.amount,0).toLocaleString()]})]})})]})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Receipt Summary by Car"}),e.jsx(E,{children:"Overview of all uploaded receipts across your inventory"})]}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"Vehicle"}),e.jsx("th",{className:"text-left p-3",children:"VIN"}),e.jsx("th",{className:"text-left p-3",children:"Receipt Count"}),e.jsx("th",{className:"text-left p-3",children:"Total Amount"}),e.jsx("th",{className:"text-left p-3",children:"Last Updated"})]})}),e.jsx("tbody",{children:D.map(a=>{const l=a.receipts.reduce((S,t)=>S+t.amount,0),N=a.receipts.length>0?a.receipts.sort((S,t)=>new Date(t.date).getTime()-new Date(S.date).getTime())[0]:null;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[a.brand," ",a.model]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.year," • ",a.color]})]})}),e.jsx("td",{className:"p-3",children:e.jsx("p",{className:"text-sm font-mono",children:a.vinNumber})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium",children:a.receipts.length})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"font-medium",children:l>0?`$${l.toLocaleString()}`:"-"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm text-gray-600",children:N?new Date(N.date).toLocaleDateString():"No receipts"})})]},a.id)})})]})})})]})]})};class q{static getDefaultSettings(){return{id:"default",monthlyElectricityRate:.12,averageKwhPerHour:3.5,laborRatePerHour:75,overheadCostPerDay:150,equipmentDepreciationPerHour:5,lastUpdated:new Date().toISOString()}}static getSettings(){try{const c=localStorage.getItem(this.SETTINGS_KEY);return c?JSON.parse(c):this.getDefaultSettings()}catch(c){return console.error("Error loading garage settings:",c),this.getDefaultSettings()}}static updateSettings(c){try{const r={...this.getSettings(),...c,lastUpdated:new Date().toISOString()};localStorage.setItem(this.SETTINGS_KEY,JSON.stringify(r))}catch(i){throw console.error("Error saving garage settings:",i),i}}static recordLaborStart(c,i,r,v,P){const s=this.getSettings(),n=`labor-${Date.now()}`,o={id:n,carVin:c,carModel:i,mechanicName:r,workType:v,startTime:new Date().toISOString(),endTime:"",actualHours:0,laborRate:s.laborRatePerHour,totalLaborCost:0,electricityUsed:0,electricityCost:0,workOrderId:P,isCompleted:!1,dateRecorded:new Date().toISOString()};return this.saveLaborCost(o),n}static recordLaborEnd(c,i){const r=this.getSettings(),v=this.getAllData(),P=v.laborCosts.findIndex(T=>T.id===c);if(P===-1)return null;const s=v.laborCosts[P],n=new Date,o=new Date(s.startTime),u=(n.getTime()-o.getTime())/(1e3*60*60),j={...s,endTime:n.toISOString(),actualHours:Number(u.toFixed(2)),totalLaborCost:Number((u*s.laborRate).toFixed(2)),electricityUsed:Number((u*r.averageKwhPerHour).toFixed(2)),electricityCost:Number((u*r.averageKwhPerHour*r.monthlyElectricityRate).toFixed(2)),notes:i,isCompleted:!0};return v.laborCosts[P]=j,this.saveAllData(v),j}static addPartsCost(c){const i=`parts-${Date.now()}`,r={...c,id:i,dateUsed:new Date().toISOString()};return this.savePartsCost(r),i}static addToolsCost(c){const i=`tools-${Date.now()}`,r={...c,id:i,dateUsed:new Date().toISOString()};return this.saveToolsCost(r),i}static addOtherCost(c){const i=`other-${Date.now()}`,r={...c,id:i,dateIncurred:new Date().toISOString()};return this.saveOtherCost(r),i}static getWorkOrderSummary(c){const i=this.getAllData(),r=i.laborCosts.filter(a=>a.workOrderId===c),v=i.partsCosts.filter(a=>a.workOrderId===c),P=i.toolsCosts.filter(a=>a.workOrderId===c),s=i.otherCosts.filter(a=>a.workOrderId===c);if(r.length===0)return null;const n=r[0],o=r.reduce((a,l)=>a+l.actualHours,0),u=r.reduce((a,l)=>a+l.totalLaborCost,0),j=r.reduce((a,l)=>a+l.electricityCost,0),T=v.reduce((a,l)=>a+l.totalCost,0),p=P.reduce((a,l)=>a+l.cost,0),m=s.reduce((a,l)=>a+l.cost,0),x=u+j+T+p+m;return{workOrderId:c,carVin:n.carVin,carModel:n.carModel,customerName:"Customer",startDate:Math.min(...r.map(a=>new Date(a.startTime).getTime())).toString(),endDate:r.every(a=>a.isCompleted)?Math.max(...r.map(a=>new Date(a.endTime||a.startTime).getTime())).toString():void 0,totalLaborHours:o,totalLaborCost:u,totalElectricityCost:j,totalPartsCost:T,totalToolsCost:p,totalOtherCosts:m,grandTotal:x,isCompleted:r.every(a=>a.isCompleted)}}static getAllWorkOrderSummaries(){const c=this.getAllData();if(c.laborCosts.length===0&&c.partsCosts.length===0)return this.loadFromRepairHistory(),this.getAllWorkOrderSummaries();const i=new Set([...c.laborCosts.map(r=>r.workOrderId).filter(Boolean),...c.partsCosts.map(r=>r.workOrderId).filter(Boolean),...c.toolsCosts.map(r=>r.workOrderId).filter(Boolean),...c.otherCosts.map(r=>r.workOrderId).filter(Boolean)]);return Array.from(i).map(r=>this.getWorkOrderSummary(r)).filter(Boolean)}static getCarCosts(c){const i=this.getAllData(),r=i.laborCosts.filter(o=>o.carVin===c),v=i.partsCosts.filter(o=>o.carVin===c),P=i.toolsCosts.filter(o=>o.carVin===c),s=i.otherCosts.filter(o=>o.carVin===c),n=r.reduce((o,u)=>o+u.totalLaborCost+u.electricityCost,0)+v.reduce((o,u)=>o+u.totalCost,0)+P.reduce((o,u)=>o+u.cost,0)+s.reduce((o,u)=>o+u.cost,0);return{labor:r,parts:v,tools:P,other:s,total:n}}static calculateDailyOverheadAllocation(c){const i=this.getSettings(),r=this.getAllData(),v=new Date(c);v.setHours(0,0,0,0);const P=new Date(c);P.setHours(23,59,59,999);const s=r.laborCosts.filter(u=>{const j=new Date(u.startTime);return j>=v&&j<=P});if(s.length===0)return 0;const o=s.reduce((u,j)=>u+j.actualHours,0)*i.equipmentDepreciationPerHour;return i.overheadCostPerDay+o}static getAllData(){try{const c=localStorage.getItem(this.STORAGE_KEY);return c?JSON.parse(c):{laborCosts:[],partsCosts:[],toolsCosts:[],otherCosts:[]}}catch(c){return console.error("Error loading garage data:",c),{laborCosts:[],partsCosts:[],toolsCosts:[],otherCosts:[]}}}static saveAllData(c){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(c))}catch(i){throw console.error("Error saving garage data:",i),i}}static saveLaborCost(c){const i=this.getAllData();i.laborCosts.push(c),this.saveAllData(i)}static savePartsCost(c){const i=this.getAllData();i.partsCosts.push(c),this.saveAllData(i)}static saveToolsCost(c){const i=this.getAllData();i.toolsCosts.push(c),this.saveAllData(i)}static saveOtherCost(c){const i=this.getAllData();i.otherCosts.push(c),this.saveAllData(i)}static exportData(){const c=this.getAllData(),i=this.getSettings();return JSON.stringify({data:c,settings:i},null,2)}static importData(c){try{const i=JSON.parse(c);i.data&&this.saveAllData(i.data),i.settings&&localStorage.setItem(this.SETTINGS_KEY,JSON.stringify(i.settings))}catch(i){throw console.error("Error importing data:",i),i}}static loadFromRepairHistory(){try{const c=localStorage.getItem("repairHistory");if(!c){console.log("No repair history data found");return}const i=JSON.parse(c);console.log(`Loading ${i.length} repairs into garage cost tracking`),i.forEach(r=>{const v=`wo-${r.id}`,P=this.getSettings(),s=Math.floor(Math.random()*3)+2,n=s*P.laborRatePerHour,o=r.cost*.7,u=r.cost*.1,j=r.cost*.2,T=s*P.averageKwhPerHour*P.monthlyElectricityRate,p={id:`labor-${r.id}`,carVin:r.carVin,carModel:r.carModel,mechanicName:r.mechanic,workType:"mechanic",startTime:r.repairDate+"T09:00:00",endTime:r.repairDate+`T${9+s}:00:00`,actualHours:s,laborRate:P.laborRatePerHour,totalLaborCost:n,electricityUsed:s*P.averageKwhPerHour,electricityCost:T,notes:r.issue,workOrderId:v,isCompleted:r.status==="completed",dateRecorded:r.repairDate},m={id:`parts-${r.id}`,carVin:r.carVin,carModel:r.carModel,partNumber:`PART-${r.id}`,partName:"Repair Parts",quantity:1,unitCost:o,totalCost:o,supplier:"Local Supplier",dateUsed:r.repairDate,mechanicName:r.mechanic,workOrderId:v,notes:r.solution},x={id:`tools-${r.id}`,carVin:r.carVin,carModel:r.carModel,toolName:"Diagnostic Tools",toolType:"equipment_usage",cost:u,quantity:1,usageHours:s,dateUsed:r.repairDate,mechanicName:r.mechanic,workOrderId:v,notes:"Equipment usage for repair"},a={id:`other-${r.id}`,carVin:r.carVin,carModel:r.carModel,costCategory:"Operations",description:"Operational costs",cost:j,dateIncurred:r.repairDate,recordedBy:r.mechanic,workOrderId:v};this.saveLaborCost(p),this.savePartsCost(m),this.saveToolsCost(x),this.saveOtherCost(a)}),console.log("Successfully loaded repair history into garage cost tracking")}catch(c){console.error("Error loading from repair history:",c)}}}ye(q,"STORAGE_KEY","garage_cost_data"),ye(q,"SETTINGS_KEY","garage_cost_settings");const is=()=>{const[D,c]=F.useState("overview"),[i,r]=F.useState(q.getSettings()),[v,P]=F.useState([]),[s,n]=F.useState(!1),[o,u]=F.useState(!1),[j,T]=F.useState(!1),[p,m]=F.useState(!1),[x,a]=F.useState({carVin:"",carModel:"",partNumber:"",partName:"",quantity:1,unitCost:0,supplier:"",mechanicName:"",notes:""}),[l,N]=F.useState({carVin:"",carModel:"",toolName:"",toolType:"consumable",cost:0,quantity:1,usageHours:0,mechanicName:"",notes:""}),[S,t]=F.useState({carVin:"",carModel:"",costCategory:"",description:"",cost:0,recordedBy:""});F.useEffect(()=>{f()},[]);const f=()=>{P(q.getAllWorkOrderSummaries())},w=()=>{q.updateSettings(i),$({title:"Settings Updated",description:"Garage cost settings have been saved successfully"}),n(!1)},y=()=>{if(!x.carVin||!x.partName||!x.mechanicName){$({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});return}q.addPartsCost({...x,totalCost:x.quantity*x.unitCost}),$({title:"Parts Cost Added",description:`Added ${x.partName} cost for ${x.carModel}`}),a({carVin:"",carModel:"",partNumber:"",partName:"",quantity:1,unitCost:0,supplier:"",mechanicName:"",notes:""}),u(!1),f()},I=()=>{if(!l.carVin||!l.toolName||!l.mechanicName){$({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});return}q.addToolsCost(l),$({title:"Tools Cost Added",description:`Added ${l.toolName} cost for ${l.carModel}`}),N({carVin:"",carModel:"",toolName:"",toolType:"consumable",cost:0,quantity:1,usageHours:0,mechanicName:"",notes:""}),T(!1),f()},A=()=>{if(!S.carVin||!S.description||!S.recordedBy){$({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});return}q.addOtherCost(S),$({title:"Other Cost Added",description:`Added ${S.costCategory} cost for ${S.carModel}`}),t({carVin:"",carModel:"",costCategory:"",description:"",cost:0,recordedBy:""}),m(!1),f()},U=v.reduce((d,G)=>d+G.grandTotal,0),B=v.reduce((d,G)=>d+G.totalLaborHours,0),ge=B>0?U/B:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Garage Cost Tracking"}),e.jsx("p",{className:"text-muted-foreground",children:"Track labor, parts, electricity, and other garage expenses"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(ee,{open:s,onOpenChange:n,children:[e.jsx(me,{asChild:!0,children:e.jsxs(O,{variant:"outline",children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Settings"]})}),e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Garage Cost Settings"}),e.jsx(xe,{children:"Configure monthly averages and rates for automatic cost calculations"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"electricityRate",children:"Electricity Rate ($/kWh)"}),e.jsx(g,{id:"electricityRate",type:"number",step:"0.01",value:i.monthlyElectricityRate,onChange:d=>r({...i,monthlyElectricityRate:Number(d.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"kwhPerHour",children:"Avg kWh per Work Hour"}),e.jsx(g,{id:"kwhPerHour",type:"number",step:"0.1",value:i.averageKwhPerHour,onChange:d=>r({...i,averageKwhPerHour:Number(d.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"laborRate",children:"Labor Rate ($/hour)"}),e.jsx(g,{id:"laborRate",type:"number",step:"1",value:i.laborRatePerHour,onChange:d=>r({...i,laborRatePerHour:Number(d.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"overheadCost",children:"Overhead Cost ($/day)"}),e.jsx(g,{id:"overheadCost",type:"number",step:"1",value:i.overheadCostPerDay,onChange:d=>r({...i,overheadCostPerDay:Number(d.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"equipmentDepreciation",children:"Equipment Depreciation ($/hour)"}),e.jsx(g,{id:"equipmentDepreciation",type:"number",step:"0.1",value:i.equipmentDepreciationPerHour,onChange:d=>r({...i,equipmentDepreciationPerHour:Number(d.target.value)})})]})]}),e.jsx(re,{children:e.jsxs(O,{onClick:w,children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Save Settings"]})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Costs"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",U.toFixed(2)]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Labor Hours"}),e.jsx("p",{className:"text-2xl font-bold",children:B.toFixed(1)})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Oe,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Cost/Hour"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",ge.toFixed(2)]})]})]})})}),e.jsx(C,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Work Orders"}),e.jsx("p",{className:"text-2xl font-bold",children:v.length})]})]})})})]}),e.jsxs(we,{value:D,onValueChange:c,className:"space-y-4",children:[e.jsxs(Pe,{className:"grid w-full grid-cols-4",children:[e.jsx(_,{value:"overview",children:"Overview"}),e.jsx(_,{value:"add-costs",children:"Add Costs"}),e.jsx(_,{value:"work-orders",children:"Work Orders"}),e.jsx(_,{value:"reports",children:"Reports"})]}),e.jsx(V,{value:"overview",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Current Settings"}),e.jsx(E,{children:"Current garage cost calculation settings"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Electricity Rate:"}),e.jsxs(L,{variant:"secondary",children:["$",i.monthlyElectricityRate,"/kWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Labor Rate:"}),e.jsxs(L,{variant:"secondary",children:["$",i.laborRatePerHour,"/hour"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Daily Overhead:"}),e.jsxs(L,{variant:"secondary",children:["$",i.overheadCostPerDay,"/day"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Equipment Depreciation:"}),e.jsxs(L,{variant:"secondary",children:["$",i.equipmentDepreciationPerHour,"/hour"]})]})]})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Recent Activity"}),e.jsx(E,{children:"Latest cost entries"})]}),e.jsx(b,{children:v.slice(0,5).map(d=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:d.carModel}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["VIN: ",d.carVin]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["$",d.grandTotal.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.totalLaborHours.toFixed(1),"h"]})]})]},d.workOrderId))})]})]})}),e.jsx(V,{value:"add-costs",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Add Parts Cost"]}),e.jsx(E,{children:"Record parts used and their costs"})]}),e.jsx(b,{children:e.jsxs(ee,{open:o,onOpenChange:u,children:[e.jsx(me,{asChild:!0,children:e.jsxs(O,{className:"w-full",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Add Parts"]})}),e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Add Parts Cost"}),e.jsx(xe,{children:"Record parts used for a specific car"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"partsCarVin",children:"Car VIN"}),e.jsx(g,{id:"partsCarVin",value:x.carVin,onChange:d=>a({...x,carVin:d.target.value}),placeholder:"Enter VIN"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"partsCarModel",children:"Car Model"}),e.jsx(g,{id:"partsCarModel",value:x.carModel,onChange:d=>a({...x,carModel:d.target.value}),placeholder:"Enter model"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"partNumber",children:"Part Number"}),e.jsx(g,{id:"partNumber",value:x.partNumber,onChange:d=>a({...x,partNumber:d.target.value}),placeholder:"Part #"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"partName",children:"Part Name *"}),e.jsx(g,{id:"partName",value:x.partName,onChange:d=>a({...x,partName:d.target.value}),placeholder:"Part name"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"quantity",children:"Quantity"}),e.jsx(g,{id:"quantity",type:"number",value:x.quantity,onChange:d=>a({...x,quantity:Number(d.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"unitCost",children:"Unit Cost ($)"}),e.jsx(g,{id:"unitCost",type:"number",step:"0.01",value:x.unitCost,onChange:d=>a({...x,unitCost:Number(d.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Total Cost"}),e.jsx(g,{value:`$${(x.quantity*x.unitCost).toFixed(2)}`,disabled:!0})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"supplier",children:"Supplier"}),e.jsx(g,{id:"supplier",value:x.supplier,onChange:d=>a({...x,supplier:d.target.value}),placeholder:"Supplier name"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"partsMechanic",children:"Mechanic Name *"}),e.jsx(g,{id:"partsMechanic",value:x.mechanicName,onChange:d=>a({...x,mechanicName:d.target.value}),placeholder:"Mechanic name"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"partsNotes",children:"Notes"}),e.jsx(pe,{id:"partsNotes",value:x.notes,onChange:d=>a({...x,notes:d.target.value}),placeholder:"Additional notes"})]})]}),e.jsx(re,{children:e.jsx(O,{type:"submit",onClick:y,children:"Add Parts Cost"})})]})]})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),"Add Tools Cost"]}),e.jsx(E,{children:"Record tool usage and costs"})]}),e.jsx(b,{children:e.jsxs(ee,{open:j,onOpenChange:T,children:[e.jsx(me,{asChild:!0,children:e.jsxs(O,{className:"w-full",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Add Tools"]})}),e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Add Tools Cost"}),e.jsx(xe,{children:"Record tool usage for a specific car"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"toolsCarVin",children:"Car VIN"}),e.jsx(g,{id:"toolsCarVin",value:l.carVin,onChange:d=>N({...l,carVin:d.target.value}),placeholder:"Enter VIN"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"toolsCarModel",children:"Car Model"}),e.jsx(g,{id:"toolsCarModel",value:l.carModel,onChange:d=>N({...l,carModel:d.target.value}),placeholder:"Enter model"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"toolName",children:"Tool Name *"}),e.jsx(g,{id:"toolName",value:l.toolName,onChange:d=>N({...l,toolName:d.target.value}),placeholder:"Tool name"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"toolType",children:"Tool Type"}),e.jsxs(J,{value:l.toolType,onValueChange:d=>N({...l,toolType:d}),children:[e.jsx(Y,{children:e.jsx(z,{})}),e.jsxs(Q,{children:[e.jsx(M,{value:"consumable",children:"Consumable"}),e.jsx(M,{value:"equipment_usage",children:"Equipment Usage"}),e.jsx(M,{value:"rental",children:"Rental"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"toolCost",children:"Cost ($)"}),e.jsx(g,{id:"toolCost",type:"number",step:"0.01",value:l.cost,onChange:d=>N({...l,cost:Number(d.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"toolQuantity",children:"Quantity"}),e.jsx(g,{id:"toolQuantity",type:"number",value:l.quantity,onChange:d=>N({...l,quantity:Number(d.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"usageHours",children:"Usage Hours"}),e.jsx(g,{id:"usageHours",type:"number",step:"0.1",value:l.usageHours,onChange:d=>N({...l,usageHours:Number(d.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"toolsMechanic",children:"Mechanic Name *"}),e.jsx(g,{id:"toolsMechanic",value:l.mechanicName,onChange:d=>N({...l,mechanicName:d.target.value}),placeholder:"Mechanic name"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"toolsNotes",children:"Notes"}),e.jsx(pe,{id:"toolsNotes",value:l.notes,onChange:d=>N({...l,notes:d.target.value}),placeholder:"Additional notes"})]})]}),e.jsx(re,{children:e.jsx(O,{type:"submit",onClick:I,children:"Add Tools Cost"})})]})]})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Add Other Costs"]}),e.jsx(E,{children:"Record miscellaneous expenses"})]}),e.jsx(b,{children:e.jsxs(ee,{open:p,onOpenChange:m,children:[e.jsx(me,{asChild:!0,children:e.jsxs(O,{className:"w-full",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Add Other"]})}),e.jsxs(se,{className:"sm:max-w-[500px]",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Add Other Cost"}),e.jsx(xe,{children:"Record miscellaneous expenses for a specific car"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"otherCarVin",children:"Car VIN"}),e.jsx(g,{id:"otherCarVin",value:S.carVin,onChange:d=>t({...S,carVin:d.target.value}),placeholder:"Enter VIN"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"otherCarModel",children:"Car Model"}),e.jsx(g,{id:"otherCarModel",value:S.carModel,onChange:d=>t({...S,carModel:d.target.value}),placeholder:"Enter model"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"costCategory",children:"Cost Category"}),e.jsx(g,{id:"costCategory",value:S.costCategory,onChange:d=>t({...S,costCategory:d.target.value}),placeholder:"e.g., Materials, Services, etc."})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",children:"Description *"}),e.jsx(pe,{id:"description",value:S.description,onChange:d=>t({...S,description:d.target.value}),placeholder:"Describe the expense"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"otherCost",children:"Cost ($)"}),e.jsx(g,{id:"otherCost",type:"number",step:"0.01",value:S.cost,onChange:d=>t({...S,cost:Number(d.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"recordedBy",children:"Recorded By *"}),e.jsx(g,{id:"recordedBy",value:S.recordedBy,onChange:d=>t({...S,recordedBy:d.target.value}),placeholder:"Your name"})]})]}),e.jsx(re,{children:e.jsx(O,{type:"submit",onClick:A,children:"Add Other Cost"})})]})]})})]})]})}),e.jsx(V,{value:"work-orders",children:e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Work Order Cost Summaries"}),e.jsx(E,{children:"Detailed cost breakdown for each work order"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[v.map(d=>e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d.carModel}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["VIN: ",d.carVin]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Work Order: ",d.workOrderId]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:["$",d.grandTotal.toFixed(2)]}),e.jsx(L,{variant:d.isCompleted?"default":"secondary",children:d.isCompleted?"Completed":"In Progress"})]})]}),e.jsx(Ae,{className:"my-4"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Labor"}),e.jsxs("p",{className:"font-medium",children:["$",d.totalLaborCost.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.totalLaborHours.toFixed(1),"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Electricity"}),e.jsxs("p",{className:"font-medium",children:["$",d.totalElectricityCost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Parts"}),e.jsxs("p",{className:"font-medium",children:["$",d.totalPartsCost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Tools"}),e.jsxs("p",{className:"font-medium",children:["$",d.totalToolsCost.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Other"}),e.jsxs("p",{className:"font-medium",children:["$",d.totalOtherCosts.toFixed(2)]})]})]})]},d.workOrderId)),v.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No work orders found. Costs will appear here when labor is tracked."})]})})]})}),e.jsx(V,{value:"reports",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Export Data"}),e.jsx(E,{children:"Download all garage cost data"})]}),e.jsx(b,{children:e.jsxs(O,{onClick:()=>{const d=q.exportData(),G=new Blob([d],{type:"application/json"}),K=URL.createObjectURL(G),W=document.createElement("a");W.href=K,W.download=`garage-costs-${new Date().toISOString().split("T")[0]}.json`,W.click(),URL.revokeObjectURL(K)},className:"w-full",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),"Export Data"]})})]}),e.jsxs(C,{children:[e.jsxs(R,{children:[e.jsx(k,{children:"Import Data"}),e.jsx(E,{children:"Upload previously exported data"})]}),e.jsx(b,{children:e.jsxs(O,{onClick:()=>{const d=document.createElement("input");d.type="file",d.accept=".json",d.onchange=G=>{var W;const K=(W=G.target.files)==null?void 0:W[0];if(K){const ne=new FileReader;ne.onload=ve=>{var ce;try{const oe=(ce=ve.target)==null?void 0:ce.result;q.importData(oe),f(),$({title:"Data Imported",description:"Garage cost data has been imported successfully"})}catch{$({title:"Import Failed",description:"Failed to import data. Please check the file format.",variant:"destructive"})}},ne.readAsText(K)}},d.click()},className:"w-full",variant:"outline",children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Import Data"]})})]})]})})]})]})},ns=({isOpen:D,onClose:c,onSave:i,initialData:r={},mode:v="create",title:P})=>{var S;const[s,n]=F.useState({type:"car_sale",entityId:"",entityName:"",date:new Date().toISOString().split("T")[0],currency:"USD",status:"draft",...r}),[o,u]=F.useState("basic"),[j,T]=F.useState({totalCost:0,grossProfit:0,netProfit:0,profitMargin:0,roi:0}),p=v==="view";F.useEffect(()=>{(()=>{const{purchasePrice:f=0,shippingCost:w=0,importDuty:y=0,customsClearance:I=0,inspectionFees:A=0,registrationFees:U=0,insuranceCost:B=0,transportCost:ge=0,storageCost:d=0,preparationCost:G=0,totalLaborCost:K=0,totalPartsCost:W=0,electricityCost:ne=0,equipmentUsageCost:ve=0,toolsUsageCost:ce=0,facilityRentAllocation:oe=0,overheadCost:$e=0,finalSalePrice:Ee=0,discountGiven:Le=0,salesCommission:_e=0,marketingCost:Ve=0}=s,Z=f+w+y+I+A+U+B+ge+d+G+K+W+ne+ve+ce+oe+$e,Ne=Ee-Le,de=Ne-Z,fe=de-_e-Ve,De=Ne>0?de/Ne*100:0,Fe=Z>0?fe/Z*100:0;T({totalCost:Z,grossProfit:de,netProfit:fe,profitMargin:De,roi:Fe}),n(He=>({...He,totalCost:Z,grossProfit:de,netProfit:fe,profitMargin:De,roi:Fe}))})()},[s.purchasePrice,s.shippingCost,s.importDuty,s.customsClearance,s.inspectionFees,s.registrationFees,s.insuranceCost,s.transportCost,s.storageCost,s.preparationCost,s.totalLaborCost,s.totalPartsCost,s.electricityCost,s.equipmentUsageCost,s.toolsUsageCost,s.facilityRentAllocation,s.overheadCost,s.finalSalePrice,s.discountGiven,s.salesCommission,s.marketingCost]),F.useEffect(()=>{const{laborHours:t=0,laborRate:f=0,overtimeHours:w=0,overtimeRate:y=0}=s,I=t*f,A=w*(y||f*1.5),U=I+A;U!==s.totalLaborCost&&n(B=>({...B,totalLaborCost:U}))},[s.laborHours,s.laborRate,s.overtimeHours,s.overtimeRate]),F.useEffect(()=>{const{partsCost:t=0,partsMarkup:f=0}=s,w=t*(1+f/100);w!==s.totalPartsCost&&n(y=>({...y,totalPartsCost:w}))},[s.partsCost,s.partsMarkup]);const m=(t,f)=>{n(w=>({...w,[t]:f}))},x=()=>{if(!s.entityName.trim()){$({title:"Validation Error",description:"Entity name is required",variant:"destructive"});return}if(s.type==="car_sale"&&!s.purchasePrice&&!s.finalSalePrice){$({title:"Validation Error",description:"Either purchase price or sale price is required for car sales",variant:"destructive"});return}const t={...s,lastUpdated:new Date().toISOString(),id:s.id||`fin-${Date.now()}`};i(t),$({title:"Financial Data Saved",description:`${s.entityName} financial information has been saved successfully`}),c()},a=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:s.currency||"USD"}).format(t),l=t=>t>0?"text-green-600":t<0?"text-red-600":"text-gray-600",N=t=>t>=20?"default":t>=10?"secondary":t>=0?"outline":"destructive";return e.jsx(ee,{open:D,onOpenChange:c,children:e.jsxs(se,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),P||`${v==="create"?"Add":v==="edit"?"Edit":"View"} Financial Information`]})}),e.jsxs(we,{value:o,onValueChange:u,className:"w-full",children:[e.jsxs(Pe,{className:"grid w-full grid-cols-5",children:[e.jsx(_,{value:"basic",children:"Basic Info"}),e.jsx(_,{value:"costs",children:"Costs"}),e.jsx(_,{value:"labor",children:"Labor"}),e.jsx(_,{value:"sale",children:"Sale Info"}),e.jsx(_,{value:"summary",children:"Summary"})]}),e.jsxs(V,{value:"basic",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"type",children:"Transaction Type"}),e.jsxs(J,{value:s.type,onValueChange:t=>m("type",t),disabled:p,children:[e.jsx(Y,{children:e.jsx(z,{})}),e.jsxs(Q,{children:[e.jsx(M,{value:"car_sale",children:"Car Sale"}),e.jsx(M,{value:"repair",children:"Repair Service"}),e.jsx(M,{value:"parts",children:"Parts Sale"}),e.jsx(M,{value:"service",children:"General Service"}),e.jsx(M,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"date",children:"Date"}),e.jsx(g,{id:"date",type:"date",value:s.date,onChange:t=>m("date",t.target.value),disabled:p,className:"pdi-date-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"entityName",children:"Item/Service Name"}),e.jsx(g,{id:"entityName",placeholder:"e.g., BMW X5 2024, Engine Repair, etc.",value:s.entityName,onChange:t=>m("entityName",t.target.value),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"currency",children:"Currency"}),e.jsxs(J,{value:s.currency,onValueChange:t=>m("currency",t),disabled:p,children:[e.jsx(Y,{children:e.jsx(z,{})}),e.jsxs(Q,{children:[e.jsx(M,{value:"USD",children:"USD ($)"}),e.jsx(M,{value:"EUR",children:"EUR (€)"}),e.jsx(M,{value:"LBP",children:"LBP (ل.ل)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"clientName",children:"Client Name"}),e.jsx(g,{id:"clientName",placeholder:"Client or customer name",value:s.clientName||"",onChange:t=>m("clientName",t.target.value),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"clientContact",children:"Client Contact"}),e.jsx(g,{id:"clientContact",placeholder:"Phone or email",value:s.clientContact||"",onChange:t=>m("clientContact",t.target.value),disabled:p})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"notes",children:"Notes"}),e.jsx(pe,{id:"notes",placeholder:"Additional notes or comments",value:s.notes||"",onChange:t=>m("notes",t.target.value),disabled:p,rows:3})]})]}),e.jsxs(V,{value:"costs",className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(R,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Acquisition & Import Costs"]})}),e.jsxs(b,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"purchasePrice",children:"Purchase Price"}),e.jsx(g,{id:"purchasePrice",type:"number",placeholder:"0",value:s.purchasePrice||"",onChange:t=>m("purchasePrice",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"shippingCost",children:"Shipping Cost"}),e.jsx(g,{id:"shippingCost",type:"number",placeholder:"0",value:s.shippingCost||"",onChange:t=>m("shippingCost",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"importDuty",children:"Import Duty"}),e.jsx(g,{id:"importDuty",type:"number",placeholder:"0",value:s.importDuty||"",onChange:t=>m("importDuty",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"customsClearance",children:"Customs Clearance"}),e.jsx(g,{id:"customsClearance",type:"number",placeholder:"0",value:s.customsClearance||"",onChange:t=>m("customsClearance",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"inspectionFees",children:"Inspection Fees"}),e.jsx(g,{id:"inspectionFees",type:"number",placeholder:"0",value:s.inspectionFees||"",onChange:t=>m("inspectionFees",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"registrationFees",children:"Registration Fees"}),e.jsx(g,{id:"registrationFees",type:"number",placeholder:"0",value:s.registrationFees||"",onChange:t=>m("registrationFees",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"insuranceCost",children:"Insurance Cost"}),e.jsx(g,{id:"insuranceCost",type:"number",placeholder:"0",value:s.insuranceCost||"",onChange:t=>m("insuranceCost",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"transportCost",children:"Transport Cost"}),e.jsx(g,{id:"transportCost",type:"number",placeholder:"0",value:s.transportCost||"",onChange:t=>m("transportCost",parseFloat(t.target.value)||0),disabled:p})]})]})]}),e.jsxs(C,{children:[e.jsx(R,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Parts & Materials"]})}),e.jsxs(b,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"partsCost",children:"Parts Cost (Base)"}),e.jsx(g,{id:"partsCost",type:"number",placeholder:"0",value:s.partsCost||"",onChange:t=>m("partsCost",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"partsMarkup",children:"Markup (%)"}),e.jsx(g,{id:"partsMarkup",type:"number",placeholder:"0",value:s.partsMarkup||"",onChange:t=>m("partsMarkup",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"totalPartsCost",children:"Total Parts Cost"}),e.jsx(g,{id:"totalPartsCost",type:"number",value:s.totalPartsCost||0,disabled:!0,className:"bg-gray-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"partsSupplier",children:"Parts Supplier"}),e.jsx(g,{id:"partsSupplier",placeholder:"Supplier name",value:s.partsSupplier||"",onChange:t=>m("partsSupplier",t.target.value),disabled:p})]})]})]}),e.jsxs(C,{children:[e.jsx(R,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),"Operational Costs"]})}),e.jsxs(b,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"electricityCost",children:"Electricity Cost"}),e.jsx(g,{id:"electricityCost",type:"number",placeholder:"0",value:s.electricityCost||"",onChange:t=>m("electricityCost",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"equipmentUsageCost",children:"Equipment Usage"}),e.jsx(g,{id:"equipmentUsageCost",type:"number",placeholder:"0",value:s.equipmentUsageCost||"",onChange:t=>m("equipmentUsageCost",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"storageCost",children:"Storage Cost"}),e.jsx(g,{id:"storageCost",type:"number",placeholder:"0",value:s.storageCost||"",onChange:t=>m("storageCost",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"overheadCost",children:"Overhead Allocation"}),e.jsx(g,{id:"overheadCost",type:"number",placeholder:"0",value:s.overheadCost||"",onChange:t=>m("overheadCost",parseFloat(t.target.value)||0),disabled:p})]})]})]})]}),e.jsx(V,{value:"labor",className:"space-y-4",children:e.jsxs(C,{children:[e.jsx(R,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-4 w-4"}),"Labor Information"]})}),e.jsxs(b,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"laborHours",children:"Regular Hours"}),e.jsx(g,{id:"laborHours",type:"number",step:"0.1",placeholder:"0",value:s.laborHours||"",onChange:t=>m("laborHours",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"laborRate",children:"Hourly Rate"}),e.jsx(g,{id:"laborRate",type:"number",placeholder:"0",value:s.laborRate||"",onChange:t=>m("laborRate",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"overtimeHours",children:"Overtime Hours"}),e.jsx(g,{id:"overtimeHours",type:"number",step:"0.1",placeholder:"0",value:s.overtimeHours||"",onChange:t=>m("overtimeHours",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"overtimeRate",children:"Overtime Rate"}),e.jsx(g,{id:"overtimeRate",type:"number",placeholder:"Auto (1.5x regular)",value:s.overtimeRate||"",onChange:t=>m("overtimeRate",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(h,{htmlFor:"totalLaborCost",children:"Total Labor Cost"}),e.jsx(g,{id:"totalLaborCost",type:"number",value:s.totalLaborCost||0,disabled:!0,className:"bg-gray-50 text-lg font-semibold"})]})]})]})}),e.jsx(V,{value:"sale",className:"space-y-4",children:e.jsxs(C,{children:[e.jsx(R,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Sale & Revenue Information"]})}),e.jsxs(b,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"quotedPrice",children:"Quoted Price"}),e.jsx(g,{id:"quotedPrice",type:"number",placeholder:"0",value:s.quotedPrice||"",onChange:t=>m("quotedPrice",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"listingPrice",children:"Listing Price"}),e.jsx(g,{id:"listingPrice",type:"number",placeholder:"0",value:s.listingPrice||"",onChange:t=>m("listingPrice",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"finalSalePrice",children:"Final Sale Price"}),e.jsx(g,{id:"finalSalePrice",type:"number",placeholder:"0",value:s.finalSalePrice||"",onChange:t=>m("finalSalePrice",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"discountGiven",children:"Discount Given"}),e.jsx(g,{id:"discountGiven",type:"number",placeholder:"0",value:s.discountGiven||"",onChange:t=>m("discountGiven",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"salesCommission",children:"Sales Commission"}),e.jsx(g,{id:"salesCommission",type:"number",placeholder:"0",value:s.salesCommission||"",onChange:t=>m("salesCommission",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"marketingCost",children:"Marketing Cost"}),e.jsx(g,{id:"marketingCost",type:"number",placeholder:"0",value:s.marketingCost||"",onChange:t=>m("marketingCost",parseFloat(t.target.value)||0),disabled:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"paymentMethod",children:"Payment Method"}),e.jsxs(J,{value:s.paymentMethod||"",onValueChange:t=>m("paymentMethod",t),disabled:p,children:[e.jsx(Y,{children:e.jsx(z,{placeholder:"Select payment method"})}),e.jsxs(Q,{children:[e.jsx(M,{value:"cash",children:"Cash"}),e.jsx(M,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(M,{value:"check",children:"Check"}),e.jsx(M,{value:"credit_card",children:"Credit Card"}),e.jsx(M,{value:"financing",children:"Financing"}),e.jsx(M,{value:"trade_in",children:"Trade-in"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"paymentTerms",children:"Payment Terms"}),e.jsx(g,{id:"paymentTerms",placeholder:"e.g., Net 30, COD, etc.",value:s.paymentTerms||"",onChange:t=>m("paymentTerms",t.target.value),disabled:p})]})]})]})}),e.jsx(V,{value:"summary",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsx(R,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Financial Summary"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Cost:"}),e.jsx("span",{className:"font-semibold text-red-600",children:a(j.totalCost)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Gross Revenue:"}),e.jsx("span",{className:"font-semibold",children:a((s.finalSalePrice||0)-(s.discountGiven||0))})]}),e.jsx(Ae,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Gross Profit:"}),e.jsx("span",{className:`font-semibold ${l(j.grossProfit)}`,children:a(j.grossProfit)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Net Profit:"}),e.jsx("span",{className:`font-semibold ${l(j.netProfit)}`,children:a(j.netProfit)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Profit Margin:"}),e.jsxs(L,{variant:N(j.profitMargin),children:[j.profitMargin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ROI:"}),e.jsxs(L,{variant:N(j.roi),children:[j.roi.toFixed(1),"%"]})]})]})]}),e.jsxs(C,{children:[e.jsx(R,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Status & Information"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"status",children:"Status"}),e.jsxs(J,{value:s.status,onValueChange:t=>m("status",t),disabled:p,children:[e.jsx(Y,{children:e.jsx(z,{})}),e.jsxs(Q,{children:[e.jsx(M,{value:"draft",children:"Draft"}),e.jsx(M,{value:"pending",children:"Pending Approval"}),e.jsx(M,{value:"approved",children:"Approved"}),e.jsx(M,{value:"completed",children:"Completed"}),e.jsx(M,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Transaction Type"}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.type==="car_sale"&&e.jsx(ie,{className:"h-4 w-4"}),s.type==="repair"&&e.jsx(Ie,{className:"h-4 w-4"}),s.type==="parts"&&e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{className:"capitalize",children:(S=s.type)==null?void 0:S.replace("_"," ")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Date"}),e.jsx("div",{className:"text-sm text-gray-600",children:new Date(s.date).toLocaleDateString()})]}),s.clientName&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Client"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.clientName,s.clientContact&&e.jsx("div",{className:"text-xs text-gray-500",children:s.clientContact})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Performance"})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[j.profitMargin>=20&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(Ce,{className:"h-3 w-3"}),"Excellent profit margin"]}),j.profitMargin<10&&j.profitMargin>0&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600",children:[e.jsx(Me,{className:"h-3 w-3"}),"Low profit margin"]}),j.profitMargin<0&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(Me,{className:"h-3 w-3"}),"Loss on transaction"]})]})]})]})]})]})})]}),e.jsxs(re,{className:"flex gap-2",children:[e.jsx(O,{variant:"outline",onClick:c,children:"Cancel"}),!p&&e.jsxs(O,{onClick:x,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Save Financial Data"]})]})]})})},bs=()=>{const[D,c]=F.useState("pricing"),[i,r]=F.useState([]),[v,P]=F.useState(!0),[s,n]=F.useState(!1),[o,u]=F.useState(null),{logActivity:j}=ze();F.useEffect(()=>{T()},[]);const T=async()=>{try{P(!0);const t=localStorage.getItem("carInventory");if(t){const w=JSON.parse(t).map(y=>{const I=new Date(y.arrivalDate),A=y.soldDate?new Date(y.soldDate):null,B=Math.floor(A?(A.getTime()-I.getTime())/(1e3*60*60*24):(new Date().getTime()-I.getTime())/(1e3*60*60*24));return{id:y.id,vinNumber:y.vinNumber,model:y.model,brand:y.brand||"Unknown",year:y.year,color:y.color,arrivalDate:y.arrivalDate,soldDate:y.soldDate,purchasePrice:y.purchasePrice,sellingPrice:y.sellingPrice,marketPrice:p(y),receipts:y.receipts||[],status:y.status,daysInInventory:B,profitMargin:x(y.purchasePrice,y.sellingPrice)}});r(w)}}catch(t){console.error("Error loading financial data:",t),$({title:"Error",description:"Failed to load financial data",variant:"destructive"})}finally{P(!1)}},p=t=>{const f=m(t.model,t.category),w=Math.max(.7,1-(new Date().getFullYear()-t.year)*.05);return Math.round(f*w)},m=(t,f)=>({"Voyah Free":45e3,"Voyah Dream":55e3,"Voyah Passion":65e3,"Voyah Courage":75e3,"MHero 917":85e3,"Tesla Model 3":35e3,"Tesla Model Y":45e3,"BMW X3":5e4})[t]||(f==="EV"?4e4:35e3),x=(t,f)=>!t||!f?0:(f-t)/t*100,a=(t,f,w)=>{r(I=>I.map(A=>A.id===t?{...A,purchasePrice:f,sellingPrice:w,profitMargin:x(f,w)}:A));const y=localStorage.getItem("carInventory");if(y){const A=JSON.parse(y).map(U=>U.id===t?{...U,purchasePrice:f,sellingPrice:w}:U);localStorage.setItem("carInventory",JSON.stringify(A))}$({title:"Pricing Updated",description:"Car pricing has been successfully updated"})},l=(t,f)=>{const w=i.find(I=>I.id===t),y={...f,id:Date.now().toString()};r(I=>I.map(A=>A.id===t?{...A,receipts:[...A.receipts,y]}:A)),j("UPLOAD","FINANCIAL","RECEIPT",`Uploaded ${f.type} receipt for ${w==null?void 0:w.model} (VIN: ${w==null?void 0:w.vinNumber}) - Amount: $${f.amount.toLocaleString()}`,{entityId:y.id,entityName:`${f.type} receipt - ${w==null?void 0:w.model}`,changes:[{field:"receiptType",oldValue:null,newValue:f.type},{field:"amount",oldValue:null,newValue:f.amount},{field:"description",oldValue:null,newValue:f.description}]}),$({title:"Receipt Added",description:"Receipt has been uploaded and saved"})},N=t=>{u(null),n(!0)},S=async t=>{try{if(o){r(w=>w.map(y=>y.id===o.id?{...y,purchasePrice:t.purchasePrice||y.purchasePrice,sellingPrice:t.finalSalePrice||y.sellingPrice,profitMargin:x(t.purchasePrice||y.purchasePrice,t.finalSalePrice||y.sellingPrice)}:y));const f=localStorage.getItem("carInventory");if(f){const y=JSON.parse(f).map(I=>I.id===o.id?{...I,purchasePrice:t.purchasePrice||I.purchasePrice,sellingPrice:t.finalSalePrice||I.sellingPrice}:I);localStorage.setItem("carInventory",JSON.stringify(y))}}await j(o?"UPDATE":"CREATE","FINANCIAL","FINANCIAL_RECORD",`${o?"Updated":"Created"} comprehensive financial record for ${t.entityName}`,{entityId:t.entityId,entityName:t.entityName,metadata:{pageUrl:window.location.href,deviceType:"desktop"}}),$({title:"Financial Data Saved",description:`Comprehensive financial information for ${t.entityName} has been saved successfully.`}),n(!1),u(null)}catch(f){console.error("Error saving financial data:",f),$({title:"Error",description:"Failed to save financial data. Please try again.",variant:"destructive"})}};return v?e.jsx("div",{className:"container mx-auto p-4",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading financial data..."})]})})}):e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Financial Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage car pricing, analyze supply & demand, and forecast inventory needs"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(O,{onClick:()=>N(),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ue,{className:"mr-1 h-4 w-4"}),"Add Financial Record"]}),e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Inventory Value"}),e.jsxs("p",{className:"text-lg font-semibold",children:["$",i.reduce((t,f)=>t+(f.marketPrice||0),0).toLocaleString()]})]})]})}),e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cars in Stock"}),e.jsx("p",{className:"text-lg font-semibold",children:i.filter(t=>t.status==="in_stock").length})]})]})})]})]}),e.jsxs(we,{value:D,onValueChange:c,className:"space-y-4",children:[e.jsxs(Pe,{className:"grid w-full grid-cols-6",children:[e.jsxs(_,{value:"pricing",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Pricing & Receipts"]}),e.jsxs(_,{value:"analytics",className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Supply & Demand"]}),e.jsxs(_,{value:"forecast",className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Inventory Forecast"]}),e.jsxs(_,{value:"profitability",className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Profitability"]}),e.jsxs(_,{value:"garage-costs",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Garage Costs"]}),e.jsxs(_,{value:"receipts",className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Receipt Manager"]}),e.jsxs(_,{value:"marketing-budget",className:"flex items-center gap-2",children:[e.jsx(Clock,{className:"h-4 w-4"}),"Marketing Budget"]})]}),e.jsx(V,{value:"pricing",children:e.jsx(ss,{cars:i,onUpdatePricing:a})}),e.jsx(V,{value:"analytics",children:e.jsx(ts,{cars:i})}),e.jsx(V,{value:"forecast",children:e.jsx(as,{cars:i})}),e.jsx(V,{value:"profitability",children:e.jsx(rs,{cars:i})}),e.jsx(V,{value:"garage-costs",children:e.jsx(is,{})}),e.jsx(V,{value:"receipts",children:e.jsx(ls,{cars:i,onAddReceipt:l})}),e.jsx(V,{value:"marketing-budget",children:e.jsx(es,{})})]}),e.jsx(ns,{isOpen:s,onClose:()=>n(!1),onSave:S,initialData:o?{entityId:o.id,entityName:`${o.brand} ${o.model}`,type:"car_sale",date:new Date().toISOString().split("T")[0],purchasePrice:o.purchasePrice,finalSalePrice:o.sellingPrice,currency:"USD",status:"draft"}:void 0})]})};export{bs as default};
