import{R as He,aP as ha,r as n,t as b,j as e,a as v,ab as Se,aK as We,D as De,q as _e,v as Re,w as Ie,e as Ee,B as fe,b as X,c as ee,d as ae,ag as le,f as re,L as N,I as w,aq as ze,g as Ve,h as Te,i as ce,k as H,l as Oe,m as W,bE as Ue,ac as Qe,au as Ye,a1 as Pe,a2 as ga,X as xa,U as va,aH as fa,bO as $e,aB as Ne,aG as xe,Y as ya,Z as ja,_ as we,aA as Ce,aa as ba,bP as ie,bQ as ke,b0 as Na,C as wa,bR as Ca}from"./index-BKWZsjPE.js";import{E as ve}from"./EnhancedSelect-BUa4Zeg3.js";import{S as qe}from"./scan-DCSRxph9.js";import{L as ka}from"./loader-2-D5fSlfQJ.js";import{R as Ge}from"./rotate-ccw-4VfiR85H.js";import{S as Be}from"./square-pen-BiZj5u6Y.js";import{C as Sa}from"./chevron-left-CwLHv2Ng.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=He("CameraOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=He("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),Me={async processReceiptImage(y){try{const L=(await ha.processEnhancedMessage(`Analyze this receipt image and extract the following information in JSON format:
        {
          "supplier": "supplier name",
          "orderReference": "order/invoice number",
          "orderDate": "date in YYYY-MM-DD format",
          "items": [
            {
              "partName": "part name",
              "partNumber": "part number",
              "quantity": number,
              "price": number
            }
          ],
          "totalAmount": total amount,
          "shippingCompany": "shipping company if mentioned",
          "trackingCode": "tracking code if mentioned"
        }
        Extract all visible parts/items from the receipt. Be thorough and accurate.`,{source:"receipt_processing",imageData:y,currentRoute:"/ordered-parts"})).textResponse.match(/\{[\s\S]*\}/);if(L)return JSON.parse(L[0]);throw new Error("Could not extract structured data from receipt")}catch(T){throw console.error("Error processing receipt:",T),new Error("Failed to process receipt. Please try again or enter data manually.")}}},Ke=()=>{const[y,T]=n.useState(!1),[L,S]=n.useState(null),[R,h]=n.useState(null),[K,O]=n.useState(!1),[Q,f]=n.useState(!0),[x,m]=n.useState(!1),u=n.useRef(null),Y=n.useRef(null),E=n.useRef(null),A=n.useRef(null);n.useEffect(()=>{(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){f(!1);return}const j=(await navigator.mediaDevices.enumerateDevices()).some(C=>C.kind==="videoinput");f(j)}catch(i){console.error("Camera support check failed:",i),f(!1)}})()},[]),n.useEffect(()=>{const c=()=>{document.hidden&&y&&!L&&(console.log("Tab hidden with camera open and no photo taken, stopping camera"),z(),b({title:"Camera stopped",description:"Camera was turned off when you left the tab"}))};return document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c),E.current&&E.current.getTracks().forEach(i=>i.stop())}},[y,L]);const U=async()=>{try{if(console.log("üé• Starting camera..."),h(null),!Q){h("Camera not supported on this device");return}E.current&&E.current.getTracks().forEach(C=>C.stop());let c={video:{width:{ideal:1920,min:640},height:{ideal:1080,min:480},facingMode:"environment",frameRate:{ideal:30,min:15}}},i;try{console.log("üì± Trying with full constraints..."),i=await navigator.mediaDevices.getUserMedia(c)}catch{console.log("‚ö†Ô∏è Full constraints failed, trying with basic constraints..."),c={video:{facingMode:"environment"}};try{i=await navigator.mediaDevices.getUserMedia(c)}catch{console.log("‚ö†Ô∏è Environment camera failed, trying any camera..."),c={video:!0},i=await navigator.mediaDevices.getUserMedia(c)}}console.log("üì± Final constraints used:",c),console.log("‚úÖ Got camera stream:",{id:i.id,active:i.active,tracks:i.getTracks().length,videoTracks:i.getVideoTracks().length}),E.current=i;let j=u.current;if(!j){console.log("üì∫ Video element not ready, waiting...");for(let C=0;C<50&&(await new Promise(D=>setTimeout(D,100)),j=u.current,!j);C++);}if(j)j.srcObject=i,console.log("üì∫ Set video srcObject, waiting for video to be ready..."),await new Promise((C,D)=>{if(!u.current){D(new Error("Video element not available"));return}const k=u.current;let q;const M=()=>{q&&clearTimeout(q),k.removeEventListener("loadedmetadata",F),k.removeEventListener("error",l),k.removeEventListener("canplay",J)},F=()=>{console.log("Video metadata loaded, dimensions:",k.videoWidth,"x",k.videoHeight)},J=()=>{console.log("‚úÖ Video can play"),k.play().then(()=>{console.log("üé¨ Video playing successfully"),T(!0),b({title:"Camera started",description:"Camera is ready for capturing"}),M(),C(!0)}).catch(t=>{console.error("‚ùå Error playing video:",t),M(),D(t)})},l=t=>{console.error("Video element error:",t),M(),D(t)};q=setTimeout(()=>{console.error("‚è∞ Camera initialization timeout"),M(),D(new Error("Camera initialization timeout"))},1e4),k.addEventListener("loadedmetadata",F,{once:!0}),k.addEventListener("canplay",J,{once:!0}),k.addEventListener("error",l,{once:!0})});else throw console.error("‚ùå Video element not available after waiting"),new Error("Video element not found in DOM. The camera container may not be rendered yet.")}catch(c){console.error("‚ùå Error starting camera:",c);const i=c instanceof Error?c.message:"Unknown camera error";i.includes("Permission denied")||i.includes("NotAllowedError")?h("Camera permission denied. Please allow camera access and try again."):i.includes("NotFoundError")||i.includes("DevicesNotFoundError")?h("No camera found on this device."):i.includes("NotReadableError")||i.includes("TrackStartError")?h("Camera is busy or not accessible. Please close other applications using the camera."):h(i),b({title:"Camera Error",description:`Failed to start camera: ${i}`,variant:"destructive"})}},G=async()=>{if(u.current&&Y.current&&E.current)try{const c=u.current,i=Y.current,j=i.getContext("2d");if(!j)throw new Error("Canvas context not available");if((c.videoWidth===0||c.videoHeight===0)&&(await new Promise(D=>setTimeout(D,100)),c.videoWidth===0||c.videoHeight===0))throw new Error("Video not ready for capture - no dimensions available");i.width=c.videoWidth,i.height=c.videoHeight,j.drawImage(c,0,0,i.width,i.height);const C=i.toDataURL("image/jpeg",.9);return S(C),b({title:"Photo captured",description:"Photo captured successfully"}),C}catch(c){return console.error("Capture error:",c),b({title:"Capture Failed",description:"Failed to capture image. Please try again.",variant:"destructive"}),null}return null},I=async()=>{try{return O(!0),await G()}catch(c){return console.error("Error capturing image:",c),b({title:"Capture Failed",description:"Failed to capture image. Please try again.",variant:"destructive"}),null}finally{O(!1)}},$=c=>new Promise(i=>{var D;const j=(D=c.target.files)==null?void 0:D[0];if(!j){i(null);return}if(!j.type.startsWith("image/")){b({title:"Invalid file",description:"Please select an image file",variant:"destructive"}),i(null);return}const C=new FileReader;C.onload=k=>{var M;const q=(M=k.target)==null?void 0:M.result;S(q),b({title:"Image uploaded",description:"Image uploaded successfully"}),i(q)},C.onerror=()=>{b({title:"Upload failed",description:"Failed to upload image",variant:"destructive"}),i(null)},C.readAsDataURL(j)}),z=()=>{console.log("üõë Stopping camera..."),E.current&&(E.current.getTracks().forEach(c=>{console.log("üîá Stopping track:",c.kind),c.stop()}),E.current=null),u.current&&(u.current.srcObject=null),T(!1),S(null),h(null),O(!1)};return{cameraOpen:y,capturedImage:L,setCapturedImage:S,cameraError:R,isCapturing:K,cameraSupported:Q,isStartingCamera:x,videoRef:u,canvasRef:Y,streamRef:E,fileInputRef:A,startCamera:U,capturePhoto:G,captureImage:I,handleFileUpload:$,stopCamera:z}},Ze=({cameraOpen:y,cameraError:T,capturedImage:L,extractedData:S,isProcessing:R,videoRef:h,canvasRef:K,streamRef:O,fileInputRef:Q,onStartCamera:f,onStopCamera:x,onCapturePhoto:m,onFileUpload:u})=>{var Y,E;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:y?x:f,disabled:R,className:"flex-1",variant:"outline",children:[y?e.jsx(Ea,{className:"h-4 w-4 mr-2"}):e.jsx(Se,{className:"h-4 w-4 mr-2"}),y?"Stop Camera":"Start Camera"]}),e.jsxs(v,{onClick:()=>{var A;return(A=Q.current)==null?void 0:A.click()},disabled:R,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4"}),"Upload"]})]}),e.jsx("input",{ref:Q,type:"file",accept:"image/*",onChange:u,className:"hidden"}),T&&e.jsxs("div",{className:"p-2 bg-red-50 border border-red-200 rounded text-sm text-red-600",children:[e.jsx("strong",{children:"Camera Error:"})," ",T]}),y&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative w-full bg-gray-900 rounded-lg overflow-hidden border-2 border-blue-300",style:{aspectRatio:"4/3",minHeight:"200px"},children:[e.jsx("video",{ref:h,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{backgroundColor:"#000000",display:"block"}}),e.jsxs("div",{className:"absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded text-xs flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),O.current?"LIVE":"Connecting..."]}),e.jsxs("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs",children:[(Y=h.current)==null?void 0:Y.videoWidth,"x",(E=h.current)==null?void 0:E.videoHeight]})]}),e.jsxs(v,{onClick:m,className:"w-full",disabled:R||!O.current,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Capture & Auto-Analyze"]})]}),L&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:L,alt:"Captured",className:"w-full rounded-lg border max-h-64 object-contain bg-gray-50"}),S&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded text-xs",children:"Analyzed ‚úì"})]}),S&&e.jsxs("div",{className:"p-2 bg-green-50 rounded text-xs",children:[e.jsx("strong",{children:"MonzaBot Found:"}),Object.entries(S).map(([A,U])=>e.jsxs("div",{className:"truncate",children:[A,": ",String(U)]},A))]})]}),e.jsx("canvas",{ref:K,className:"hidden"})]})},Pa=({isOpen:y,onClose:T,onSave:L})=>{const[S,R]=n.useState("upload"),[h,K]=n.useState(!1),[O,Q]=n.useState(null),[f,x]=n.useState([]),[m,u]=n.useState({supplier:"",orderReference:"",orderDate:"",expectedDelivery:"",estimatedEta:"",shippingCompany:"",trackingCode:""}),{cameraOpen:Y,capturedImage:E,cameraError:A,videoRef:U,canvasRef:G,streamRef:I,fileInputRef:$,startCamera:z,capturePhoto:c,handleFileUpload:i,stopCamera:j}=Ke(),C=async()=>{const t=await c();t&&await k(t)},D=async t=>{const r=await i(t);r&&await k(r)},k=async t=>{try{K(!0),j();const r=await Me.processReceiptImage(t);Q(r),u(d=>({...d,supplier:r.supplier||"",orderReference:r.orderReference||"",orderDate:r.orderDate||"",shippingCompany:r.shippingCompany||"",trackingCode:r.trackingCode||""}));const p=r.items.map(d=>({partName:d.partName,partNumber:d.partNumber,quantity:d.quantity,price:d.price}));x(p),R("review"),b({title:"Receipt processed",description:`Found ${r.items.length} Voyah/Mhero parts. Please review and edit as needed.`})}catch(r){b({title:"Processing failed",description:r instanceof Error?r.message:"Failed to process receipt",variant:"destructive"})}finally{K(!1)}},q=()=>{x(t=>[...t,{partName:"",partNumber:"",quantity:1,price:0}])},M=t=>{x(r=>r.filter((p,d)=>d!==t))},F=(t,r,p)=>{x(d=>d.map((P,B)=>B===t?{...P,[r]:p}:P))},J=()=>{const t=f.map(r=>({part_name:r.partName,part_number:r.partNumber,quantity:r.quantity,supplier:m.supplier,order_reference:m.orderReference,order_date:m.orderDate||new Date().toISOString(),expected_delivery:m.expectedDelivery||void 0,estimated_eta:m.estimatedEta||void 0,status:"ordered",price:r.price,shipping_company:m.shippingCompany||void 0,tracking_code:m.trackingCode||void 0,notes:r.notes||void 0,category:"voyah"}));L(t),l()},l=()=>{R("upload"),Q(null),x([]),u({supplier:"",orderReference:"",orderDate:"",expectedDelivery:"",estimatedEta:"",shippingCompany:"",trackingCode:""}),j(),T()};return e.jsx(De,{open:y,onOpenChange:l,children:e.jsxs(_e,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(Re,{children:e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-blue-600"}),"Bulk Upload Voyah/Mhero Parts",e.jsx(fe,{variant:"outline",className:"bg-blue-100 text-blue-800",children:S})]})}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[S==="upload"&&e.jsx("div",{className:"space-y-4",children:e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(ae,{className:"text-blue-700",children:"Upload Voyah/Mhero Parts Receipt"}),e.jsx(le,{children:"Upload receipt for Voyah or Mhero electric vehicle parts. MonzaBot will extract the information automatically."})]}),e.jsx(re,{children:e.jsx(Ze,{cameraOpen:Y,cameraError:A,capturedImage:E,extractedData:O,isProcessing:h,videoRef:U,canvasRef:G,streamRef:I,fileInputRef:$,onStartCamera:z,onStopCamera:j,onCapturePhoto:C,onFileUpload:D})})]})}),S==="review"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(ae,{className:"text-blue-700",children:"Voyah/Mhero Order Settings"}),e.jsx(le,{children:"These settings will apply to all Voyah/Mhero parts in this order"})]}),e.jsxs(re,{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Supplier *"}),e.jsx(w,{value:m.supplier,onChange:t=>u(r=>({...r,supplier:t.target.value})),placeholder:"Voyah/Mhero supplier"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Order Reference *"}),e.jsx(w,{value:m.orderReference,onChange:t=>u(r=>({...r,orderReference:t.target.value})),placeholder:"Order reference"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Order Date"}),e.jsx(w,{type:"date",value:m.orderDate,onChange:t=>u(r=>({...r,orderDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Expected Delivery"}),e.jsx(w,{type:"date",value:m.expectedDelivery,onChange:t=>u(r=>({...r,expectedDelivery:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Shipping Company"}),e.jsx(w,{value:m.shippingCompany,onChange:t=>u(r=>({...r,shippingCompany:t.target.value})),placeholder:"Shipping company"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Tracking Code"}),e.jsx(w,{value:m.trackingCode,onChange:t=>u(r=>({...r,trackingCode:t.target.value})),placeholder:"Tracking code"})]})]})]}),e.jsxs(X,{children:[e.jsx(ee,{children:e.jsxs(ae,{className:"flex items-center justify-between text-blue-700",children:["Voyah/Mhero Parts List (",f.length," items)",e.jsxs(v,{onClick:q,size:"sm",variant:"outline",children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),"Add Item"]})]})}),e.jsx(re,{children:e.jsxs(Ve,{children:[e.jsx(Te,{children:e.jsxs(ce,{children:[e.jsx(H,{children:"Part Name"}),e.jsx(H,{children:"Part Number"}),e.jsx(H,{children:"Quantity"}),e.jsx(H,{children:"Price"}),e.jsx(H,{children:"Actions"})]})}),e.jsx(Oe,{children:f.map((t,r)=>e.jsxs(ce,{children:[e.jsx(W,{children:e.jsx(w,{value:t.partName,onChange:p=>F(r,"partName",p.target.value),placeholder:"Voyah/Mhero part name"})}),e.jsx(W,{children:e.jsx(w,{value:t.partNumber,onChange:p=>F(r,"partNumber",p.target.value),placeholder:"Part number"})}),e.jsx(W,{children:e.jsx(w,{type:"number",min:"1",value:t.quantity,onChange:p=>F(r,"quantity",parseInt(p.target.value))})}),e.jsx(W,{children:e.jsx(w,{type:"number",step:"0.01",value:t.price||"",onChange:p=>F(r,"price",parseFloat(p.target.value)||0),placeholder:"Price"})}),e.jsx(W,{children:e.jsx(v,{onClick:()=>M(r),size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:e.jsx(Ue,{className:"h-4 w-4"})})})]},r))})]})})]})]})]}),e.jsxs(Qe,{children:[S==="upload"&&e.jsx(v,{onClick:l,variant:"outline",children:"Cancel"}),S==="review"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{onClick:()=>R("upload"),variant:"outline",children:"Back"}),e.jsxs(v,{onClick:J,disabled:!m.supplier||!m.orderReference||f.length===0,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Save ",f.length," Voyah/Mhero Parts"]})]})]})]})})},Da=({isOpen:y,onClose:T,onSave:L})=>{const[S,R]=n.useState("upload"),[h,K]=n.useState(!1),[O,Q]=n.useState(null),[f,x]=n.useState([]),[m,u]=n.useState({supplier:"",orderReference:"",orderDate:"",expectedDelivery:"",estimatedEta:"",shippingCompany:"",trackingCode:""}),{cameraOpen:Y,capturedImage:E,cameraError:A,videoRef:U,canvasRef:G,streamRef:I,fileInputRef:$,startCamera:z,capturePhoto:c,handleFileUpload:i,stopCamera:j}=Ke(),C=async()=>{const t=await c();t&&await k(t)},D=async t=>{const r=await i(t);r&&await k(r)},k=async t=>{try{K(!0),j();const r=await Me.processReceiptImage(t);Q(r),u(d=>({...d,supplier:r.supplier||"",orderReference:r.orderReference||"",orderDate:r.orderDate||"",shippingCompany:r.shippingCompany||"",trackingCode:r.trackingCode||""}));const p=r.items.map(d=>({partName:d.partName,partNumber:d.partNumber,quantity:d.quantity,price:d.price}));x(p),R("review"),b({title:"Receipt processed",description:`Found ${r.items.length} ICEV parts. Please review and edit as needed.`})}catch(r){b({title:"Processing failed",description:r instanceof Error?r.message:"Failed to process receipt",variant:"destructive"})}finally{K(!1)}},q=()=>{x(t=>[...t,{partName:"",partNumber:"",quantity:1,price:0}])},M=t=>{x(r=>r.filter((p,d)=>d!==t))},F=(t,r,p)=>{x(d=>d.map((P,B)=>B===t?{...P,[r]:p}:P))},J=()=>{const t=f.map(r=>({part_name:r.partName,part_number:r.partNumber,quantity:r.quantity,supplier:m.supplier,order_reference:m.orderReference,order_date:m.orderDate||new Date().toISOString(),expected_delivery:m.expectedDelivery||void 0,estimated_eta:m.estimatedEta||void 0,status:"ordered",price:r.price,shipping_company:m.shippingCompany||void 0,tracking_code:m.trackingCode||void 0,notes:r.notes||void 0,category:"normal_engine"}));L(t),l()},l=()=>{R("upload"),Q(null),x([]),u({supplier:"",orderReference:"",orderDate:"",expectedDelivery:"",estimatedEta:"",shippingCompany:"",trackingCode:""}),j(),T()};return e.jsx(De,{open:y,onOpenChange:l,children:e.jsxs(_e,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(Re,{children:e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-gray-600"}),"Bulk Upload ICEV Parts",e.jsx(fe,{variant:"outline",className:"bg-gray-100 text-gray-800",children:S})]})}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[S==="upload"&&e.jsx("div",{className:"space-y-4",children:e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(ae,{className:"text-gray-700",children:"Upload ICEV Parts Receipt"}),e.jsx(le,{children:"Upload receipt for Internal Combustion Engine Vehicle parts. MonzaBot will extract the information automatically."})]}),e.jsx(re,{children:e.jsx(Ze,{cameraOpen:Y,cameraError:A,capturedImage:E,extractedData:O,isProcessing:h,videoRef:U,canvasRef:G,streamRef:I,fileInputRef:$,onStartCamera:z,onStopCamera:j,onCapturePhoto:C,onFileUpload:D})})]})}),S==="review"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(ae,{className:"text-gray-700",children:"ICEV Order Settings"}),e.jsx(le,{children:"These settings will apply to all ICEV parts in this order"})]}),e.jsxs(re,{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Supplier *"}),e.jsx(w,{value:m.supplier,onChange:t=>u(r=>({...r,supplier:t.target.value})),placeholder:"ICEV parts supplier"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Order Reference *"}),e.jsx(w,{value:m.orderReference,onChange:t=>u(r=>({...r,orderReference:t.target.value})),placeholder:"Order reference"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Order Date"}),e.jsx(w,{type:"date",value:m.orderDate,onChange:t=>u(r=>({...r,orderDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Expected Delivery"}),e.jsx(w,{type:"date",value:m.expectedDelivery,onChange:t=>u(r=>({...r,expectedDelivery:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Shipping Company"}),e.jsx(w,{value:m.shippingCompany,onChange:t=>u(r=>({...r,shippingCompany:t.target.value})),placeholder:"Shipping company"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Tracking Code"}),e.jsx(w,{value:m.trackingCode,onChange:t=>u(r=>({...r,trackingCode:t.target.value})),placeholder:"Tracking code"})]})]})]}),e.jsxs(X,{children:[e.jsx(ee,{children:e.jsxs(ae,{className:"flex items-center justify-between text-gray-700",children:["ICEV Parts List (",f.length," items)",e.jsxs(v,{onClick:q,size:"sm",variant:"outline",children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),"Add Item"]})]})}),e.jsx(re,{children:e.jsxs(Ve,{children:[e.jsx(Te,{children:e.jsxs(ce,{children:[e.jsx(H,{children:"Part Name"}),e.jsx(H,{children:"Part Number"}),e.jsx(H,{children:"Quantity"}),e.jsx(H,{children:"Price"}),e.jsx(H,{children:"Actions"})]})}),e.jsx(Oe,{children:f.map((t,r)=>e.jsxs(ce,{children:[e.jsx(W,{children:e.jsx(w,{value:t.partName,onChange:p=>F(r,"partName",p.target.value),placeholder:"ICEV part name"})}),e.jsx(W,{children:e.jsx(w,{value:t.partNumber,onChange:p=>F(r,"partNumber",p.target.value),placeholder:"Part number"})}),e.jsx(W,{children:e.jsx(w,{type:"number",min:"1",value:t.quantity,onChange:p=>F(r,"quantity",parseInt(p.target.value))})}),e.jsx(W,{children:e.jsx(w,{type:"number",step:"0.01",value:t.price||"",onChange:p=>F(r,"price",parseFloat(p.target.value)||0),placeholder:"Price"})}),e.jsx(W,{children:e.jsx(v,{onClick:()=>M(r),size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",children:e.jsx(Ue,{className:"h-4 w-4"})})})]},r))})]})})]})]})]}),e.jsxs(Qe,{children:[S==="upload"&&e.jsx(v,{onClick:l,variant:"outline",children:"Cancel"}),S==="review"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{onClick:()=>R("upload"),variant:"outline",children:"Back"}),e.jsxs(v,{onClick:J,disabled:!m.supplier||!m.orderReference||f.length===0,className:"bg-gray-600 hover:bg-gray-700",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Save ",f.length," ICEV Parts"]})]})]})]})})},_a=({isOpen:y,onClose:T,onReceiptProcessed:L})=>{const[S,R]=n.useState(!1),[h,K]=n.useState(null),[O,Q]=n.useState(null),[f,x]=n.useState(!1),[m,u]=n.useState(!1),[Y,E]=n.useState(null),[A,U]=n.useState("select"),G=n.useRef(null),I=n.useRef(null),$=n.useRef(null),z=n.useRef(null),c=n.useRef(!0);n.useEffect(()=>(c.current=!0,y||(console.log("üö™ Dialog closed, stopping camera..."),j()),()=>{console.log("üßπ Component cleanup, unmounting..."),c.current=!1,j()}),[y]);const i=n.useCallback(async()=>{try{if(u(!0),U("camera"),console.log("üé• Starting receipt camera..."),await new Promise(P=>setTimeout(P,100)),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera API not supported in this browser");if(!(window.location.protocol==="https:"||window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"))throw new Error("Camera requires HTTPS or localhost. Current protocol: "+window.location.protocol);const t=[{video:{facingMode:"environment",width:{ideal:1920,max:4032},height:{ideal:1080,max:3024}}},{video:{facingMode:"environment",width:{ideal:1280,max:1920},height:{ideal:720,max:1080}}},{video:{facingMode:"user",width:{ideal:1280,max:1920},height:{ideal:720,max:1080}}},{video:{width:{ideal:1280,max:1920},height:{ideal:720,max:1080}}},{video:!0}];let r=null,p=null;for(let P=0;P<t.length;P++){const B=t[P];try{console.log(`Trying camera constraint set ${P+1}/${t.length}:`,B),r=await navigator.mediaDevices.getUserMedia(B),p=B,console.log("Camera stream obtained with constraints:",B);break}catch(_){if(console.warn(`Constraint set ${P+1} failed:`,_ instanceof Error?_.name:"Unknown",_ instanceof Error?_.message:String(_)),_ instanceof DOMException&&_.name==="NotAllowedError")throw _;continue}}if(!r)throw new Error("Failed to get camera stream with any constraints. Please check camera permissions and try again.");if(console.log("üé• Camera setup completed with constraints:",p),z.current=r,!c.current||!I.current){console.error("Video element ref is null or component unmounted - cannot assign stream"),r&&r.getTracks().forEach(P=>P.stop()),u(!1),b({title:"Camera Error",description:"Video element not found. Please try again.",variant:"destructive"});return}console.log("üì∫ Setting up video element...");const d=I.current;d.srcObject=null,setTimeout(()=>{console.log("Assigning stream to video element..."),d.srcObject=r,d.muted=!0,d.playsInline=!0,d.autoplay=!0,d.style.display="block",d.style.width="100%",d.style.height="100%";const P=()=>{console.log("üì∫ Video metadata loaded"),d.play().then(()=>{var _;console.log("Video playing successfully - setting camera active"),x(!0),u(!1),console.log("Camera state after successful start:",{isCameraActive:!0,isCameraLoading:!1,mode:"camera",streamActive:(_=z.current)==null?void 0:_.active,videoSrcObject:!!d.srcObject})}).catch(_=>{console.error("Video play error:",_),x(!0),u(!1)})},B=_=>{console.error("Video element error:",_),u(!1),b({title:"Video Error",description:"Video element error occurred. Please try again.",variant:"destructive"})};d.addEventListener("loadedmetadata",P,{once:!0}),d.addEventListener("error",B,{once:!0})},100)}catch(l){u(!1),console.error("Camera error:",l);let t="Could not access camera. ",r="Camera Error";if(l instanceof DOMException)switch(l.name){case"NotAllowedError":r="Camera Permission Denied",t="Please allow camera access in your browser settings and refresh the page.";break;case"NotFoundError":r="No Camera Found",t="No camera devices were found on this device.";break;case"NotSupportedError":r="Camera Not Supported",t="Camera is not supported in this browser or device.";break;case"NotReadableError":r="Camera Not Available",t="Camera is already in use by another application or there was a hardware error.";break;case"SecurityError":r="Security Error",t="Camera access blocked due to security restrictions.";break;default:t=`Camera error: ${l.name}. Please check camera permissions and ensure you are using HTTPS.`}else l instanceof Error&&(t=l.message);b({title:r,description:t,variant:"destructive"})}},[]),j=n.useCallback(()=>{console.log("üõë Stopping camera - current state:",{hasStream:!!z.current,hasVideo:!!I.current,isCameraActive:f,mode:A}),z.current&&(z.current.getTracks().forEach(l=>{console.log("üîå Stopping track:",l.kind,l.label),l.stop()}),z.current=null),I.current&&(I.current.srcObject=null),x(!1),u(!1),E(null),U("select"),console.log("Camera stopped, reset to select mode")},[f,A]),C=n.useCallback(()=>{if(!I.current||!$.current){b({title:"Camera not ready",description:"Please ensure the camera is active before capturing.",variant:"destructive"});return}const l=$.current,t=I.current,r=l.getContext("2d");if(!r)return;l.width=t.videoWidth,l.height=t.videoHeight,r.drawImage(t,0,0);const p=l.toDataURL("image/jpeg",.9);E(p),j(),b({title:"Photo captured",description:"Receipt photo captured! Processing with OCR..."}),k(p)},[]),D=async l=>{var r;const t=(r=l.target.files)==null?void 0:r[0];if(t){if(!t.type.startsWith("image/")){b({title:"Invalid file type",description:"Please upload an image file",variant:"destructive"});return}U("upload"),R(!0);try{const p=new FileReader;p.onload=async d=>{var B;const P=(B=d.target)==null?void 0:B.result;await k(P)},p.readAsDataURL(t)}catch(p){console.error("Error reading file:",p),b({title:"Error",description:"Failed to read the image file",variant:"destructive"}),R(!1)}}},k=async l=>{try{const t=await Me.processReceiptImage(l);K(t);const r=q(t);Q(r),b({title:"Receipt processed successfully",description:`Found ${t.items.length} items. Category: ${r==="voyah"?"Voyah/MHero":"ICEV"}`})}catch(t){console.error("Error processing receipt:",t),b({title:"Processing failed",description:t instanceof Error?t.message:"Failed to process receipt",variant:"destructive"})}finally{R(!1)}},q=l=>{const t=["voyah","mhero","electric","ev","battery","hybrid","lantu"],r=`${l.supplier||""} ${l.items.map(d=>`${d.partName} ${d.partNumber}`).join(" ")}`.toLowerCase();return t.some(d=>r.includes(d))?"voyah":"normal_engine"},M=()=>{h&&O&&(L(h,O),T(),F())},F=()=>{K(null),Q(null),R(!1),E(null),U("select"),j(),G.current&&(G.current.value="")},J=()=>{T(),F()};return e.jsx(De,{open:y,onOpenChange:J,children:e.jsxs(_e,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Re,{children:[e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5"}),"Upload Receipt for Parts"]}),e.jsx(ga,{children:"Upload a receipt image and MonzaBot will extract the parts information automatically"})]}),e.jsxs("div",{className:"space-y-6",children:[A==="select"&&!h&&!S&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(v,{onClick:()=>{var l;return(l=G.current)==null?void 0:l.click()},variant:"outline",className:"h-32 flex flex-col items-center justify-center gap-3 border-2 border-dashed hover:border-solid",children:[e.jsx(We,{className:"h-8 w-8"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium",children:"Upload Image"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"From your device"})]})]}),e.jsxs(v,{onClick:i,variant:"outline",className:"h-32 flex flex-col items-center justify-center gap-3 border-2 border-dashed border-monza-yellow hover:border-solid hover:bg-monza-yellow/5",children:[e.jsx(Se,{className:"h-8 w-8 text-monza-yellow"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium",children:"Take Photo"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Using camera"})]})]})]}),A==="camera"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden mx-auto max-w-lg",children:[e.jsx("video",{ref:I,autoPlay:!0,playsInline:!0,muted:!0,controls:!1,className:"w-full h-full min-h-[400px] max-h-[600px] object-cover cursor-pointer block",style:{display:"block",backgroundColor:"#000",minHeight:"400px",maxHeight:"600px"}}),m&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-80 flex items-center justify-center z-20",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-monza-yellow border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-sm font-medium",children:"Starting camera..."}),e.jsx("p",{className:"text-xs opacity-80 mt-1",children:"Please allow camera access when prompted"})]})}),f&&!m&&e.jsx("div",{className:"absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded z-10",children:"üìπ Camera Active"}),f&&!m&&e.jsx("div",{className:"absolute inset-4 border-2 border-monza-yellow border-dashed rounded-lg flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"bg-black/70 text-white px-4 py-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-sm font-medium",children:"DOCUMENT Position receipt here"}),e.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Ensure all text is visible and clear"})]})}),f&&!m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-8 left-8 w-6 h-6 border-l-2 border-t-2 border-monza-yellow"}),e.jsx("div",{className:"absolute top-8 right-8 w-6 h-6 border-r-2 border-t-2 border-monza-yellow"}),e.jsx("div",{className:"absolute bottom-8 left-8 w-6 h-6 border-l-2 border-b-2 border-monza-yellow"}),e.jsx("div",{className:"absolute bottom-8 right-8 w-6 h-6 border-r-2 border-b-2 border-monza-yellow"})]})]}),f&&!m&&e.jsxs("div",{className:"flex gap-2 justify-center flex-wrap",children:[e.jsxs(v,{onClick:C,className:"flex items-center gap-2 bg-monza-yellow hover:bg-monza-yellow/90 text-monza-black font-semibold",children:[e.jsx(qe,{className:"h-4 w-4"}),"Capture & Process Receipt"]}),e.jsxs(v,{onClick:j,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(xa,{className:"h-4 w-4"}),"Cancel"]})]}),e.jsx("canvas",{ref:$,className:"hidden"})]}),S&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ka,{className:"h-8 w-8 animate-spin mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Processing receipt..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"MonzaBot is extracting parts information"})]}),Y&&!h&&!S&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"relative inline-block",children:e.jsx("img",{src:Y,alt:"Captured receipt",className:"max-w-full max-h-64 object-contain rounded-lg border"})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(v,{onClick:()=>k(Y),className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4"}),"Process Receipt"]}),e.jsxs(v,{onClick:()=>{E(null),i()},variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Retake Photo"]})]})]}),h&&e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsxs(ae,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Extracted Information"}),e.jsx(fe,{variant:O==="voyah"?"default":"secondary",children:O==="voyah"?"Voyah/MHero Parts":"ICEV Parts"})]}),e.jsx(le,{children:"Review the extracted information before adding to ordered parts"})]}),e.jsxs(re,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(N,{className:"font-medium",children:"Supplier"}),e.jsx("p",{children:h.supplier||"Not detected"})]}),e.jsxs("div",{children:[e.jsx(N,{className:"font-medium",children:"Order Reference"}),e.jsx("p",{children:h.orderReference||"Not detected"})]}),e.jsxs("div",{children:[e.jsx(N,{className:"font-medium",children:"Order Date"}),e.jsx("p",{children:h.orderDate||"Not detected"})]}),e.jsxs("div",{children:[e.jsx(N,{className:"font-medium",children:"Total Amount"}),e.jsx("p",{children:h.totalAmount?`$${h.totalAmount}`:"Not detected"})]})]}),e.jsxs("div",{children:[e.jsxs(N,{className:"font-medium mb-2 block",children:["Parts (",h.items.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:h.items.map((l,t)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.partName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["#",l.partNumber]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["Qty: ",l.quantity]}),l.price&&e.jsxs("p",{className:"text-sm text-gray-600",children:["$",l.price]})]})]},t))})]}),(h.shippingCompany||h.trackingCode)&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[h.shippingCompany&&e.jsxs("div",{children:[e.jsx(N,{className:"font-medium",children:"Shipping Company"}),e.jsx("p",{children:h.shippingCompany})]}),h.trackingCode&&e.jsxs("div",{children:[e.jsx(N,{className:"font-medium",children:"Tracking Code"}),e.jsx("p",{children:h.trackingCode})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:J,children:"Cancel"}),h&&e.jsxs(v,{onClick:M,className:"flex items-center gap-2",children:[e.jsx(va,{className:"h-4 w-4"}),"Add to Ordered Parts"]})]})]}),e.jsx("input",{ref:G,type:"file",accept:"image/*",onChange:D,className:"hidden"})]})})},Ma=()=>{fa();const[y,T]=n.useState([]),[L,S]=n.useState(!1),[R,h]=n.useState(!1),[K,O]=n.useState(!1),[Q,f]=n.useState("ev_erev"),[x,m]=n.useState({supplier:"",status:"",partName:"",etaRange:{start:"",end:""}}),[u,Y]=n.useState("order_date"),[E,A]=n.useState("desc"),[U,G]=n.useState(1),[I]=n.useState(10),[$,z]=n.useState(""),[c,i]=n.useState(""),[j,C]=n.useState(1),[D,k]=n.useState(""),[q,M]=n.useState(""),[F,J]=n.useState(""),[l,t]=n.useState(""),[r,p]=n.useState(""),[d,P]=n.useState(""),[B,_]=n.useState(""),[ye,se]=n.useState(""),[ue,ne]=n.useState("ev_erev"),[Z,de]=n.useState({}),[he,je]=n.useState(null);n.useEffect(()=>{Xe();const a=Ne("orderedPartsActiveTab","ev_erev");a&&["order-new","ev_erev","normal-engine"].includes(a)&&f(a)},[]);const Xe=$e(()=>{const a=Ne("orderedParts",[]);T(a)},a=>{console.error("Error loading ordered parts:",a),T([])}),me=$e(a=>{ie("orderedParts",a),T(a)},a=>{console.error("Error saving ordered parts:",a),b({title:"Error",description:"Failed to save ordered parts data.",variant:"destructive"})}),ea=a=>{const o=a;if(f(o),ie("orderedPartsActiveTab",o),o==="order-new"){const g=document.getElementById("order-form");g&&g.scrollIntoView({behavior:"smooth"})}},Fe=()=>{const a={};return $.trim()||(a.partName="Part name is required"),c.trim()?/^[A-Z0-9\-]+$/.test(c.trim())||(a.partNumber="Part number must contain only letters, numbers, and hyphens"):a.partNumber="Part number is required",D.trim()||(a.supplier="Supplier is required"),q.trim()||(a.orderReference="Order reference is required"),de(a),Object.keys(a).length===0},pe=a=>{de(o=>({...o,[a]:void 0}))},Ae=a=>{let o=a.filter(g=>!(x.partName&&!g.part_name.toLowerCase().includes(x.partName.toLowerCase())||x.supplier&&!g.supplier.toLowerCase().includes(x.supplier.toLowerCase())||x.status&&g.status!==x.status||x.etaRange.start&&g.expected_delivery&&new Date(g.expected_delivery)<new Date(x.etaRange.start)||x.etaRange.end&&g.expected_delivery&&new Date(g.expected_delivery)>new Date(x.etaRange.end)));return o.sort((g,s)=>{let V,te;switch(u){case"order_date":V=new Date(g.created_at),te=new Date(s.created_at);break;case"expected_delivery":V=g.expected_delivery?new Date(g.expected_delivery):new Date(0),te=s.expected_delivery?new Date(s.expected_delivery):new Date(0);break;case"part_name":V=g.part_name.toLowerCase(),te=s.part_name.toLowerCase();break;case"supplier":V=g.supplier.toLowerCase(),te=s.supplier.toLowerCase();break;default:V=g.status,te=s.status}return E==="asc"?V>te?1:-1:V<te?1:-1}),o},aa=a=>{const o=(U-1)*I,g=o+I;return a.slice(o,g)},ge=Math.ceil(Ae(y).length/I),ra=a=>[...new Set(a.map(o=>o.supplier))].sort(),oe=(a,o,g)=>{const s=JSON.parse(Ne("orderedPartsAuditLog","[]"));s.push({action:a,partId:o,details:g,timestamp:new Date().toISOString(),user:"Current User"}),ie("orderedPartsAuditLog",JSON.stringify(s))},ta=(a,o)=>{const g=y.map(s=>s.id===a?{...s,status:o,updated_at:new Date().toISOString()}:s);me(g),oe("status_update",a,{newStatus:o}),b({title:"Status Updated",description:`Part status changed to ${o}`})},sa=(a,o)=>{const g=o==="voyah"?"ev_erev":"normal_engine",s=a.items.map(V=>({part_name:V.partName,part_number:V.partNumber,quantity:V.quantity,supplier:a.supplier||"Unknown",order_reference:`REC-${Date.now()}`,expected_delivery:"",estimated_eta:"",price:ke(V.price,0),shipping_company:"",tracking_code:"",notes:"",status:"ordered",category:g,order_date:new Date().toISOString()}));be(s),O(!1)},be=a=>{const o=a.map(s=>({...s,id:`part_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),order_date:new Date().toISOString()})),g=[...y,...o];me(g),o.forEach(s=>{oe("part_created",s.id,{part_name:s.part_name,supplier:s.supplier})}),b({title:"Parts Added",description:`${o.length} parts have been added to the order`})},na=a=>{if(a.preventDefault(),!Fe()){b({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"});return}const o={id:`part_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,part_name:$.trim(),part_number:c.trim(),quantity:j,supplier:D.trim(),order_reference:q.trim(),expected_delivery:F||void 0,estimated_eta:l||void 0,price:ke(r,0),shipping_company:d.trim(),tracking_code:B.trim(),notes:ye.trim(),status:"ordered",category:ue,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),order_date:new Date().toISOString()},g=[...y,o];me(g),oe("part_created",o.id,{part_name:o.part_name,supplier:o.supplier}),z(""),i(""),C(1),k(""),M(""),J(""),t(""),p(""),P(""),_(""),se(""),ne("ev_erev"),de({});const s=ue==="ev_erev"?"ev_erev":"normal-engine";f(s),ie("orderedPartsActiveTab",s),b({title:"Part Ordered",description:`${$} has been added to the order`})},oa=a=>{const o=y.find(s=>s.id===a);if(!o)return;const g=y.filter(s=>s.id!==a);me(g),oe("part_deleted",a,{part_name:o.part_name}),b({title:"Part Deleted",description:`${o.part_name} has been removed from the order`})},ia=a=>{const o=y.find(g=>g.id===a);o&&(ta(a,"delivered"),b({title:"Part Delivered",description:`${o.part_name} has been marked as delivered and moved to new arrivals`}))},la=a=>{const o={ordered:"bg-blue-100 text-blue-800",shipped:"bg-yellow-100 text-yellow-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"};return o[a]||o.ordered},ca=a=>{if(!a)return"";const o=new Date(a),g=new Date,s=Math.ceil((o.getTime()-g.getTime())/(1e3*60*60*24));return s<0?"bg-red-50 border-red-200":s<=3?"bg-yellow-50 border-yellow-200":""},da=a=>{z(a.part_name),i(a.part_number),C(a.quantity),k(a.supplier),p(a.price.toString()),se(`Reordered from ${a.order_reference}`),ne(a.category),f("order-new"),ie("orderedPartsActiveTab","order-new");const o=document.getElementById("order-form");o&&o.scrollIntoView({behavior:"smooth"}),oe("part_reordered",a.id,{original_order:a.order_reference}),b({title:"Part Ready for Reorder",description:`${a.part_name} has been added to the order form`})},ma=a=>{je(a),f("order-new"),ie("orderedPartsActiveTab","order-new"),z(a.part_name),i(a.part_number),C(a.quantity),k(a.supplier),M(a.order_reference),J(a.expected_delivery||""),t(a.estimated_eta||""),p(a.price.toString()),P(a.shipping_company),_(a.tracking_code),se(a.notes),ne(a.category);const o=document.getElementById("order-form");o&&o.scrollIntoView({behavior:"smooth"})},pa=()=>{if(!he||!Fe()){b({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"});return}const a=y.map(o=>o.id===he.id?{...o,part_name:$.trim(),part_number:c.trim(),quantity:j,supplier:D.trim(),order_reference:q.trim(),expected_delivery:F||void 0,estimated_eta:l||void 0,price:ke(r,0),shipping_company:d.trim(),tracking_code:B.trim(),notes:ye.trim(),category:ue,updated_at:new Date().toISOString()}:o);me(a),oe("part_edited",he.id,{part_name:$}),je(null),z(""),i(""),C(1),k(""),M(""),J(""),t(""),p(""),P(""),_(""),se(""),ne("ev_erev"),de({}),b({title:"Part Updated",description:`${$} has been updated`})},ua=()=>{je(null),z(""),i(""),C(1),k(""),M(""),J(""),t(""),p(""),P(""),_(""),se(""),ne("ev_erev"),de({})},Le=a=>{const o=Ae(a),g=aa(o);return g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Parts Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:x.supplier||x.partName||x.status?"No parts match your current filters":"No parts have been ordered yet"}),e.jsxs(v,{onClick:()=>f("order-new"),className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),"Order New Part"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Na,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(w,{placeholder:"Search by part name, number, or supplier...",value:x.partName,onChange:s=>m(V=>({...V,partName:s.target.value})),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ve,{value:x.supplier,onValueChange:s=>m(V=>({...V,supplier:s})),options:[{value:"",label:"All Suppliers"},...ra(y).map(s=>({value:s,label:s}))],placeholder:"Filter by supplier",className:"w-48",searchable:!0}),e.jsx(ve,{value:x.status,onValueChange:s=>m(V=>({...V,status:s})),options:[{value:"",label:"All Status"},{value:"ordered",label:"Ordered"},{value:"shipped",label:"Shipped"},{value:"delivered",label:"Delivered"},{value:"cancelled",label:"Cancelled"}],placeholder:"Status",className:"w-32"}),e.jsx(ve,{value:u,onValueChange:s=>Y(s),options:[{value:"order_date",label:"Order Date"},{value:"expected_delivery",label:"Expected Delivery"},{value:"status",label:"Status"},{value:"part_name",label:"Part Name"},{value:"supplier",label:"Supplier"}],placeholder:"Sort by",className:"w-40"}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>A(s=>s==="asc"?"desc":"asc"),children:E==="asc"?"‚Üë":"‚Üì"})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(Ve,{children:[e.jsx(Te,{children:e.jsxs(ce,{children:[e.jsx(H,{children:"Part Name"}),e.jsx(H,{children:"Part Number"}),e.jsx(H,{children:"Supplier"}),e.jsx(H,{children:"Status"}),e.jsx(H,{children:"Expected Delivery"}),e.jsx(H,{children:"Price"}),e.jsx(H,{children:"Actions"})]})}),e.jsx(Oe,{children:g.map(s=>e.jsxs(ce,{children:[e.jsx(W,{className:"font-medium",children:s.part_name}),e.jsx(W,{className:"font-mono text-sm",children:s.part_number}),e.jsx(W,{children:s.supplier}),e.jsx(W,{children:e.jsx(fe,{className:la(s.status),children:s.status})}),e.jsx(W,{children:e.jsx("div",{className:`p-2 rounded border ${ca(s.expected_delivery)}`,children:s.expected_delivery?new Date(s.expected_delivery).toLocaleDateString():"Not set"})}),e.jsxs(W,{children:["$",s.price]}),e.jsx(W,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(v,{size:"sm",variant:"outline",onClick:()=>ma(s),title:"Edit Part",children:e.jsx(Be,{className:"h-3 w-3"})}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>oa(s.id),title:"Delete Part",children:e.jsx(Ue,{className:"h-3 w-3"})}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>ia(s.id),title:"Mark as Delivered",children:e.jsx(wa,{className:"h-3 w-3"})}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>da(s),title:"Reorder Part",children:e.jsx(Ge,{className:"h-3 w-3"})})]})})]},s.id))})]})}),ge>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(U-1)*I+1," to ",Math.min(U*I,o.length)," of ",o.length," parts"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>G(s=>Math.max(1,s-1)),disabled:U===1,children:[e.jsx(Sa,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:ge},(s,V)=>V+1).map(s=>e.jsx(v,{variant:U===s?"default":"outline",size:"sm",onClick:()=>G(s),children:s},s))}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>G(s=>Math.min(ge,s+1)),disabled:U===ge,children:["Next",e.jsx(Ca,{className:"h-4 w-4"})]})]})]})]})};return e.jsxs("div",{className:"container mx-auto py-6 space-y-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-monza-yellow p-3 rounded-lg",children:e.jsx(xe,{className:"h-8 w-8 text-monza-black"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-monza-black",children:"Ordered Parts"}),e.jsx("p",{className:"text-gray-600",children:"Track parts orders for EV/EREV vehicles and normal engine cars"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:a=>{a.preventDefault(),a.stopPropagation(),console.log("Receipt upload clicked"),O(!0)},className:"flex items-center gap-2 bg-green-50 hover:bg-green-100 text-green-700 border border-green-200",variant:"outline",children:[e.jsx(Je,{className:"h-4 w-4"}),"Upload Receipt"]}),e.jsxs(v,{onClick:a=>{a.preventDefault(),a.stopPropagation(),console.log("EV/EREV bulk upload clicked"),S(!0)},variant:"outline",className:"flex items-center gap-2 bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200",children:[e.jsx(Ee,{className:"h-4 w-4"}),"EV/EREV Bulk Upload"]}),e.jsxs(v,{onClick:a=>{a.preventDefault(),a.stopPropagation(),console.log("ICEV bulk upload clicked"),h(!0)},variant:"outline",className:"flex items-center gap-2 bg-gray-50 hover:bg-gray-100 text-gray-700 border border-gray-200",children:[e.jsx(Pe,{className:"h-4 w-4"}),"ICEV Bulk Upload"]})]})]}),e.jsxs(ya,{value:Q,onValueChange:ea,className:"w-full",children:[e.jsxs(ja,{className:"grid w-full grid-cols-3 bg-white border border-gray-200",children:[e.jsxs(we,{value:"order-new",className:"flex items-center gap-2 data-[state=active]:bg-monza-yellow data-[state=active]:text-monza-black",onClick:a=>{a.preventDefault(),f("order-new")},children:[e.jsx(xe,{className:"h-4 w-4"}),"Order New Part"]}),e.jsxs(we,{value:"ev_erev",className:"flex items-center gap-2 data-[state=active]:bg-monza-yellow data-[state=active]:text-monza-black",onClick:a=>{a.preventDefault(),f("ev_erev")},children:[e.jsx(Ee,{className:"h-4 w-4"}),"EV/EREV Parts (",y.filter(a=>a.category==="ev_erev").length,")"]}),e.jsxs(we,{value:"normal-engine",className:"flex items-center gap-2 data-[state=active]:bg-monza-yellow data-[state=active]:text-monza-black",onClick:a=>{a.preventDefault(),f("normal-engine")},children:[e.jsx(Pe,{className:"h-4 w-4"}),"Normal Engine Parts (",y.filter(a=>a.category==="normal_engine").length,")"]})]}),e.jsx(Ce,{value:"order-new",children:e.jsxs(X,{className:"border-gray-200 shadow-sm",children:[e.jsxs(ee,{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx(ae,{className:"text-monza-black",children:"Order New Part"}),e.jsx(le,{children:"Add a new part order to track shipment and delivery"})]}),e.jsx(re,{className:"p-6",children:e.jsxs("form",{onSubmit:na,className:"space-y-4",id:"order-form",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"partType",className:"text-monza-black",children:"Part Type *"}),e.jsx(ve,{value:ue,onValueChange:a=>{ne(a),pe("partName")},options:[{value:"ev_erev",label:"EV/EREV"},{value:"normal_engine",label:"Normal Engine (ICEV)"}],placeholder:"Select part type",className:"w-full",triggerClassName:"h-10 rounded-md border border-gray-200 bg-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-monza-yellow focus:border-monza-yellow"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"partName",className:"text-monza-black",children:"Part Name *"}),e.jsx(w,{id:"partName",value:$,onChange:a=>{z(a.target.value),pe("partName")},placeholder:"Enter part name",className:`border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow ${Z.partName?"border-red-500 focus:border-red-500 focus:ring-red-500":""}`}),Z.partName&&e.jsx("p",{className:"text-red-500 text-sm",children:Z.partName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"partNumber",className:"text-monza-black",children:"Part Number *"}),e.jsx(w,{id:"partNumber",value:c,onChange:a=>{i(a.target.value),pe("partNumber")},placeholder:"e.g., VOY-X43-009",className:`border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow ${Z.partNumber?"border-red-500 focus:border-red-500 focus:ring-red-500":""}`}),Z.partNumber&&e.jsx("p",{className:"text-red-500 text-sm",children:Z.partNumber})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"quantity",className:"text-monza-black",children:"Quantity"}),e.jsx(w,{id:"quantity",type:"number",min:"1",value:j,onChange:a=>C(parseInt(a.target.value)||1),className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"supplier",className:"text-monza-black",children:"Supplier *"}),e.jsx(w,{id:"supplier",value:D,onChange:a=>{k(a.target.value),pe("supplier")},placeholder:"Enter supplier name",className:`border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow ${Z.supplier?"border-red-500 focus:border-red-500 focus:ring-red-500":""}`}),Z.supplier&&e.jsx("p",{className:"text-red-500 text-sm",children:Z.supplier})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"orderReference",className:"text-monza-black",children:"Order Reference *"}),e.jsx(w,{id:"orderReference",value:q,onChange:a=>{M(a.target.value),pe("orderReference")},placeholder:"Enter order reference",className:`border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow ${Z.orderReference?"border-red-500 focus:border-red-500 focus:ring-red-500":""}`}),Z.orderReference&&e.jsx("p",{className:"text-red-500 text-sm",children:Z.orderReference})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"expectedDelivery",className:"text-monza-black",children:"Expected Delivery"}),e.jsx("div",{className:"relative date-input-wrapper",children:e.jsx(w,{id:"expectedDelivery",type:"date",value:F,onChange:a=>J(a.target.value),className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow",style:{zIndex:1e4}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"estimatedEta",className:"text-monza-black",children:"Estimated ETA"}),e.jsx("div",{className:"relative date-input-wrapper",children:e.jsx(w,{id:"estimatedEta",type:"date",value:l,onChange:a=>t(a.target.value),className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow",style:{zIndex:1e4}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"price",className:"text-monza-black",children:"Price"}),e.jsx(w,{id:"price",type:"number",step:"0.01",value:r,onChange:a=>p(a.target.value),placeholder:"Enter price",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"shippingCompany",className:"text-monza-black",children:"Shipping Company"}),e.jsx(w,{id:"shippingCompany",value:d,onChange:a=>P(a.target.value),placeholder:"Enter shipping company",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"trackingCode",className:"text-monza-black",children:"Tracking Code"}),e.jsx(w,{id:"trackingCode",value:B,onChange:a=>_(a.target.value),placeholder:"Enter tracking code",className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"notes",className:"text-monza-black",children:"Notes"}),e.jsx(ba,{id:"notes",value:ye,onChange:a=>se(a.target.value),placeholder:"Enter any additional notes",rows:3,className:"border-gray-200 focus:border-monza-yellow focus:ring-monza-yellow"})]}),e.jsx("div",{className:"flex gap-2",children:he?e.jsxs(e.Fragment,{children:[e.jsxs(v,{type:"button",onClick:pa,className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Update Part"]}),e.jsx(v,{type:"button",onClick:ua,variant:"outline",children:"Cancel"})]}):e.jsxs(v,{type:"submit",className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Order Part"]})})]})})]})}),e.jsx(Ce,{value:"ev_erev",children:Le(y.filter(a=>a.category==="ev_erev"))}),e.jsx(Ce,{value:"normal-engine",children:Le(y.filter(a=>a.category==="normal_engine"))})]}),e.jsx(Pa,{isOpen:L,onClose:()=>S(!1),onSave:be}),e.jsx(Da,{isOpen:R,onClose:()=>h(!1),onSave:be}),e.jsx(_a,{isOpen:K,onClose:()=>O(!1),onReceiptProcessed:sa})]})};export{Ma as default};
