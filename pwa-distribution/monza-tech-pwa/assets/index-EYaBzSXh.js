import{$ as Z,r as o,t as S,j as e,b1 as q,bY as G,d as D,az as K,e as m,f as h,g as u,h as Q,i as f,a4 as W,bR as ee,Y as se,Z as te,_ as k,aA as $,ag as C,B as O,L as A,I as R,bP as B,C as ae,X as ie}from"./index-CrIDvSVN.js";import{E as ne}from"./eye-off-DEKAPFZi.js";import{P as re}from"./percent-Bp62DjoX.js";const xe=()=>{const{user:t}=Z(),[E,M]=o.useState({}),[F,j]=o.useState(!0),[r,v]=o.useState([]),[p,b]=o.useState("overview"),[n,I]=o.useState(!0);if(o.useEffect(()=>{(t==null?void 0:t.role)==="owner"&&N(),j(!1)},[t]),(t==null?void 0:t.role)!=="owner")return S({title:"Access Denied",description:"Only owners can access financial data.",variant:"destructive"}),e.jsx(q,{to:"/dashboard"});const N=async()=>{try{j(!0);const s=localStorage.getItem("carInventory");if(s){const x=JSON.parse(s).map(i=>{const c=new Date(i.arrivalDate),l=i.soldDate?new Date(i.soldDate):null,H=Math.floor(l?(l.getTime()-c.getTime())/(1e3*60*60*24):(new Date().getTime()-c.getTime())/(1e3*60*60*24)),g=i.purchasePrice||0,w=i.sellingPrice||0,Y=g>0&&w>0?(w-g)/g*100:0,X=w-g;return{id:i.id,vinNumber:i.vinNumber,model:i.model,brand:i.brand||"Unknown",year:i.year,color:i.color,status:i.status||"in_stock",purchasePrice:g,sellingPrice:w,soldDate:i.soldDate,arrivalDate:i.arrivalDate,daysInInventory:H,profitMargin:Y,totalCost:g,netProfit:X}});v(x)}}catch(s){console.error("Error loading financial data:",s),S({title:"Error",description:"Failed to load financial data",variant:"destructive"})}finally{j(!1)}},L=(s,a,x)=>{v(c=>c.map(l=>l.id===s?{...l,purchasePrice:a,sellingPrice:x,profitMargin:a>0?(x-a)/a*100:0,netProfit:x-a}:l));const i=localStorage.getItem("carInventory");if(i){const l=JSON.parse(i).map(P=>P.id===s?{...P,purchasePrice:a,sellingPrice:x}:P);localStorage.setItem("carInventory",JSON.stringify(l))}S({title:"Pricing Updated",description:"Purchase and selling prices have been updated"})},U=r.reduce((s,a)=>s+(a.purchasePrice||0),0),_=r.filter(s=>s.status==="in_stock").reduce((s,a)=>s+(a.sellingPrice||0),0),V=r.filter(s=>s.status==="sold").reduce((s,a)=>s+(a.sellingPrice||0),0),z=r.filter(s=>s.status==="sold").reduce((s,a)=>s+(a.purchasePrice||0),0),J=V-z,T=r.filter(s=>s.profitMargin&&s.status==="sold").reduce((s,a)=>s+(a.profitMargin||0),0)/Math.max(1,r.filter(s=>s.profitMargin&&s.status==="sold").length),d=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),y=s=>s>20?"text-green-600":s>10?"text-yellow-600":s>0?"text-orange-600":"text-red-600";return F?e.jsx("div",{className:"container mx-auto p-4",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading financial data..."})]})})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[e.jsx(G,{className:"h-8 w-8 text-blue-600"}),"Owner Finances"]}),e.jsx("p",{className:"text-muted-foreground",children:"Confidential financial data and purchase prices - Owner access only"})]}),e.jsxs(D,{variant:"outline",onClick:()=>I(!n),className:"flex items-center gap-2",children:[n?e.jsx(ne,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"}),n?"Hide Prices":"Show Prices"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(m,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Inventory Value"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?d(U):"•••••••"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Based on purchase prices"})]})]}),e.jsxs(m,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Projected Revenue"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n?d(_):"•••••••"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"From current inventory"})]})]}),e.jsxs(m,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Actual Profit"}),e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:`text-2xl font-bold ${y(T)}`,children:n?d(J):"•••••••"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"From sold vehicles"})]})]}),e.jsxs(m,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Avg Profit Margin"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsxs("div",{className:`text-2xl font-bold ${y(T)}`,children:[T.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"On sold vehicles"})]})]})]}),e.jsxs(se,{value:p,onValueChange:b,className:"space-y-4",children:[e.jsxs(te,{children:[e.jsx(k,{value:"overview",children:"Financial Overview"}),e.jsx(k,{value:"details",children:"Car Details"}),e.jsx(k,{value:"pricing",children:"Pricing Management"})]}),e.jsx($,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Inventory Status Breakdown"}),e.jsx(C,{children:"Financial breakdown by car status"})]}),e.jsx(f,{className:"space-y-4",children:["in_stock","sold","reserved"].map(s=>{const a=r.filter(c=>c.status===s),x=a.reduce((c,l)=>c+(l.purchasePrice||0),0),i=a.reduce((c,l)=>c+(l.sellingPrice||0),0);return e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{children:e.jsxs(O,{variant:s==="sold"?"default":s==="reserved"?"secondary":"outline",children:[s.replace("_"," ")," (",a.length,")"]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:n?d(x):"•••••••"}),s==="sold"&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Revenue: ",n?d(i):"•••••••"]})]})]},s)})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Top Profit Margins"}),e.jsx(C,{children:"Best performing sold vehicles"})]}),e.jsx(f,{children:e.jsx("div",{className:"space-y-3",children:r.filter(s=>s.status==="sold"&&s.profitMargin).sort((s,a)=>(a.profitMargin||0)-(s.profitMargin||0)).slice(0,5).map(s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.brand," ",s.model]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.year," • ",s.color]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-bold ${y(s.profitMargin||0)}`,children:[(s.profitMargin||0).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n?d(s.netProfit||0):"•••••••"})]})]},s.id))})})]})]})}),e.jsx($,{value:"details",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Detailed Financial Data"}),e.jsx(C,{children:"Complete financial breakdown for all vehicles"})]}),e.jsx(f,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Vehicle"}),e.jsx("th",{className:"text-left p-2",children:"Status"}),e.jsx("th",{className:"text-left p-2",children:"Purchase Price"}),e.jsx("th",{className:"text-left p-2",children:"Selling Price"}),e.jsx("th",{className:"text-left p-2",children:"Net Profit"}),e.jsx("th",{className:"text-left p-2",children:"Margin"}),e.jsx("th",{className:"text-left p-2",children:"Days in Inventory"})]})}),e.jsx("tbody",{children:r.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.brand," ",s.model]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.year," • ",s.color]})]})}),e.jsx("td",{className:"p-2",children:e.jsx(O,{variant:s.status==="sold"?"default":s.status==="reserved"?"secondary":"outline",children:(s.status||"in_stock").replace("_"," ")})}),e.jsx("td",{className:"p-2 font-medium",children:n?d(s.purchasePrice||0):"••••••"}),e.jsx("td",{className:"p-2 font-medium",children:n?d(s.sellingPrice||0):"••••••"}),e.jsx("td",{className:`p-2 font-medium ${y(s.profitMargin||0)}`,children:n?d(s.netProfit||0):"••••••"}),e.jsxs("td",{className:`p-2 font-bold ${y(s.profitMargin||0)}`,children:[(s.profitMargin||0).toFixed(1),"%"]}),e.jsxs("td",{className:"p-2",children:[s.daysInInventory," days"]})]},s.id))})]})})})]})}),e.jsx($,{value:"pricing",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Pricing Management"}),e.jsx(C,{children:"Update purchase and selling prices for vehicles"})]}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4",children:r.filter(s=>s.status!=="sold").map(s=>e.jsx(le,{car:s,onUpdatePricing:L,showPrices:n},s.id))})})]})})]})]})},le=({car:t,onUpdatePricing:E,showPrices:M})=>{const[F,j]=o.useState(!1),[r,v]=o.useState(t.purchasePrice||0),[p,b]=o.useState(t.sellingPrice||0),n=()=>{if(r<=0||p<=0){S({title:"Invalid Prices",description:"Both purchase and selling prices must be greater than 0",variant:"destructive"});return}E(t.id,r,p),j(!1)},I=()=>{v(t.purchasePrice||0),b(t.sellingPrice||0),j(!1)};return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[t.brand," ",t.model]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.year," • ",t.color," • ",t.vinNumber]})]}),e.jsx("div",{className:"flex items-center gap-4",children:F?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-xs",children:"Purchase Price"}),e.jsx(R,{type:"number",value:r,onChange:N=>v(B(N.target.value,0)),className:"w-32"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(A,{className:"text-xs",children:"Selling Price"}),e.jsx(R,{type:"number",value:p,onChange:N=>b(B(N.target.value,0)),className:"w-32"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{size:"sm",onClick:n,children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(D,{size:"sm",variant:"outline",onClick:I,children:e.jsx(ie,{className:"h-4 w-4"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Purchase"}),e.jsx("div",{className:"font-medium",children:M?`$${(t.purchasePrice||0).toLocaleString()}`:"••••••"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Selling"}),e.jsx("div",{className:"font-medium",children:M?`$${(t.sellingPrice||0).toLocaleString()}`:"••••••"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Margin"}),e.jsxs("div",{className:`font-bold ${t.profitMargin&&t.profitMargin>0?"text-green-600":"text-red-600"}`,children:[(t.profitMargin||0).toFixed(1),"%"]})]}),e.jsx(D,{size:"sm",variant:"outline",onClick:()=>j(!0),children:"Edit"})]})})]})};export{xe as default};
