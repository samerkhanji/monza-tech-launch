import{j as t,D as he,a as pe,b as ve,c as ye,r as i,s as B,t as c,u as Qe,B as I,C as ce,A as Ge,d as q,Q as We,e as Ye,f as Ke,g as Xe,h as me,X as ge,T as Ze,i as et,k as tt,l as rt,m as ue,n as f,o as st,p as x,W as at,q as ot,F as nt,v as it,M as lt,w as dt,P as ct,V as mt,L as T,I as O,E as gt,x as ut,y as ht,z as pt,G as vt,H as yt,J as ft,K as xt,N as wt,O as X}from"./index-CrIDvSVN.js";const Dt=({isOpen:s,onClose:w,car:D})=>t.jsx(he,{open:s,onOpenChange:w,children:t.jsxs(pe,{className:"max-w-md",children:[t.jsx(ve,{children:t.jsx(ye,{children:"ðŸ§ª Car Click Test"})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold",children:"SUCCESS! Car clicking is working!"}),t.jsx("p",{className:"text-sm text-gray-600",children:"The click handler successfully triggered this dialog."})]}),D&&t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium",children:"Car Data Received:"}),t.jsxs("div",{className:"bg-gray-100 p-3 rounded text-sm",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"VIN:"})," ",D.vinNumber||D.vin||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Model:"})," ",D.model||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Year:"})," ",D.year||"N/A"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Status:"})," ",D.status||"N/A"]})]})]}),t.jsxs("div",{className:"text-xs text-gray-500",children:[t.jsx("p",{children:"If you see this dialog, the car clicking functionality is working correctly!"}),t.jsx("p",{children:"We can now replace this with the full CarHistoryDetailsDialog."})]})]})]})}),St=()=>({connectedUsers:[],currentPageUsers:[],isConnected:!1,broadcastUpdate:async()=>{},updateUserStatus:async()=>{},subscribe:()=>()=>{}});function Ct(){const[s,w]=i.useState([]),[D,S]=i.useState(!0),[P,h]=i.useState(null),[U,F]=i.useState("cars"),{subscribe:C}=St(),V=async()=>{try{S(!0),h(null);let{data:g,error:m}=await B.from("cars").select("*").order("created_at",{ascending:!1});if(m){const u=await B.from("car_inventory").select("*").order("created_at",{ascending:!1});if(u.error)throw m;F("car_inventory"),g=u.data}else F("cars");w(g||[])}catch(g){h(g instanceof Error?g.message:"Failed to fetch cars"),console.error("Error fetching cars:",g)}finally{S(!1)}},k=async g=>{try{const{data:m,error:u}=await B.from(U).insert([g]).select().single();if(u)throw u;return w(o=>[m,...o]),m}catch(m){return h(m instanceof Error?m.message:"Failed to add car"),console.error("Error adding car:",m),null}},H=async(g,m)=>{try{const{data:u,error:o}=await B.from(U).update({...m,updated_at:new Date().toISOString()}).eq("id",g).select().single();if(o)throw o;return w(n=>n.map(l=>l.id===g?u:l)),u}catch(u){return h(u instanceof Error?u.message:"Failed to update car"),console.error("Error updating car:",u),null}},L=async g=>{try{const{error:m}=await B.from(U).delete().eq("id",g);if(m)throw m;return w(u=>u.filter(o=>o.id!==g)),!0}catch(m){return h(m instanceof Error?m.message:"Failed to delete car"),console.error("Error deleting car:",m),!1}},z=async()=>{await V()};return i.useEffect(()=>{V()},[]),i.useEffect(()=>C(),[C]),{cars:s,loading:D,error:P,refetch:z,addCar:k,updateCar:H,deleteCar:L}}const Z=s=>({id:s.id,vinNumber:s.vin_number||s.vinNumber,model:s.model,brand:s.brand,year:s.year,color:s.color,interiorColor:s.interior_color||s.interiorColor,category:s.category,status:s.status,currentFloor:s.current_location||s.currentLocation||s.currentFloor,arrivalDate:s.arrival_date||s.arrivalDate||new Date().toISOString(),soldDate:s.sold_date||s.soldDate,reservedDate:s.reserved_date||s.reservedDate,sellingPrice:s.selling_price||s.sellingPrice,batteryPercentage:s.battery_percentage||s.batteryPercentage,pdiCompleted:s.pdi_completed||s.pdiCompleted,inShowroom:s.in_showroom||s.inShowroom,showroomNote:s.showroom_note||s.showroomNote,showroomEntryDate:s.showroom_entry_date||s.showroomEntryDate,showroomExitDate:s.showroom_exit_date||s.showroomExitDate,clientName:s.client_name||s.clientName,clientPhone:s.client_phone||s.clientPhone,clientLicensePlate:s.client_license_plate||s.clientLicensePlate,clientEmail:s.client_email||s.clientEmail,clientAddress:s.client_address||s.clientAddress,pdiTechnician:s.pdi_technician||s.pdiTechnician,pdiNotes:s.pdi_notes||s.pdiNotes,pdiPhotos:s.pdi_photos||s.pdiPhotos,pdiDate:s.pdi_date||s.pdiDate,notes:s.notes,lastUpdated:s.last_updated||s.lastUpdated||new Date().toISOString()}),jt=()=>{const{cars:s,loading:w,error:D,addCar:S,updateCar:P,refetch:h}=Ct(),[U,F]=i.useState([]),[C,V]=i.useState(!1);return i.useEffect(()=>{if(!w&&!C){let o=[];if(s&&s.length>0)o=s.map(Z),console.log(`Car Inventory: Loaded ${o.length} cars from Supabase`);else try{const n=localStorage.getItem("carInventory"),l=localStorage.getItem("showroomFloor1Cars"),N=localStorage.getItem("showroomFloor2Cars"),J=localStorage.getItem("garageCars"),M=localStorage.getItem("inventoryFloor2Cars"),Q=[...n?JSON.parse(n):[],...l?JSON.parse(l):[],...N?JSON.parse(N):[],...J?JSON.parse(J):[],...M?JSON.parse(M):[]];Q.length>0?(o=Q.map(Z),console.log(`Car Inventory: Loaded ${o.length} cars from localStorage fallback`)):console.log("Car Inventory: No data found in Supabase or localStorage")}catch(n){console.error("Error loading from localStorage:",n)}F(o),V(!0)}},[s,w,C]),i.useEffect(()=>{if(C&&s&&s.length>0){const o=s.map(Z);F(o)}},[s,C]),{cars:U,loading:w,error:D,handleStatusUpdate:async(o,n)=>{try{const l={status:n,soldDate:n==="sold"?new Date().toISOString():void 0,reservedDate:n==="reserved"?new Date().toISOString():void 0,lastUpdated:new Date().toISOString()};await P(o,l),c({title:"Status Updated",description:`Car status updated to ${n.replace("_"," ")}.`})}catch(l){console.error("Error updating car status:",l),c({title:"Update Failed",description:"Failed to update car status. Please try again.",variant:"destructive"})}},handleShowroomToggle:async(o,n,l)=>{try{const N={inShowroom:n,showroomNote:l,showroomEntryDate:n?new Date().toISOString():void 0,showroomExitDate:n?void 0:new Date().toISOString(),lastUpdated:new Date().toISOString()};await P(o,N),c({title:"Showroom Status Updated",description:`Car ${n?"added to":"removed from"} showroom.`})}catch(N){console.error("Error updating showroom status:",N),c({title:"Update Failed",description:"Failed to update showroom status. Please try again.",variant:"destructive"})}},handleClientInfoSave:async(o,n)=>{try{const l={...n,lastUpdated:new Date().toISOString()};await P(o,l),c({title:"Client Information Saved",description:"Client information has been updated successfully."})}catch(l){console.error("Error saving client info:",l),c({title:"Save Failed",description:"Failed to save client information. Please try again.",variant:"destructive"})}},handlePdiComplete:async(o,n)=>{try{const l={pdiCompleted:!0,pdiTechnician:n.technician,pdiNotes:n.notes,pdiPhotos:n.photos,pdiDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};await P(o,l),c({title:"PDI Completed",description:`PDI completed successfully by ${n.technician}.`})}catch(l){console.error("Error completing PDI:",l),c({title:"PDI Update Failed",description:"Failed to complete PDI. Please try again.",variant:"destructive"})}},handleCarUpdate:async(o,n)=>{try{const l={...n,lastUpdated:new Date().toISOString()};await P(o,l),c({title:"Car Updated",description:"Car information has been updated successfully."})}catch(l){console.error("Error updating car:",l),c({title:"Update Failed",description:"Failed to update car information. Please try again.",variant:"destructive"})}},addCarQuick:async o=>{const n={vin_number:o.vinNumber,model:o.model,brand:o.brand,year:o.year,color:o.color,interior_color:o.interiorColor,category:o.category,status:o.status||"in_stock",arrival_date:o.arrivalDate||new Date().toISOString(),selling_price:o.sellingPrice??o.price,battery_percentage:o.batteryPercentage,pdi_completed:o.pdiCompleted,notes:o.notes};return Object.keys(n).forEach(l=>{n[l]===void 0&&delete n[l]}),await S(n)},loadCars:async()=>{try{await h()}catch(o){console.error("Error loading cars:",o),c({title:"Load Failed",description:"Failed to load car inventory. Please refresh the page.",variant:"destructive"})}}}},bt=()=>{const{cars:s,handleCarUpdate:w,addCarQuick:D}=jt(),S=s.map(e=>{let r="in_stock";e.status==="sold"?r="sold":e.status==="reserved"?r="reserved":r="in_stock";const p=["EV","REV","ICEV"].includes(e.category)?e.category:"EV";return{id:e.id,vinNumber:e.vinNumber,model:e.model,year:e.year,color:e.color,interiorColor:e.interior_color||e.interiorColor||"",price:e.sellingPrice||0,status:r,category:p,batteryPercentage:e.batteryPercentage||100,range:e.range||520,features:e.features||[],arrivalDate:e.arrivalDate||new Date().toISOString(),pdiCompleted:e.pdiCompleted,pdiStatus:e.pdiCompleted?"completed":"pending",pdiTechnician:e.pdiTechnician,pdiDate:e.pdiDate,pdiNotes:e.pdiNotes,testDriveInfo:e.testDriveInfo,customs:e.customs==="paid"?"paid":"not paid",brand:e.brand,currentFloor:e.current_location||e.category,purchasePrice:e.purchase_price,clientName:e.client_name,clientPhone:e.client_phone,clientLicensePlate:e.client_license_plate,expectedDeliveryDate:e.expected_delivery_date,notes:e.notes,lastModified:e.updated_at,softwareVersion:Math.random()>.5?e.softwareVersion||"2.1.0":void 0,softwareLastUpdated:Math.random()>.5?e.softwareLastUpdated||"2024-01-15":void 0,softwareUpdateBy:Math.random()>.5?e.softwareUpdateBy||"IT Team":void 0,softwareUpdateNotes:Math.random()>.5?e.softwareUpdateNotes||"Routine update":void 0}}),[P]=Qe(),h=P.get("filter"),U=()=>{switch(h){case"ready":return S.filter(e=>e.status==="sold"||e.pdiStatus==="completed"||e.currentFloor==="showroom"||e.pdiCompleted===!0);case"attention":return S.filter(e=>{var r,a,p;return e.status==="reserved"||e.pdiStatus==="failed"||e.customs==="not paid"||e.softwareVersion===void 0||((r=e.notes)==null?void 0:r.toLowerCase().includes("issue"))||((a=e.notes)==null?void 0:a.toLowerCase().includes("problem"))||((p=e.notes)==null?void 0:p.toLowerCase().includes("repair"))});default:return S}},[F,C]=i.useState(!1),[V,k]=i.useState(!1),[H,L]=i.useState(!1),[z,g]=i.useState(!1),[m,u]=i.useState(!1),[o,n]=i.useState(!1),[l,N]=i.useState(!1),[J,M]=i.useState(!1),[Q,ee]=i.useState(!1),[fe,Y]=i.useState(!1),[te,re]=i.useState(null),[se,K]=i.useState(null),[d,v]=i.useState(null),[xe,ae]=i.useState(!1),[_,oe]=i.useState(null),[we,ne]=i.useState(!1),[De,ie]=i.useState(!1),[Se,le]=i.useState(null),[G,Ce]=i.useState(""),W=(()=>{const e=U();if(!G.trim())return e;const r=G.toLowerCase();return e.filter(a=>{var p,j,E,$,R;return a.vinNumber.toLowerCase().includes(r)||a.model.toLowerCase().includes(r)||a.color.toLowerCase().includes(r)||(((p=a.interiorColor)==null?void 0:p.toLowerCase().includes(r))??!1)||a.category.toLowerCase().includes(r)||a.status.toLowerCase().includes(r)||((j=a.brand)==null?void 0:j.toLowerCase().includes(r))||((E=a.clientName)==null?void 0:E.toLowerCase().includes(r))||(($=a.clientPhone)==null?void 0:$.toLowerCase().includes(r))||((R=a.notes)==null?void 0:R.toLowerCase().includes(r))||a.year.toString().includes(r)||a.price.toString().includes(r)})})(),[y,b]=i.useState({vinNumber:"",model:"Voyah Dream",year:2024,color:"",price:0,status:"available",category:"EV",batteryPercentage:100,range:520,pdiStatus:"pending",customs:"not paid",horsePower:350,torque:500,acceleration:"4.5",topSpeed:250,chargingTime:"30 minutes",warranty:"4 years / 80,000 km"}),je=async e=>{const r=S.some(a=>a.vinNumber===e);if(!r){const a={vinNumber:e,model:`Vehicle ${e.slice(-4)}`,year:new Date().getFullYear(),color:"Unknown",category:"EV",status:"in_stock",arrivalDate:new Date().toISOString(),batteryPercentage:100,range:0};await D(a)}C(!1),c({title:"VIN Scanned",description:`VIN ${e} ${r?"found":"added to inventory"}`})},Ne=(e,r,a)=>{c({title:"Car Moved",description:`Car moved from ${r} to ${a}`})},be=e=>{c({title:"Car Added",description:"Car has been added to inventory"})},Ie=async()=>{await D({vinNumber:y.vinNumber,model:y.model,year:y.year,color:y.color,category:y.category,status:"in_stock",arrivalDate:new Date().toISOString(),batteryPercentage:y.batteryPercentage,range:y.range,sellingPrice:y.price}),k(!1),b({vinNumber:"",model:"Voyah Dream",year:2024,color:"",price:0,status:"available",category:"EV",batteryPercentage:100,range:520,pdiStatus:"pending",customs:"not paid",horsePower:350,torque:500,acceleration:"4.5",topSpeed:250,chargingTime:"30 minutes",warranty:"4 years / 80,000 km"}),c({title:"Car Added",description:"Car has been added to inventory"})},A=(e,r)=>{const a={...r,sellingPrice:r.price,status:r.status==="available"?"in_stock":r.status,customs:r.customs==="paid"?"paid":"not_paid",softwareVersion:r.softwareVersion,softwareLastUpdated:r.softwareLastUpdated,softwareUpdateBy:r.softwareUpdateBy,softwareUpdateNotes:r.softwareUpdateNotes};w(e,a),L(!1),v(null),c({title:"Car Updated",description:"Car details have been updated"})},Pe=(e,r)=>{if(d){if(console.log(`Moving car ${d.id} to ${e} with notes: ${r}`),e==="garage-schedule"){const a={vinNumber:d.vinNumber,model:d.model,brand:d.brand,year:d.year,color:d.color,status:"waiting",priority:"normal",estimatedDuration:120,notes:r||"Moved from Car Inventory",clientName:d.clientName||"",clientPhone:d.clientPhone||"",arrivalTime:new Date().toISOString(),scheduledTime:new Date().toISOString()},p=localStorage.getItem("garageSchedule"),j=p?JSON.parse(p):{scheduledCars:[]},E={...a,id:Date.now().toString()};j.scheduledCars.push(E),localStorage.setItem("garageSchedule",JSON.stringify(j));const $={...d,id:`garage-${Date.now()}`,status:"in_stock",garageStatus:"stored",currentFloor:"Garage",repairStatus:"pending",assignedMechanic:"",estimatedCompletion:"",repairNotes:r||"Moved from Car Inventory",lastModified:new Date().toISOString()},R=localStorage.getItem("garageCars"),de=R?JSON.parse(R):[];de.push($),localStorage.setItem("garageCars",JSON.stringify(de)),c({title:"Car Added to Garage Schedule",description:`${d.model} has been added to the garage schedule and inventory for service/repair.`})}else c({title:"Car Moved",description:`${d.model} has been moved`});g(!1),v(null)}},_e=e=>{K(e),Y(!0)},Te=e=>{le(e),ie(!0)},Ee=e=>{v(e),N(!0)},Ue=e=>{const r=e.status==="reserved"||e.status==="sold",a=e.expectedDeliveryDate;r&&a&&!e.pdiCompleted||!e.pdiCompleted?(v(e),setTimeout(()=>M(!0),0)):Ee(e)},Fe=e=>{u(!1),v(e),n(!0)},ke=e=>{ae(e),n(!1),requestAnimationFrame(()=>{u(!0)})},Oe=(e,r)=>{A(e,{testDriveInfo:{...r,isOnTestDrive:!0}}),c({title:"Test Drive Scheduled",description:`${r.isClientTestDrive?"Client":"Employee"} test drive scheduled`}),u(!1),v(null)},Ve=e=>{const r=S.find($=>$.id===e);if(!r||!r.testDriveInfo)return;const a={isOnTestDrive:r.testDriveInfo.isOnTestDrive,testDriveStartTime:r.testDriveInfo.testDriveStartTime,testDriverName:r.testDriveInfo.testDriverName,testDriverPhone:r.testDriveInfo.testDriverPhone,testDriverLicense:r.testDriveInfo.testDriverLicense,notes:r.testDriveInfo.notes,purpose:r.testDriveInfo.purpose||"Test drive",isClientTestDrive:r.testDriveInfo.isClientTestDrive||!1,loggedBy:r.testDriveInfo.loggedBy||"System",loggedByName:r.testDriveInfo.loggedByName||"System User",loggedAt:r.testDriveInfo.loggedAt||new Date().toISOString(),emergencyContact:r.testDriveInfo.emergencyContact,emergencyContactPhone:r.testDriveInfo.emergencyContactPhone,vehicleVin:r.vinNumber,vehicleModel:r.model},p=X.endTestDrive(a),j=X.addToHistory(r,p);A(e,{testDriveInfo:void 0,testDriveHistory:j.testDriveHistory});const E=X.formatDuration(p.actualDuration||0);c({title:"Test Drive Completed",description:`Test drive completed in ${E}. Added to vehicle history.`})},Le=(e,r)=>{A(e,{pdiCompleted:!0,pdiTechnician:r.technician,pdiNotes:r.notes,pdiPhotos:r.photos,pdiDate:new Date().toISOString()}),c({title:"PDI Completed",description:"Pre-Delivery Inspection has been completed successfully."})},Me=e=>{re(e),ee(!0)},Ae=(e,r,a)=>{var j;A(e,{status:r,...a,lastUpdated:new Date().toISOString()});const p=(j=S.find(E=>E.id===e))==null?void 0:j.model;c({title:"Car Status Updated",description:`${p} status updated to ${r.replace("_"," ")}`})},$e=e=>{K(e),Y(!0)},Re=(e,r)=>{w(e,r)},Be=e=>{oe(e),ne(!0)},qe=(e,r)=>{w(e,{...r,lastUpdated:new Date().toISOString()}),c({title:"Software Updated",description:"Car software information has been updated"})},He=e=>{switch(e){case"available":case"in_stock":return"bg-green-100 text-green-800 border-green-200";case"sold":return"bg-blue-100 text-blue-800 border-blue-200";case"reserved":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ze=e=>{switch(e){case"available":case"in_stock":return"Available";case"reserved":return"Reserved";case"sold":return"Sold";default:return e}},Je=e=>{switch(e){case"EV":return"category-ev";case"REV":return"category-rev";case"ICEV":return"category-icev";default:return"bg-gray-400 text-white"}};return t.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Car Inventory"}),h&&t.jsxs(I,{variant:"outline",className:"text-sm font-medium",children:[h==="ready"&&t.jsxs(t.Fragment,{children:[t.jsx(ce,{className:"w-4 h-4 mr-1"}),"Ready Cars"]}),h==="attention"&&t.jsxs(t.Fragment,{children:[t.jsx(Ge,{className:"w-4 h-4 mr-1"}),"Need Attention"]})]})]}),t.jsxs("p",{className:"text-gray-600 mt-1",children:[h==="ready"&&"Cars ready for delivery and completed processing",h==="attention"&&"Cars requiring immediate attention or action",!h&&"Manage your car inventory and track vehicle details"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(q,{onClick:()=>C(!0),variant:"outline",className:"flex items-center gap-2 border-green-200 text-green-700 hover:bg-green-50",children:[t.jsx(We,{className:"h-4 w-4"}),"VIN Scanner"]}),t.jsx(q,{onClick:()=>k(!0),className:"flex items-center gap-2 bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:"Add Car Manually"})]})]}),t.jsxs(Ye,{children:[t.jsx(Ke,{children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs(Xe,{className:"flex items-center gap-2",children:[t.jsx(me,{className:"h-5 w-5"}),h==="ready"&&`Ready Cars (${W.length})`,h==="attention"&&`Cars Needing Attention (${W.length})`,!h&&`Car Inventory (${W.length} ${G?`of ${S.length}`:""})`]}),t.jsxs("div",{className:"flex items-center gap-2",children:[h&&t.jsxs(q,{variant:"outline",size:"sm",onClick:()=>window.location.href="/car-inventory",className:"text-xs",children:[t.jsx(ge,{className:"h-3 w-3 mr-1"}),"Clear Filter"]}),t.jsx(Ze,{id:"car-inventory-search",value:G,onChange:Ce,placeholder:"Search VINs, models, clients, colors...",className:"w-full sm:w-auto"})]})]})}),t.jsx(et,{children:t.jsx("div",{className:"rounded-md border",children:t.jsxs(tt,{children:[t.jsx(rt,{children:t.jsxs(ue,{className:"bg-gray-50",children:[t.jsx(f,{className:"font-semibold",children:"VIN"}),t.jsx(f,{className:"font-semibold",children:"Model"}),t.jsx(f,{className:"font-semibold",children:"Category"}),t.jsx(f,{className:"font-semibold",children:"Year"}),t.jsx(f,{className:"font-semibold",children:"Color"}),t.jsx(f,{className:"font-semibold",children:"Color interior"}),t.jsx(f,{className:"font-semibold",children:"Price"}),t.jsx(f,{className:"font-semibold",children:"Status"}),t.jsx(f,{className:"font-semibold",children:"Warranty Life"}),t.jsx(f,{className:"font-semibold",children:"Battery"}),t.jsx(f,{className:"font-semibold",children:"Range Capacity"}),t.jsx(f,{className:"font-semibold",children:"Km Driven"}),t.jsx(f,{className:"font-semibold",children:"Test Drive"}),t.jsx(f,{className:"font-semibold",children:"PDI"}),t.jsx(f,{className:"font-semibold",children:"Customs"}),t.jsx(f,{className:"font-semibold",children:"Software Model"}),t.jsx(f,{className:"font-semibold",children:"Actions"})]})}),t.jsx(st,{children:W.map(e=>{var r;return t.jsxs(ue,{className:"hover:bg-gray-50 cursor-pointer transition-all hover:bg-blue-50",onClick:()=>Te(e),title:"Click to view complete car history",children:[t.jsx(x,{className:"font-mono text-sm",children:e.vinNumber}),t.jsx(x,{className:"font-medium",children:e.model}),t.jsx(x,{children:t.jsx(I,{className:Je(e.category),children:e.category})}),t.jsx(x,{children:e.year}),t.jsx(x,{children:e.color}),t.jsx(x,{children:e.interiorColor||e.color||"-"}),t.jsxs(x,{className:"font-medium",children:["$",e.price.toLocaleString()]}),t.jsx(x,{children:t.jsx(I,{className:`${He(e.status)} cursor-pointer hover:opacity-80 transition-all hover:scale-105 active:scale-95`,onClick:a=>{a.preventDefault(),a.stopPropagation(),Me(e)},title:"Click to change status",children:ze(e.status)})}),t.jsx(x,{children:t.jsx(at,{warrantyStartDate:e.warrantyStartDate,warrantyEndDate:e.warrantyEndDate,warrantyMonthsRemaining:e.warrantyMonthsRemaining,warrantyDaysRemaining:e.warrantyDaysRemaining,warrantyStatus:e.warrantyStatus,compact:!0})}),t.jsx(x,{children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ot,{className:"h-4 w-4"}),e.batteryPercentage,"%"]})}),t.jsx(x,{children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(nt,{className:"h-4 w-4"}),e.range," km"]})}),t.jsx(x,{children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(lt,{className:"h-4 w-4"}),it.getKilometersDriven(e.id)," km"]})}),t.jsx(x,{children:(r=e.testDriveInfo)!=null&&r.isOnTestDrive?t.jsxs(I,{className:"bg-blue-100 text-blue-800 border-blue-200 cursor-pointer hover:opacity-80 transition-opacity",onClick:a=>{a.preventDefault(),a.stopPropagation(),Ve(e.id)},title:"Click to end test drive",children:[t.jsx(dt,{className:"mr-1 h-3 w-3"}),e.testDriveInfo.isClientTestDrive?"Client":"Employee"," Test Drive"]}):e.status==="sold"||e.status==="reserved"?t.jsx(I,{variant:"outline",className:"bg-gray-50 text-gray-500",children:"Not Available"}):t.jsx(I,{variant:"outline",className:"bg-gray-50 text-gray-500 cursor-pointer hover:bg-blue-50 hover:text-blue-600 transition-colors",onClick:a=>{a.preventDefault(),a.stopPropagation(),Fe(e)},title:"Click to schedule test drive",children:"Available"})}),t.jsx(x,{children:t.jsx("div",{className:"cursor-pointer",onClick:a=>{a.preventDefault(),a.stopPropagation(),Ue(e)},children:t.jsx(I,{variant:e.pdiCompleted?"default":"outline",className:`cursor-pointer hover:opacity-80 transition-opacity ${e.pdiCompleted?"bg-green-100 text-green-800 border-green-200":"bg-yellow-100 text-yellow-800 border-yellow-200"}`,children:e.pdiCompleted?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-1 text-lg",children:"â˜º"})," Complete"]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-1 text-lg",children:"â˜¹"})," Pending"]})})})}),t.jsx(x,{children:t.jsx(I,{variant:e.customs==="paid"?"default":"destructive",className:"cursor-pointer hover:opacity-80 transition-opacity active:scale-95",onClick:a=>{a.preventDefault(),a.stopPropagation(),$e(e)},title:"Click to manage customs payment",children:e.customs==="paid"?t.jsxs(t.Fragment,{children:[t.jsx(ce,{className:"mr-1 h-4 w-4"})," paid"]}):t.jsxs(t.Fragment,{children:[t.jsx(ge,{className:"mr-1 h-4 w-4"})," ",e.customs||"not paid"]})})}),t.jsx(x,{children:t.jsx("div",{className:"flex items-center gap-1 text-xs cursor-pointer",onClick:()=>Be(e),title:"Click to manage software updates",children:e.softwareVersion?t.jsxs(t.Fragment,{children:[t.jsxs(I,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:["v",e.softwareVersion]}),e.softwareLastUpdated&&t.jsx("span",{className:"text-gray-500",children:new Date(e.softwareLastUpdated).toLocaleDateString()})]}):t.jsx(I,{variant:"secondary",className:"text-xs text-yellow-700 bg-yellow-100 hover:bg-yellow-200 transition-colors",children:"Update Needed"})})}),t.jsx(x,{children:t.jsx(ct,{options:[{value:"details",label:"View Details"},{value:"edit",label:"Edit Car"},{value:"move",label:"Move Car"}],onAction:a=>{a==="details"?_e(e):a==="edit"?(v(e),L(!0)):a==="move"&&(v(e),g(!0))},id:`actions-${e.id}`,ariaLabel:`Actions for ${e.model} ${e.vinNumber}`})})]},e.id)})})]})})})]}),t.jsx(mt,{isOpen:F,onClose:()=>C(!1),onVinScanned:je,targetLocation:"Inventory",onCarMoved:Ne,onCarAdded:be,onTestDrive:(e,r)=>{const a={id:e.id,vinNumber:e.vin_number,model:e.model,year:e.year,color:e.color,price:e.selling_price,status:e.status,category:e.category,batteryPercentage:e.battery_percentage||100,range:e.range_km||0,features:[],arrivalDate:e.arrival_date,pdiCompleted:e.pdi_completed,pdiTechnician:e.pdi_technician,pdiDate:e.pdi_date,pdiNotes:e.notes,testDriveInfo:{isOnTestDrive:e.test_drive_status},customs:e.customs==="not_paid"?"not paid":e.customs==="paid"?"paid":void 0};v(a),ae(r),n(!0),C(!1)},onPdiAction:e=>{const r={id:e.id,vinNumber:e.vin_number,model:e.model,year:e.year,color:e.color,price:e.selling_price,status:e.status,category:e.category,batteryPercentage:e.battery_percentage||100,range:e.range_km||0,features:[],arrivalDate:e.arrival_date,pdiCompleted:e.pdi_completed,pdiTechnician:e.pdi_technician,pdiDate:e.pdi_date,pdiNotes:e.notes,testDriveInfo:{isOnTestDrive:e.test_drive_status},customs:e.customs==="not_paid"?"not paid":e.customs==="paid"?"paid":"not paid"};v(r),N(!0),C(!1)}}),t.jsx(he,{open:V,onOpenChange:k,children:t.jsxs(pe,{className:"sm:max-w-[600px]",children:[t.jsx(ve,{children:t.jsxs(ye,{className:"flex items-center gap-2",children:[t.jsx(me,{className:"h-5 w-5"}),"Add Car to Inventory"]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(T,{htmlFor:"vinNumber",children:"VIN Number *"}),t.jsx(O,{id:"vinNumber",value:y.vinNumber,onChange:e=>b(r=>({...r,vinNumber:e.target.value})),placeholder:"Enter VIN number",required:!0})]}),t.jsxs("div",{children:[t.jsx(T,{htmlFor:"model",children:"Model *"}),t.jsx(O,{id:"model",value:y.model,onChange:e=>b(r=>({...r,model:e.target.value})),placeholder:"Enter model name",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(T,{htmlFor:"year",children:"Year *"}),t.jsx(O,{id:"year",type:"number",min:"2020",max:"2030",value:y.year,onChange:e=>b(r=>({...r,year:parseInt(e.target.value)})),required:!0})]}),t.jsxs("div",{children:[t.jsx(T,{htmlFor:"color",children:"Color *"}),t.jsx(O,{id:"color",value:y.color,onChange:e=>b(r=>({...r,color:e.target.value})),placeholder:"e.g., Midnight Silver",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(T,{htmlFor:"category",children:"Category *"}),t.jsxs("select",{id:"category",value:y.category,onChange:e=>b(r=>({...r,category:e.target.value})),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",required:!0,children:[t.jsx("option",{value:"EV",children:"EV (Electric Vehicle)"}),t.jsx("option",{value:"REV",children:"REV (Range Extended Vehicle)"}),t.jsx("option",{value:"ICEV",children:"ICEV (Internal Combustion Engine)"})]})]}),t.jsxs("div",{children:[t.jsx(T,{htmlFor:"price",children:"Price (USD) *"}),t.jsx(O,{id:"price",type:"number",min:"0",value:y.price,onChange:e=>b(r=>({...r,price:parseInt(e.target.value)})),placeholder:"e.g., 85000",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(T,{htmlFor:"status",children:"Status"}),t.jsxs("select",{id:"status",value:y.status,onChange:e=>b(r=>({...r,status:e.target.value})),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",children:[t.jsx("option",{value:"available",children:"Available"}),t.jsx("option",{value:"sold",children:"Sold"}),t.jsx("option",{value:"reserved",children:"Reserved"}),t.jsx("option",{value:"pending",children:"Pending"})]})]}),t.jsxs("div",{children:[t.jsx(T,{htmlFor:"batteryPercentage",children:"Battery %"}),t.jsx(O,{id:"batteryPercentage",type:"number",min:"0",max:"100",value:y.batteryPercentage,onChange:e=>b(r=>({...r,batteryPercentage:parseInt(e.target.value)}))})]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.jsxs("div",{children:[t.jsx(T,{htmlFor:"range",children:"Range (km)"}),t.jsx(O,{id:"range",type:"number",min:"0",value:y.range,onChange:e=>b(r=>({...r,range:parseInt(e.target.value)})),placeholder:"e.g., 520"})]})})]}),t.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[t.jsx(q,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),t.jsx(q,{onClick:Ie,className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:"Add Car"})]})]})}),d&&t.jsx(gt,{isOpen:H,onClose:()=>{L(!1),v(null)},car:d,onSave:A}),d&&t.jsx(ut,{isOpen:z,onClose:()=>{g(!1),v(null)},car:d,onMoveCar:Pe}),d&&t.jsx(ht,{isOpen:l,onClose:()=>{N(!1),v(null)},car:d,onPdiComplete:Le}),d&&t.jsx(pt,{isOpen:J,onClose:()=>{M(!1),v(null)},car:d,onSave:(e,r)=>{A(e,{pdiCompleted:r,pdiDate:new Date().toISOString()}),M(!1),v(null)}}),d&&t.jsx(vt,{isOpen:o,onClose:()=>{n(!1),v(null)},onSelectTestDriveType:ke,carModel:d.model,carVin:d.vinNumber}),d&&t.jsx(yt,{isOpen:m,onClose:()=>{u(!1),v(null)},car:{...d,currentFloor:d.currentFloor||"Inventory"},onScheduleTestDrive:Oe,isClientTestDrive:xe}),te&&t.jsx(ft,{isOpen:Q,onClose:()=>{ee(!1),re(null)},car:te,onStatusUpdate:Ae}),se&&t.jsx(xt,{isOpen:fe,onClose:()=>{Y(!1),K(null)},car:se,onCarUpdate:Re}),t.jsx(wt,{isOpen:we,onClose:()=>{ne(!1),oe(null)},car:_?{vinNumber:_.vinNumber,model:_.model,currentVersion:_.softwareVersion,lastUpdated:_.softwareLastUpdated,lastUpdatedBy:_.softwareUpdateBy,notes:_.softwareUpdateNotes,needsUpdate:!_.softwareVersion,priority:_.softwareVersion?"medium":"critical"}:null,onUpdateComplete:(e,r)=>{var p;const a=(p=S.find(j=>j.vinNumber===e))==null?void 0:p.id;a&&qe(a,r)}}),t.jsx(Dt,{isOpen:De,onClose:()=>{ie(!1),le(null)},car:Se})]})};export{bt as default};
