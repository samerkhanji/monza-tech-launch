var Qt=Object.defineProperty;var Wt=(s,t,r)=>t in s?Qt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var fs=(s,t,r)=>Wt(s,typeof t!="symbol"?t+"":t,r);import{R as Zt,b5 as U,b6 as Jt,b7 as er,b8 as hs,b9 as ps,ba as Pe,s as R,$ as _e,r as c,j as e,D as js,a as ws,b as ys,c as bs,L as H,I as Ee,aa as Qe,a5 as ge,a6 as ve,a7 as je,a8 as we,a9 as T,B as A,d as I,X as Ns,ad as me,b0 as We,bb as Ze,bc as sr,bd as ke,be as _s,bf as Ms,bg as tr,bh as Cs,bi as Je,bj as he,bk as Rs,bl as oe,bm as N,bn as Ss,bo as rr,bp as re,bq as nr,br as Ps,bs as Ds,bt as Es,bu as As,bv as Is,bw as ar,bx as Ts,by as Os,bz as ks,bA as qs,bB as Xe,bC as W,au as Ls,bD as or,e as te,i as ae,f as ye,g as Ae,w as qe,bE as Fs,a3 as Us,bF as xs,t as Q,bG as Ke,bH as Ye,C as $s,aq as cr,Y as ir,Z as lr,_ as ze,aA as Ve}from"./index-CrIDvSVN.js";import{A as ee,a as se,M as ue,b as Gs}from"./avatar-DZWa_orF.js";import{S as Me}from"./scroll-area-CTkIDaID.js";import{F as dr}from"./filter-BJ97fFRF.js";import{c as ur}from"./constructNow-790n9fqq.js";import{e as mr,d as fr}from"./endOfMonth-B_wOe74y.js";import{S as gs}from"./square-pen-Cu5lUal4.js";import{S as es}from"./send-Bi7lT1Ys.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=Zt("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);function De(s,t){const r=U(s),n=U(t),a=r.getTime()-n.getTime();return a<0?-1:a>0?1:a}function pr(s){return t=>{const n=(s?Math[s]:Math.trunc)(t);return n===0?0:n}}function xr(s,t){return+U(s)-+U(t)}function gr(s){const t=U(s);return t.setHours(23,59,59,999),t}function vr(s){const t=U(s);return+gr(t)==+mr(t)}function jr(s,t){const r=U(s),n=U(t),a=De(r,n),o=Math.abs(fr(r,n));let l;if(o<1)l=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-a*o);let i=De(r,n)===-a;vr(U(s))&&o===1&&De(s,n)===1&&(i=!1),l=a*(o-Number(i))}return l===0?0:l}function wr(s,t,r){const n=xr(s,t)/1e3;return pr(r==null?void 0:r.roundingMethod)(n)}function yr(s,t,r){const n=Jt(),a=(r==null?void 0:r.locale)??n.locale??er,o=2520,l=De(s,t);if(isNaN(l))throw new RangeError("Invalid time value");const i=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:l});let g,f;l>0?(g=U(t),f=U(s)):(g=U(s),f=U(t));const u=wr(f,g),m=(hs(f)-hs(g))/1e3,d=Math.round((u-m)/60);let v;if(d<2)return r!=null&&r.includeSeconds?u<5?a.formatDistance("lessThanXSeconds",5,i):u<10?a.formatDistance("lessThanXSeconds",10,i):u<20?a.formatDistance("lessThanXSeconds",20,i):u<40?a.formatDistance("halfAMinute",0,i):u<60?a.formatDistance("lessThanXMinutes",1,i):a.formatDistance("xMinutes",1,i):d===0?a.formatDistance("lessThanXMinutes",1,i):a.formatDistance("xMinutes",d,i);if(d<45)return a.formatDistance("xMinutes",d,i);if(d<90)return a.formatDistance("aboutXHours",1,i);if(d<ps){const w=Math.round(d/60);return a.formatDistance("aboutXHours",w,i)}else{if(d<o)return a.formatDistance("xDays",1,i);if(d<Pe){const w=Math.round(d/ps);return a.formatDistance("xDays",w,i)}else if(d<Pe*2)return v=Math.round(d/Pe),a.formatDistance("aboutXMonths",v,i)}if(v=jr(f,g),v<12){const w=Math.round(d/Pe);return a.formatDistance("xMonths",w,i)}else{const w=v%12,M=Math.trunc(v/12);return w<3?a.formatDistance("aboutXYears",M,i):w<9?a.formatDistance("overXYears",M,i):a.formatDistance("almostXYears",M+1,i)}}function Ie(s,t){return yr(s,ur(s),t)}class br{constructor(){fs(this,"currentUser",null)}setCurrentUser(t){this.currentUser=t}mapTagsToRoles(t=[]){const r={Owners:"admin",Owner:"admin","Garage Manager":"manager",Manager:"manager",Sales:"sales",Technicians:"technician",Technician:"technician",Assistants:"viewer",Assistant:"viewer"},n=[];for(const a of t){const o=r[a]||a.toLowerCase();n.push(o)}return Array.from(new Set(n))}async createNotificationsForRoles(t,r,n){if(!r.length)return;const{data:a,error:o}=await R.from("user_profiles").select("id, full_name, role").in("role",r);if(o)throw o;const l=`New Request: ${t.title} (${n.toUpperCase()})`,i=t.description||"You were tagged on a new request",g=(a||[]).map(f=>({user_id:f.id,request_id:t.id,notification_type:"request_created",title:l,message:i,is_read:!1}));if(g.length){const{error:f}=await R.from("request_notifications").insert(g);if(f)throw f}}async createRequest(t){var a;const{data:r,error:n}=await R.from("requests").insert({title:t.title,description:t.description??null,priority:t.priority,status:"open",type:t.category??null,created_by:(a=this.currentUser)==null?void 0:a.id,assigned_to:t.assigned_to??null,tags:t.tags??null}).select().single();if(n)throw n;try{const o=this.mapTagsToRoles(t.tags||[]);await this.createNotificationsForRoles(r,o,t.priority)}catch(o){console.error("Failed to create request notifications",o)}return r}async getRequests(t){let r=R.from("requests").select(`
        *,
        messages (*),
        created_by_user:user_profiles!requests_created_by_fkey(full_name, role),
        assigned_to_user:user_profiles!requests_assigned_to_fkey(full_name, role)
      `).order("created_at",{ascending:!1});t!=null&&t.status&&(r=r.eq("status",t.status)),t!=null&&t.priority&&(r=r.eq("priority",t.priority)),t!=null&&t.assigned_to&&(r=r.eq("assigned_to",t.assigned_to)),t!=null&&t.created_by&&(r=r.eq("created_by",t.created_by));const{data:n,error:a}=await r;if(a)throw a;return n||[]}async getRequestById(t){const{data:r,error:n}=await R.from("requests").select(`
        *,
        messages (*),
        created_by_user:user_profiles!requests_created_by_fkey(full_name, role),
        assigned_to_user:user_profiles!requests_assigned_to_fkey(full_name, role)
      `).eq("id",t).single();if(n)throw n;return r}async updateRequest(t,r){const{data:n,error:a}=await R.from("requests").update(r).eq("id",t).select().single();if(a)throw a;return n}async deleteRequest(t){const{error:r}=await R.from("requests").delete().eq("id",t);if(r)throw r}async createMessage(t){var a;const{data:r,error:n}=await R.from("messages").insert({...t,sender_id:(a=this.currentUser)==null?void 0:a.id}).select().single();if(n)throw n;try{const o=await this.getRequestById(t.request_id);o&&o.assigned_to&&await R.from("request_notifications").insert({user_id:o.assigned_to,request_id:o.id,notification_type:"request_message",title:`New message on: ${o.title}`,message:t.message_text.slice(0,140),is_read:!1})}catch(o){console.error("Failed to create message notification",o)}return r}async getMessagesByRequestId(t){const{data:r,error:n}=await R.from("messages").select(`
        *,
        sender:user_profiles!messages_sender_id_fkey(full_name, role)
      `).eq("request_id",t).order("created_at",{ascending:!0});if(n)throw n;return r||[]}async updateMessage(t,r){const{data:n,error:a}=await R.from("messages").update(r).eq("id",t).select().single();if(a)throw a;return n}async deleteMessage(t){const{error:r}=await R.from("messages").delete().eq("id",t);if(r)throw r}async createBroadcast(t){var a;const{data:r,error:n}=await R.from("broadcasts").insert({...t,sender_id:(a=this.currentUser)==null?void 0:a.id}).select().single();if(n)throw n;return r}async getBroadcasts(){const{data:t,error:r}=await R.from("broadcasts").select("*").order("created_at",{ascending:!1});if(r)throw r;return t||[]}async deleteBroadcast(t){const{error:r}=await R.from("broadcasts").delete().eq("id",t);if(r)throw r}async getNotifications(){var n;const{data:t,error:r}=await R.from("request_notifications").select("*").eq("user_id",(n=this.currentUser)==null?void 0:n.id).eq("is_read",!1).order("created_at",{ascending:!1});if(r)throw r;return t||[]}async markNotificationAsRead(t){const{error:r}=await R.from("request_notifications").update({is_read:!0}).eq("id",t);if(r)throw r}async markAllNotificationsAsRead(){var r;const{error:t}=await R.from("request_notifications").update({is_read:!0}).eq("user_id",(r=this.currentUser)==null?void 0:r.id).eq("is_read",!1);if(t)throw t}async getUsers(){const{data:t,error:r}=await R.from("user_profiles").select("id, full_name, role").order("full_name");if(r)throw r;return t||[]}async searchUsers(t){const{data:r,error:n}=await R.from("user_profiles").select("id, full_name, role").ilike("full_name",`%${t}%`).order("full_name");if(n)throw n;return r||[]}parseMentions(t){const r=/@(\w+)/g,n=[];let a;for(;(a=r.exec(t))!==null;)n.push(a[1]);return n}subscribeToRequests(t){return R.channel("requests").on("postgres_changes",{event:"*",schema:"public",table:"requests"},t).subscribe()}subscribeToMessages(t){return R.channel("messages").on("postgres_changes",{event:"*",schema:"public",table:"messages"},t).subscribe()}subscribeToNotifications(t){return R.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"request_notifications"},t).subscribe()}}const k=new br,Nr=["Owners","Assistants","Garage Manager","Sales","Technicians"],_r=({open:s,onOpenChange:t,onSubmit:r,initialData:n})=>{var O,L,G,z;const{user:a}=_e(),[o,l]=c.useState({title:"",description:"",priority:"medium",category:"Other",assigned_to:void 0,tags:[]}),[i,g]=c.useState([]),[f,u]=c.useState(""),[m,d]=c.useState([]),[v,w]=c.useState(!1),[M,S]=c.useState(!1);c.useEffect(()=>{s&&(x(),l(n?{title:n.title||"",description:n.description||"",priority:n.priority||"medium",category:n.category||"Other",assigned_to:n.assigned_to,tags:n.tags||[]}:{title:"",description:"",priority:"medium",category:"Other",assigned_to:void 0,tags:[]}))},[s,n]),c.useEffect(()=>{if(f.trim()){const j=i.filter(p=>{var h,_;return((h=p.full_name)==null?void 0:h.toLowerCase().includes(f.toLowerCase()))||((_=p.role)==null?void 0:_.toLowerCase().includes(f.toLowerCase()))});d(j)}else d(i)},[f,i]);const x=async()=>{try{const j=await k.getUsers();g(j),d(j)}catch(j){console.error("Error loading users:",j)}},P=async j=>{if(j.preventDefault(),!!o.title.trim()){S(!0);try{await r(o),t(!1),l({title:"",description:"",priority:"medium",category:"Other",assigned_to:void 0,tags:[]})}catch(p){console.error("Error submitting request:",p)}finally{S(!1)}}},D=j=>{l(p=>({...p,assigned_to:j})),w(!1),u("")},V=()=>{l(j=>({...j,assigned_to:void 0}))},$=j=>{l(p=>{var E;const _=((E=p.tags)==null?void 0:E.includes(j))?(p.tags||[]).filter(F=>F!==j):[...p.tags||[],j];return{...p,tags:_}})},y=()=>i.find(j=>j.id===o.assigned_to),C=j=>{switch(j){case"urgent":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return e.jsx(js,{open:s,onOpenChange:t,children:e.jsxs(ws,{className:"sm:max-w-[640px]",children:[e.jsx(ys,{children:e.jsx(bs,{children:n?"Edit Request":"Create New Request"})}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"title",children:"Title *"}),e.jsx(Ee,{id:"title",value:o.title,onChange:j=>l(p=>({...p,title:j.target.value})),placeholder:"Enter request title...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"description",children:"Description"}),e.jsx(Qe,{id:"description",value:o.description,onChange:j=>l(p=>({...p,description:j.target.value})),placeholder:"Describe the request details...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"category",children:"Category"}),e.jsxs(ge,{value:o.category,onValueChange:j=>l(p=>({...p,category:j})),children:[e.jsx(ve,{children:e.jsx(je,{placeholder:"Select category"})}),e.jsxs(we,{children:[e.jsx(T,{value:"Part Request",children:"Part Request"}),e.jsx(T,{value:"Task Help",children:"Task Help"}),e.jsx(T,{value:"Client Issue",children:"Client Issue"}),e.jsx(T,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"priority",children:"Priority"}),e.jsxs(ge,{value:o.priority,onValueChange:j=>l(p=>({...p,priority:j})),children:[e.jsx(ve,{children:e.jsx(je,{})}),e.jsxs(we,{children:[e.jsx(T,{value:"low",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:C("low"),children:"Low"}),e.jsx("span",{children:"Low Priority"})]})}),e.jsx(T,{value:"medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:C("medium"),children:"Medium"}),e.jsx("span",{children:"Medium Priority"})]})}),e.jsx(T,{value:"high",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:C("high"),children:"High"}),e.jsx("span",{children:"High Priority"})]})}),e.jsx(T,{value:"urgent",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:C("urgent"),children:"Urgent"}),e.jsx("span",{children:"Urgent Priority"})]})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Assign To"}),e.jsx("div",{className:"relative",children:o.assigned_to?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",children:[e.jsx(ee,{className:"h-8 w-8",children:e.jsx(se,{children:((L=(O=y())==null?void 0:O.full_name)==null?void 0:L.charAt(0))||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:(G=y())==null?void 0:G.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(z=y())==null?void 0:z.role})]}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",onClick:V,children:e.jsx(Ns,{className:"h-4 w-4"})})]}):e.jsxs(I,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>w(!0),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Assign to someone..."]})}),v&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border rounded-lg shadow-lg",children:[e.jsx("div",{className:"p-2 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Search users...",value:f,onChange:j=>u(j.target.value),className:"pl-8"})]})}),e.jsx(Me,{className:"max-h-60",children:e.jsxs("div",{className:"p-2",children:[m.map(j=>{var p;return e.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-muted rounded-lg cursor-pointer",onClick:()=>D(j.id),children:[e.jsx(ee,{className:"h-8 w-8",children:e.jsx(se,{children:((p=j.full_name)==null?void 0:p.charAt(0))||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:j.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j.role})]})]},j.id)}),m.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No users found"})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Recipients"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Nr.map(j=>{var h;const p=(h=o.tags)==null?void 0:h.includes(j);return e.jsx(I,{type:"button",variant:p?"default":"outline",className:p?"bg-yellow-100 text-yellow-900 border-yellow-300":"",onClick:()=>$(j),children:j},j)})}),o.tags&&o.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.tags.map(j=>e.jsx(A,{variant:"secondary",children:j},j))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:M,children:"Cancel"}),e.jsx(I,{type:"submit",disabled:M||!o.title.trim(),children:M?"Creating...":n?"Update Request":"Create Request"})]})]})]})})};var He=["Enter"," "],Mr=["ArrowDown","PageUp","Home"],Bs=["ArrowUp","PageDown","End"],Cr=[...Mr,...Bs],Rr={ltr:[...He,"ArrowRight"],rtl:[...He,"ArrowLeft"]},Sr={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Ce="Menu",[be,Pr,Dr]=sr(Ce),[ce,Ks]=Ze(Ce,[Dr,ke,_s]),Le=ke(),zs=_s(),[Er,ie]=ce(Ce),[Ar,Re]=ce(Ce),Vs=s=>{const{__scopeMenu:t,open:r=!1,children:n,dir:a,onOpenChange:o,modal:l=!0}=s,i=Le(t),[g,f]=c.useState(null),u=c.useRef(!1),m=Ms(o),d=tr(a);return c.useEffect(()=>{const v=()=>{u.current=!0,document.addEventListener("pointerdown",w,{capture:!0,once:!0}),document.addEventListener("pointermove",w,{capture:!0,once:!0})},w=()=>u.current=!1;return document.addEventListener("keydown",v,{capture:!0}),()=>{document.removeEventListener("keydown",v,{capture:!0}),document.removeEventListener("pointerdown",w,{capture:!0}),document.removeEventListener("pointermove",w,{capture:!0})}},[]),e.jsx(Cs,{...i,children:e.jsx(Er,{scope:t,open:r,onOpenChange:m,content:g,onContentChange:f,children:e.jsx(Ar,{scope:t,onClose:c.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:u,dir:d,modal:l,children:n})})})};Vs.displayName=Ce;var Ir="MenuAnchor",ss=c.forwardRef((s,t)=>{const{__scopeMenu:r,...n}=s,a=Le(r);return e.jsx(Je,{...a,...n,ref:t})});ss.displayName=Ir;var ts="MenuPortal",[Tr,Xs]=ce(ts,{forceMount:void 0}),Ys=s=>{const{__scopeMenu:t,forceMount:r,children:n,container:a}=s,o=ie(ts,t);return e.jsx(Tr,{scope:t,forceMount:r,children:e.jsx(he,{present:r||o.open,children:e.jsx(Rs,{asChild:!0,container:a,children:n})})})};Ys.displayName=ts;var K="MenuContent",[Or,rs]=ce(K),Hs=c.forwardRef((s,t)=>{const r=Xs(K,s.__scopeMenu),{forceMount:n=r.forceMount,...a}=s,o=ie(K,s.__scopeMenu),l=Re(K,s.__scopeMenu);return e.jsx(be.Provider,{scope:s.__scopeMenu,children:e.jsx(he,{present:n||o.open,children:e.jsx(be.Slot,{scope:s.__scopeMenu,children:l.modal?e.jsx(kr,{...a,ref:t}):e.jsx(qr,{...a,ref:t})})})})}),kr=c.forwardRef((s,t)=>{const r=ie(K,s.__scopeMenu),n=c.useRef(null),a=oe(t,n);return c.useEffect(()=>{const o=n.current;if(o)return Ss(o)},[]),e.jsx(ns,{...s,ref:a,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:N(s.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),qr=c.forwardRef((s,t)=>{const r=ie(K,s.__scopeMenu);return e.jsx(ns,{...s,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),Lr=Es("MenuContent.ScrollLock"),ns=c.forwardRef((s,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:a,onOpenAutoFocus:o,onCloseAutoFocus:l,disableOutsidePointerEvents:i,onEntryFocus:g,onEscapeKeyDown:f,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:d,onDismiss:v,disableOutsideScroll:w,...M}=s,S=ie(K,r),x=Re(K,r),P=Le(r),D=zs(r),V=Pr(r),[$,y]=c.useState(null),C=c.useRef(null),O=oe(t,C,S.onContentChange),L=c.useRef(0),G=c.useRef(""),z=c.useRef(0),j=c.useRef(null),p=c.useRef("right"),h=c.useRef(0),_=w?Ds:c.Fragment,E=w?{as:Lr,allowPinchZoom:!0}:void 0,F=b=>{var le,us;const B=G.current+b,X=V().filter(Y=>!Y.disabled),J=document.activeElement,Ge=(le=X.find(Y=>Y.ref.current===J))==null?void 0:le.textValue,Be=X.map(Y=>Y.textValue),ds=Qr(Be,B,Ge),pe=(us=X.find(Y=>Y.textValue===ds))==null?void 0:us.ref.current;(function Y(ms){G.current=ms,window.clearTimeout(L.current),ms!==""&&(L.current=window.setTimeout(()=>Y(""),1e3))})(B),pe&&setTimeout(()=>pe.focus())};c.useEffect(()=>()=>window.clearTimeout(L.current),[]),Ps();const Z=c.useCallback(b=>{var X,J;return p.current===((X=j.current)==null?void 0:X.side)&&Zr(b,(J=j.current)==null?void 0:J.area)},[]);return e.jsx(Or,{scope:r,searchRef:G,onItemEnter:c.useCallback(b=>{Z(b)&&b.preventDefault()},[Z]),onItemLeave:c.useCallback(b=>{var B;Z(b)||((B=C.current)==null||B.focus(),y(null))},[Z]),onTriggerLeave:c.useCallback(b=>{Z(b)&&b.preventDefault()},[Z]),pointerGraceTimerRef:z,onPointerGraceIntentChange:c.useCallback(b=>{j.current=b},[]),children:e.jsx(_,{...E,children:e.jsx(As,{asChild:!0,trapped:a,onMountAutoFocus:N(o,b=>{var B;b.preventDefault(),(B=C.current)==null||B.focus({preventScroll:!0})}),onUnmountAutoFocus:l,children:e.jsx(Is,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:f,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:d,onDismiss:v,children:e.jsx(ar,{asChild:!0,...D,dir:x.dir,orientation:"vertical",loop:n,currentTabStopId:$,onCurrentTabStopIdChange:y,onEntryFocus:N(g,b=>{x.isUsingKeyboardRef.current||b.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Ts,{role:"menu","aria-orientation":"vertical","data-state":ut(S.open),"data-radix-menu-content":"",dir:x.dir,...P,...M,ref:O,style:{outline:"none",...M.style},onKeyDown:N(M.onKeyDown,b=>{const X=b.target.closest("[data-radix-menu-content]")===b.currentTarget,J=b.ctrlKey||b.altKey||b.metaKey,Ge=b.key.length===1;X&&(b.key==="Tab"&&b.preventDefault(),!J&&Ge&&F(b.key));const Be=C.current;if(b.target!==Be||!Cr.includes(b.key))return;b.preventDefault();const pe=V().filter(le=>!le.disabled).map(le=>le.ref.current);Bs.includes(b.key)&&pe.reverse(),Yr(pe)}),onBlur:N(s.onBlur,b=>{b.currentTarget.contains(b.target)||(window.clearTimeout(L.current),G.current="")}),onPointerMove:N(s.onPointerMove,Ne(b=>{const B=b.target,X=h.current!==b.clientX;if(b.currentTarget.contains(B)&&X){const J=b.clientX>h.current?"right":"left";p.current=J,h.current=b.clientX}}))})})})})})})});Hs.displayName=K;var Fr="MenuGroup",as=c.forwardRef((s,t)=>{const{__scopeMenu:r,...n}=s;return e.jsx(re.div,{role:"group",...n,ref:t})});as.displayName=Fr;var Ur="MenuLabel",Qs=c.forwardRef((s,t)=>{const{__scopeMenu:r,...n}=s;return e.jsx(re.div,{...n,ref:t})});Qs.displayName=Ur;var Te="MenuItem",vs="menu.itemSelect",Fe=c.forwardRef((s,t)=>{const{disabled:r=!1,onSelect:n,...a}=s,o=c.useRef(null),l=Re(Te,s.__scopeMenu),i=rs(Te,s.__scopeMenu),g=oe(t,o),f=c.useRef(!1),u=()=>{const m=o.current;if(!r&&m){const d=new CustomEvent(vs,{bubbles:!0,cancelable:!0});m.addEventListener(vs,v=>n==null?void 0:n(v),{once:!0}),nr(m,d),d.defaultPrevented?f.current=!1:l.onClose()}};return e.jsx(Ws,{...a,ref:g,disabled:r,onClick:N(s.onClick,u),onPointerDown:m=>{var d;(d=s.onPointerDown)==null||d.call(s,m),f.current=!0},onPointerUp:N(s.onPointerUp,m=>{var d;f.current||(d=m.currentTarget)==null||d.click()}),onKeyDown:N(s.onKeyDown,m=>{const d=i.searchRef.current!=="";r||d&&m.key===" "||He.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});Fe.displayName=Te;var Ws=c.forwardRef((s,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:a,...o}=s,l=rs(Te,r),i=zs(r),g=c.useRef(null),f=oe(t,g),[u,m]=c.useState(!1),[d,v]=c.useState("");return c.useEffect(()=>{const w=g.current;w&&v((w.textContent??"").trim())},[o.children]),e.jsx(be.ItemSlot,{scope:r,disabled:n,textValue:a??d,children:e.jsx(rr,{asChild:!0,...i,focusable:!n,children:e.jsx(re.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:f,onPointerMove:N(s.onPointerMove,Ne(w=>{n?l.onItemLeave(w):(l.onItemEnter(w),w.defaultPrevented||w.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:N(s.onPointerLeave,Ne(w=>l.onItemLeave(w))),onFocus:N(s.onFocus,()=>m(!0)),onBlur:N(s.onBlur,()=>m(!1))})})})}),$r="MenuCheckboxItem",Zs=c.forwardRef((s,t)=>{const{checked:r=!1,onCheckedChange:n,...a}=s;return e.jsx(rt,{scope:s.__scopeMenu,checked:r,children:e.jsx(Fe,{role:"menuitemcheckbox","aria-checked":Oe(r)?"mixed":r,...a,ref:t,"data-state":cs(r),onSelect:N(a.onSelect,()=>n==null?void 0:n(Oe(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Zs.displayName=$r;var Js="MenuRadioGroup",[Gr,Br]=ce(Js,{value:void 0,onValueChange:()=>{}}),et=c.forwardRef((s,t)=>{const{value:r,onValueChange:n,...a}=s,o=Ms(n);return e.jsx(Gr,{scope:s.__scopeMenu,value:r,onValueChange:o,children:e.jsx(as,{...a,ref:t})})});et.displayName=Js;var st="MenuRadioItem",tt=c.forwardRef((s,t)=>{const{value:r,...n}=s,a=Br(st,s.__scopeMenu),o=r===a.value;return e.jsx(rt,{scope:s.__scopeMenu,checked:o,children:e.jsx(Fe,{role:"menuitemradio","aria-checked":o,...n,ref:t,"data-state":cs(o),onSelect:N(n.onSelect,()=>{var l;return(l=a.onValueChange)==null?void 0:l.call(a,r)},{checkForDefaultPrevented:!1})})})});tt.displayName=st;var os="MenuItemIndicator",[rt,Kr]=ce(os,{checked:!1}),nt=c.forwardRef((s,t)=>{const{__scopeMenu:r,forceMount:n,...a}=s,o=Kr(os,r);return e.jsx(he,{present:n||Oe(o.checked)||o.checked===!0,children:e.jsx(re.span,{...a,ref:t,"data-state":cs(o.checked)})})});nt.displayName=os;var zr="MenuSeparator",at=c.forwardRef((s,t)=>{const{__scopeMenu:r,...n}=s;return e.jsx(re.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});at.displayName=zr;var Vr="MenuArrow",ot=c.forwardRef((s,t)=>{const{__scopeMenu:r,...n}=s,a=Le(r);return e.jsx(Os,{...a,...n,ref:t})});ot.displayName=Vr;var Xr="MenuSub",[xa,ct]=ce(Xr),xe="MenuSubTrigger",it=c.forwardRef((s,t)=>{const r=ie(xe,s.__scopeMenu),n=Re(xe,s.__scopeMenu),a=ct(xe,s.__scopeMenu),o=rs(xe,s.__scopeMenu),l=c.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:g}=o,f={__scopeMenu:s.__scopeMenu},u=c.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return c.useEffect(()=>u,[u]),c.useEffect(()=>{const m=i.current;return()=>{window.clearTimeout(m),g(null)}},[i,g]),e.jsx(ss,{asChild:!0,...f,children:e.jsx(Ws,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":a.contentId,"data-state":ut(r.open),...s,ref:ks(t,a.onTriggerChange),onClick:m=>{var d;(d=s.onClick)==null||d.call(s,m),!(s.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:N(s.onPointerMove,Ne(m=>{o.onItemEnter(m),!m.defaultPrevented&&!s.disabled&&!r.open&&!l.current&&(o.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{r.onOpenChange(!0),u()},100))})),onPointerLeave:N(s.onPointerLeave,Ne(m=>{var v,w;u();const d=(v=r.content)==null?void 0:v.getBoundingClientRect();if(d){const M=(w=r.content)==null?void 0:w.dataset.side,S=M==="right",x=S?-5:5,P=d[S?"left":"right"],D=d[S?"right":"left"];o.onPointerGraceIntentChange({area:[{x:m.clientX+x,y:m.clientY},{x:P,y:d.top},{x:D,y:d.top},{x:D,y:d.bottom},{x:P,y:d.bottom}],side:M}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(m),m.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:N(s.onKeyDown,m=>{var v;const d=o.searchRef.current!=="";s.disabled||d&&m.key===" "||Rr[n.dir].includes(m.key)&&(r.onOpenChange(!0),(v=r.content)==null||v.focus(),m.preventDefault())})})})});it.displayName=xe;var lt="MenuSubContent",dt=c.forwardRef((s,t)=>{const r=Xs(K,s.__scopeMenu),{forceMount:n=r.forceMount,...a}=s,o=ie(K,s.__scopeMenu),l=Re(K,s.__scopeMenu),i=ct(lt,s.__scopeMenu),g=c.useRef(null),f=oe(t,g);return e.jsx(be.Provider,{scope:s.__scopeMenu,children:e.jsx(he,{present:n||o.open,children:e.jsx(be.Slot,{scope:s.__scopeMenu,children:e.jsx(ns,{id:i.contentId,"aria-labelledby":i.triggerId,...a,ref:f,align:"start",side:l.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var m;l.isUsingKeyboardRef.current&&((m=g.current)==null||m.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:N(s.onFocusOutside,u=>{u.target!==i.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:N(s.onEscapeKeyDown,u=>{l.onClose(),u.preventDefault()}),onKeyDown:N(s.onKeyDown,u=>{var v;const m=u.currentTarget.contains(u.target),d=Sr[l.dir].includes(u.key);m&&d&&(o.onOpenChange(!1),(v=i.trigger)==null||v.focus(),u.preventDefault())})})})})})});dt.displayName=lt;function ut(s){return s?"open":"closed"}function Oe(s){return s==="indeterminate"}function cs(s){return Oe(s)?"indeterminate":s?"checked":"unchecked"}function Yr(s){const t=document.activeElement;for(const r of s)if(r===t||(r.focus(),document.activeElement!==t))return}function Hr(s,t){return s.map((r,n)=>s[(t+n)%s.length])}function Qr(s,t,r){const a=t.length>1&&Array.from(t).every(f=>f===t[0])?t[0]:t,o=r?s.indexOf(r):-1;let l=Hr(s,Math.max(o,0));a.length===1&&(l=l.filter(f=>f!==r));const g=l.find(f=>f.toLowerCase().startsWith(a.toLowerCase()));return g!==r?g:void 0}function Wr(s,t){const{x:r,y:n}=s;let a=!1;for(let o=0,l=t.length-1;o<t.length;l=o++){const i=t[o],g=t[l],f=i.x,u=i.y,m=g.x,d=g.y;u>n!=d>n&&r<(m-f)*(n-u)/(d-u)+f&&(a=!a)}return a}function Zr(s,t){if(!t)return!1;const r={x:s.clientX,y:s.clientY};return Wr(r,t)}function Ne(s){return t=>t.pointerType==="mouse"?s(t):void 0}var Jr=Vs,en=ss,sn=Ys,tn=Hs,rn=as,nn=Qs,an=Fe,on=Zs,cn=et,ln=tt,dn=nt,un=at,mn=ot,fn=it,hn=dt,Ue="DropdownMenu",[pn,ga]=Ze(Ue,[Ks]),q=Ks(),[xn,mt]=pn(Ue),ft=s=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:a,defaultOpen:o,onOpenChange:l,modal:i=!0}=s,g=q(t),f=c.useRef(null),[u,m]=qs({prop:a,defaultProp:o??!1,onChange:l,caller:Ue});return e.jsx(xn,{scope:t,triggerId:Xe(),triggerRef:f,contentId:Xe(),open:u,onOpenChange:m,onOpenToggle:c.useCallback(()=>m(d=>!d),[m]),modal:i,children:e.jsx(Jr,{...g,open:u,onOpenChange:m,dir:n,modal:i,children:r})})};ft.displayName=Ue;var ht="DropdownMenuTrigger",pt=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...a}=s,o=mt(ht,r),l=q(r);return e.jsx(en,{asChild:!0,...l,children:e.jsx(re.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...a,ref:ks(t,o.triggerRef),onPointerDown:N(s.onPointerDown,i=>{!n&&i.button===0&&i.ctrlKey===!1&&(o.onOpenToggle(),o.open||i.preventDefault())}),onKeyDown:N(s.onKeyDown,i=>{n||(["Enter"," "].includes(i.key)&&o.onOpenToggle(),i.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});pt.displayName=ht;var gn="DropdownMenuPortal",xt=s=>{const{__scopeDropdownMenu:t,...r}=s,n=q(t);return e.jsx(sn,{...n,...r})};xt.displayName=gn;var gt="DropdownMenuContent",vt=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=mt(gt,r),o=q(r),l=c.useRef(!1);return e.jsx(tn,{id:a.contentId,"aria-labelledby":a.triggerId,...o,...n,ref:t,onCloseAutoFocus:N(s.onCloseAutoFocus,i=>{var g;l.current||(g=a.triggerRef.current)==null||g.focus(),l.current=!1,i.preventDefault()}),onInteractOutside:N(s.onInteractOutside,i=>{const g=i.detail.originalEvent,f=g.button===0&&g.ctrlKey===!0,u=g.button===2||f;(!a.modal||u)&&(l.current=!0)}),style:{...s.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});vt.displayName=gt;var vn="DropdownMenuGroup",jn=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(rn,{...a,...n,ref:t})});jn.displayName=vn;var wn="DropdownMenuLabel",jt=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(nn,{...a,...n,ref:t})});jt.displayName=wn;var yn="DropdownMenuItem",wt=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(an,{...a,...n,ref:t})});wt.displayName=yn;var bn="DropdownMenuCheckboxItem",yt=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(on,{...a,...n,ref:t})});yt.displayName=bn;var Nn="DropdownMenuRadioGroup",_n=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(cn,{...a,...n,ref:t})});_n.displayName=Nn;var Mn="DropdownMenuRadioItem",bt=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(ln,{...a,...n,ref:t})});bt.displayName=Mn;var Cn="DropdownMenuItemIndicator",Nt=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(dn,{...a,...n,ref:t})});Nt.displayName=Cn;var Rn="DropdownMenuSeparator",_t=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(un,{...a,...n,ref:t})});_t.displayName=Rn;var Sn="DropdownMenuArrow",Pn=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(mn,{...a,...n,ref:t})});Pn.displayName=Sn;var Dn="DropdownMenuSubTrigger",Mt=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(fn,{...a,...n,ref:t})});Mt.displayName=Dn;var En="DropdownMenuSubContent",Ct=c.forwardRef((s,t)=>{const{__scopeDropdownMenu:r,...n}=s,a=q(r);return e.jsx(hn,{...a,...n,ref:t,style:{...s.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ct.displayName=En;var An=ft,In=pt,Tn=xt,Rt=vt,St=jt,Pt=wt,Dt=yt,Et=bt,At=Nt,It=_t,Tt=Mt,Ot=Ct;const kt=An,qt=In,On=c.forwardRef(({className:s,inset:t,children:r,...n},a)=>e.jsx(Tt,{ref:a,className:W("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",s),...n,children:r}));On.displayName=Tt.displayName;const kn=c.forwardRef(({className:s,...t},r)=>e.jsx(Ot,{ref:r,className:W("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));kn.displayName=Ot.displayName;const is=c.forwardRef(({className:s,sideOffset:t=4,...r},n)=>e.jsx(Tn,{children:e.jsx(Rt,{ref:n,sideOffset:t,className:W("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}));is.displayName=Rt.displayName;const de=c.forwardRef(({className:s,inset:t,...r},n)=>e.jsx(Pt,{ref:n,className:W("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),...r}));de.displayName=Pt.displayName;const qn=c.forwardRef(({className:s,children:t,checked:r,...n},a)=>e.jsxs(Dt,{ref:a,className:W("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:r,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(At,{children:e.jsx(Ls,{className:"h-4 w-4"})})}),t]}));qn.displayName=Dt.displayName;const Ln=c.forwardRef(({className:s,children:t,...r},n)=>e.jsxs(Et,{ref:n,className:W("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(At,{children:e.jsx(or,{className:"h-2 w-2 fill-current"})})}),t]}));Ln.displayName=Et.displayName;const Fn=c.forwardRef(({className:s,inset:t,...r},n)=>e.jsx(St,{ref:n,className:W("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...r}));Fn.displayName=St.displayName;const Un=c.forwardRef(({className:s,...t},r)=>e.jsx(It,{ref:r,className:W("-mx-1 my-1 h-px bg-muted",s),...t}));Un.displayName=It.displayName;const $n=({requests:s,isLoading:t,filters:r,onFiltersChange:n,onRequestSelect:a,onRequestUpdate:o,onRequestDelete:l,getPriorityColor:i,getStatusColor:g})=>{const[f,u]=c.useState(""),m=s.filter(x=>{var D;return x.title.toLowerCase().includes(f.toLowerCase())||((D=x.description)==null?void 0:D.toLowerCase().includes(f.toLowerCase()))}),d=async(x,P)=>{try{await o(x,{status:P})}catch(D){console.error("Error updating request status:",D)}},v=async x=>{if(confirm("Are you sure you want to delete this request?"))try{await l(x)}catch(P){console.error("Error deleting request:",P)}},w=()=>[{value:"open",label:"Open"},{value:"in_progress",label:"In Progress"},{value:"done",label:"Done"},{value:"pending_review",label:"Pending Review"}],M=()=>[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"urgent",label:"Urgent"}],S=x=>{switch(x){case"urgent":return"border-red-400 bg-red-50";case"high":return"border-orange-400 bg-orange-50";case"medium":return"border-yellow-300 bg-yellow-50";case"low":return"border-gray-200 bg-gray-50";default:return"border-gray-200 bg-white"}};return t?e.jsx(te,{children:e.jsx(ae,{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading requests..."})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(te,{children:[e.jsx(ye,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(dr,{className:"h-5 w-5"}),"Filters"]})}),e.jsx(ae,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Search requests...",value:f,onChange:x=>u(x.target.value),className:"pl-8"})]}),e.jsxs(ge,{value:r.status||"",onValueChange:x=>n({...r,status:x||void 0}),children:[e.jsx(ve,{children:e.jsx(je,{placeholder:"All Statuses"})}),e.jsxs(we,{children:[e.jsx(T,{value:"",children:"All Statuses"}),w().map(x=>e.jsx(T,{value:x.value,children:x.label},x.value))]})]}),e.jsxs(ge,{value:r.priority||"",onValueChange:x=>n({...r,priority:x||void 0}),children:[e.jsx(ve,{children:e.jsx(je,{placeholder:"All Priorities"})}),e.jsxs(we,{children:[e.jsx(T,{value:"",children:"All Priorities"}),M().map(x=>e.jsx(T,{value:x.value,children:x.label},x.value))]})]}),e.jsx(Ee,{placeholder:"Assigned User ID",value:r.assigned_to||"",onChange:x=>n({...r,assigned_to:x.target.value||void 0})}),e.jsx(I,{variant:"outline",onClick:()=>{n({}),u("")},children:"Clear Filters"})]})})]}),e.jsxs(te,{children:[e.jsx(ye,{children:e.jsxs(Ae,{children:["Requests (",m.length,")"]})}),e.jsx(ae,{children:m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No requests found"}),e.jsx("p",{className:"text-muted-foreground",children:s.length===0?"No requests have been created yet.":"No requests match your filters."})]}):e.jsx(Me,{className:"h-[600px]",children:e.jsx("div",{className:"space-y-4",children:m.map(x=>{var P,D;return e.jsx("div",{className:`p-4 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors ${S(x.priority)}`,onClick:()=>a(x),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:x.title}),e.jsx(A,{className:i(x.priority),children:x.priority}),e.jsx(A,{className:g(x.status),children:x.status}),x.type&&e.jsx(A,{variant:"secondary",children:x.type})]}),x.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:x.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsxs("span",{children:["Created by ",(P=x.created_by_user)==null?void 0:P.full_name]})]}),x.assigned_to_user&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-4 w-4",children:e.jsx(se,{className:"text-xs",children:(D=x.assigned_to_user.full_name)==null?void 0:D.charAt(0)})}),e.jsxs("span",{children:["Assigned to ",x.assigned_to_user.full_name]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{children:Ie(new Date(x.created_at),{addSuffix:!0})})]}),x.messages&&x.messages.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsxs("span",{children:[x.messages.length," messages"]})]})]})]}),e.jsxs(kt,{children:[e.jsx(qt,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",children:e.jsx(Gs,{className:"h-4 w-4"})})}),e.jsxs(is,{align:"end",children:[e.jsxs(de,{onClick:()=>a(x),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"View Messages"]}),e.jsxs(de,{onClick:()=>d(x.id,"in_progress"),children:[e.jsx(gs,{className:"h-4 w-4 mr-2"}),"Mark In Progress"]}),e.jsxs(de,{onClick:()=>d(x.id,"done"),children:[e.jsx(gs,{className:"h-4 w-4 mr-2"}),"Mark Done"]}),e.jsxs(de,{onClick:()=>v(x.id),className:"text-red-600",children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})},x.id)})})})})]})]})},Gn=({request:s,onSendMessage:t,onRequestUpdate:r})=>{var G,z,j;const{user:n}=_e(),[a,o]=c.useState(""),[l,i]=c.useState(!1),[g,f]=c.useState(!1),[u,m]=c.useState(""),[d,v]=c.useState(0),w=c.useRef(null),M=c.useRef(null);c.useEffect(()=>{S()},[s.messages]);const S=()=>{var p;(p=w.current)==null||p.scrollIntoView({behavior:"smooth"})},x=async()=>{if(a.trim()){i(!0);try{const p=D(a);await t(s.id,a,p),o("")}catch(p){console.error("Error sending message:",p)}finally{i(!1)}}},P=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),x())},D=p=>{const h=/@(\w+)/g,_=[];let E;for(;(E=h.exec(p))!==null;)_.push(E[1]);return _},V=p=>{const h=p.target.value;o(h);const _=p.target.selectionStart,E=h.slice(0,_),F=E.lastIndexOf("@");if(F!==-1&&F<_){const Z=E.slice(F+1);m(Z),f(!0),v(_)}else f(!1)},$=p=>{const h=a.slice(0,d-u.length-1),_=a.slice(d),E=h+"@"+p+" "+_;o(E),f(!1),setTimeout(()=>{var F;(F=M.current)==null||F.focus()},0)},y=p=>{switch(p){case"urgent":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},C=p=>{switch(p){case"open":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-orange-100 text-orange-800";case"done":return"bg-green-100 text-green-800";case"pending_review":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},O=async p=>{try{await r(s.id,{status:p})}catch(h){console.error("Error updating request status:",h)}},L=async p=>{confirm("Are you sure you want to delete this message?")&&console.log("Delete message:",p)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(te,{children:e.jsx(ye,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:s.title}),e.jsx(A,{className:y(s.priority),children:s.priority}),e.jsx(A,{className:C(s.status),children:s.status})]}),s.description&&e.jsx("p",{className:"text-muted-foreground",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsxs("span",{children:["Created by ",(G=s.created_by_user)==null?void 0:G.full_name]})]}),s.assigned_to_user&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-4 w-4",children:e.jsx(se,{className:"text-xs",children:(z=s.assigned_to_user.full_name)==null?void 0:z.charAt(0)})}),e.jsxs("span",{children:["Assigned to ",s.assigned_to_user.full_name]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{children:Ie(new Date(s.created_at),{addSuffix:!0})})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(ge,{value:s.status,onValueChange:O,children:[e.jsx(ve,{className:"w-32",children:e.jsx(je,{})}),e.jsxs(we,{children:[e.jsx(T,{value:"open",children:"Open"}),e.jsx(T,{value:"in_progress",children:"In Progress"}),e.jsx(T,{value:"done",children:"Done"}),e.jsx(T,{value:"pending_review",children:"Pending Review"})]})]})})]})})}),e.jsxs(te,{children:[e.jsx(ye,{children:e.jsxs(Ae,{children:["Messages (",((j=s.messages)==null?void 0:j.length)||0,")"]})}),e.jsx(ae,{children:e.jsxs(Me,{className:"h-[400px]",children:[e.jsx("div",{className:"space-y-4",children:s.messages&&s.messages.length>0?s.messages.map(p=>{var h,_,E;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ee,{className:"h-8 w-8",children:e.jsx(se,{children:((_=(h=p.sender)==null?void 0:h.full_name)==null?void 0:_.charAt(0))||"U"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:((E=p.sender)==null?void 0:E.full_name)||"Unknown User"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Ie(new Date(p.created_at),{addSuffix:!0})}),p.sender_id===(n==null?void 0:n.id)&&e.jsxs(kt,{children:[e.jsx(qt,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(Gs,{className:"h-3 w-3"})})}),e.jsx(is,{align:"end",children:e.jsxs(de,{onClick:()=>L(p.id),children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),"Delete"]})})]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:p.message_text}),p.mentions&&p.mentions.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx(hr,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Mentioned ",p.mentions.length," user(s)"]})]})]})]})]},p.id)}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No messages yet. Start the conversation!"})})}),e.jsx("div",{ref:w})]})})]}),e.jsx(te,{children:e.jsx(ae,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{ref:M,value:a,onChange:V,onKeyPress:P,placeholder:"Type your message... Use @ to mention someone",className:"min-h-[100px] resize-none"}),g&&e.jsx("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white border rounded-lg shadow-lg z-10",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-2",children:['Suggestions for "',u,'"']}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 hover:bg-muted rounded cursor-pointer",onClick:()=>$("lara"),children:[e.jsx(ee,{className:"h-6 w-6",children:e.jsx(se,{className:"text-xs",children:"L"})}),e.jsx("span",{className:"text-sm",children:"Lara"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 hover:bg-muted rounded cursor-pointer",onClick:()=>$("mark"),children:[e.jsx(ee,{className:"h-6 w-6",children:e.jsx(se,{className:"text-xs",children:"M"})}),e.jsx("span",{className:"text-sm",children:"Mark"})]})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Press Enter to send, Shift+Enter for new line"}),e.jsxs(I,{onClick:x,disabled:l||!a.trim(),children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),l?"Sending...":"Send Message"]})]})]})})})]})},Bn=({open:s,onOpenChange:t})=>{const{user:r}=_e(),[n,a]=c.useState(""),[o,l]=c.useState([]),[i,g]=c.useState([]),[f,u]=c.useState(""),[m,d]=c.useState([]),[v,w]=c.useState(!1),M=[{value:"all",label:"All Employees",description:"Send to everyone"},{value:"admin",label:"Admins Only",description:"Send to administrators"},{value:"manager",label:"Managers Only",description:"Send to managers"},{value:"technician",label:"Technicians Only",description:"Send to technicians"},{value:"sales",label:"Sales Team",description:"Send to sales team"},{value:"custom",label:"Custom Selection",description:"Select specific users"}];c.useEffect(()=>{s&&S()},[s]),c.useEffect(()=>{if(f.trim()){const y=i.filter(C=>{var O,L;return((O=C.full_name)==null?void 0:O.toLowerCase().includes(f.toLowerCase()))||((L=C.role)==null?void 0:L.toLowerCase().includes(f.toLowerCase()))});d(y)}else d(i)},[f,i]);const S=async()=>{try{const y=await k.getUsers();g(y),d(y)}catch(y){console.error("Error loading users:",y)}},x=async y=>{if(y.preventDefault(),!n.trim()){Q({title:"Error",description:"Please enter a message",variant:"destructive"});return}if(o.length===0){Q({title:"Error",description:"Please select an audience",variant:"destructive"});return}w(!0);try{const C={message_text:n,audience:o};await k.createBroadcast(C),Q({title:"Broadcast sent",description:"Your broadcast message has been sent successfully"}),t(!1),a(""),l([])}catch{Q({title:"Error",description:"Failed to send broadcast",variant:"destructive"})}finally{w(!1)}},P=y=>{l(y==="all"?["all"]:y==="custom"?[]:[y])},D=y=>{l(C=>C.includes(y)?C.filter(O=>O!==y):[...C,y])},V=()=>o.includes("all")?"All Employees":o.includes("admin")?"Admins Only":o.includes("manager")?"Managers Only":o.includes("technician")?"Technicians Only":o.includes("sales")?"Sales Team":o.length>0?`${o.length} selected users`:"Select audience...",$=()=>i.filter(y=>o.includes(y.id));return e.jsx(js,{open:s,onOpenChange:t,children:e.jsxs(ws,{className:"sm:max-w-[600px]",children:[e.jsx(ys,{children:e.jsxs(bs,{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"h-5 w-5"}),"Send Broadcast Message"]})}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"message",children:"Message *"}),e.jsx(Qe,{id:"message",value:n,onChange:y=>a(y.target.value),placeholder:"Enter your broadcast message...",rows:4,required:!0})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(H,{children:"Audience *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:M.map(y=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${o.includes(y.value)||y.value==="custom"&&o.length>0&&!o.includes("all")?"border-primary bg-primary/5":"border-muted hover:border-primary/50"}`,onClick:()=>P(y.value),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xs,{checked:o.includes(y.value)||y.value==="custom"&&o.length>0&&!o.includes("all"),readOnly:!0}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:y.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y.description})]})]})},y.value))}),o.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Selected Audience"}),e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:V()}),o.includes("custom")&&$().length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:f,onChange:y=>u(y.target.value),className:"flex-1 text-sm border-none bg-transparent outline-none"})]}),e.jsx(Me,{className:"max-h-32",children:e.jsx("div",{className:"space-y-1",children:m.map(y=>{var C;return e.jsxs("div",{className:"flex items-center gap-2 p-2 hover:bg-muted/50 rounded cursor-pointer",onClick:()=>D(y.id),children:[e.jsx(xs,{checked:o.includes(y.id),readOnly:!0}),e.jsx(ee,{className:"h-6 w-6",children:e.jsx(se,{className:"text-xs",children:((C=y.full_name)==null?void 0:C.charAt(0))||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:y.full_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y.role})]})]},y.id)})})})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:v,children:"Cancel"}),e.jsxs(I,{type:"submit",disabled:v||!n.trim()||o.length===0,children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),v?"Sending...":"Send Broadcast"]})]})]})]})})};var $e="Popover",[Lt,va]=Ze($e,[ke]),Se=ke(),[Kn,ne]=Lt($e),Ft=s=>{const{__scopePopover:t,children:r,open:n,defaultOpen:a,onOpenChange:o,modal:l=!1}=s,i=Se(t),g=c.useRef(null),[f,u]=c.useState(!1),[m,d]=qs({prop:n,defaultProp:a??!1,onChange:o,caller:$e});return e.jsx(Cs,{...i,children:e.jsx(Kn,{scope:t,contentId:Xe(),triggerRef:g,open:m,onOpenChange:d,onOpenToggle:c.useCallback(()=>d(v=>!v),[d]),hasCustomAnchor:f,onCustomAnchorAdd:c.useCallback(()=>u(!0),[]),onCustomAnchorRemove:c.useCallback(()=>u(!1),[]),modal:l,children:r})})};Ft.displayName=$e;var Ut="PopoverAnchor",zn=c.forwardRef((s,t)=>{const{__scopePopover:r,...n}=s,a=ne(Ut,r),o=Se(r),{onCustomAnchorAdd:l,onCustomAnchorRemove:i}=a;return c.useEffect(()=>(l(),()=>i()),[l,i]),e.jsx(Je,{...o,...n,ref:t})});zn.displayName=Ut;var $t="PopoverTrigger",Gt=c.forwardRef((s,t)=>{const{__scopePopover:r,...n}=s,a=ne($t,r),o=Se(r),l=oe(t,a.triggerRef),i=e.jsx(re.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Xt(a.open),...n,ref:l,onClick:N(s.onClick,a.onOpenToggle)});return a.hasCustomAnchor?i:e.jsx(Je,{asChild:!0,...o,children:i})});Gt.displayName=$t;var ls="PopoverPortal",[Vn,Xn]=Lt(ls,{forceMount:void 0}),Bt=s=>{const{__scopePopover:t,forceMount:r,children:n,container:a}=s,o=ne(ls,t);return e.jsx(Vn,{scope:t,forceMount:r,children:e.jsx(he,{present:r||o.open,children:e.jsx(Rs,{asChild:!0,container:a,children:n})})})};Bt.displayName=ls;var fe="PopoverContent",Kt=c.forwardRef((s,t)=>{const r=Xn(fe,s.__scopePopover),{forceMount:n=r.forceMount,...a}=s,o=ne(fe,s.__scopePopover);return e.jsx(he,{present:n||o.open,children:o.modal?e.jsx(Hn,{...a,ref:t}):e.jsx(Qn,{...a,ref:t})})});Kt.displayName=fe;var Yn=Es("PopoverContent.RemoveScroll"),Hn=c.forwardRef((s,t)=>{const r=ne(fe,s.__scopePopover),n=c.useRef(null),a=oe(t,n),o=c.useRef(!1);return c.useEffect(()=>{const l=n.current;if(l)return Ss(l)},[]),e.jsx(Ds,{as:Yn,allowPinchZoom:!0,children:e.jsx(zt,{...s,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:N(s.onCloseAutoFocus,l=>{var i;l.preventDefault(),o.current||(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:N(s.onPointerDownOutside,l=>{const i=l.detail.originalEvent,g=i.button===0&&i.ctrlKey===!0,f=i.button===2||g;o.current=f},{checkForDefaultPrevented:!1}),onFocusOutside:N(s.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1})})})}),Qn=c.forwardRef((s,t)=>{const r=ne(fe,s.__scopePopover),n=c.useRef(!1),a=c.useRef(!1);return e.jsx(zt,{...s,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var l,i;(l=s.onCloseAutoFocus)==null||l.call(s,o),o.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),o.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:o=>{var g,f;(g=s.onInteractOutside)==null||g.call(s,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const l=o.target;((f=r.triggerRef.current)==null?void 0:f.contains(l))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}})}),zt=c.forwardRef((s,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEscapeKeyDown:i,onPointerDownOutside:g,onFocusOutside:f,onInteractOutside:u,...m}=s,d=ne(fe,r),v=Se(r);return Ps(),e.jsx(As,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:o,children:e.jsx(Is,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:u,onEscapeKeyDown:i,onPointerDownOutside:g,onFocusOutside:f,onDismiss:()=>d.onOpenChange(!1),children:e.jsx(Ts,{"data-state":Xt(d.open),role:"dialog",id:d.contentId,...v,...m,ref:t,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Vt="PopoverClose",Wn=c.forwardRef((s,t)=>{const{__scopePopover:r,...n}=s,a=ne(Vt,r);return e.jsx(re.button,{type:"button",...n,ref:t,onClick:N(s.onClick,()=>a.onOpenChange(!1))})});Wn.displayName=Vt;var Zn="PopoverArrow",Jn=c.forwardRef((s,t)=>{const{__scopePopover:r,...n}=s,a=Se(r);return e.jsx(Os,{...a,...n,ref:t})});Jn.displayName=Zn;function Xt(s){return s?"open":"closed"}var ea=Ft,sa=Gt,ta=Bt,Yt=Kt;const ra=ea,na=sa,Ht=c.forwardRef(({className:s,align:t="center",sideOffset:r=4,...n},a)=>e.jsx(ta,{children:e.jsx(Yt,{ref:a,align:t,sideOffset:r,className:W("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}));Ht.displayName=Yt.displayName;const aa=({notifications:s,unreadCount:t,onMarkAsRead:r})=>{const[n,a]=c.useState(!1),o=u=>{switch(u){case"mention":return e.jsx(ue,{className:"h-4 w-4 text-blue-600"});case"assignment":return e.jsx(me,{className:"h-4 w-4 text-green-600"});case"status_change":return e.jsx($s,{className:"h-4 w-4 text-orange-600"});case"new_request":return e.jsx(qe,{className:"h-4 w-4 text-purple-600"});default:return e.jsx(Ke,{className:"h-4 w-4 text-gray-600"})}},l=u=>{switch(u){case"mention":return"You were mentioned";case"assignment":return"Request assigned to you";case"status_change":return"Request status updated";case"new_request":return"New request created";default:return"Notification"}},i=u=>{switch(u){case"mention":return"Someone mentioned you in a message";case"assignment":return"A request has been assigned to you";case"status_change":return"A request status has been updated";case"new_request":return"A new request has been created";default:return"You have a new notification"}},g=async(u,m)=>{m.stopPropagation();try{await r(u)}catch(d){console.error("Error marking notification as read:",d)}},f=async()=>{try{console.log("Mark all as read")}catch(u){console.error("Error marking all notifications as read:",u)}};return e.jsxs(ra,{open:n,onOpenChange:a,children:[e.jsx(na,{asChild:!0,children:e.jsxs(I,{variant:"ghost",size:"sm",className:"relative",children:[e.jsx(Ke,{className:"h-5 w-5"}),t>0&&e.jsx(A,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:t>9?"9+":t})]})}),e.jsx(Ht,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Notifications"}),t>0&&e.jsxs(I,{variant:"ghost",size:"sm",onClick:f,className:"text-xs",children:[e.jsx(Ls,{className:"h-3 w-3 mr-1"}),"Mark all read"]})]}),e.jsx(Ye,{}),e.jsx(Me,{className:"h-64",children:s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ke,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No notifications"})]}):e.jsx("div",{className:"space-y-2",children:s.map(u=>e.jsx("div",{className:`p-3 rounded-lg border transition-colors ${u.is_read?"bg-muted/30":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:o(u.notification_type)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:l(u.notification_type)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i(u.notification_type)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Ie(new Date(u.created_at),{addSuffix:!0})})]}),!u.is_read&&e.jsx(I,{variant:"ghost",size:"sm",onClick:m=>g(u.id,m),className:"h-6 w-6 p-0",children:e.jsx(Ns,{className:"h-3 w-3"})})]})})]})},u.id))})}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{}),e.jsx("div",{className:"text-center",children:e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>a(!1),className:"text-xs",children:"View all notifications"})})]})]})})]})},oa=()=>{const{user:s}=_e(),[t,r]=c.useState([]),[n,a]=c.useState(!0),[o,l]=c.useState({});c.useEffect(()=>{s&&(k.setCurrentUser(s),i())},[s,o]);const i=async()=>{try{a(!0);const d=await k.getRequests(o);r(d)}catch(d){console.error("Error loading requests:",d)}finally{a(!1)}};return{requests:t,isLoading:n,filters:o,setFilters:l,createRequest:async d=>{try{const v=await k.createRequest(d);return await i(),v}catch(v){throw console.error("Error creating request:",v),v}},updateRequest:async(d,v)=>{try{const w=await k.updateRequest(d,v);return r(M=>M.map(S=>S.id===d?{...S,...w}:S)),w}catch(w){throw console.error("Error updating request:",w),w}},deleteRequest:async d=>{try{await k.deleteRequest(d),r(v=>v.filter(w=>w.id!==d))}catch(v){throw console.error("Error deleting request:",v),v}},refreshRequests:()=>{i()}}},ja=()=>{var p;const{user:s}=_e(),[t,r]=c.useState("requests"),[n,a]=c.useState(!1),[o,l]=c.useState(!1),[i,g]=c.useState(null),[f,u]=c.useState([]),[m,d]=c.useState(0),{requests:v,isLoading:w,filters:M,setFilters:S,createRequest:x,updateRequest:P,deleteRequest:D,refreshRequests:V}=oa();c.useEffect(()=>{s&&(k.setCurrentUser(s),$(),y())},[s]);const $=async()=>{try{const h=await k.getNotifications();u(h),d(h.length)}catch(h){console.error("Error loading notifications:",h)}},y=()=>{k.subscribeToNotifications(h=>{h.new&&h.new.user_id===(s==null?void 0:s.id)&&($(),Q({title:"New notification",description:"You have a new request notification"}))}),k.subscribeToRequests(h=>{V()})},C=async h=>{try{await x(h),a(!1),Q({title:"Request created",description:"Your request has been created successfully"})}catch{Q({title:"Error",description:"Failed to create request",variant:"destructive"})}},O=h=>{g(h),r("messages")},L=async(h,_,E)=>{try{if(await k.createMessage({request_id:h,message_text:_,mentions:E}),(i==null?void 0:i.id)===h){const F=await k.getRequestById(h);F&&g(F)}Q({title:"Message sent",description:"Your message has been sent successfully"})}catch{Q({title:"Error",description:"Failed to send message",variant:"destructive"})}},G=async h=>{try{await k.markNotificationAsRead(h),$()}catch(_){console.error("Error marking notification as read:",_)}},z=h=>{switch(h){case"urgent":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},j=h=>{switch(h){case"open":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-orange-100 text-orange-800";case"done":return"bg-green-100 text-green-800";case"pending_review":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Request & Messaging Center"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage requests, communicate with team members, and stay updated"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(aa,{notifications:f,unreadCount:m,onMarkAsRead:G}),(s==null?void 0:s.role)==="owner"&&e.jsxs(I,{onClick:()=>l(!0),variant:"outline",size:"sm",children:[e.jsx(Us,{className:"h-4 w-4 mr-2"}),"Broadcast"]}),e.jsxs(I,{onClick:()=>a(!0),children:[e.jsx(cr,{className:"h-4 w-4 mr-2"}),"New Request"]})]})]}),e.jsxs(ir,{value:t,onValueChange:r,className:"space-y-4",children:[e.jsxs(lr,{className:"grid w-full grid-cols-3",children:[e.jsxs(ze,{value:"requests",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Requests",v.length>0&&e.jsx(A,{variant:"secondary",className:"ml-1",children:v.length})]}),e.jsxs(ze,{value:"messages",className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),"Messages",i&&e.jsx(A,{variant:"secondary",className:"ml-1",children:((p=i.messages)==null?void 0:p.length)||0})]}),e.jsxs(ze,{value:"inbox",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"My Inbox"]})]}),e.jsx(Ve,{value:"requests",className:"space-y-4",children:e.jsx($n,{requests:v,isLoading:w,filters:M,onFiltersChange:S,onRequestSelect:O,onRequestUpdate:P,onRequestDelete:D,getPriorityColor:z,getStatusColor:j})}),e.jsx(Ve,{value:"messages",className:"space-y-4",children:i?e.jsx(Gn,{request:i,onSendMessage:L,onRequestUpdate:P}):e.jsx(te,{children:e.jsx(ae,{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Request Selected"}),e.jsx("p",{className:"text-muted-foreground",children:"Select a request from the Requests tab to view its messages"})]})})})}),e.jsx(Ve,{value:"inbox",className:"space-y-4",children:e.jsxs(te,{children:[e.jsx(ye,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"My Inbox"]})}),e.jsx(ae,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx($s,{className:"h-4 w-4 text-blue-600"}),"Assigned to Me"]}),e.jsxs("div",{className:"space-y-2",children:[v.filter(h=>h.assigned_to===(s==null?void 0:s.id)).map(h=>{var _;return e.jsx("div",{className:"p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>O(h),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:h.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Created by ",(_=h.created_by_user)==null?void 0:_.full_name]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{className:z(h.priority),children:h.priority}),e.jsx(A,{className:j(h.status),children:h.status})]})]})},h.id)}),v.filter(h=>h.assigned_to===(s==null?void 0:s.id)).length===0&&e.jsx("p",{className:"text-muted-foreground text-sm",children:"No requests assigned to you"})]})]}),e.jsx(Ye,{}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 text-green-600"}),"Created by Me"]}),e.jsxs("div",{className:"space-y-2",children:[v.filter(h=>h.created_by===(s==null?void 0:s.id)).map(h=>{var _;return e.jsx("div",{className:"p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>O(h),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:h.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Assigned to ",((_=h.assigned_to_user)==null?void 0:_.full_name)||"Unassigned"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{className:z(h.priority),children:h.priority}),e.jsx(A,{className:j(h.status),children:h.status})]})]})},h.id)}),v.filter(h=>h.created_by===(s==null?void 0:s.id)).length===0&&e.jsx("p",{className:"text-muted-foreground text-sm",children:"No requests created by you"})]})]})]})})]})})]}),e.jsx(_r,{open:n,onOpenChange:a,onSubmit:C}),e.jsx(Bn,{open:o,onOpenChange:l})]})};export{ja as default};
