import{r as m,j as e,ax as P,b as c,f as D,a4 as B,B as z,af as V,aJ as I,b0 as Y,I as J,a5 as U,a6 as q,a7 as X,a8 as G,a9 as S,g as Q,h as W,i as L,k as p,l as _,m as j,$ as Z,aH as ee,t as se,b1 as ae,a as te,U as le}from"./index-BUhc98AO.js";import{S as T}from"./star-Dr40v_NV.js";import{R as f,B as A,C as M,X as F,Y as k,T as N,a as R,b as K,L as $}from"./BarChart-lcMgdMZn.js";import{P as O,a as E}from"./PieChart-BAloduJe.js";const re=()=>{const[n,y]=m.useState([]);m.useEffect(()=>{const s=localStorage.getItem("clientComments");s&&y(JSON.parse(s))},[]);const l=n.reduce((s,r)=>(s[r.category]=(s[r.category]||0)+1,s),{}),g=Object.entries(l).map(([s,r])=>({category:s.charAt(0).toUpperCase()+s.slice(1),count:r})),x=n.reduce((s,r)=>(s[r.rating]=(s[r.rating]||0)+1,s),{}),v=[1,2,3,4,5].map(s=>({rating:`${s} Star${s>1?"s":""}`,count:x[s]||0})),h=n.length>0?(n.reduce((s,r)=>s+r.rating,0)/n.length).toFixed(1):"0",w=s=>Array.from({length:5},(r,a)=>e.jsx(T,{className:`h-4 w-4 ${a<s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},a));return n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(P,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No client comments yet. Start collecting feedback to see analytics!"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(c,{children:e.jsxs(D,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-monza-black",children:n.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Comments"})]})}),e.jsx(c,{children:e.jsxs(D,{className:"p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"text-2xl font-bold text-monza-black",children:h}),e.jsx(T,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Average Rating"})]})}),e.jsx(c,{children:e.jsxs(D,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-monza-black",children:Object.keys(l).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Categories"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(c,{className:"p-4",children:[e.jsxs("h4",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"Comments by Category"]}),e.jsx("div",{className:"h-64",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(A,{data:g,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"category"}),e.jsx(k,{}),e.jsx(N,{}),e.jsx(R,{dataKey:"count",fill:"#8884d8"})]})})})]}),e.jsxs(c,{className:"p-4",children:[e.jsxs("h4",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Rating Distribution"]}),e.jsx("div",{className:"h-64",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(O,{children:[e.jsx(E,{data:v,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,value:r})=>`${s}: ${r}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:v.map((s,r)=>e.jsx(K,{fill:["#FFD700","#FFA500","#FF6347","#32CD32","#4169E1"][r]},`cell-${r}`))}),e.jsx(N,{})]})})})]})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("h4",{className:"text-lg font-medium mb-4",children:"Recent Comments"}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:n.slice(0,5).map(s=>e.jsxs("div",{className:"border-l-4 border-l-monza-yellow pl-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.clientName}),e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:s.carModel})]}),e.jsx("div",{className:"flex items-center gap-1",children:w(s.rating)})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-1",children:s.comment}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{variant:"secondary",className:"text-xs",children:s.category}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleDateString()})]})]},s.id))})]})]})},H=["#8884d8","#83a6ed","#8dd1e1","#82ca9d","#a4de6c","#d0ed57","#ffc658"],ne=({data:n,period:y})=>{const[l,g]=m.useState(n),[x,v]=m.useState(""),[h,w]=m.useState("all");m.useEffect(()=>{const a=JSON.parse(localStorage.getItem("salesLeads")||"[]");if(a.length>0){const t=new Map;a.forEach(b=>{const o=b.leadSource,u=b.carModel;t.has(o)||t.set(o,{count:0,models:new Map});const i=t.get(o);i.count++,i.models.has(u)||i.models.set(u,0),i.models.set(u,i.models.get(u)+1)});const d=a.length,C=Array.from(t.entries()).map(([b,o])=>({source:b,count:o.count,percentage:Math.round(o.count/d*100),trend:Math.floor(Math.random()*20)-10,models:Array.from(o.models.entries()).map(([u,i])=>({name:u,count:i}))}));g(C)}},[]);const s=l.filter(a=>{const t=a.source.toLowerCase().includes(x.toLowerCase());let d=!0;return h==="positive"?d=a.trend>0:h==="negative"?d=a.trend<0:h==="neutral"&&(d=a.trend===0),t&&d});l.reduce((a,t)=>a+t.count,0),l.map(a=>({name:a.source,value:a.count}));const r=l.flatMap(a=>a.models.map(t=>({source:a.source,model:t.name,count:t.count})));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Sales Lead Sources"]}),l.length===0?e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(V,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Sales Data Yet"}),e.jsx("p",{className:"text-gray-600",children:"Start recording lead sources to see analytics here."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs(c,{className:"lg:col-span-2 p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Lead Source Distribution"}),e.jsx("div",{className:"h-80",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(A,{data:l,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"source"}),e.jsx(k,{}),e.jsx(N,{}),e.jsx($,{}),e.jsx(R,{dataKey:"count",name:"Number of Leads",fill:"#8884d8"})]})})})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Lead Sources Percentage"}),e.jsx("div",{className:"h-80",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(O,{children:[e.jsx(E,{data:l,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percentage:t})=>`${a} ${t}%`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:l.map((a,t)=>e.jsx(K,{fill:H[t%H.length]},`cell-${t}`))}),e.jsx(N,{})]})})})]})]}),r.length>0&&e.jsxs(c,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"Lead Sources by Model"]}),e.jsx("div",{className:"h-80",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(A,{data:r,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"model"}),e.jsx(k,{}),e.jsx(N,{}),e.jsx($,{}),e.jsx(R,{dataKey:"count",name:"Number of Leads",fill:"#82ca9d"})]})})})]}),e.jsxs(c,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Detailed Lead Source Data"]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:"absolute left-2 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Search lead sources...",className:"pl-8",value:x,onChange:a=>v(a.target.value)})]}),e.jsxs(U,{value:h,onValueChange:w,children:[e.jsx(q,{className:"w-48",children:e.jsx(X,{placeholder:"Filter by trend"})}),e.jsxs(G,{children:[e.jsx(S,{value:"all",children:"All Trends"}),e.jsx(S,{value:"positive",children:"Positive Trend"}),e.jsx(S,{value:"negative",children:"Negative Trend"}),e.jsx(S,{value:"neutral",children:"Neutral Trend"})]})]})]}),e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(L,{children:[e.jsx(p,{children:"Source"}),e.jsx(p,{children:"Leads"}),e.jsx(p,{children:"Percentage"}),e.jsx(p,{children:"Trend"}),e.jsx(p,{children:"Top Model"})]})}),e.jsxs(_,{children:[s.map(a=>{const t=[...a.models].sort((d,C)=>C.count-d.count)[0];return e.jsxs(L,{children:[e.jsx(j,{className:"font-medium",children:a.source}),e.jsx(j,{children:a.count}),e.jsxs(j,{children:[a.percentage,"%"]}),e.jsxs(j,{className:a.trend>0?"text-green-600":"text-red-600",children:[a.trend>0?"+":"",a.trend,"%"]}),e.jsx(j,{children:(t==null?void 0:t.name)||"N/A"})]},a.source)}),s.length===0&&e.jsx(L,{children:e.jsx(j,{colSpan:5,className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No lead sources match your search criteria."})})})]})]})]})]}),e.jsxs(c,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Client Comments Analytics"]}),e.jsx(re,{})]})]})},ce=[{source:"Online Ads",count:78,percentage:27,trend:15,models:[{name:"Voyah Free 2024",count:35},{name:"MHero 917 2024",count:28},{name:"Voyah Dream 2025",count:15}]},{source:"Social Media",count:65,percentage:23,trend:22,models:[{name:"Voyah Free 2024",count:30},{name:"MHero 917 2024",count:25},{name:"Voyah Passion 2024",count:10}]},{source:"Dealer Referral",count:42,percentage:15,trend:-5,models:[{name:"Voyah Free 2024",count:20},{name:"MHero 917 2024",count:15},{name:"Voyah Dream 2025",count:7}]},{source:"Car Shows",count:38,percentage:13,trend:8,models:[{name:"Voyah Free 2025",count:18},{name:"MHero 917 2024",count:12},{name:"Voyah Passion 2024",count:8}]},{source:"Customer Referral",count:35,percentage:12,trend:30,models:[{name:"Voyah Free 2024",count:15},{name:"MHero 917 2024",count:12},{name:"Voyah Free 2025",count:8}]},{source:"Search Engines",count:28,percentage:10,trend:5,models:[{name:"Voyah Free 2024",count:12},{name:"MHero 917 2024",count:10},{name:"Voyah Dream 2025",count:6}]}],xe=()=>{const[n,y]=m.useState("month"),{user:l}=Z(),g=ee();return(l==null?void 0:l.role)!=="owner"&&(l==null?void 0:l.role)!=="sales"?(se({title:"Access Denied",description:"Only owners and sales staff can access the marketing analytics page.",variant:"destructive"}),e.jsx(ae,{to:"/dashboard"})):e.jsxs("div",{className:"space-y-8 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Marketing Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Analyze sales performance, lead sources, and marketing effectiveness"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(te,{variant:"outline",onClick:()=>g("/sales"),className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Add Lead Source"]}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-background px-3 py-2",value:n,onChange:x=>y(x.target.value),children:[e.jsx("option",{value:"week",children:"Last Week"}),e.jsx("option",{value:"month",children:"Last Month"}),e.jsx("option",{value:"quarter",children:"Last Quarter"}),e.jsx("option",{value:"year",children:"Last Year"})]})]})]}),e.jsx("div",{className:"space-y-8",children:e.jsx(ne,{data:ce,period:n})})]})};export{xe as default};
