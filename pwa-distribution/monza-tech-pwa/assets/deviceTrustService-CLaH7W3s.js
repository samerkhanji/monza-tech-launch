var E=Object.defineProperty;var y=(t,e,n)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var g=(t,e,n)=>y(t,typeof e!="symbol"?e+"":e,n);const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));function S(t,e=0){return(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase()}let w;const A=new Uint8Array(16);function x(){if(!w){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");w=crypto.getRandomValues.bind(crypto)}return w(A)}const _=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),D={randomUUID:_};function C(t,e,n){var o;if(D.randomUUID&&!t)return D.randomUUID();t=t||{};const i=t.random??((o=t.rng)==null?void 0:o.call(t))??x();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,S(i)}const h=class h{constructor(){g(this,"STORAGE_KEY","monza_trusted_owner_devices");g(this,"DEVICE_SEED_KEY","monza_device_seed")}static getInstance(){return this.instance||(this.instance=new h),this.instance}getOrCreateDeviceSeed(){let e=localStorage.getItem(this.DEVICE_SEED_KEY);return e||(e=C(),localStorage.setItem(this.DEVICE_SEED_KEY,e)),e}getCurrentDeviceId(){var v,I;const e=this.getOrCreateDeviceSeed(),n=navigator.userAgent||"",i=navigator.platform||"",o=navigator.language||"",s=Intl.DateTimeFormat().resolvedOptions().timeZone||"",d=((v=window.screen)==null?void 0:v.width)||0,a=((I=window.screen)==null?void 0:I.height)||0,l=(window.devicePixelRatio||1).toString(),u=[e,n,i,o,s,d,a,l].join("|");let c=0;for(let m=0;m<u.length;m++)c=(c<<5)-c+u.charCodeAt(m),c|=0;return`mdid_${Math.abs(c)}`}readAll(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return{};const n=JSON.parse(e);return typeof n=="object"&&n?n:{}}catch{return{}}}writeAll(e){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}listTrustedDevices(e){return this.readAll()[e]||[]}isTrustedOwnerDevice(e){const n=this.getCurrentDeviceId();return this.listTrustedDevices(e).some(i=>i.deviceId===n)}registerCurrentDevice(e,n){var a,l;const i=this.readAll(),o=i[e]||[],s={deviceId:this.getCurrentDeviceId(),label:(n==null?void 0:n.trim())||this.defaultLabel(),userAgent:navigator.userAgent||"",platform:navigator.platform||"",screen:{width:((a=window.screen)==null?void 0:a.width)||0,height:((l=window.screen)==null?void 0:l.height)||0,pixelRatio:window.devicePixelRatio||1},locale:navigator.language||"",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone||"",registeredAt:new Date().toISOString()},d=o.findIndex(u=>u.deviceId===s.deviceId);return d>=0?o[d]=s:o.push(s),i[e]=o,this.writeAll(i),s}removeTrustedDevice(e,n){const i=this.readAll(),o=(i[e]||[]).filter(s=>s.deviceId!==n);i[e]=o,this.writeAll(i)}defaultLabel(){var o,s;const e=navigator.platform||"Device",n=((o=window.screen)==null?void 0:o.width)||0,i=((s=window.screen)==null?void 0:s.height)||0;return`${e} ${n}x${i}`}};g(h,"instance");let p=h;export{p as D};
