import{$ as X,r as l,aH as ee,j as e,b1 as se,bZ as te,a as f,b3 as B,bE as G,b as c,c as n,d,f as x,Y as ae,Z as ie,_ as D,c2 as re,af as Y,a3 as le,aA as R,ag as y,B as v,ae as A,L as p,b0 as ce,I as ne,a5 as L,a6 as C,a7 as O,a8 as I,a9 as a,g as de,h as xe,i as U,k as N,l as oe,m,ad as $,U as me,t as he,aK as je,az as ue,aq as ve}from"./index-BUhc98AO.js";import{u as Ne}from"./useAuditLog-tWZQ5JCa.js";import{F as pe}from"./filter-CsR6QRYn.js";import{S as ge}from"./square-pen-D5pISChf.js";const we=()=>{var M,H;const{user:h}=X(),{auditLogs:j,filterLogs:k,getAuditStats:V,clearOldLogs:q}=Ne(),[z,Z]=l.useState("overview"),[g,_]=l.useState({}),[w,P]=l.useState(""),[T,F]=l.useState("today");if(ee(),l.useMemo(()=>[],[]),l.useMemo(()=>[],[]),(h==null?void 0:h.role)!=="owner"&&(h==null?void 0:h.role)!=="garage_manager")return e.jsx(se,{to:"/dashboard",replace:!0});const u=l.useMemo(()=>V(),[V]),b=l.useMemo(()=>{let s=j;const t=new Date;switch(T){case"today":s=j.filter(i=>new Date(i.timestamp).toDateString()===t.toDateString());break;case"week":const r=new Date(t.getTime()-7*24*60*60*1e3);s=j.filter(i=>new Date(i.timestamp)>=r);break;case"month":const o=new Date(t.getTime()-30*24*60*60*1e3);s=j.filter(i=>new Date(i.timestamp)>=o);break}return k({...g,searchTerm:w}).filter(r=>s.includes(r))},[j,g,w,T,k]),W=(s,t)=>{_(r=>({...r,[s]:t||void 0}))},K=()=>{_({}),P(""),F("today")},J=s=>{switch(s){case"CREATE":return e.jsx(ve,{className:"h-4 w-4 text-green-600"});case"UPDATE":return e.jsx(ge,{className:"h-4 w-4 text-blue-600"});case"DELETE":return e.jsx(G,{className:"h-4 w-4 text-red-600"});case"VIEW":return e.jsx(ue,{className:"h-4 w-4 text-gray-600"});case"UPLOAD":return e.jsx(je,{className:"h-4 w-4 text-purple-600"});case"DOWNLOAD":return e.jsx(B,{className:"h-4 w-4 text-indigo-600"});default:return e.jsx(Y,{className:"h-4 w-4 text-gray-600"})}},S=s=>{switch(s){case"CREATE":return"bg-green-100 text-green-800 border-green-300";case"UPDATE":return"bg-blue-100 text-blue-800 border-blue-300";case"DELETE":return"bg-red-100 text-red-800 border-red-300";case"VIEW":return"bg-gray-100 text-gray-800 border-gray-300";case"UPLOAD":return"bg-purple-100 text-purple-800 border-purple-300";case"DOWNLOAD":return"bg-indigo-100 text-indigo-800 border-indigo-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},E=s=>({INVENTORY:"bg-yellow-100 text-yellow-800 border-yellow-300",SHOWROOM_1:"bg-blue-100 text-blue-800 border-blue-300",SHOWROOM_2:"bg-green-100 text-green-800 border-green-300",GARAGE:"bg-orange-100 text-orange-800 border-orange-300",PDI:"bg-purple-100 text-purple-800 border-purple-300",FINANCIAL:"bg-emerald-100 text-emerald-800 border-emerald-300",REPAIRS:"bg-red-100 text-red-800 border-red-300",NEW_ARRIVALS:"bg-cyan-100 text-cyan-800 border-cyan-300"})[s]||"bg-gray-100 text-gray-800 border-gray-300",Q=()=>{const s=[["Timestamp","User","Role","Action","Section","Entity Type","Details"],...b.map(i=>[i.timestamp,i.userName,i.userRole,i.action,i.section,i.entityType,i.details])].map(i=>i.join(",")).join(`
`),t=new Blob([s],{type:"text/csv"}),r=window.URL.createObjectURL(t),o=document.createElement("a");o.href=r,o.download=`audit_log_${new Date().toISOString().split("T")[0]}.csv`,o.click(),window.URL.revokeObjectURL(r),he({title:"Export Complete",description:"Audit logs have been exported to CSV file."})};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Activity Monitor"}),e.jsx("p",{className:"text-muted-foreground",children:"Track all user activities and changes across the CMS"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",onClick:Q,children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Export Logs"]}),e.jsxs(f,{variant:"outline",onClick:q,children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Clear Old Logs"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(c,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium",children:"Total Activities"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.totalActivities.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All time activities"})]})]}),e.jsxs(c,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium",children:"Today's Activities"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.todayActivities}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Activities today"})]})]}),e.jsxs(c,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium",children:"Active Users"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.activeUsers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Users active today"})]})]}),e.jsxs(c,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium",children:"Most Active Section"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((M=u.sectionsActivity[0])==null?void 0:M.section.replace("_"," "))||"None"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((H=u.sectionsActivity[0])==null?void 0:H.count)||0," activities"]})]})]})]}),e.jsxs(ae,{value:z,onValueChange:Z,className:"space-y-4",children:[e.jsxs(ie,{className:"grid w-full grid-cols-3",children:[e.jsxs(D,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Overview"]}),e.jsxs(D,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Activity Log"]}),e.jsxs(D,{value:"users",className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"User Activity"]})]}),e.jsx(R,{value:"overview",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Section Activity"}),e.jsx(y,{children:"Activity breakdown by system sections"})]}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:u.sectionsActivity.slice(0,8).map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(v,{className:E(s.section),children:s.section.replace("_"," ")})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium",children:[s.count," activities"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Last: ",A.formatDateTime(s.lastActivity)]})]})]},s.section))})})]}),e.jsxs(c,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Recent Activities"}),e.jsx(y,{children:"Latest 10 system activities"})]}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:j.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-2",children:J(s.action)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:s.userName}),e.jsx(v,{className:S(s.action),children:s.action}),e.jsx(v,{className:E(s.section),children:s.section.replace("_"," ")})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.details}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:A.formatDateTime(s.timestamp)})]})]},s.id))})})]})]})}),e.jsx(R,{value:"activities",children:e.jsxs(c,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Activity Filters"}),e.jsx(y,{children:"Filter activities by section, action, user, and time range"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-2 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(ne,{placeholder:"Search activities...",className:"pl-8",value:w,onChange:s=>P(s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Section"}),e.jsxs(L,{value:g.section||"all",onValueChange:s=>W("section",s==="all"?"":s),children:[e.jsx(C,{children:e.jsx(O,{placeholder:"All Sections"})}),e.jsxs(I,{children:[e.jsx(a,{value:"all",children:"All Sections"}),e.jsx(a,{value:"INVENTORY",children:"Inventory"}),e.jsx(a,{value:"SHOWROOM_1",children:"Showroom 1"}),e.jsx(a,{value:"SHOWROOM_2",children:"Showroom 2"}),e.jsx(a,{value:"GARAGE",children:"Garage"}),e.jsx(a,{value:"PDI",children:"PDI"}),e.jsx(a,{value:"FINANCIAL",children:"Financial"}),e.jsx(a,{value:"REPAIRS",children:"Repairs"}),e.jsx(a,{value:"NEW_ARRIVALS",children:"New Arrivals"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Action"}),e.jsxs(L,{value:g.action||"all",onValueChange:s=>W("action",s==="all"?"":s),children:[e.jsx(C,{children:e.jsx(O,{placeholder:"All Actions"})}),e.jsxs(I,{children:[e.jsx(a,{value:"all",children:"All Actions"}),e.jsx(a,{value:"CREATE",children:"Create"}),e.jsx(a,{value:"UPDATE",children:"Update"}),e.jsx(a,{value:"DELETE",children:"Delete"}),e.jsx(a,{value:"VIEW",children:"View"}),e.jsx(a,{value:"UPLOAD",children:"Upload"}),e.jsx(a,{value:"DOWNLOAD",children:"Download"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Time Range"}),e.jsxs(L,{value:T,onValueChange:F,children:[e.jsx(C,{children:e.jsx(O,{})}),e.jsxs(I,{children:[e.jsx(a,{value:"today",children:"Today"}),e.jsx(a,{value:"week",children:"This Week"}),e.jsx(a,{value:"month",children:"This Month"}),e.jsx(a,{value:"all",children:"All Time"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Â "}),e.jsxs(f,{variant:"outline",onClick:K,className:"w-full",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Clear Filters"]})]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(de,{children:[e.jsx(xe,{children:e.jsxs(U,{children:[e.jsx(N,{children:"Time"}),e.jsx(N,{children:"User"}),e.jsx(N,{children:"Action"}),e.jsx(N,{children:"Section"}),e.jsx(N,{children:"Entity"}),e.jsx(N,{children:"Details"})]})}),e.jsx(oe,{children:b.length>0?b.slice(0,100).map(s=>e.jsxs(U,{children:[e.jsx(m,{className:"text-sm",children:A.formatDateTime(s.timestamp)}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.userName}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.userRole})]})]})}),e.jsx(m,{children:e.jsx(v,{className:S(s.action),children:s.action})}),e.jsx(m,{children:e.jsx(v,{className:E(s.section),children:s.section.replace("_"," ")})}),e.jsx(m,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:s.entityType}),s.entityName&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.entityName})]})}),e.jsxs(m,{className:"max-w-md",children:[e.jsx("p",{className:"text-sm truncate",children:s.details}),s.changes&&s.changes.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[s.changes.length," field(s) changed"]})]})]},s.id)):e.jsx(U,{children:e.jsxs(m,{colSpan:6,className:"text-center py-8",children:[e.jsx(me,{className:"h-12 w-12 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"font-medium",children:"No activities found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Try adjusting your filters or time range"})]})})})]})})]})]})}),e.jsx(R,{value:"users",children:e.jsxs(c,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Employee Activity Summary"}),e.jsx(y,{children:"Click on any employee to view their detailed audit logs"})]}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(b.reduce((s,t)=>(s[t.userId]||(s[t.userId]={userName:t.userName,userRole:t.userRole,totalActivities:0,lastActivity:t.timestamp,actions:{}}),s[t.userId].totalActivities++,s[t.userId].actions[t.action]=(s[t.userId].actions[t.action]||0)+1,new Date(t.timestamp)>new Date(s[t.userId].lastActivity)&&(s[t.userId].lastActivity=t.timestamp),s),{})).map(([s,t])=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>window.open(`/employee-audit/${s}`,"_blank"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.userName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.userRole})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[t.totalActivities," activities"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Last: ",A.formatDateTime(t.lastActivity)]}),e.jsx(f,{variant:"outline",size:"sm",className:"mt-2",children:"View Details"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(t.actions).map(([r,o])=>e.jsxs(v,{variant:"outline",className:S(r),children:[r,": ",o]},r))})]},s))})})]})})]})]})};export{we as default};
