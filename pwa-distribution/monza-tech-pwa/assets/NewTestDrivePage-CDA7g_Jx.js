import{u as D,aH as S,a0 as s,j as e,s as w}from"./index-CnqA2hW7.js";function _(){const[v]=D(),i=S(),a=v.get("vehicleId")??"",[l,n]=s.useState(!1),[d,o]=s.useState(null),[c,p]=s.useState(""),[m,b]=s.useState(""),[u,g]=s.useState(30),[h,N]=s.useState(""),f=async t=>{t.preventDefault(),o(null),n(!0);try{if(!a)throw new Error("Missing vehicleId");const r=new Date(c);if(isNaN(r.getTime()))throw new Error("Choose a valid date & time.");const j=new Date(r.getTime()+u*6e4),{error:x}=await w.rpc("rpc_vehicle_move_to_schedule",{p_vehicle_id:a,p_title:"Test Drive",p_reason:h||`Test drive for ${m||"client"}`,p_priority:2,p_start:r.toISOString(),p_end:j.toISOString(),p_assignee_user_id:null});if(x)throw x;i(`/vehicles/${a}`)}catch(r){o(r.message||"Failed to schedule test drive.")}finally{n(!1)}};return e.jsxs("main",{className:"mx-auto max-w-3xl p-6",children:[e.jsxs("header",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Schedule Test Drive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create a test drive job for this vehicle."})]}),e.jsxs("form",{onSubmit:f,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"testDriveDate",className:"block text-sm font-medium",children:"Test Drive Date & Time"}),e.jsx("input",{id:"testDriveDate",type:"datetime-local",value:c,onChange:t=>p(t.target.value),className:"mt-1 w-full h-12 border px-4 rounded-md",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"driverName",className:"block text-sm font-medium",children:"Driver"}),e.jsx("input",{id:"driverName",placeholder:"Driver name",value:m,onChange:t=>b(t.target.value),className:"mt-1 w-full h-12 border px-4 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"duration",className:"block text-sm font-medium",children:"Duration (minutes)"}),e.jsx("input",{id:"duration",type:"number",min:5,value:u,onChange:t=>g(Number(t.target.value)),className:"mt-1 w-full h-12 border px-4 rounded-md",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium",children:"Notes"}),e.jsx("textarea",{id:"notes",placeholder:"Any special requests or route notes…",value:h,onChange:t=>N(t.target.value),className:"mt-1 w-full min-h-[100px] border px-4 py-3 rounded-md"})]}),d&&e.jsx("div",{className:"text-red-600 text-sm border border-red-300 rounded-md p-2 bg-red-50",children:d}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i(-1),className:"h-10 px-4 border rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:l,className:"h-10 px-4 rounded-md bg-monza-yellow text-monza-black disabled:opacity-50",children:l?"Scheduling…":"Schedule Test Drive"})]})]})]})}export{_ as default};
