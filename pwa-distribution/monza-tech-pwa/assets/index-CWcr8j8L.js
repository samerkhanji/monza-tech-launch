import{r as u,ao as V,j as e,b as N,c as y,d as C,aJ as k,f as v,a as S,U as B,L as I,I as _,aK as R,ah as L,aL as M,C as T,an as Y,aM as w,s as A}from"./index-BKWZsjPE.js";import{R as $}from"./realExcelService-DX2RpXSV.js";const J=()=>{const[d,f]=u.useState(!1),[j,o]=u.useState(0),[r,p]=u.useState(null),[c,U]=u.useState(null),{toast:i}=V(),F=t=>{var l;const a=(l=t.target.files)==null?void 0:l[0];a&&(U(a),p(null))},E=async()=>{if(!c){i({title:"No File Selected",description:"Please select a CSV or Excel file to upload.",variant:"destructive"});return}f(!0),o(0);try{i({title:"Processing File",description:"Reading and parsing your data file..."});const t=["VIN Number","Model","Brand","Year","Color","Status","Client Name","Current Floor"],a=await $.importFromExcel(c,t);if(a.errors.length>0&&a.data.length===0)throw new Error(a.errors.join(", "));o(30);const l=a.data.map(s=>({vin_number:s["VIN Number"]||s.vinNumber||s.vin||"",model:s.Model||s.model||"",brand:s.Brand||s.brand||"Voyah",year:parseInt(s.Year||s.year)||new Date().getFullYear(),color:s.Color||s.color||"",status:s.Status||s.status||"in_stock",client_name:s["Client Name"]||s.clientName||"",client_phone:s["Client Phone"]||s.clientPhone||"",client_email:s["Client Email"]||s.clientEmail||"",current_location:s["Current Floor"]||s.currentFloor||"Inventory",selling_price:parseFloat(s.Price||s.price)||5e4,category:s.Category||s.category||"EV",battery_percentage:parseInt(s["Battery %"]||s.batteryPercentage)||100,pdi_completed:s["PDI Completed"]==="true"||s.pdi_completed===!0||!1,notes:s.Notes||s.notes||""}));o(50);const n=10;let m=0;const x=[];for(let s=0;s<l.length;s+=n){const b=l.slice(s,s+n);try{const{data:g,error:h}=await A.from("cars").insert(b);h?(console.error("Supabase insert error:",h),x.push(`Batch ${Math.floor(s/n)+1}: ${h.message}`)):m+=b.length}catch(g){console.error("Batch upload error:",g),x.push(`Batch ${Math.floor(s/n)+1}: Upload failed`)}const P=50+(s+n)/l.length*50;o(Math.min(P,100))}p({total:l.length,successful:m,errors:[...a.errors,...x]}),m>0&&i({title:"Upload Successful!",description:`Successfully uploaded ${m} cars to Supabase database.`})}catch(t){console.error("Upload error:",t),i({title:"Upload Failed",description:t.message||"Failed to upload data. Please check your file format.",variant:"destructive"}),p({total:0,successful:0,errors:[t.message||"Upload failed"]})}finally{f(!1),o(0)}},D=()=>{const t=`VIN Number,Model,Brand,Year,Color,Status,Client Name,Client Phone,Client Email,Current Floor,Price,Category,Battery %,PDI Completed,Notes
LDP95H961SE900001,Free,Voyah,2024,White,available,John Doe,+1234567890,john@example.com,Showroom Floor 1,75000,REEV,95,false,Sample car entry
LDP95C969SY890002,Dream,Voyah,2024,Black,sold,Jane Smith,+1234567891,jane@example.com,Inventory,95000,EV,88,true,Another sample entry`,a=new Blob([t],{type:"text/csv"}),l=window.URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download="car_data_template.csv",n.click(),window.URL.revokeObjectURL(l),i({title:"Template Downloaded",description:"CSV template file has been downloaded. Fill it with your data and upload it back."})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(y,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Upload Data to Supabase"]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Need a template?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Download our CSV template to get started"})]}),e.jsxs(S,{variant:"outline",onClick:D,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Download Template"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"file-upload",children:"Select CSV or Excel file"}),e.jsx(_,{id:"file-upload",type:"file",accept:".csv,.xlsx,.xls",onChange:F,disabled:d}),c&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Selected: ",c.name," (",(c.size/1024).toFixed(1)," KB)"]})]}),e.jsxs(S,{onClick:E,disabled:!c||d,className:"w-full",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),d?"Uploading...":"Upload to Supabase"]}),d&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{value:j,className:"w-full"}),e.jsxs("p",{className:"text-sm text-center text-muted-foreground",children:[j,"% complete"]})]}),r&&e.jsxs(M,{className:r.successful>0?"border-green-200 bg-green-50":"border-red-200 bg-red-50",children:[r.successful>0?e.jsx(T,{className:"h-4 w-4 text-green-600"}):e.jsx(Y,{className:"h-4 w-4 text-red-600"}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-medium",children:["Upload Complete: ",r.successful,"/",r.total," cars uploaded successfully"]}),r.errors.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:"Errors:"}),e.jsxs("ul",{className:"text-sm list-disc list-inside",children:[r.errors.slice(0,5).map((t,a)=>e.jsx("li",{children:t},a)),r.errors.length>5&&e.jsxs("li",{children:["... and ",r.errors.length-5," more errors"]})]})]})]})})]})]})]}),e.jsxs(N,{children:[e.jsx(y,{children:e.jsx(C,{children:"Upload Instructions"})}),e.jsx(v,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium",children:"1"}),e.jsx("p",{className:"text-sm",children:"Download the CSV template or prepare your Excel file with the required columns"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium",children:"2"}),e.jsx("p",{className:"text-sm",children:"Fill in your car data (VIN Number, Model, Brand, Year, Color, etc.)"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium",children:"3"}),e.jsx("p",{className:"text-sm",children:"Upload the file and it will be automatically saved to your Supabase database"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium",children:"4"}),e.jsx("p",{className:"text-sm",children:"Your uploaded cars will appear immediately in all inventory pages"})]})]})})]})]})},K=()=>e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Data Upload"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Upload your car inventory data directly to the Supabase database"})]}),e.jsx(J,{})]});export{K as default};
