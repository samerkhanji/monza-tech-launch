import{r as l,s as B,t as c,u as Me,j as t,B as b,C as le,A as Ae,a as q,Q as $e,b as Re,c as Be,d as qe,e as de,X as ce,T as ze,f as Je,g as He,h as Qe,i as me,k as y,l as Ge,m as x,W as Ke,n as We,F as Ye,o as Xe,M as Ze,p as et,P as tt,V as rt,D as at,q as st,v as ot,w as nt,L as _,I as O,E as it,x as lt,y as dt,z as ct,G as mt,H as gt,J as ut,K as ht,N as pt,O as X}from"./index-CnqA2hW7.js";const vt=()=>({connectedUsers:[],currentPageUsers:[],isConnected:!1,broadcastUpdate:async()=>{},updateUserStatus:async()=>{},subscribe:()=>()=>{}});function ft(){const[a,S]=l.useState([]),[k,w]=l.useState(!0),[I,h]=l.useState(null),[E,U]=l.useState("cars"),{subscribe:D}=vt(),V=async()=>{try{w(!0),h(null);let{data:g,error:m}=await B.from("cars").select("*").order("created_at",{ascending:!1});if(m){const u=await B.from("car_inventory").select("*").order("created_at",{ascending:!1});if(u.error)throw m;U("car_inventory"),g=u.data}else U("cars");S(g||[])}catch(g){h(g instanceof Error?g.message:"Failed to fetch cars"),console.error("Error fetching cars:",g)}finally{w(!1)}},F=async g=>{try{const{data:m,error:u}=await B.from(E).insert([g]).select().single();if(u)throw u;return S(o=>[m,...o]),m}catch(m){return h(m instanceof Error?m.message:"Failed to add car"),console.error("Error adding car:",m),null}},z=async(g,m)=>{try{const{data:u,error:o}=await B.from(E).update({...m,updated_at:new Date().toISOString()}).eq("id",g).select().single();if(o)throw o;return S(n=>n.map(i=>i.id===g?u:i)),u}catch(u){return h(u instanceof Error?u.message:"Failed to update car"),console.error("Error updating car:",u),null}},L=async g=>{try{const{error:m}=await B.from(E).delete().eq("id",g);if(m)throw m;return S(u=>u.filter(o=>o.id!==g)),!0}catch(m){return h(m instanceof Error?m.message:"Failed to delete car"),console.error("Error deleting car:",m),!1}},J=async()=>{await V()};return l.useEffect(()=>{V()},[]),l.useEffect(()=>D(),[D]),{cars:a,loading:k,error:I,refetch:J,addCar:F,updateCar:z,deleteCar:L}}const Z=a=>({id:a.id,vinNumber:a.vin_number||a.vinNumber,model:a.model,brand:a.brand,year:a.year,color:a.color,interiorColor:a.interior_color||a.interiorColor,category:a.category,status:a.status,currentFloor:a.current_location||a.currentLocation||a.currentFloor,arrivalDate:a.arrival_date||a.arrivalDate||new Date().toISOString(),soldDate:a.sold_date||a.soldDate,reservedDate:a.reserved_date||a.reservedDate,sellingPrice:a.selling_price||a.sellingPrice,batteryPercentage:a.battery_percentage||a.batteryPercentage,pdiCompleted:a.pdi_completed||a.pdiCompleted,inShowroom:a.in_showroom||a.inShowroom,showroomNote:a.showroom_note||a.showroomNote,showroomEntryDate:a.showroom_entry_date||a.showroomEntryDate,showroomExitDate:a.showroom_exit_date||a.showroomExitDate,clientName:a.client_name||a.clientName,clientPhone:a.client_phone||a.clientPhone,clientLicensePlate:a.client_license_plate||a.clientLicensePlate,clientEmail:a.client_email||a.clientEmail,clientAddress:a.client_address||a.clientAddress,pdiTechnician:a.pdi_technician||a.pdiTechnician,pdiNotes:a.pdi_notes||a.pdiNotes,pdiPhotos:a.pdi_photos||a.pdiPhotos,pdiDate:a.pdi_date||a.pdiDate,notes:a.notes,lastUpdated:a.last_updated||a.lastUpdated||new Date().toISOString()}),yt=()=>{const{cars:a,loading:S,error:k,addCar:w,updateCar:I,refetch:h}=ft(),[E,U]=l.useState([]),[D,V]=l.useState(!1);return l.useEffect(()=>{if(!S&&!D){let o=[];if(a&&a.length>0)o=a.map(Z),console.log(`Car Inventory: Loaded ${o.length} cars from Supabase`);else try{const n=localStorage.getItem("carInventory"),i=localStorage.getItem("showroomFloor1Cars"),j=localStorage.getItem("showroomFloor2Cars"),H=localStorage.getItem("garageCars"),M=localStorage.getItem("inventoryFloor2Cars"),Q=[...n?JSON.parse(n):[],...i?JSON.parse(i):[],...j?JSON.parse(j):[],...H?JSON.parse(H):[],...M?JSON.parse(M):[]];Q.length>0?(o=Q.map(Z),console.log(`Car Inventory: Loaded ${o.length} cars from localStorage fallback`)):console.log("Car Inventory: No data found in Supabase or localStorage")}catch(n){console.error("Error loading from localStorage:",n)}U(o),V(!0)}},[a,S,D]),l.useEffect(()=>{if(D&&a&&a.length>0){const o=a.map(Z);U(o)}},[a,D]),{cars:E,loading:S,error:k,handleStatusUpdate:async(o,n)=>{try{const i={status:n,soldDate:n==="sold"?new Date().toISOString():void 0,reservedDate:n==="reserved"?new Date().toISOString():void 0,lastUpdated:new Date().toISOString()};await I(o,i),c({title:"Status Updated",description:`Car status updated to ${n.replace("_"," ")}.`})}catch(i){console.error("Error updating car status:",i),c({title:"Update Failed",description:"Failed to update car status. Please try again.",variant:"destructive"})}},handleShowroomToggle:async(o,n,i)=>{try{const j={inShowroom:n,showroomNote:i,showroomEntryDate:n?new Date().toISOString():void 0,showroomExitDate:n?void 0:new Date().toISOString(),lastUpdated:new Date().toISOString()};await I(o,j),c({title:"Showroom Status Updated",description:`Car ${n?"added to":"removed from"} showroom.`})}catch(j){console.error("Error updating showroom status:",j),c({title:"Update Failed",description:"Failed to update showroom status. Please try again.",variant:"destructive"})}},handleClientInfoSave:async(o,n)=>{try{const i={...n,lastUpdated:new Date().toISOString()};await I(o,i),c({title:"Client Information Saved",description:"Client information has been updated successfully."})}catch(i){console.error("Error saving client info:",i),c({title:"Save Failed",description:"Failed to save client information. Please try again.",variant:"destructive"})}},handlePdiComplete:async(o,n)=>{try{const i={pdiCompleted:!0,pdiTechnician:n.technician,pdiNotes:n.notes,pdiPhotos:n.photos,pdiDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};await I(o,i),c({title:"PDI Completed",description:`PDI completed successfully by ${n.technician}.`})}catch(i){console.error("Error completing PDI:",i),c({title:"PDI Update Failed",description:"Failed to complete PDI. Please try again.",variant:"destructive"})}},handleCarUpdate:async(o,n)=>{try{const i={...n,lastUpdated:new Date().toISOString()};await I(o,i),c({title:"Car Updated",description:"Car information has been updated successfully."})}catch(i){console.error("Error updating car:",i),c({title:"Update Failed",description:"Failed to update car information. Please try again.",variant:"destructive"})}},addCarQuick:async o=>{const n={vin_number:o.vinNumber,model:o.model,brand:o.brand,year:o.year,color:o.color,interior_color:o.interiorColor,category:o.category,status:o.status||"in_stock",arrival_date:o.arrivalDate||new Date().toISOString(),selling_price:o.sellingPrice??o.price,battery_percentage:o.batteryPercentage,pdi_completed:o.pdiCompleted,notes:o.notes};return Object.keys(n).forEach(i=>{n[i]===void 0&&delete n[i]}),await w(n)},loadCars:async()=>{try{await h()}catch(o){console.error("Error loading cars:",o),c({title:"Load Failed",description:"Failed to load car inventory. Please refresh the page.",variant:"destructive"})}}}},wt=()=>{const{cars:a,handleCarUpdate:S,addCarQuick:k}=yt(),w=a.map(e=>{let r="in_stock";e.status==="sold"?r="sold":e.status==="reserved"?r="reserved":r="in_stock";const p=["EV","REV","ICEV"].includes(e.category)?e.category:"EV";return{id:e.id,vinNumber:e.vinNumber,model:e.model,year:e.year,color:e.color,interiorColor:e.interior_color||e.interiorColor||"",price:e.sellingPrice||0,status:r,category:p,batteryPercentage:e.batteryPercentage||100,range:e.range||520,features:e.features||[],arrivalDate:e.arrivalDate||new Date().toISOString(),pdiCompleted:e.pdiCompleted,pdiStatus:e.pdiCompleted?"completed":"pending",pdiTechnician:e.pdiTechnician,pdiDate:e.pdiDate,pdiNotes:e.pdiNotes,testDriveInfo:e.testDriveInfo,customs:e.customs==="paid"?"paid":"not paid",brand:e.brand,currentFloor:e.current_location||e.category,purchasePrice:e.purchase_price,clientName:e.client_name,clientPhone:e.client_phone,clientLicensePlate:e.client_license_plate,expectedDeliveryDate:e.expected_delivery_date,notes:e.notes,lastModified:e.updated_at,softwareVersion:Math.random()>.5?e.softwareVersion||"2.1.0":void 0,softwareLastUpdated:Math.random()>.5?e.softwareLastUpdated||"2024-01-15":void 0,softwareUpdateBy:Math.random()>.5?e.softwareUpdateBy||"IT Team":void 0,softwareUpdateNotes:Math.random()>.5?e.softwareUpdateNotes||"Routine update":void 0}}),[I]=Me(),h=I.get("filter"),E=()=>{switch(h){case"ready":return w.filter(e=>e.status==="sold"||e.pdiStatus==="completed"||e.currentFloor==="showroom"||e.pdiCompleted===!0);case"attention":return w.filter(e=>{var r,s,p;return e.status==="reserved"||e.pdiStatus==="failed"||e.customs==="not paid"||e.softwareVersion===void 0||((r=e.notes)==null?void 0:r.toLowerCase().includes("issue"))||((s=e.notes)==null?void 0:s.toLowerCase().includes("problem"))||((p=e.notes)==null?void 0:p.toLowerCase().includes("repair"))});default:return w}},[U,D]=l.useState(!1),[V,F]=l.useState(!1),[z,L]=l.useState(!1),[J,g]=l.useState(!1),[m,u]=l.useState(!1),[o,n]=l.useState(!1),[i,j]=l.useState(!1),[H,M]=l.useState(!1),[Q,ee]=l.useState(!1),[ge,W]=l.useState(!1),[te,re]=l.useState(null),[ae,Y]=l.useState(null),[d,v]=l.useState(null),[ue,se]=l.useState(!1),[P,oe]=l.useState(null),[he,ne]=l.useState(!1),[G,pe]=l.useState(""),K=(()=>{const e=E();if(!G.trim())return e;const r=G.toLowerCase();return e.filter(s=>{var p,C,T,$,R;return s.vinNumber.toLowerCase().includes(r)||s.model.toLowerCase().includes(r)||s.color.toLowerCase().includes(r)||(((p=s.interiorColor)==null?void 0:p.toLowerCase().includes(r))??!1)||s.category.toLowerCase().includes(r)||s.status.toLowerCase().includes(r)||((C=s.brand)==null?void 0:C.toLowerCase().includes(r))||((T=s.clientName)==null?void 0:T.toLowerCase().includes(r))||(($=s.clientPhone)==null?void 0:$.toLowerCase().includes(r))||((R=s.notes)==null?void 0:R.toLowerCase().includes(r))||s.year.toString().includes(r)||s.price.toString().includes(r)})})(),[f,N]=l.useState({vinNumber:"",model:"Voyah Dream",year:2024,color:"",price:0,status:"available",category:"EV",batteryPercentage:100,range:520,pdiStatus:"pending",customs:"not paid",horsePower:350,torque:500,acceleration:"4.5",topSpeed:250,chargingTime:"30 minutes",warranty:"4 years / 80,000 km"}),ve=async e=>{const r=w.some(s=>s.vinNumber===e);if(!r){const s={vinNumber:e,model:`Vehicle ${e.slice(-4)}`,year:new Date().getFullYear(),color:"Unknown",category:"EV",status:"in_stock",arrivalDate:new Date().toISOString(),batteryPercentage:100,range:0};await k(s)}D(!1),c({title:"VIN Scanned",description:`VIN ${e} ${r?"found":"added to inventory"}`})},fe=(e,r,s)=>{c({title:"Car Moved",description:`Car moved from ${r} to ${s}`})},ye=e=>{c({title:"Car Added",description:"Car has been added to inventory"})},xe=async()=>{await k({vinNumber:f.vinNumber,model:f.model,year:f.year,color:f.color,category:f.category,status:"in_stock",arrivalDate:new Date().toISOString(),batteryPercentage:f.batteryPercentage,range:f.range,sellingPrice:f.price}),F(!1),N({vinNumber:"",model:"Voyah Dream",year:2024,color:"",price:0,status:"available",category:"EV",batteryPercentage:100,range:520,pdiStatus:"pending",customs:"not paid",horsePower:350,torque:500,acceleration:"4.5",topSpeed:250,chargingTime:"30 minutes",warranty:"4 years / 80,000 km"}),c({title:"Car Added",description:"Car has been added to inventory"})},A=(e,r)=>{const s={...r,sellingPrice:r.price,status:r.status==="available"?"in_stock":r.status,customs:r.customs==="paid"?"paid":"not_paid",softwareVersion:r.softwareVersion,softwareLastUpdated:r.softwareLastUpdated,softwareUpdateBy:r.softwareUpdateBy,softwareUpdateNotes:r.softwareUpdateNotes};S(e,s),L(!1),v(null),c({title:"Car Updated",description:"Car details have been updated"})},we=(e,r)=>{if(d){if(console.log(`Moving car ${d.id} to ${e} with notes: ${r}`),e==="garage-schedule"){const s={vinNumber:d.vinNumber,model:d.model,brand:d.brand,year:d.year,color:d.color,status:"waiting",priority:"normal",estimatedDuration:120,notes:r||"Moved from Car Inventory",clientName:d.clientName||"",clientPhone:d.clientPhone||"",arrivalTime:new Date().toISOString(),scheduledTime:new Date().toISOString()},p=localStorage.getItem("garageSchedule"),C=p?JSON.parse(p):{scheduledCars:[]},T={...s,id:Date.now().toString()};C.scheduledCars.push(T),localStorage.setItem("garageSchedule",JSON.stringify(C));const $={...d,id:`garage-${Date.now()}`,status:"in_stock",garageStatus:"stored",currentFloor:"Garage",repairStatus:"pending",assignedMechanic:"",estimatedCompletion:"",repairNotes:r||"Moved from Car Inventory",lastModified:new Date().toISOString()},R=localStorage.getItem("garageCars"),ie=R?JSON.parse(R):[];ie.push($),localStorage.setItem("garageCars",JSON.stringify(ie)),c({title:"Car Added to Garage Schedule",description:`${d.model} has been added to the garage schedule and inventory for service/repair.`})}else c({title:"Car Moved",description:`${d.model} has been moved`});g(!1),v(null)}},De=e=>{Y(e),W(!0)},Se=e=>{v(e),j(!0)},Ce=e=>{const r=e.status==="reserved"||e.status==="sold",s=e.expectedDeliveryDate;r&&s&&!e.pdiCompleted||!e.pdiCompleted?(v(e),setTimeout(()=>M(!0),0)):Se(e)},je=e=>{u(!1),v(e),n(!0)},Ne=e=>{se(e),n(!1),requestAnimationFrame(()=>{u(!0)})},be=(e,r)=>{A(e,{testDriveInfo:{...r,isOnTestDrive:!0}}),c({title:"Test Drive Scheduled",description:`${r.isClientTestDrive?"Client":"Employee"} test drive scheduled`}),u(!1),v(null)},Ie=e=>{const r=w.find($=>$.id===e);if(!r||!r.testDriveInfo)return;const s={isOnTestDrive:r.testDriveInfo.isOnTestDrive,testDriveStartTime:r.testDriveInfo.testDriveStartTime,testDriverName:r.testDriveInfo.testDriverName,testDriverPhone:r.testDriveInfo.testDriverPhone,testDriverLicense:r.testDriveInfo.testDriverLicense,notes:r.testDriveInfo.notes,purpose:r.testDriveInfo.purpose||"Test drive",isClientTestDrive:r.testDriveInfo.isClientTestDrive||!1,loggedBy:r.testDriveInfo.loggedBy||"System",loggedByName:r.testDriveInfo.loggedByName||"System User",loggedAt:r.testDriveInfo.loggedAt||new Date().toISOString(),emergencyContact:r.testDriveInfo.emergencyContact,emergencyContactPhone:r.testDriveInfo.emergencyContactPhone,vehicleVin:r.vinNumber,vehicleModel:r.model},p=X.endTestDrive(s),C=X.addToHistory(r,p);A(e,{testDriveInfo:void 0,testDriveHistory:C.testDriveHistory});const T=X.formatDuration(p.actualDuration||0);c({title:"Test Drive Completed",description:`Test drive completed in ${T}. Added to vehicle history.`})},Pe=(e,r)=>{A(e,{pdiCompleted:!0,pdiTechnician:r.technician,pdiNotes:r.notes,pdiPhotos:r.photos,pdiDate:new Date().toISOString()}),c({title:"PDI Completed",description:"Pre-Delivery Inspection has been completed successfully."})},_e=e=>{re(e),ee(!0)},Te=(e,r,s)=>{var C;A(e,{status:r,...s,lastUpdated:new Date().toISOString()});const p=(C=w.find(T=>T.id===e))==null?void 0:C.model;c({title:"Car Status Updated",description:`${p} status updated to ${r.replace("_"," ")}`})},Ee=e=>{Y(e),W(!0)},Ue=(e,r)=>{S(e,r)},Fe=e=>{oe(e),ne(!0)},Oe=(e,r)=>{S(e,{...r,lastUpdated:new Date().toISOString()}),c({title:"Software Updated",description:"Car software information has been updated"})},ke=e=>{switch(e){case"available":case"in_stock":return"bg-green-100 text-green-800 border-green-200";case"sold":return"bg-blue-100 text-blue-800 border-blue-200";case"reserved":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},Ve=e=>{switch(e){case"available":case"in_stock":return"Available";case"reserved":return"Reserved";case"sold":return"Sold";default:return e}},Le=e=>{switch(e){case"EV":return"category-ev";case"REV":return"category-rev";case"ICEV":return"category-icev";default:return"bg-gray-400 text-white"}};return t.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Car Inventory"}),h&&t.jsxs(b,{variant:"outline",className:"text-sm font-medium",children:[h==="ready"&&t.jsxs(t.Fragment,{children:[t.jsx(le,{className:"w-4 h-4 mr-1"}),"Ready Cars"]}),h==="attention"&&t.jsxs(t.Fragment,{children:[t.jsx(Ae,{className:"w-4 h-4 mr-1"}),"Need Attention"]})]})]}),t.jsxs("p",{className:"text-gray-600 mt-1",children:[h==="ready"&&"Cars ready for delivery and completed processing",h==="attention"&&"Cars requiring immediate attention or action",!h&&"Manage your car inventory and track vehicle details"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(q,{onClick:()=>D(!0),variant:"outline",className:"flex items-center gap-2 border-green-200 text-green-700 hover:bg-green-50",children:[t.jsx($e,{className:"h-4 w-4"}),"VIN Scanner"]}),t.jsx(q,{onClick:()=>F(!0),className:"flex items-center gap-2 bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:"Add Car Manually"})]})]}),t.jsxs(Re,{children:[t.jsx(Be,{children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs(qe,{className:"flex items-center gap-2",children:[t.jsx(de,{className:"h-5 w-5"}),h==="ready"&&`Ready Cars (${K.length})`,h==="attention"&&`Cars Needing Attention (${K.length})`,!h&&`Car Inventory (${K.length} ${G?`of ${w.length}`:""})`]}),t.jsxs("div",{className:"flex items-center gap-2",children:[h&&t.jsxs(q,{variant:"outline",size:"sm",onClick:()=>window.location.href="/car-inventory",className:"text-xs",children:[t.jsx(ce,{className:"h-3 w-3 mr-1"}),"Clear Filter"]}),t.jsx(ze,{id:"car-inventory-search",value:G,onChange:pe,placeholder:"Search VINs, models, clients, colors...",className:"w-full sm:w-auto"})]})]})}),t.jsx(Je,{children:t.jsx("div",{className:"rounded-md border",children:t.jsxs(He,{children:[t.jsx(Qe,{children:t.jsxs(me,{className:"bg-gray-50",children:[t.jsx(y,{className:"font-semibold",children:"VIN"}),t.jsx(y,{className:"font-semibold",children:"Model"}),t.jsx(y,{className:"font-semibold",children:"Category"}),t.jsx(y,{className:"font-semibold",children:"Year"}),t.jsx(y,{className:"font-semibold",children:"Color"}),t.jsx(y,{className:"font-semibold",children:"Color interior"}),t.jsx(y,{className:"font-semibold",children:"Price"}),t.jsx(y,{className:"font-semibold",children:"Status"}),t.jsx(y,{className:"font-semibold",children:"Warranty Life"}),t.jsx(y,{className:"font-semibold",children:"Battery"}),t.jsx(y,{className:"font-semibold",children:"Range Capacity"}),t.jsx(y,{className:"font-semibold",children:"Km Driven"}),t.jsx(y,{className:"font-semibold",children:"Test Drive"}),t.jsx(y,{className:"font-semibold",children:"PDI"}),t.jsx(y,{className:"font-semibold",children:"Customs"}),t.jsx(y,{className:"font-semibold",children:"Software Model"}),t.jsx(y,{className:"font-semibold",children:"Actions"})]})}),t.jsx(Ge,{children:K.map(e=>{var r;return t.jsxs(me,{className:"hover:bg-gray-50",children:[t.jsx(x,{className:"font-mono text-sm",children:e.vinNumber}),t.jsx(x,{className:"font-medium",children:e.model}),t.jsx(x,{children:t.jsx(b,{className:Le(e.category),children:e.category})}),t.jsx(x,{children:e.year}),t.jsx(x,{children:e.color}),t.jsx(x,{children:e.interiorColor||e.color||"-"}),t.jsxs(x,{className:"font-medium",children:["$",e.price.toLocaleString()]}),t.jsx(x,{children:t.jsx(b,{className:`${ke(e.status)} cursor-pointer hover:opacity-80 transition-all hover:scale-105 active:scale-95`,onClick:s=>{s.preventDefault(),s.stopPropagation(),_e(e)},title:"Click to change status",children:Ve(e.status)})}),t.jsx(x,{children:t.jsx(Ke,{warrantyStartDate:e.warrantyStartDate,warrantyEndDate:e.warrantyEndDate,warrantyMonthsRemaining:e.warrantyMonthsRemaining,warrantyDaysRemaining:e.warrantyDaysRemaining,warrantyStatus:e.warrantyStatus,compact:!0})}),t.jsx(x,{children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(We,{className:"h-4 w-4"}),e.batteryPercentage,"%"]})}),t.jsx(x,{children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ye,{className:"h-4 w-4"}),e.range," km"]})}),t.jsx(x,{children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ze,{className:"h-4 w-4"}),Xe.getKilometersDriven(e.id)," km"]})}),t.jsx(x,{children:(r=e.testDriveInfo)!=null&&r.isOnTestDrive?t.jsxs(b,{className:"bg-blue-100 text-blue-800 border-blue-200 cursor-pointer hover:opacity-80 transition-opacity",onClick:s=>{s.preventDefault(),s.stopPropagation(),Ie(e.id)},title:"Click to end test drive",children:[t.jsx(et,{className:"mr-1 h-3 w-3"}),e.testDriveInfo.isClientTestDrive?"Client":"Employee"," Test Drive"]}):e.status==="sold"||e.status==="reserved"?t.jsx(b,{variant:"outline",className:"bg-gray-50 text-gray-500",children:"Not Available"}):t.jsx(b,{variant:"outline",className:"bg-gray-50 text-gray-500 cursor-pointer hover:bg-blue-50 hover:text-blue-600 transition-colors",onClick:s=>{s.preventDefault(),s.stopPropagation(),je(e)},title:"Click to schedule test drive",children:"Available"})}),t.jsx(x,{children:t.jsx("div",{className:"cursor-pointer",onClick:s=>{s.preventDefault(),s.stopPropagation(),Ce(e)},children:t.jsx(b,{variant:e.pdiCompleted?"default":"outline",className:`cursor-pointer hover:opacity-80 transition-opacity ${e.pdiCompleted?"bg-green-100 text-green-800 border-green-200":"bg-yellow-100 text-yellow-800 border-yellow-200"}`,children:e.pdiCompleted?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-1 text-lg",children:"☺"})," Complete"]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"mr-1 text-lg",children:"☹"})," Pending"]})})})}),t.jsx(x,{children:t.jsx(b,{variant:e.customs==="paid"?"default":"destructive",className:"cursor-pointer hover:opacity-80 transition-opacity active:scale-95",onClick:s=>{s.preventDefault(),s.stopPropagation(),Ee(e)},title:"Click to manage customs payment",children:e.customs==="paid"?t.jsxs(t.Fragment,{children:[t.jsx(le,{className:"mr-1 h-4 w-4"})," paid"]}):t.jsxs(t.Fragment,{children:[t.jsx(ce,{className:"mr-1 h-4 w-4"})," ",e.customs||"not paid"]})})}),t.jsx(x,{children:t.jsx("div",{className:"flex items-center gap-1 text-xs cursor-pointer",onClick:()=>Fe(e),title:"Click to manage software updates",children:e.softwareVersion?t.jsxs(t.Fragment,{children:[t.jsxs(b,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:["v",e.softwareVersion]}),e.softwareLastUpdated&&t.jsx("span",{className:"text-gray-500",children:new Date(e.softwareLastUpdated).toLocaleDateString()})]}):t.jsx(b,{variant:"secondary",className:"text-xs text-yellow-700 bg-yellow-100 hover:bg-yellow-200 transition-colors",children:"Update Needed"})})}),t.jsx(x,{children:t.jsx(tt,{options:[{value:"details",label:"View Details"},{value:"edit",label:"Edit Car"},{value:"move",label:"Move Car"}],onAction:s=>{s==="details"?De(e):s==="edit"?(v(e),L(!0)):s==="move"&&(v(e),g(!0))},id:`actions-${e.id}`,ariaLabel:`Actions for ${e.model} ${e.vinNumber}`})})]},e.id)})})]})})})]}),t.jsx(rt,{isOpen:U,onClose:()=>D(!1),onVinScanned:ve,targetLocation:"Inventory",onCarMoved:fe,onCarAdded:ye,onTestDrive:(e,r)=>{const s={id:e.id,vinNumber:e.vin_number,model:e.model,year:e.year,color:e.color,price:e.selling_price,status:e.status,category:e.category,batteryPercentage:e.battery_percentage||100,range:e.range_km||0,features:[],arrivalDate:e.arrival_date,pdiCompleted:e.pdi_completed,pdiTechnician:e.pdi_technician,pdiDate:e.pdi_date,pdiNotes:e.notes,testDriveInfo:{isOnTestDrive:e.test_drive_status},customs:e.customs==="not_paid"?"not paid":e.customs==="paid"?"paid":void 0};v(s),se(r),n(!0),D(!1)},onPdiAction:e=>{const r={id:e.id,vinNumber:e.vin_number,model:e.model,year:e.year,color:e.color,price:e.selling_price,status:e.status,category:e.category,batteryPercentage:e.battery_percentage||100,range:e.range_km||0,features:[],arrivalDate:e.arrival_date,pdiCompleted:e.pdi_completed,pdiTechnician:e.pdi_technician,pdiDate:e.pdi_date,pdiNotes:e.notes,testDriveInfo:{isOnTestDrive:e.test_drive_status},customs:e.customs==="not_paid"?"not paid":e.customs==="paid"?"paid":"not paid"};v(r),j(!0),D(!1)}}),t.jsx(at,{open:V,onOpenChange:F,children:t.jsxs(st,{className:"sm:max-w-[600px]",children:[t.jsx(ot,{children:t.jsxs(nt,{className:"flex items-center gap-2",children:[t.jsx(de,{className:"h-5 w-5"}),"Add Car to Inventory"]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(_,{htmlFor:"vinNumber",children:"VIN Number *"}),t.jsx(O,{id:"vinNumber",value:f.vinNumber,onChange:e=>N(r=>({...r,vinNumber:e.target.value})),placeholder:"Enter VIN number",required:!0})]}),t.jsxs("div",{children:[t.jsx(_,{htmlFor:"model",children:"Model *"}),t.jsx(O,{id:"model",value:f.model,onChange:e=>N(r=>({...r,model:e.target.value})),placeholder:"Enter model name",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(_,{htmlFor:"year",children:"Year *"}),t.jsx(O,{id:"year",type:"number",min:"2020",max:"2030",value:f.year,onChange:e=>N(r=>({...r,year:parseInt(e.target.value)})),required:!0})]}),t.jsxs("div",{children:[t.jsx(_,{htmlFor:"color",children:"Color *"}),t.jsx(O,{id:"color",value:f.color,onChange:e=>N(r=>({...r,color:e.target.value})),placeholder:"e.g., Midnight Silver",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(_,{htmlFor:"category",children:"Category *"}),t.jsxs("select",{id:"category",value:f.category,onChange:e=>N(r=>({...r,category:e.target.value})),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",required:!0,children:[t.jsx("option",{value:"EV",children:"EV (Electric Vehicle)"}),t.jsx("option",{value:"REV",children:"REV (Range Extended Vehicle)"}),t.jsx("option",{value:"ICEV",children:"ICEV (Internal Combustion Engine)"})]})]}),t.jsxs("div",{children:[t.jsx(_,{htmlFor:"price",children:"Price (USD) *"}),t.jsx(O,{id:"price",type:"number",min:"0",value:f.price,onChange:e=>N(r=>({...r,price:parseInt(e.target.value)})),placeholder:"e.g., 85000",required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(_,{htmlFor:"status",children:"Status"}),t.jsxs("select",{id:"status",value:f.status,onChange:e=>N(r=>({...r,status:e.target.value})),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2",children:[t.jsx("option",{value:"available",children:"Available"}),t.jsx("option",{value:"sold",children:"Sold"}),t.jsx("option",{value:"reserved",children:"Reserved"}),t.jsx("option",{value:"pending",children:"Pending"})]})]}),t.jsxs("div",{children:[t.jsx(_,{htmlFor:"batteryPercentage",children:"Battery %"}),t.jsx(O,{id:"batteryPercentage",type:"number",min:"0",max:"100",value:f.batteryPercentage,onChange:e=>N(r=>({...r,batteryPercentage:parseInt(e.target.value)}))})]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.jsxs("div",{children:[t.jsx(_,{htmlFor:"range",children:"Range (km)"}),t.jsx(O,{id:"range",type:"number",min:"0",value:f.range,onChange:e=>N(r=>({...r,range:parseInt(e.target.value)})),placeholder:"e.g., 520"})]})})]}),t.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[t.jsx(q,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),t.jsx(q,{onClick:xe,className:"bg-monza-yellow text-monza-black hover:bg-monza-yellow/90",children:"Add Car"})]})]})}),d&&t.jsx(it,{isOpen:z,onClose:()=>{L(!1),v(null)},car:d,onSave:A}),d&&t.jsx(lt,{isOpen:J,onClose:()=>{g(!1),v(null)},car:d,onMoveCar:we}),d&&t.jsx(dt,{isOpen:i,onClose:()=>{j(!1),v(null)},car:d,onPdiComplete:Pe}),d&&t.jsx(ct,{isOpen:H,onClose:()=>{M(!1),v(null)},car:d,onSave:(e,r)=>{A(e,{pdiCompleted:r,pdiDate:new Date().toISOString()}),M(!1),v(null)}}),d&&t.jsx(mt,{isOpen:o,onClose:()=>{n(!1),v(null)},onSelectTestDriveType:Ne,carModel:d.model,carVin:d.vinNumber}),d&&t.jsx(gt,{isOpen:m,onClose:()=>{u(!1),v(null)},car:{...d,currentFloor:d.currentFloor||"Inventory"},onScheduleTestDrive:be,isClientTestDrive:ue}),te&&t.jsx(ut,{isOpen:Q,onClose:()=>{ee(!1),re(null)},car:te,onStatusUpdate:Te}),ae&&t.jsx(ht,{isOpen:ge,onClose:()=>{W(!1),Y(null)},car:ae,onCarUpdate:Ue}),t.jsx(pt,{isOpen:he,onClose:()=>{ne(!1),oe(null)},car:P?{vinNumber:P.vinNumber,model:P.model,currentVersion:P.softwareVersion,lastUpdated:P.softwareLastUpdated,lastUpdatedBy:P.softwareUpdateBy,notes:P.softwareUpdateNotes,needsUpdate:!P.softwareVersion,priority:P.softwareVersion?"medium":"critical"}:null,onUpdateComplete:(e,r)=>{var p;const s=(p=w.find(C=>C.vinNumber===e))==null?void 0:p.id;s&&Oe(s,r)}})]})};export{wt as default};
