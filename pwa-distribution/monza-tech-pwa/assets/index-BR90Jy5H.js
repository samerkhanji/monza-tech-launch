import{r as c,s as j,t as l,j as e,h as m,aG as h,b3 as E,b0 as D,I as T,k,bU as L,l as P,m as o,n as r,w as H,i as f,ad as I,M as B,o as F,p as t,bS as N,ae as U,B as i,aw as A,bT as M}from"./index-D4jk50_k.js";const Z=()=>{const[d,v]=c.useState([]),[y,p]=c.useState(!1),[x,w]=c.useState("");console.log("InventoryHistoryPage component is rendering"),c.useEffect(()=>{console.log("InventoryHistoryPage useEffect triggered"),u()},[]);const u=async()=>{try{p(!0),console.log("Loading parts usage history...");const{data:s,error:a}=await j.from("parts_usage_tracking").select("*").order("usage_date",{ascending:!1});if(a){console.error("Error loading parts usage history:",a),l({title:"Error",description:"Failed to load parts usage history",variant:"destructive"});return}console.log("Parts usage history loaded:",s),v(s||[])}catch(s){console.error("Error loading parts usage history:",s),l({title:"Error",description:"Failed to load parts usage history",variant:"destructive"})}finally{p(!1)}},g=async()=>{try{const s=[{part_number:"BRK-001",part_name:"Brake Pad Set Front",quantity:1,car_vin:"WVWZZZ1JZ3W386752",car_model:"Tesla Model 3",client_name:"John Smith",client_phone:"+1234567890",client_license_plate:"ABC123",technician:"Mike Johnson",usage_date:new Date().toISOString(),arrival_date:new Date(Date.now()-6048e5).toISOString(),cost_per_unit:150,total_cost:150,location_used:"garage",repair_type:"Brake Replacement",notes:"Standard brake pad replacement"}],{error:a}=await j.from("parts_usage_tracking").insert(s);if(a){console.error("Error creating sample data:",a),l({title:"Error",description:"Failed to create sample data",variant:"destructive"});return}l({title:"Sample Data Created",description:"Sample parts usage data has been added"}),u()}catch(s){console.error("Error creating sample data:",s),l({title:"Error",description:"Failed to create sample data",variant:"destructive"})}},n=d.filter(s=>{if(!x)return!0;const a=x.toLowerCase();return s.part_name.toLowerCase().includes(a)||s.part_number.toLowerCase().includes(a)||s.car_vin.toLowerCase().includes(a)||s.client_name.toLowerCase().includes(a)||s.technician.toLowerCase().includes(a)||s.car_model&&s.car_model.toLowerCase().includes(a)||s.repair_type&&s.repair_type.toLowerCase().includes(a)}),_=s=>{if(!s)return"N/A";try{return M(new Date(s),"MMM d, yyyy")}catch{return s}},b=s=>{if(!s)return e.jsx(i,{variant:"outline",children:"N/A"});const S={garage:"bg-blue-100 text-blue-800",showroom:"bg-green-100 text-green-800","floor 1":"bg-purple-100 text-purple-800","floor 2":"bg-orange-100 text-orange-800"}[s.toLowerCase()]||"bg-gray-100 text-gray-800";return e.jsx(i,{variant:"outline",className:S,children:s})},C=()=>{l({title:"Export Feature",description:"Excel export functionality will be implemented soon."})};return console.log("Rendering InventoryHistoryPage with history length:",d.length),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Parts Usage History"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Complete tracking of parts usage with client and car details"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:g,children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Add Sample Data"]}),e.jsxs(m,{variant:"outline",onClick:C,children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Export to Excel"]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(D,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(T,{placeholder:"Search parts, VIN, client, technician...",className:"pl-9",value:x,onChange:s=>w(s.target.value)})]})}),e.jsx("div",{className:"bg-white rounded-lg border shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(k,{children:[e.jsx(L,{children:n.length>0?`Showing ${n.length} parts usage records`:"No parts usage records found. Add sample data to see how it works."}),e.jsx(P,{children:e.jsxs(o,{children:[e.jsx(r,{className:"min-w-[140px]",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-4 w-4"}),"Usage Date & Time"]})}),e.jsx(r,{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"h-4 w-4"}),"Part Details"]})}),e.jsx(r,{children:"Quantity Used"}),e.jsx(r,{className:"min-w-[180px]",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-4 w-4"}),"Car Information"]})}),e.jsx(r,{className:"min-w-[150px]",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-4 w-4"}),"Client Details"]})}),e.jsx(r,{children:"Technician"}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4"}),"Location"]})}),e.jsx(r,{children:"Cost Information"}),e.jsx(r,{children:"Arrival Date"})]})}),e.jsx(F,{children:y?e.jsx(o,{children:e.jsx(t,{colSpan:9,className:"text-center py-8",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(N,{className:"h-6 w-6 text-muted-foreground mr-2 animate-spin"}),"Loading parts usage history..."]})})}):n.length>0?n.map(s=>e.jsxs(o,{children:[e.jsx(t,{children:e.jsx("div",{className:"text-sm font-medium",children:U.formatDateTime(s.usage_date)})}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:s.part_name}),e.jsx("div",{className:"text-xs text-muted-foreground font-mono",children:s.part_number}),s.repair_type&&e.jsx(i,{variant:"outline",className:"text-xs",children:s.repair_type})]})}),e.jsx(t,{children:e.jsx(i,{variant:"secondary",className:"font-semibold",children:s.quantity})}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-3 w-3"}),e.jsx("span",{className:"font-mono text-xs",children:s.car_vin})]}),s.car_model&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.car_model}),s.client_license_plate&&e.jsx(i,{variant:"outline",className:"text-xs",children:s.client_license_plate})]})}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:s.client_name}),s.client_phone&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(A,{className:"h-3 w-3"}),e.jsx("span",{children:s.client_phone})]})]})}),e.jsx(t,{children:e.jsx(i,{variant:"outline",children:s.technician})}),e.jsx(t,{children:b(s.location_used)}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-1",children:[s.cost_per_unit&&e.jsxs("div",{className:"text-sm",children:["$",s.cost_per_unit.toFixed(2),"/unit"]}),s.total_cost&&e.jsxs("div",{className:"font-medium text-green-600",children:["$",s.total_cost.toFixed(2)]})]})}),e.jsx(t,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:_(s.arrival_date)})})]},s.id)):e.jsx(o,{children:e.jsx(t,{colSpan:9,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(N,{className:"h-12 w-12 text-muted-foreground"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-lg",children:"No Parts Usage History Found"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"This table will show detailed records of parts usage including usage date & time, part details, quantities, car information, client details, technician info, location, cost information, and arrival dates."})]}),e.jsxs(m,{onClick:g,className:"mt-4",children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Add Sample Data to Get Started"]})]})})})})]})})}),n.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Showing ",n.length," of ",d.length," records"]})]})};export{Z as default};
