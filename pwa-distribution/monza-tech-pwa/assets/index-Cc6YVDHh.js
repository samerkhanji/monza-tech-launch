var at=Object.defineProperty;var rt=(n,a,s)=>a in n?at(n,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[a]=s;var fe=(n,a,s)=>rt(n,typeof a!="symbol"?a+"":a,s);import{R as it,$ as ke,r as x,t as T,j as e,D as Me,q as Ee,v as Ie,w as Ae,ad as nt,aC as ot,e as re,B as U,aD as ye,a as q,L as Se,I as ie,aE as lt,aF as Ne,aG as ct,p as ne,ac as dt,aH as mt,ay as ut,u as gt,S as ht,Q as pt,b as J,f as G,a1 as je,af as se,C as we,c as xt,d as vt,g as ft,h as yt,i as be,k as E,l as St,m as I,W as Nt,n as jt,F as wt,X as bt,P as Ct,V as Dt,y as Tt,J as kt,K as Mt,N as Et,aI as It}from"./index-CnqA2hW7.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=it("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);class Pt{constructor(){fe(this,"activeActivities",new Map)}async startActivity(a){const s=new Date().toISOString(),o=crypto.randomUUID(),i={...a,id:crypto.randomUUID(),createdAt:s,isActive:!0,sessionId:o,startTime:a.startTime||s};this.activeActivities.set(i.id,i);try{const c=localStorage.getItem("timeTrackingEvents"),d=c?JSON.parse(c):[];return d.push(i),localStorage.setItem("timeTrackingEvents",JSON.stringify(d)),console.log(`Started tracking: ${i.activityType} by ${i.employeeName}`),i.id}catch(c){return console.error("Error starting activity tracking:",c),i.id}}async endActivity(a,s){const o=this.activeActivities.get(a);if(!o)return console.warn(`Activity ${a} not found in active activities`),null;const i=new Date().toISOString(),c=new Date(o.startTime),d=new Date(i),m=Math.round((d.getTime()-c.getTime())/(1e3*60)),D=Math.round(m/60*100)/100;let v,w;o.estimatedDurationMinutes&&(v=Math.round((m-o.estimatedDurationMinutes)/o.estimatedDurationMinutes*100),v<=-20?w=5:v<=-10?w=4:v<=10?w=3:v<=25?w=2:w=1);const k={...o,...s,endTime:i,durationMinutes:m,durationHours:D,actualVsEstimated:v,efficiencyRating:w,updatedAt:i,isActive:!1};this.activeActivities.delete(a);try{const g=localStorage.getItem("timeTrackingEvents"),A=(g?JSON.parse(g):[]).map(u=>u.id===a?k:u);return localStorage.setItem("timeTrackingEvents",JSON.stringify(A)),console.log(`Completed tracking: ${k.activityType} by ${k.employeeName} - Duration: ${m}min`),k}catch(g){return console.error("Error ending activity tracking:",g),k}}async logCompletedActivity(a){const s=new Date(a.startTime),o=new Date(a.endTime),i=Math.round((o.getTime()-s.getTime())/(1e3*60)),c=Math.round(i/60*100)/100;let d,m;a.estimatedDurationMinutes&&(d=Math.round((i-a.estimatedDurationMinutes)/a.estimatedDurationMinutes*100),d<=-20?m=5:d<=-10?m=4:d<=10?m=3:d<=25?m=2:m=1);const D={...a,id:crypto.randomUUID(),createdAt:new Date().toISOString(),durationMinutes:i,durationHours:c,actualVsEstimated:d,efficiencyRating:m,isActive:!1};try{const v=localStorage.getItem("timeTrackingEvents"),w=v?JSON.parse(v):[];return w.push(D),localStorage.setItem("timeTrackingEvents",JSON.stringify(w)),console.log(`Logged completed activity: ${D.activityType} by ${D.employeeName} - Duration: ${i}min`),D.id}catch(v){return console.error("Error logging completed activity:",v),D.id}}getActiveActivities(a){const s=Array.from(this.activeActivities.values());return a?s.filter(o=>o.employeeName===a):s}async getEmployeePerformance(a,s,o){try{const i=localStorage.getItem("timeTrackingEvents");if(!i)return null;const d=JSON.parse(i).filter(u=>u.employeeName===a&&u.startTime>=s&&u.startTime<=o&&!u.isActive);if(d.length===0)return null;const m=d.reduce((u,V)=>u+(V.durationMinutes||0),0),D=Math.round(m/60*100)/100,v=Math.round(m/d.length),w=d.reduce((u,V)=>u+(V.efficiencyRating||3),0)/d.length,k={},g=new Set,b=new Set;let A=0;return d.forEach(u=>{u.carVin&&g.add(u.carVin),u.clientName&&b.add(u.clientName),u.efficiencyRating&&u.efficiencyRating>=3&&A++,k[u.activityType]||(k[u.activityType]={count:0,totalMinutes:0,averageMinutes:0,efficiencyScore:0});const V=k[u.activityType];V.count++,V.totalMinutes+=u.durationMinutes||0,V.efficiencyScore+=u.efficiencyRating||3}),Object.values(k).forEach(u=>{u.averageMinutes=Math.round(u.totalMinutes/u.count),u.efficiencyScore=u.efficiencyScore/u.count}),{employeeName:a,timePeriodd:{start:s,end:o},totalHours:D,totalMinutes:m,activitiesCompleted:d.length,averageActivityDuration:v,efficiencyScore:w,activitiesByType:k,carsWorkedOn:g.size,clientsServed:b.size,onTimePerformance:Math.round(A/d.length*100)}}catch(i){return console.error("Error getting employee performance:",i),null}}async getActivityAnalytics(a,s,o){try{const i=localStorage.getItem("timeTrackingEvents");if(!i)return null;const d=JSON.parse(i).filter(g=>g.activityType===a&&g.startTime>=s&&g.startTime<=o&&g.endTime!==null);if(d.length===0)return null;const m=d.map(g=>g.durationMinutes||0),D=m.reduce((g,b)=>g+b,0),v=Math.round(D/d.length),w={};d.forEach(g=>{w[g.employeeName]||(w[g.employeeName]={totalDuration:0,count:0,efficiencySum:0}),w[g.employeeName].totalDuration+=g.durationMinutes||0,w[g.employeeName].count++,w[g.employeeName].efficiencySum+=g.efficiencyRating||3});const k=Object.entries(w).map(([g,b])=>({employeeName:g,averageDuration:Math.round(b.totalDuration/b.count),totalActivities:b.count,efficiencyScore:b.efficiencySum/b.count})).sort((g,b)=>g.averageDuration-b.averageDuration);return{activityType:a,totalOccurrences:d.length,averageDurationMinutes:v,fastestDurationMinutes:Math.min(...m),slowestDurationMinutes:Math.max(...m),totalTimeSpentMinutes:D,employeeRankings:k}}catch(i){return console.error("Error getting activity analytics:",i),null}}async getAllTimeTrackingData(a,s){try{const o=localStorage.getItem("timeTrackingEvents");return o?JSON.parse(o).filter(d=>(!a||d.startTime>=a)&&(!s||d.startTime<s)):[]}catch(o){return console.error("Error getting time tracking data:",o),[]}}formatDuration(a){const s=Math.floor(a/60),o=a%60;return s>0?`${s}h ${o}m`:`${o}m`}calculateEfficiencyPercentage(a,s){return s===0?100:Math.round((s-a)/s*100)}}const B=new Pt,Ce={start:(n,a,s,o,i=!1)=>B.startActivity({employeeName:n,activityType:i?"test_drive_client":"test_drive_employee",activityDescription:`${i?"Client":"Employee"} test drive - ${s}${o?` for ${o}`:""}`,startTime:new Date().toISOString(),carVin:a,carModel:s,clientName:o,estimatedDurationMinutes:i?30:15,location:"Test Drive Route",department:"Sales"}),end:(n,a,s)=>B.endActivity(n,{notes:a,issues:s})},De={start:(n,a,s,o,i)=>B.startActivity({employeeName:n,activityType:"repair_start",activityDescription:`Repair: ${o} on ${s}`,startTime:new Date().toISOString(),carVin:a,carModel:s,estimatedDurationMinutes:i*60,location:"Garage",department:"Service"}),end:(n,a,s,o)=>B.endActivity(n,{partsUsed:a,toolsUsed:s,notes:o})},Ot={log:(n,a,s,o,i,c)=>{const d=new Date,m=new Date(d.getTime()-i*60*1e3);return B.logCompletedActivity({employeeName:n,activityType:"client_interaction",activityDescription:`${o} with ${a}`,startTime:m.toISOString(),endTime:d.toISOString(),clientName:a,clientPhone:s,carVin:c,location:"Showroom",department:"Sales"})}},$t=(n={})=>{const{user:a}=ke(),[s,o]=x.useState(!1),[i,c]=x.useState(null),[d,m]=x.useState(0),[D,v]=x.useState(null),{activityType:w,activityDescription:k,carVin:g,carModel:b,clientName:A,clientPhone:u,estimatedDurationMinutes:V,location:W="Workplace",department:K="General",autoTrack:_=!1,showNotifications:P=!0}=n;x.useEffect(()=>{let N;return s&&D&&(N=setInterval(()=>{const j=Math.floor((new Date().getTime()-D.getTime())/1e3);m(j)},1e3)),()=>{N&&clearInterval(N)}},[s,D]),x.useEffect(()=>{_&&w&&k&&!s&&a&&C()},[_,w,k,s,a]);const H=x.useCallback(N=>{const y=Math.floor(N/3600),j=Math.floor(N%3600/60),S=N%60;return y>0?`${y}:${j.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}`:`${j}:${S.toString().padStart(2,"0")}`},[]),C=x.useCallback(async(N={})=>{var j;if(!a)return console.error("User not authenticated for time tracking"),null;if(s)return console.warn("Activity tracking already in progress"),i;const y={...n,...N};if(!y.activityType||!y.activityDescription)return console.error("Activity type and description required for tracking"),null;try{const S=((j=a==null?void 0:a.user_metadata)==null?void 0:j.full_name)||a.email||"Unknown Employee",$=await B.startActivity({employeeName:S,employeeEmail:a.email,activityType:y.activityType,activityDescription:y.activityDescription,startTime:new Date().toISOString(),carVin:y.carVin,carModel:y.carModel,clientName:y.clientName,estimatedDurationMinutes:y.estimatedDurationMinutes,location:y.location,department:y.department});return c($),o(!0),v(new Date),m(0),P&&T({title:"Activity Tracking Started",description:`Now tracking: ${y.activityDescription}`,duration:3e3}),$}catch(S){return console.error("Error starting activity tracking:",S),P&&T({title:"Tracking Error",description:"Failed to start activity tracking",variant:"destructive"}),null}},[a,n,s,i,P]),O=x.useCallback(async(N,y)=>{if(!i||!s)return console.warn("No active activity to end"),null;try{const j=await B.endActivity(i,{notes:N,issues:y});return c(null),o(!1),v(null),m(0),P&&j&&T({title:"Activity Completed",description:`Completed in ${B.formatDuration(j.durationMinutes||0)}`,duration:5e3}),j}catch(j){return console.error("Error ending activity tracking:",j),P&&T({title:"Tracking Error",description:"Failed to end activity tracking",variant:"destructive"}),null}},[i,s,P]);return{isTracking:s,activeActivityId:i,elapsedTime:d,startTracking:C,endTracking:O,formatTime:H,trackTestDrive:{start:async(N=!1)=>{var j;if(!a||!g||!b)return console.error("Missing required data for test drive tracking"),null;const y=((j=a==null?void 0:a.user_metadata)==null?void 0:j.full_name)||a.email||"Unknown Employee";try{const S=await Ce.start(y,g,b,A,N);return c(S),o(!0),v(new Date),m(0),P&&T({title:"Test Drive Started",description:`${N?"Client":"Employee"} test drive tracking started`,duration:3e3}),S}catch(S){return console.error("Error starting test drive tracking:",S),null}},end:async(N,y)=>{if(!i)return null;try{const j=await Ce.end(i,N,y);return c(null),o(!1),v(null),m(0),j}catch(j){return console.error("Error ending test drive tracking:",j),null}}},trackRepair:{start:async(N,y)=>{var S;if(!a||!g||!b)return console.error("Missing required data for repair tracking"),null;const j=((S=a==null?void 0:a.user_metadata)==null?void 0:S.full_name)||a.email||"Unknown Employee";try{const $=await De.start(j,g,b,N,y);return c($),o(!0),v(new Date),m(0),P&&T({title:"Repair Tracking Started",description:`Repair tracking started: ${N}`,duration:3e3}),$}catch($){return console.error("Error starting repair tracking:",$),null}},end:async(N,y,j)=>{if(!i)return null;try{const S=await De.end(i,N,y,j);return c(null),o(!1),v(null),m(0),S}catch(S){return console.error("Error ending repair tracking:",S),null}}},trackClientInteraction:{log:async(N,y)=>{var S;if(!a||!A||!u)return console.error("Missing required data for client interaction tracking"),null;const j=((S=a==null?void 0:a.user_metadata)==null?void 0:S.full_name)||a.email||"Unknown Employee";try{const $=await Ot.log(j,A,u,N,y,g);return P&&T({title:"Client Interaction Logged",description:`${N} with ${A} (${y}min)`,duration:3e3}),$}catch($){return console.error("Error logging client interaction:",$),null}}}}},Rt=({isOpen:n,onClose:a,car:s,onStartTestDrive:o,onEndTestDrive:i,isClientTestDrive:c=!1})=>{var _,P,H;const{user:d}=ke(),[m,D]=x.useState(""),[v,w]=x.useState(""),[k,g]=x.useState(0),b=$t({activityType:c?"test_drive_client":"test_drive_employee",activityDescription:`${c?"Client":"Employee"} test drive - ${(s==null?void 0:s.model)||"Vehicle"}`,carVin:(s==null?void 0:s.vinNumber)||(s==null?void 0:s.vin),carModel:s==null?void 0:s.model,clientName:c?v:void 0,estimatedDurationMinutes:c?30:15,location:"Test Drive Route",department:"Sales",showNotifications:!1});x.useEffect(()=>{var O,p;let C;return(O=s==null?void 0:s.testDriveInfo)!=null&&O.isOnTestDrive&&((p=s==null?void 0:s.testDriveInfo)!=null&&p.testDriveStartTime)&&(C=setInterval(()=>{const L=new Date(s.testDriveInfo.testDriveStartTime),N=Math.floor((new Date().getTime()-L.getTime())/1e3);g(N)},1e3)),()=>{C&&clearInterval(C)}},[(_=s==null?void 0:s.testDriveInfo)==null?void 0:_.isOnTestDrive,(P=s==null?void 0:s.testDriveInfo)==null?void 0:P.testDriveStartTime]);const A=C=>{const O=Math.floor(C/3600),p=Math.floor(C%3600/60),L=C%60;return O>0?`${O}:${p.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`:`${p}:${L.toString().padStart(2,"0")}`},u=async()=>{if(!s)return;if(!m.trim()){T({title:"Employee Required",description:"Please enter the employee name.",variant:"destructive"});return}if(c&&!v.trim()){T({title:"Client Name Required",description:"Please enter the client name for client test drive.",variant:"destructive"});return}const C=new Date,O={isOnTestDrive:!0,testDriveStartTime:C.toISOString(),actualStartTime:C.toISOString(),scheduledStartTime:null,employeeName:m.trim(),clientName:c?v.trim():null,isClientTestDrive:c,loggedBy:(d==null?void 0:d.email)||"Unknown",loggedAt:C.toISOString(),vehicleVin:s.vinNumber||s.vin,vehicleModel:s.model,startMethod:"immediate",realTimeCapture:!0},p=await b.trackTestDrive.start(c);p&&console.log(`Started time tracking for test drive: ${p}`),o(s.id,O),T({title:"🚗 Test Drive Started - Real Time",description:`${c?"Client":"Employee"} test drive started NOW with ${m} at ${C.toLocaleTimeString()}`,duration:5e3}),D(""),w("")},V=async()=>{if(!m.trim()){T({title:"Employee Required",description:"Please enter the employee name first.",variant:"destructive"});return}if(c&&!v.trim()){T({title:"Client Name Required",description:"Please enter the client name first.",variant:"destructive"});return}await u()},W=async()=>{if(!s)return;const C=await b.trackTestDrive.end();C&&console.log(`Completed time tracking for test drive. Duration: ${C.durationMinutes} minutes`),i(s.id);const O=A(k);T({title:"Test Drive Completed",description:`Test drive completed. Duration: ${O}`}),a()};if(!s)return null;const K=(H=s.testDriveInfo)==null?void 0:H.isOnTestDrive;return e.jsx(Me,{open:n,onOpenChange:a,children:e.jsxs(Ee,{className:"max-w-2xl w-[95vw] max-h-[95vh] overflow-y-auto",children:[e.jsx(Ie,{className:"sticky top-0 bg-white z-10 border-b pb-4",children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[c?e.jsx(nt,{className:"h-5 w-5 text-blue-600"}):e.jsx(ot,{className:"h-5 w-5 text-orange-600"}),c?"Client":"Employee"," Test Drive"]})}),e.jsxs("div",{className:"space-y-4 px-1",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(re,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"font-medium text-sm",children:[s.model," (",s.year,")"]})]}),e.jsxs("div",{className:"text-xs text-gray-600 font-mono",children:["VIN: ",s.vinNumber||s.vin]})]}),K?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs(U,{className:"bg-green-100 text-green-800 border-green-300 px-4 py-2",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Test Drive Active - Real Time"]})}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg border-2 border-green-300",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Current Duration"}),e.jsx("div",{className:"text-4xl font-mono font-bold text-green-600",children:A(k)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Started: ",new Date(s.testDriveInfo.testDriveStartTime).toLocaleString()]})]}),e.jsxs("div",{className:"space-y-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Employee:"}),e.jsx("span",{children:s.testDriveInfo.employeeName})]}),s.testDriveInfo.clientName&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Client:"}),e.jsx("span",{children:s.testDriveInfo.clientName})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Actual Start:"}),e.jsx("span",{className:"font-mono text-green-600 font-semibold",children:new Date(s.testDriveInfo.testDriveStartTime).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Start Method:"}),e.jsx("span",{className:"text-green-600 font-semibold",children:s.testDriveInfo.startMethod==="immediate"?"🕐 Real-Time Capture":"Scheduled"})]})]}),e.jsxs(q,{onClick:W,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3",children:[e.jsx(At,{className:"h-4 w-4 mr-2"}),"End Test Drive & Calculate Duration"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Current Time"}),e.jsx("div",{className:"text-xl font-mono font-bold text-blue-600",children:new Date().toLocaleTimeString()}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date().toLocaleDateString()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Se,{htmlFor:"employeeName",children:[c?"Accompanying Employee":"Employee Name"," *"]}),e.jsx(ie,{id:"employeeName",value:m,onChange:C=>D(C.target.value),placeholder:"Enter employee name",className:"border-gray-300"})]}),c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Se,{htmlFor:"clientName",children:"Client Name *"}),e.jsx(ie,{id:"clientName",value:v,onChange:C=>w(C.target.value),placeholder:"Enter client name",className:"border-gray-300"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border-2 border-green-300",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"text-lg font-bold text-green-800",children:"Ready to Start Test Drive?"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Click below to capture the real start time"})]}),e.jsxs(q,{onClick:V,className:"w-full bg-green-600 hover:bg-green-700 text-white py-4 text-lg font-semibold",disabled:!m.trim()||c&&!v.trim(),children:[e.jsx(lt,{className:"h-5 w-5 mr-2"}),"🚗 Take Car Now - Start Real Time"]})]}),e.jsx("div",{className:"text-center",children:e.jsx(q,{onClick:u,variant:"outline",className:"text-sm",disabled:!m.trim()||c&&!v.trim(),children:"Or Schedule Test Drive"})})]}),e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-700",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Real-Time Tracking:"}),' When you click "Take Car Now", the system will capture the exact timestamp and start duration tracking automatically.']})]})})]})]})]})})},Vt=({isOpen:n,onClose:a,car:s,onMoveCar:o})=>{const i=[{id:"floor1",label:"Showroom Floor 1",description:"Move to main showroom floor 1",icon:Ne},{id:"floor2",label:"Showroom Floor 2",description:"Move to luxury showroom floor 2",icon:Ne},{id:"inventory",label:"Car Inventory",description:"Move to main car inventory storage",icon:ct},{id:"garage-schedule",label:"Garage Schedule",description:"Add to garage schedule for service/repair",icon:ne}];return e.jsx(Me,{open:n,onOpenChange:a,children:e.jsxs(Ee,{className:"sm:max-w-[400px]",children:[e.jsx(Ie,{children:e.jsxs(Ae,{children:["Move Car - ",s==null?void 0:s.model]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"VIN:"})," ",s==null?void 0:s.vinNumber]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Model:"})," ",s==null?void 0:s.model]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Color:"})," ",s==null?void 0:s.color]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Select destination:"}),i.map(c=>e.jsx(q,{variant:"outline",className:"w-full justify-start",onClick:()=>o(c.id),children:c.label},c.id))]})]}),e.jsx(dt,{children:e.jsx(q,{variant:"outline",onClick:a,children:"Cancel"})})]})})},Te=()=>{try{const n=localStorage.getItem("garageCars");if(n){const a=JSON.parse(n);return console.log(`Garage: Loaded ${a.length} cars from localStorage`),a}}catch(n){console.error("Error loading garage cars from localStorage:",n)}return[{id:"g-1",vinNumber:"1HGBH41JXMN109186",model:"Tesla Model 3",year:2024,color:"Pearl White",price:45e3,status:"in_stock",garageStatus:"stored",category:"EV",batteryPercentage:85,range:350,arrivalDate:"2024-01-15",currentFloor:"Garage",repairStatus:"in_progress",assignedMechanic:"John Smith",estimatedCompletion:"2024-01-20",repairNotes:"Electrical system check in progress",partsUsed:["Battery tester","Multimeter"],laborHours:2,lastModified:"2024-01-15T10:30:00Z"},{id:"g-2",vinNumber:"5YJSA1E47HF123456",model:"Tesla Model S",year:2024,color:"Midnight Silver",price:85e3,status:"in_stock",garageStatus:"stored",category:"EV",batteryPercentage:92,range:400,arrivalDate:"2024-01-16",currentFloor:"Garage",repairStatus:"pending",assignedMechanic:"Mike Johnson",estimatedCompletion:"2024-01-21",repairNotes:"Brake system inspection needed, customer reported squeaking",partsUsed:[],laborHours:0,lastModified:"2024-01-16T14:20:00Z"}]},ae=n=>{try{localStorage.setItem("garageCars",JSON.stringify(n)),console.log(`Garage: Saved ${n.length} cars to localStorage`)}catch(a){console.error("Error saving garage cars to localStorage:",a)}},Lt=()=>{const[n,a]=x.useState([]),[s,o]=x.useState(""),[i,c]=x.useState("All Models"),[d,m]=x.useState("All Status"),[D,v]=x.useState("All Categories"),[w,k]=x.useState(!1),[g,b]=x.useState(!1),[A,u]=x.useState(!1),[V,W]=x.useState(!1),[K,_]=x.useState(!1),[P,H]=x.useState(!1),[C,O]=x.useState(!1),[p,L]=x.useState(null),[Q,N]=x.useState(null),[y,j]=x.useState(null),[S,$]=x.useState(null),[oe,Pe]=x.useState(null),[R,Y]=x.useState(null),[le,Z]=x.useState(!1),[F,ee]=x.useState(null),te=mt();ut(),gt(),x.useEffect(()=>{localStorage.removeItem("garageCars"),localStorage.removeItem("garageInventory"),localStorage.removeItem("garageSchedule"),localStorage.removeItem("garageSchedules"),localStorage.removeItem("inventoryGarage");const t=Te();a(t)},[]);const Oe=()=>{const t=n.length,h=n.filter(M=>M.garageStatus==="in_repair"||M.status==="maintenance").length,r=n.filter(M=>M.repairStatus==="completed").length,l=n.filter(M=>M.repairStatus==="in_progress").length,f=n.filter(M=>M.repairStatus==="pending").length;return{totalCars:t,inRepair:h,completed:r,inProgress:l,pending:f}},$e=()=>n.filter(t=>{var he,pe,xe,ve;const h=s.toLowerCase(),r=(((he=t.vinNumber)==null?void 0:he.toLowerCase())||"").includes(h)||(((pe=t.model)==null?void 0:pe.toLowerCase())||"").includes(h)||(((xe=t.brand)==null?void 0:xe.toLowerCase())||"").includes(h)||(((ve=t.assignedMechanic)==null?void 0:ve.toLowerCase())||"").includes(h),l=i==="All Models"||t.model===i,f=d==="All Status"||t.status===d,M=D==="All Categories"||t.category===D;return r&&l&&f&&M}),ce=t=>{switch(t){case"in_stock":case"stored":return"bg-green-100 text-green-800 border-green-200";case"sold":return"bg-blue-100 text-blue-800 border-blue-200";case"reserved":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"maintenance":case"in_repair":return"bg-orange-100 text-orange-800 border-orange-200";case"completed":case"ready_for_pickup":return"bg-green-100 text-green-800 border-green-200";case"pending":case"awaiting_parts":return"bg-red-100 text-red-800 border-red-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},X=t=>{switch(t){case"in_stock":return"In Stock";case"stored":return"Stored";case"sold":return"Sold";case"reserved":return"Reserved";case"maintenance":return"Maintenance";case"in_repair":return"In Repair";case"completed":return"Completed";case"ready_for_pickup":return"Ready for Pickup";case"pending":return"Pending";case"awaiting_parts":return"Awaiting Parts";case"cancelled":return"Cancelled";default:return t.replace("_"," ").replace(/\b\w/g,h=>h.toUpperCase())}},Re=t=>{switch(t){case"EV":return"bg-blue-100 text-blue-800";case"REV":return"bg-green-100 text-green-800";case"ICEV":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},Ve=t=>{console.log("VIN scanned in garage:",t),T({title:"VIN Scanned",description:`VIN ${t} scanned successfully`})},Ue=t=>{L(t),_(!0)},_e=t=>{ee(t),Z(!0)},Le=(t,h)=>{if(!F)return;a(l=>l.filter(f=>f.id!==F.id));const r=n.filter(l=>l.id!==F.id);localStorage.setItem("garageCars",JSON.stringify(r)),T({title:"Car Moved Successfully",description:`${F.model} has been moved to ${t}.`}),Z(!1),ee(null)},Fe=(t,h)=>{a(l=>l.map(f=>f.id===t?{...f,...h,lastModified:new Date().toISOString()}:f));const r=n.map(l=>l.id===t?{...l,...h,lastModified:new Date().toISOString()}:l);localStorage.setItem("garageCars",JSON.stringify(r)),T({title:"Car Updated",description:"Car information has been updated successfully"})},Je=t=>{console.log("PDI clicked for car:",t),N(t),b(!0)},Ge=(t,h)=>{a(l=>l.map(f=>f.id===t?{...f,pdiCompleted:!0,pdiStatus:"completed",pdiTechnician:h.technician,pdiNotes:h.notes,pdiDate:new Date().toISOString(),lastModified:new Date().toISOString()}:f));const r=n.map(l=>l.id===t?{...l,pdiCompleted:!0,pdiStatus:"completed",pdiTechnician:h.technician,pdiNotes:h.notes,pdiDate:new Date().toISOString(),lastModified:new Date().toISOString()}:l);localStorage.setItem("garageCars",JSON.stringify(r)),T({title:"PDI Completed",description:"Pre-delivery inspection has been completed successfully"})},de=t=>{t.status==="sold"||t.status,Y(t),W(!0)},qe=(t,h,r)=>{a(f=>f.map(M=>M.id===t?{...M,status:h,clientName:(r==null?void 0:r.name)||M.clientName,clientPhone:(r==null?void 0:r.phone)||M.clientPhone,clientLicensePlate:(r==null?void 0:r.licensePlate)||M.clientLicensePlate,lastModified:new Date().toISOString()}:M));const l=n.map(f=>f.id===t?{...f,status:h,clientName:(r==null?void 0:r.name)||f.clientName,clientPhone:(r==null?void 0:r.phone)||f.clientPhone,clientLicensePlate:(r==null?void 0:r.licensePlate)||f.clientLicensePlate,lastModified:new Date().toISOString()}:f);localStorage.setItem("garageCars",JSON.stringify(l)),T({title:"Status Updated",description:`Car status has been updated to ${X(h)}`})},Be=t=>{Pe(t),O(!0)},He=(t,h)=>{a(l=>l.map(f=>f.id===t?{...f,...h,lastModified:new Date().toISOString()}:f));const r=n.map(l=>l.id===t?{...l,...h,lastModified:new Date().toISOString()}:l);ae(r),T({title:"Customs Updated",description:"Customs information has been updated successfully"})},me=(t,h)=>{const r=n.find(l=>l.id===t);r&&(j(r),u(!0))},ue=t=>{const h=n.find(l=>l.id===t);if(!h||!h.testDriveInfo)return;const r=n.map(l=>l.id===t?{...l,testDriveInfo:null}:l);a(r),ae(r),T({title:"Test Drive Completed",description:"Test drive has been completed and added to vehicle history."})},We=t=>{console.log("Software clicked for car:",t),$(t),H(!0)},ze=(t,h)=>{a(l=>l.map(f=>f.id===t?{...f,...h,lastModified:new Date().toISOString()}:f));const r=n.map(l=>l.id===t?{...l,...h,lastModified:new Date().toISOString()}:l);ae(r),T({title:"Software Updated",description:"Software information has been updated successfully"})},Ke=t=>{console.log("View Details clicked for car:",t),L(t),_(!0)},Qe=()=>{const t=Te();a(t),T({title:"Inventory Refreshed",description:"Garage inventory has been refreshed"})},Xe=()=>{T({title:"Export Started",description:"Garage inventory export has been initiated"})},Ye=()=>{te("/garage-schedule")},Ze=()=>{te("/repairs")},z=Oe(),ge=$e(),et=["All Models",...Array.from(new Set(n.map(t=>t.model)))],tt=["All Status",...Array.from(new Set(n.map(t=>t.status)))],st=["All Categories",...Array.from(new Set(n.map(t=>t.category)))];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Garage Inventory"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage cars currently in garage for repairs and maintenance"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{variant:"outline",onClick:Qe,children:[e.jsx(ht,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsx(q,{variant:"outline",onClick:Xe,children:"Export"}),e.jsxs(q,{onClick:()=>k(!0),children:[e.jsx(pt,{className:"h-4 w-4 mr-2"}),"Scan VIN"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(J,{children:e.jsxs(G,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Total Cars"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:z.totalCars}),e.jsx("p",{className:"text-sm text-gray-600",children:"In garage"})]})}),e.jsx(J,{children:e.jsxs(G,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"In Repair"})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:z.inRepair}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active repairs"})]})}),e.jsx(J,{children:e.jsxs(G,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"In Progress"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:z.inProgress}),e.jsx("p",{className:"text-sm text-gray-600",children:"Currently working"})]})}),e.jsx(J,{children:e.jsxs(G,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Completed"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:z.completed}),e.jsx("p",{className:"text-sm text-gray-600",children:"Finished today"})]})}),e.jsx(J,{children:e.jsxs(G,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Pending"})]}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:z.pending}),e.jsx("p",{className:"text-sm text-gray-600",children:"Waiting to start"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(J,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:-translate-y-1",onClick:Ye,children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Garage Schedule"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View work schedule"})]})]})})}),e.jsx(J,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:-translate-y-1",onClick:()=>te("/garage-schedule"),children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Daily Plan"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Full day overview"})]})]})})}),e.jsx(J,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 hover:-translate-y-1",onClick:Ze,children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Repairs"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage repairs"})]})]})})})]}),e.jsxs("div",{className:"form-container grid grid-cols-1 sm:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"form-col",children:e.jsx(ie,{id:"garageSearch",placeholder:"Search by VIN, model, or mechanic...",value:s,onChange:t=>o(t.target.value)})}),e.jsx("div",{className:"form-col",children:e.jsx("select",{id:"modelFilter",className:"form-element",value:i,onChange:t=>c(t.target.value),children:et.map(t=>e.jsx("option",{value:t,children:t},t))})}),e.jsx("div",{className:"form-col",children:e.jsx("select",{id:"statusFilter",className:"form-element",value:d,onChange:t=>m(t.target.value),children:tt.map(t=>e.jsx("option",{value:t,children:t==="All Status"?"All Status":X(t)},t))})}),e.jsx("div",{className:"form-col",children:e.jsx("select",{id:"categoryFilter",className:"form-element",value:D,onChange:t=>v(t.target.value),children:st.map(t=>e.jsx("option",{value:t,children:t},t))})})]}),e.jsxs(J,{children:[e.jsx(xt,{children:e.jsxs(vt,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Garage Cars Inventory",e.jsxs(U,{variant:"secondary",className:"ml-auto",children:[ge.length," cars"]})]})}),e.jsx(G,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(ft,{children:[e.jsx(yt,{children:e.jsxs(be,{children:[e.jsx(E,{children:"VIN"}),e.jsx(E,{children:"Model"}),e.jsx(E,{children:"Category"}),e.jsx(E,{children:"Year"}),e.jsx(E,{children:"Color"}),e.jsx(E,{children:"Color interior"}),e.jsx(E,{children:"Price"}),e.jsx(E,{children:"Status"}),e.jsx(E,{children:"Warranty Life"}),e.jsx(E,{children:"Battery"}),e.jsx(E,{children:"Range Capacity"}),e.jsx(E,{children:"Km Driven"}),e.jsx(E,{children:"Test Drive"}),e.jsx(E,{children:"PDI"}),e.jsx(E,{children:"Customs"}),e.jsx(E,{children:"Software Model"}),e.jsx(E,{children:"Actions"})]})}),e.jsx(St,{children:ge.map(t=>{var h;return e.jsxs(be,{children:[e.jsx(I,{className:"font-mono text-sm",children:t.vinNumber}),e.jsx(I,{className:"font-medium",children:t.model}),e.jsx(I,{children:e.jsx(U,{className:Re(t.category),children:t.category})}),e.jsx(I,{children:t.year||"N/A"}),e.jsx(I,{children:t.color}),e.jsx(I,{children:t.interiorColor||t.interior_color||"-"}),e.jsxs(I,{children:["$",t.price?t.price.toLocaleString():"0"]}),e.jsx(I,{children:t.status==="sold"||t.status==="reserved"?e.jsx(U,{className:`${ce(t.status)} cursor-pointer hover:opacity-80 transition-opacity`,onClick:r=>{r.preventDefault(),r.stopPropagation(),de(t)},title:"Click to view client information",children:X(t.status)}):e.jsx(U,{className:`${ce(t.status)} cursor-pointer hover:opacity-80 transition-opacity`,onClick:r=>{r.preventDefault(),r.stopPropagation(),de(t)},title:"Click to add client information",children:X(t.status)})}),e.jsx(I,{children:e.jsx(Nt,{warrantyStartDate:t.warrantyStartDate,warrantyEndDate:t.warrantyEndDate,warrantyMonthsRemaining:t.warrantyMonthsRemaining,warrantyDaysRemaining:t.warrantyDaysRemaining,warrantyStatus:t.warrantyStatus,compact:!0})}),e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(jt,{className:"h-4 w-4"}),t.batteryPercentage||0,"%"]})}),e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(wt,{className:"h-4 w-4"}),t.range||0," km"]})}),e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),t.mileage||t.kmDriven||0," km"]})}),e.jsx(I,{children:(h=t.testDriveInfo)!=null&&h.isOnTestDrive?e.jsx(U,{variant:"outline",className:"bg-blue-50 text-blue-600 cursor-pointer hover:bg-blue-100 transition-colors",onClick:r=>{r.preventDefault(),r.stopPropagation(),ue(t.id)},title:"Click to end test drive",children:"On Test Drive"}):t.status==="sold"||t.status==="reserved"?e.jsx(U,{variant:"outline",className:"bg-gray-50 text-gray-500",children:"Not Available"}):e.jsx(U,{variant:"outline",className:"bg-gray-50 text-gray-500 cursor-pointer hover:bg-blue-50 hover:text-blue-600 transition-colors",onClick:r=>{r.preventDefault(),r.stopPropagation(),me(t.id,{carModel:t.model,carVin:t.vinNumber})},title:"Click to schedule test drive",children:"Available"})}),e.jsx(I,{children:e.jsx("div",{className:"cursor-pointer",onClick:()=>Je(t),children:e.jsx(U,{variant:t.pdiCompleted?"default":"outline",className:`cursor-pointer hover:opacity-80 transition-opacity ${t.pdiCompleted?"bg-green-100 text-green-800 border-green-200":"bg-yellow-100 text-yellow-800 border-yellow-200"}`,children:t.pdiCompleted?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-1 text-lg",children:"☺"})," Complete"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-1 text-lg",children:"☹"})," Pending"]})})})}),e.jsx(I,{children:e.jsx(U,{variant:t.customs==="paid"?"default":"destructive",className:"cursor-pointer hover:opacity-80 transition-opacity active:scale-95",onClick:()=>Be(t),title:"Click to manage customs payment",children:t.customs==="paid"?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"mr-1 h-4 w-4"})," paid"]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"mr-1 h-4 w-4"})," ",t.customs||"not paid"]})})}),e.jsx(I,{children:e.jsx("div",{className:"flex items-center gap-1 text-xs cursor-pointer",onClick:()=>We(t),title:"Click to manage software updates",children:t.softwareVersion?e.jsxs(e.Fragment,{children:[e.jsxs(U,{variant:"outline",className:"text-xs hover:bg-blue-50 transition-colors",children:["v",t.softwareVersion]}),t.softwareLastUpdated&&e.jsx("span",{className:"text-gray-500",children:new Date(t.softwareLastUpdated).toLocaleDateString()})]}):e.jsx(U,{variant:"secondary",className:"text-xs text-yellow-700 bg-yellow-100 hover:bg-yellow-200 transition-colors",children:"Update Needed"})})}),e.jsx(I,{children:e.jsx(Ct,{options:[{value:"view",label:"View Details"},{value:"edit",label:"Edit Car"},{value:"move",label:"Move Car"}],onAction:r=>{r==="view"?Ke(t):r==="edit"?Ue(t):r==="move"&&_e(t)},id:`actions-${t.id}`,ariaLabel:`Actions for ${t.model} ${t.vinNumber}`})})]},t.id)})})]})})})]}),e.jsx(Dt,{isOpen:w,onClose:()=>k(!1),onVinScanned:Ve}),Q&&e.jsx(Tt,{isOpen:g,onClose:()=>b(!1),car:Q,onPdiComplete:Ge}),y&&e.jsx(Rt,{isOpen:A,onClose:()=>u(!1),car:y,onStartTestDrive:me,onEndTestDrive:ue}),R&&e.jsx(kt,{isOpen:V,onClose:()=>{W(!1),Y(null)},car:{id:R.id,model:R.model,vinNumber:R.vinNumber,brand:R.brand,year:R.year,color:R.color,status:R.status,clientName:R.clientName,clientPhone:R.clientPhone,clientLicensePlate:R.clientLicensePlate,sellingPrice:R.price,reservationDate:void 0,saleDate:void 0,notes:R.notes},onStatusUpdate:qe}),p&&e.jsx(Mt,{isOpen:K,onClose:()=>{_(!1),L(null)},car:{id:p.id,vinNumber:p.vinNumber,model:p.model,brand:p.brand,year:p.year,color:p.color,status:p.status,sellingPrice:p.price,arrivalDate:p.arrivalDate,currentFloor:p.currentFloor,customs:p.customs,notes:p.notes,clientName:p.clientName,clientPhone:p.clientPhone,clientLicensePlate:p.clientLicensePlate,pdiCompleted:p.pdiCompleted,pdiDate:p.pdiDate,pdiTechnician:p.pdiTechnician,pdiNotes:p.pdiNotes,batteryPercentage:p.batteryPercentage,range:p.range,testDriveInfo:p.testDriveInfo,lastUpdated:p.lastModified},onCarUpdate:Fe}),S&&e.jsx(Et,{isOpen:P,onClose:()=>{H(!1),$(null)},car:{vinNumber:S.vinNumber,model:S.model,currentVersion:S.softwareVersion,lastUpdated:S.softwareLastUpdated,lastUpdatedBy:S.softwareUpdateBy,notes:S.softwareUpdateNotes,needsUpdate:!S.softwareVersion,priority:S.softwareVersion?"medium":"critical"},onUpdateComplete:(t,h)=>{var l;const r=(l=n.find(f=>f.vinNumber===t))==null?void 0:l.id;r&&ze(r,h)}}),oe&&e.jsx(It,{open:C,onOpenChange:O,car:oe,onCustomsUpdate:He}),le&&F&&e.jsx(Vt,{isOpen:le,onClose:()=>{Z(!1),ee(null)},car:{id:F.id,model:F.model,vinNumber:F.vinNumber,color:F.color},onMoveCar:Le})]})};export{Lt as default};
